"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1424],{5022:function(e,t,r){r.d(t,{gb:function(){return o}});var i=r(7437);r(2265);var a=r(2169);function o(e){let{size:t="md",variant:r="spinner",className:o,text:n}=e,s={sm:"w-4 h-4",md:"w-6 h-6",lg:"w-8 h-8"},l={sm:"text-sm",md:"text-base",lg:"text-lg"};return"spinner"===r?(0,i.jsxs)("div",{className:(0,a.cn)("flex flex-col items-center justify-center",o),children:[(0,i.jsx)("div",{className:(0,a.cn)("animate-spin rounded-full border-2 border-gray-300 border-t-[#FF5A5F]",s[t])}),n&&(0,i.jsx)("p",{className:(0,a.cn)("mt-2 text-gray-600",l[t]),children:n})]}):"dots"===r?(0,i.jsxs)("div",{className:(0,a.cn)("flex flex-col items-center justify-center",o),children:[(0,i.jsx)("div",{className:"flex space-x-1",children:[0,1,2].map(e=>(0,i.jsx)("div",{className:(0,a.cn)("bg-[#FF5A5F] rounded-full animate-pulse","sm"===t?"w-2 h-2":"md"===t?"w-3 h-3":"w-4 h-4"),style:{animationDelay:"".concat(.2*e,"s"),animationDuration:"1.2s"}},e))}),n&&(0,i.jsx)("p",{className:(0,a.cn)("mt-2 text-gray-600",l[t]),children:n})]}):"pulse"===r?(0,i.jsxs)("div",{className:(0,a.cn)("flex flex-col items-center justify-center",o),children:[(0,i.jsx)("div",{className:(0,a.cn)("bg-[#FF5A5F] rounded-full animate-pulse",s[t])}),n&&(0,i.jsx)("p",{className:(0,a.cn)("mt-2 text-gray-600",l[t]),children:n})]}):null}},2169:function(e,t,r){r.d(t,{cn:function(){return o}});var i=r(7042),a=r(4769);function o(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.m6)((0,i.W)(t))}},8228:function(e,t,r){r.d(t,{a:function(){return o}});var i=r(4660),a=r(4810);let o=(0,i.Ue)()((0,a.tJ)((e,t)=>({user:null,token:null,refreshToken:null,isLoading:!1,isAuthenticated:!1,login:async(t,r)=>{e({isLoading:!0});try{var i,a,o,n;let s=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:t,password:r})}),l=await s.json();if(!s.ok||!l.success)throw Error(l.error||l.message||"登入失敗");let c={id:l.data.user.id,email:l.data.user.email,name:l.data.user.name,avatar:l.data.user.avatar,role:l.data.user.role.toLowerCase(),isEmailVerified:l.data.user.isEmailVerified,isKYCVerified:l.data.user.isKycVerified,createdAt:l.data.user.createdAt,permissions:l.data.user.permissions||[],profile:{phone:l.data.user.phone,bio:null===(i=l.data.user.userProfile)||void 0===i?void 0:i.bio,location:null===(a=l.data.user.userProfile)||void 0===a?void 0:a.location,languages:null===(o=l.data.user.userProfile)||void 0===o?void 0:o.languages,specialties:null===(n=l.data.user.userProfile)||void 0===n?void 0:n.specialties}};e({user:c,token:l.data.token,refreshToken:null,isAuthenticated:!0,isLoading:!1})}catch(t){throw e({isLoading:!1}),t}},register:async t=>{e({isLoading:!0});try{await new Promise(e=>setTimeout(e,1500));let r={id:Date.now().toString(),email:t.email,name:t.name,role:t.userType||"customer",isEmailVerified:!1,isKYCVerified:!1,createdAt:new Date().toISOString(),permissions:"guide"===t.userType?["user:read","guide:manage","booking:manage"]:["user:read","booking:create"],profile:{phone:t.phone}},i="mock-jwt-token-"+Date.now();e({user:r,token:i,refreshToken:"mock-refresh-token",isAuthenticated:!0,isLoading:!1})}catch(t){throw e({isLoading:!1}),t}},logout:async()=>{try{await fetch("/api/auth/logout",{method:"POST",credentials:"include"})}catch(e){}e({user:null,token:null,refreshToken:null,isAuthenticated:!1})},updateUser:async r=>{let{user:i,token:a}=t();if(!i||!a)throw Error("未登入");e({isLoading:!0});try{let t=await fetch("/api/users/profile",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify(r)});if(!t.ok)throw Error("更新失敗");let o=await t.json();e({user:{...i,...o},isLoading:!1})}catch(t){throw e({isLoading:!1}),t}},refreshAuth:async()=>{let{refreshToken:r}=t();if(r)try{let t=await fetch("/api/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:r})});if(!t.ok)throw Error("Token 刷新失敗");let i=await t.json();e({token:i.token,refreshToken:i.refreshToken})}catch(e){t().logout()}},initializeAuth:async()=>{try{let o=await fetch("/api/auth/me",{credentials:"include"});if(o.ok){let n=await o.json();if(n.success&&n.data.user){var t,r,i,a;let o={id:n.data.user.id,email:n.data.user.email,name:n.data.user.name,avatar:n.data.user.avatar,role:n.data.user.role.toLowerCase(),isEmailVerified:n.data.user.isEmailVerified,isKYCVerified:n.data.user.isKycVerified,createdAt:n.data.user.createdAt,permissions:n.data.user.permissions||[],profile:{phone:n.data.user.phone,bio:null===(t=n.data.user.userProfile)||void 0===t?void 0:t.bio,location:null===(r=n.data.user.userProfile)||void 0===r?void 0:r.location,languages:null===(i=n.data.user.userProfile)||void 0===i?void 0:i.languages,specialties:null===(a=n.data.user.userProfile)||void 0===a?void 0:a.specialties}};e({user:o,isAuthenticated:!0})}}}catch(e){}},setLoading:t=>{e({isLoading:t})},hasPermission:e=>{var r;let{user:i}=t();return!!i&&("GUIDE"===i.role||(null===(r=i.permissions)||void 0===r?void 0:r.includes(e))||!1)}}),{name:"guidee-auth",partialize:e=>({user:e.user,token:e.token,refreshToken:e.refreshToken,isAuthenticated:e.isAuthenticated})}))},4477:function(e,t,r){r.d(t,{v:function(){return o}});var i=r(4660),a=r(8228);let o=(0,i.Ue)((e,t)=>({currentBooking:null,bookingStep:"details",bookings:[],isLoading:!1,error:null,paymentIntent:null,isProcessingPayment:!1,initializeBooking:(t,r)=>{e({currentBooking:{serviceId:t,guideId:r,guests:2},bookingStep:"details",error:null})},updateBookingDetails:t=>{e(e=>({currentBooking:e.currentBooking?{...e.currentBooking,...t}:t}))},setBookingStep:t=>{e({bookingStep:t})},createBooking:async()=>{let{currentBooking:r}=t();if(!r)throw Error("沒有預訂資料");let{token:i}=a.a.getState();if(!i)throw Error("請先登入");e({isLoading:!0,error:null});try{let t=await fetch("/api/bookings",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(i)},body:JSON.stringify(r)});if(!t.ok)throw Error("建立預訂失敗");let a=await t.json();return e({paymentIntent:a.paymentIntent,bookingStep:"payment",isLoading:!1}),a.bookingId}catch(t){throw e({error:t instanceof Error?t.message:"建立預訂時發生錯誤",isLoading:!1}),t}},processPayment:async(t,r)=>{let{token:i}=a.a.getState();if(!i)throw Error("請先登入");e({isProcessingPayment:!0,error:null});try{let a=await fetch("/api/bookings/payment",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(i)},body:JSON.stringify({bookingId:t,paymentMethodId:r})});if(!a.ok)throw Error("支付處理失敗");let o=await a.json();if("succeeded"===o.status)e({bookingStep:"confirmation",isProcessingPayment:!1});else throw Error("支付未成功")}catch(t){throw e({error:t instanceof Error?t.message:"支付處理時發生錯誤",isProcessingPayment:!1}),t}},confirmBooking:async r=>{let{token:i}=a.a.getState();if(!i)throw Error("請先登入");e({isLoading:!0,error:null});try{if(!(await fetch("/api/bookings/".concat(r,"/confirm"),{method:"POST",headers:{Authorization:"Bearer ".concat(i)}})).ok)throw Error("確認預訂失敗");await t().fetchBookings(),e({isLoading:!1})}catch(t){throw e({error:t instanceof Error?t.message:"確認預訂時發生錯誤",isLoading:!1}),t}},cancelBooking:async(r,i)=>{let{token:o}=a.a.getState();if(!o)throw Error("請先登入");e({isLoading:!0,error:null});try{if(!(await fetch("/api/bookings/".concat(r,"/cancel"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(o)},body:JSON.stringify({reason:i})})).ok)throw Error("取消預訂失敗");await t().fetchBookings(),e({isLoading:!1})}catch(t){throw e({error:t instanceof Error?t.message:"取消預訂時發生錯誤",isLoading:!1}),t}},fetchBookings:async()=>{let{token:t}=a.a.getState();if(!t)throw Error("請先登入");e({isLoading:!0,error:null});try{let r=await fetch("/api/bookings",{headers:{Authorization:"Bearer ".concat(t)}});if(!r.ok)throw Error("獲取預訂列表失敗");let i=await r.json();e({bookings:i.bookings,isLoading:!1})}catch(t){e({error:t instanceof Error?t.message:"獲取預訂列表時發生錯誤",isLoading:!1})}},submitReview:async(r,i,o)=>{let{token:n}=a.a.getState();if(!n)throw Error("請先登入");e({isLoading:!0,error:null});try{if(!(await fetch("/api/bookings/".concat(r,"/review"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n)},body:JSON.stringify({rating:i,comment:o})})).ok)throw Error("提交評價失敗");await t().fetchBookings(),e({isLoading:!1})}catch(t){throw e({error:t instanceof Error?t.message:"提交評價時發生錯誤",isLoading:!1}),t}},clearCurrentBooking:()=>{e({currentBooking:null,bookingStep:"details",paymentIntent:null,error:null})},setError:t=>{e({error:t})}}))}}]);