"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[811,1248],{4563:function(e,t,a){a.d(t,{G:function(){return d},U:function(){return c}});var r=a(7437),s=a(2265),i=a(1541),n=a(2549),l=a(8438),o=a(2169);function c(e){let{value:t,onChange:a,multiple:l=!1,maxFiles:c=5,maxSize:d=5,accept:u="image/*",className:m,disabled:h=!1,label:f,description:g,required:p=!1}=e,[x,y]=s.useState(!1),[v,j]=s.useState([]),w=s.useRef(null);s.useEffect(()=>{t?j(Array.isArray(t)?t:[t]):j([])},[t]);let b=e=>{if(!e||h)return;let r=Array.from(e),s=[];for(let e of r){if(e.size>1048576*d){alert("檔案 ".concat(e.name," 超過 ").concat(d,"MB 限制"));continue}if(!e.type.startsWith("image/")){alert("檔案 ".concat(e.name," 不是有效的圖片格式"));continue}s.push(e)}if((Array.isArray(t)?t.length:t?1:0)+s.length>c){alert("最多只能上傳 ".concat(c," 個檔案"));return}let i=[];s.forEach(e=>{let t=URL.createObjectURL(e);i.push(t)}),l?a([...Array.isArray(t)?t:t?[t]:[],...i]):a(i[0]||"")},N=e=>{h||(l&&Array.isArray(t)?a(t.filter((t,a)=>a!==e)):a(""))};return(0,r.jsxs)("div",{className:(0,o.cn)("space-y-4",m),children:[f&&(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700",children:[f,p&&(0,r.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),(0,r.jsxs)("div",{className:(0,o.cn)("border-2 border-dashed rounded-lg p-6 transition-colors cursor-pointer",x?"border-[#FF5A5F] bg-red-50":"border-gray-300 hover:border-gray-400",h&&"opacity-50 cursor-not-allowed"),onDrop:e=>{e.preventDefault(),y(!1),b(e.dataTransfer.files)},onDragOver:e=>{e.preventDefault(),y(!0)},onDragLeave:()=>{y(!1)},onClick:()=>{var e;h||null===(e=w.current)||void 0===e||e.click()},children:[(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)(i.Z,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,r.jsx)("div",{className:"text-lg font-medium text-gray-900 mb-2",children:"點擊上傳或拖放檔案"}),g&&(0,r.jsx)("div",{className:"text-sm text-gray-500 mb-4",children:g}),(0,r.jsxs)("div",{className:"text-sm text-gray-500",children:["支援 JPG, PNG, GIF（最大 ",d,"MB）",l&&" \xb7 最多 ".concat(c," 個檔案")]})]}),(0,r.jsx)("input",{ref:w,type:"file",accept:u,multiple:l,onChange:e=>b(e.target.files),className:"hidden",disabled:h})]}),v.length>0&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("div",{className:"text-sm font-medium text-gray-700",children:"預覽"}),(0,r.jsx)("div",{className:(0,o.cn)("grid gap-4",l?"grid-cols-2 md:grid-cols-3 lg:grid-cols-4":"grid-cols-1"),children:v.map((e,t)=>(0,r.jsxs)("div",{className:"relative group",children:[(0,r.jsx)("div",{className:"aspect-square bg-gray-100 rounded-lg overflow-hidden",children:(0,r.jsx)("img",{src:e,alt:"預覽 ".concat(t+1),className:"w-full h-full object-cover"})}),!h&&(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),N(t)},className:"absolute top-2 right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:(0,r.jsx)(n.Z,{className:"w-4 h-4"})})]},t))})]})]})}function d(e){let{value:t,onChange:a,size:n="md",className:c,disabled:d=!1}=e,u=s.useRef(null),m=e=>{if(!e||0===e.length||d)return;let t=e[0];if(t){if(!t.type.startsWith("image/")){alert("請選擇圖片檔案");return}if(t.size>2097152){alert("檔案大小不能超過 2MB");return}a(URL.createObjectURL(t))}};return(0,r.jsxs)("div",{className:(0,o.cn)("space-y-2",c),children:[(0,r.jsx)("div",{className:"text-sm font-medium text-gray-700",children:"個人頭像"}),(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsxs)("div",{className:(0,o.cn)("relative rounded-full overflow-hidden bg-gray-100 border-2 border-gray-200",{sm:"w-16 h-16",md:"w-24 h-24",lg:"w-32 h-32"}[n],!d&&"cursor-pointer hover:border-gray-300"),onClick:()=>{var e;return!d&&(null===(e=u.current)||void 0===e?void 0:e.click())},children:[t?(0,r.jsx)("img",{src:t,alt:"頭像",className:"w-full h-full object-cover"}):(0,r.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,r.jsx)(l.Z,{className:"w-6 h-6 text-gray-400"})}),!d&&(0,r.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity",children:(0,r.jsx)(i.Z,{className:"w-4 h-4 text-white"})})]}),(0,r.jsxs)("div",{className:"text-sm text-gray-500",children:[(0,r.jsx)("div",{children:"建議尺寸 400x400px"}),(0,r.jsx)("div",{children:"檔案大小不超過 2MB"})]})]}),(0,r.jsx)("input",{ref:u,type:"file",accept:"image/*",onChange:e=>m(e.target.files),className:"hidden",disabled:d})]})}},5022:function(e,t,a){a.d(t,{gb:function(){return i}});var r=a(7437);a(2265);var s=a(2169);function i(e){let{size:t="md",variant:a="spinner",className:i,text:n}=e,l={sm:"w-4 h-4",md:"w-6 h-6",lg:"w-8 h-8"},o={sm:"text-sm",md:"text-base",lg:"text-lg"};return"spinner"===a?(0,r.jsxs)("div",{className:(0,s.cn)("flex flex-col items-center justify-center",i),children:[(0,r.jsx)("div",{className:(0,s.cn)("animate-spin rounded-full border-2 border-gray-300 border-t-[#FF5A5F]",l[t])}),n&&(0,r.jsx)("p",{className:(0,s.cn)("mt-2 text-gray-600",o[t]),children:n})]}):"dots"===a?(0,r.jsxs)("div",{className:(0,s.cn)("flex flex-col items-center justify-center",i),children:[(0,r.jsx)("div",{className:"flex space-x-1",children:[0,1,2].map(e=>(0,r.jsx)("div",{className:(0,s.cn)("bg-[#FF5A5F] rounded-full animate-pulse","sm"===t?"w-2 h-2":"md"===t?"w-3 h-3":"w-4 h-4"),style:{animationDelay:"".concat(.2*e,"s"),animationDuration:"1.2s"}},e))}),n&&(0,r.jsx)("p",{className:(0,s.cn)("mt-2 text-gray-600",o[t]),children:n})]}):"pulse"===a?(0,r.jsxs)("div",{className:(0,s.cn)("flex flex-col items-center justify-center",i),children:[(0,r.jsx)("div",{className:(0,s.cn)("bg-[#FF5A5F] rounded-full animate-pulse",l[t])}),n&&(0,r.jsx)("p",{className:(0,s.cn)("mt-2 text-gray-600",o[t]),children:n})]}):null}},7290:function(e,t,a){a.d(t,{pm:function(){return o}}),a(7437);var r=a(2265),s=a(3008),i=a(1981),n=a(2894),l=a(4056);function o(){let[e,t]=(0,r.useState)([]),a=e=>{let a=Math.random().toString(36).substr(2,9),r={id:a,duration:5e3,...e};return t(e=>[...e,r]),a};return{toasts:e,addToast:a,removeToast:e=>{t(t=>t.filter(t=>t.id!==e))},success:(e,t)=>a({type:"success",title:e,message:t}),error:(e,t)=>a({type:"error",title:e,message:t}),warning:(e,t)=>a({type:"warning",title:e,message:t}),info:(e,t)=>a({type:"info",title:e,message:t})}}s.Z,i.Z,n.Z,l.Z},2169:function(e,t,a){a.d(t,{cn:function(){return i}});var r=a(7042),s=a(4769);function i(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,s.m6)((0,r.W)(t))}},8228:function(e,t,a){a.d(t,{a:function(){return i}});var r=a(4660),s=a(4810);let i=(0,r.Ue)()((0,s.tJ)((e,t)=>({user:null,token:null,refreshToken:null,isLoading:!1,isAuthenticated:!1,login:async(t,a)=>{e({isLoading:!0});try{var r,s,i,n;let l=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:t,password:a})}),o=await l.json();if(!l.ok||!o.success)throw Error(o.error||o.message||"登入失敗");let c={id:o.data.user.id,email:o.data.user.email,name:o.data.user.name,avatar:o.data.user.avatar,role:o.data.user.role.toLowerCase(),isEmailVerified:o.data.user.isEmailVerified,isKYCVerified:o.data.user.isKycVerified,createdAt:o.data.user.createdAt,permissions:o.data.user.permissions||[],profile:{phone:o.data.user.phone,bio:null===(r=o.data.user.userProfile)||void 0===r?void 0:r.bio,location:null===(s=o.data.user.userProfile)||void 0===s?void 0:s.location,languages:null===(i=o.data.user.userProfile)||void 0===i?void 0:i.languages,specialties:null===(n=o.data.user.userProfile)||void 0===n?void 0:n.specialties}};e({user:c,token:o.data.token,refreshToken:null,isAuthenticated:!0,isLoading:!1})}catch(t){throw e({isLoading:!1}),t}},register:async t=>{e({isLoading:!0});try{await new Promise(e=>setTimeout(e,1500));let a={id:Date.now().toString(),email:t.email,name:t.name,role:t.userType||"customer",isEmailVerified:!1,isKYCVerified:!1,createdAt:new Date().toISOString(),permissions:"guide"===t.userType?["user:read","guide:manage","booking:manage"]:["user:read","booking:create"],profile:{phone:t.phone}},r="mock-jwt-token-"+Date.now();e({user:a,token:r,refreshToken:"mock-refresh-token",isAuthenticated:!0,isLoading:!1})}catch(t){throw e({isLoading:!1}),t}},logout:async()=>{try{await fetch("/api/auth/logout",{method:"POST",credentials:"include"})}catch(e){}e({user:null,token:null,refreshToken:null,isAuthenticated:!1})},updateUser:async a=>{let{user:r,token:s}=t();if(!r||!s)throw Error("未登入");e({isLoading:!0});try{let t=await fetch("/api/users/profile",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s)},body:JSON.stringify(a)});if(!t.ok)throw Error("更新失敗");let i=await t.json();e({user:{...r,...i},isLoading:!1})}catch(t){throw e({isLoading:!1}),t}},refreshAuth:async()=>{let{refreshToken:a}=t();if(a)try{let t=await fetch("/api/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:a})});if(!t.ok)throw Error("Token 刷新失敗");let r=await t.json();e({token:r.token,refreshToken:r.refreshToken})}catch(e){t().logout()}},initializeAuth:async()=>{try{let i=await fetch("/api/auth/me",{credentials:"include"});if(i.ok){let n=await i.json();if(n.success&&n.data.user){var t,a,r,s;let i={id:n.data.user.id,email:n.data.user.email,name:n.data.user.name,avatar:n.data.user.avatar,role:n.data.user.role.toLowerCase(),isEmailVerified:n.data.user.isEmailVerified,isKYCVerified:n.data.user.isKycVerified,createdAt:n.data.user.createdAt,permissions:n.data.user.permissions||[],profile:{phone:n.data.user.phone,bio:null===(t=n.data.user.userProfile)||void 0===t?void 0:t.bio,location:null===(a=n.data.user.userProfile)||void 0===a?void 0:a.location,languages:null===(r=n.data.user.userProfile)||void 0===r?void 0:r.languages,specialties:null===(s=n.data.user.userProfile)||void 0===s?void 0:s.specialties}};e({user:i,isAuthenticated:!0})}}}catch(e){}},setLoading:t=>{e({isLoading:t})},hasPermission:e=>{var a;let{user:r}=t();return!!r&&("admin"===r.role||(null===(a=r.permissions)||void 0===a?void 0:a.includes(e))||!1)}}),{name:"guidee-auth",partialize:e=>({user:e.user,token:e.token,refreshToken:e.refreshToken,isAuthenticated:e.isAuthenticated})}))}}]);