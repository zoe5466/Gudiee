"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1248],{5022:function(e,a,t){t.d(a,{gb:function(){return s}});var i=t(7437);t(2265);var r=t(2169);function s(e){let{size:a="md",variant:t="spinner",className:s,text:n}=e,o={sm:"w-4 h-4",md:"w-6 h-6",lg:"w-8 h-8"},l={sm:"text-sm",md:"text-base",lg:"text-lg"};return"spinner"===t?(0,i.jsxs)("div",{className:(0,r.cn)("flex flex-col items-center justify-center",s),children:[(0,i.jsx)("div",{className:(0,r.cn)("animate-spin rounded-full border-2 border-gray-300 border-t-[#FF5A5F]",o[a])}),n&&(0,i.jsx)("p",{className:(0,r.cn)("mt-2 text-gray-600",l[a]),children:n})]}):"dots"===t?(0,i.jsxs)("div",{className:(0,r.cn)("flex flex-col items-center justify-center",s),children:[(0,i.jsx)("div",{className:"flex space-x-1",children:[0,1,2].map(e=>(0,i.jsx)("div",{className:(0,r.cn)("bg-[#FF5A5F] rounded-full animate-pulse","sm"===a?"w-2 h-2":"md"===a?"w-3 h-3":"w-4 h-4"),style:{animationDelay:"".concat(.2*e,"s"),animationDuration:"1.2s"}},e))}),n&&(0,i.jsx)("p",{className:(0,r.cn)("mt-2 text-gray-600",l[a]),children:n})]}):"pulse"===t?(0,i.jsxs)("div",{className:(0,r.cn)("flex flex-col items-center justify-center",s),children:[(0,i.jsx)("div",{className:(0,r.cn)("bg-[#FF5A5F] rounded-full animate-pulse",o[a])}),n&&(0,i.jsx)("p",{className:(0,r.cn)("mt-2 text-gray-600",l[a]),children:n})]}):null}},7290:function(e,a,t){t.d(a,{pm:function(){return l}}),t(7437);var i=t(2265),r=t(3008),s=t(1981),n=t(2894),o=t(4056);function l(){let[e,a]=(0,i.useState)([]),t=e=>{let t=Math.random().toString(36).substr(2,9),i={id:t,duration:5e3,...e};return a(e=>[...e,i]),t};return{toasts:e,addToast:t,removeToast:e=>{a(a=>a.filter(a=>a.id!==e))},success:(e,a)=>t({type:"success",title:e,message:a}),error:(e,a)=>t({type:"error",title:e,message:a}),warning:(e,a)=>t({type:"warning",title:e,message:a}),info:(e,a)=>t({type:"info",title:e,message:a})}}r.Z,s.Z,n.Z,o.Z},2169:function(e,a,t){t.d(a,{cn:function(){return s}});var i=t(7042),r=t(4769);function s(){for(var e=arguments.length,a=Array(e),t=0;t<e;t++)a[t]=arguments[t];return(0,r.m6)((0,i.W)(a))}},8228:function(e,a,t){t.d(a,{a:function(){return s}});var i=t(4660),r=t(4810);let s=(0,i.Ue)()((0,r.tJ)((e,a)=>({user:null,token:null,refreshToken:null,isLoading:!1,isAuthenticated:!1,login:async(a,t)=>{e({isLoading:!0});try{var i,r,s,n;let o=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:a,password:t})}),l=await o.json();if(!o.ok||!l.success)throw Error(l.error||l.message||"登入失敗");let d={id:l.data.user.id,email:l.data.user.email,name:l.data.user.name,avatar:l.data.user.avatar,role:l.data.user.role.toLowerCase(),isEmailVerified:l.data.user.isEmailVerified,isKYCVerified:l.data.user.isKycVerified,createdAt:l.data.user.createdAt,permissions:l.data.user.permissions||[],profile:{phone:l.data.user.phone,bio:null===(i=l.data.user.userProfile)||void 0===i?void 0:i.bio,location:null===(r=l.data.user.userProfile)||void 0===r?void 0:r.location,languages:null===(s=l.data.user.userProfile)||void 0===s?void 0:s.languages,specialties:null===(n=l.data.user.userProfile)||void 0===n?void 0:n.specialties}};e({user:d,token:l.data.token,refreshToken:null,isAuthenticated:!0,isLoading:!1})}catch(a){throw e({isLoading:!1}),a}},register:async a=>{e({isLoading:!0});try{await new Promise(e=>setTimeout(e,1500));let t={id:Date.now().toString(),email:a.email,name:a.name,role:a.userType||"customer",isEmailVerified:!1,isKYCVerified:!1,createdAt:new Date().toISOString(),permissions:"guide"===a.userType?["user:read","guide:manage","booking:manage"]:["user:read","booking:create"],profile:{phone:a.phone}},i="mock-jwt-token-"+Date.now();e({user:t,token:i,refreshToken:"mock-refresh-token",isAuthenticated:!0,isLoading:!1})}catch(a){throw e({isLoading:!1}),a}},logout:async()=>{try{await fetch("/api/auth/logout",{method:"POST",credentials:"include"})}catch(e){}e({user:null,token:null,refreshToken:null,isAuthenticated:!1})},updateUser:async t=>{let{user:i,token:r}=a();if(!i||!r)throw Error("未登入");e({isLoading:!0});try{let a=await fetch("/api/users/profile",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)},body:JSON.stringify(t)});if(!a.ok)throw Error("更新失敗");let s=await a.json();e({user:{...i,...s},isLoading:!1})}catch(a){throw e({isLoading:!1}),a}},refreshAuth:async()=>{let{refreshToken:t}=a();if(t)try{let a=await fetch("/api/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:t})});if(!a.ok)throw Error("Token 刷新失敗");let i=await a.json();e({token:i.token,refreshToken:i.refreshToken})}catch(e){a().logout()}},initializeAuth:async()=>{try{let s=await fetch("/api/auth/me",{credentials:"include"});if(s.ok){let n=await s.json();if(n.success&&n.data.user){var a,t,i,r;let s={id:n.data.user.id,email:n.data.user.email,name:n.data.user.name,avatar:n.data.user.avatar,role:n.data.user.role.toLowerCase(),isEmailVerified:n.data.user.isEmailVerified,isKYCVerified:n.data.user.isKycVerified,createdAt:n.data.user.createdAt,permissions:n.data.user.permissions||[],profile:{phone:n.data.user.phone,bio:null===(a=n.data.user.userProfile)||void 0===a?void 0:a.bio,location:null===(t=n.data.user.userProfile)||void 0===t?void 0:t.location,languages:null===(i=n.data.user.userProfile)||void 0===i?void 0:i.languages,specialties:null===(r=n.data.user.userProfile)||void 0===r?void 0:r.specialties}};e({user:s,isAuthenticated:!0})}}}catch(e){}},setLoading:a=>{e({isLoading:a})},hasPermission:e=>{var t;let{user:i}=a();return!!i&&("GUIDE"===i.role||(null===(t=i.permissions)||void 0===t?void 0:t.includes(e))||!1)}}),{name:"guidee-auth",partialize:e=>({user:e.user,token:e.token,refreshToken:e.refreshToken,isAuthenticated:e.isAuthenticated})}))}}]);