(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3471],{2240:function(e,t,s){Promise.resolve().then(s.bind(s,5865))},5865:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return b}});var r=s(7437),l=s(2265),a=s(4033),n=s(3067),i=s(2549),c=s(2245),d=s(9883),o=s(4891),x=s(1541),m=s(8228);function u(e){let{bookingId:t,serviceId:s,serviceName:a,guideName:n,guideId:u,onSubmit:h,onCancel:g,onClose:b,isLoading:p=!1,className:j=""}=e,{user:f}=(0,m.a)(),[y,v]=(0,l.useState)(0),[N,w]=(0,l.useState)(0),[k,C]=(0,l.useState)(""),[I,S]=(0,l.useState)([]),[Z,L]=(0,l.useState)([""]),[T,_]=(0,l.useState)([""]),[R,D]=(0,l.useState)(!1),[E,O]=(0,l.useState)([]),[U,A]=(0,l.useState)(!1),F=(0,l.useRef)(null),P=e=>{S(t=>t.filter((t,s)=>s!==e))},W=e=>{"pros"===e?L(e=>[...e,""]):_(e=>[...e,""])},M=(e,t)=>{"pros"===e?L(e=>e.filter((e,s)=>s!==t)):_(e=>e.filter((e,s)=>s!==t))},z=(e,t,s)=>{"pros"===e?L(e=>e.map((e,r)=>r===t?s:e)):_(e=>e.map((e,r)=>r===t?s:e))},V=e=>{O(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},$=async e=>{if(e.preventDefault(),!f){alert("請先登入");return}if(0===y){alert("請選擇評分");return}if(k.trim().length<10){alert("評論內容至少需要 10 個字符");return}A(!0);try{await h({serviceId:s,guideId:u,userId:f.id,bookingId:t,rating:y,comment:k.trim(),photos:I.map(e=>URL.createObjectURL(e)),pros:Z.filter(e=>e.trim()).length>0?Z.filter(e=>e.trim()):void 0,cons:T.filter(e=>e.trim()).length>0?T.filter(e=>e.trim()):void 0,isVerified:!0,isAnonymous:R,helpful:0,reported:0,tags:E.length>0?E:void 0}),alert("評論提交成功！感謝您的寶貴意見！"),null==b||b()}catch(e){alert("提交失敗，請稍後再試")}finally{A(!1)}},q=y>0&&k.trim().length>=10&&!U;return(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-lg border p-6 ".concat(j),children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:"撰寫評論"}),b&&(0,r.jsx)("button",{onClick:b,className:"p-1 text-gray-400 hover:text-gray-600 rounded-full hover:bg-gray-100",children:(0,r.jsx)(i.Z,{className:"w-5 h-5"})})]}),(0,r.jsxs)("form",{onSubmit:$,className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:["整體評分 ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[[1,2,3,4,5].map(e=>(0,r.jsx)("button",{type:"button",onMouseEnter:()=>w(e),onMouseLeave:()=>w(0),onClick:()=>v(e),className:"p-1 transition-transform hover:scale-110",children:(0,r.jsx)(c.Z,{className:"w-8 h-8 ".concat(e<=(N||y)?"text-yellow-400 fill-yellow-400":"text-gray-300")})},e)),(0,r.jsx)("span",{className:"ml-3 text-sm text-gray-600",children:y>0&&(0,r.jsxs)(r.Fragment,{children:[y," 星 - ",5===y?"極好":4===y?"很好":3===y?"一般":2===y?"不好":"很差"]})})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["詳細評論 ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("textarea",{value:k,onChange:e=>C(e.target.value),placeholder:"請分享您的體驗，幫助其他旅客了解這項服務...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:4,minLength:10,maxLength:1e3}),(0,r.jsxs)("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[(0,r.jsx)("span",{children:"最少 10 個字符"}),(0,r.jsxs)("span",{children:[k.length,"/1000"]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"服務特色標籤"}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:["專業","準時","親切","知識豐富","溝通良好","行程豐富","價格合理","服務周到","安全可靠","幽默風趣","攝影技術好","語言能力強"].map(e=>(0,r.jsx)("button",{type:"button",onClick:()=>V(e),className:"px-3 py-1 rounded-full text-sm border transition-colors ".concat(E.includes(e)?"bg-blue-100 border-blue-300 text-blue-700":"bg-gray-50 border-gray-200 text-gray-700 hover:bg-gray-100"),children:e},e))})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"服務優點"}),(0,r.jsxs)("button",{type:"button",onClick:()=>W("pros"),className:"flex items-center gap-1 text-sm text-blue-600 hover:text-blue-800",children:[(0,r.jsx)(d.Z,{className:"w-4 h-4"}),"新增"]})]}),(0,r.jsx)("div",{className:"space-y-2",children:Z.map((e,t)=>(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("input",{type:"text",value:e,onChange:e=>z("pros",t,e.target.value),placeholder:"例如：導遊很專業",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),Z.length>1&&(0,r.jsx)("button",{type:"button",onClick:()=>M("pros",t),className:"p-2 text-gray-400 hover:text-red-600",children:(0,r.jsx)(o.Z,{className:"w-4 h-4"})})]},t))})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"改進建議"}),(0,r.jsxs)("button",{type:"button",onClick:()=>W("cons"),className:"flex items-center gap-1 text-sm text-blue-600 hover:text-blue-800",children:[(0,r.jsx)(d.Z,{className:"w-4 h-4"}),"新增"]})]}),(0,r.jsx)("div",{className:"space-y-2",children:T.map((e,t)=>(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("input",{type:"text",value:e,onChange:e=>z("cons",t,e.target.value),placeholder:"例如：時間安排可以更彈性",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),T.length>1&&(0,r.jsx)("button",{type:"button",onClick:()=>M("cons",t),className:"p-2 text-gray-400 hover:text-red-600",children:(0,r.jsx)(o.Z,{className:"w-4 h-4"})})]},t))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"上傳照片 (最多 5 張)"}),(0,r.jsxs)("div",{className:"space-y-3",children:[I.length>0&&(0,r.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-3",children:I.map((e,t)=>(0,r.jsxs)("div",{className:"relative group",children:[(0,r.jsx)("img",{src:URL.createObjectURL(e),alt:"評論照片 ".concat(t+1),className:"w-full h-20 object-cover rounded-lg border"}),(0,r.jsx)("button",{type:"button",onClick:()=>P(t),className:"absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:(0,r.jsx)(i.Z,{className:"w-3 h-3"})})]},t))}),I.length<5&&(0,r.jsxs)("button",{type:"button",onClick:()=>{var e;return null===(e=F.current)||void 0===e?void 0:e.click()},className:"w-full border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-400 hover:bg-blue-50 transition-colors",children:[(0,r.jsx)(x.Z,{className:"w-6 h-6 mx-auto mb-2 text-gray-400"}),(0,r.jsxs)("span",{className:"text-sm text-gray-600",children:["點擊上傳照片 (",I.length,"/5)"]})]}),(0,r.jsx)("input",{ref:F,type:"file",multiple:!0,accept:"image/*",onChange:e=>{let t=Array.from(e.target.files||[]).filter(e=>e.type.startsWith("image/"));if(t.length+I.length>5){alert("最多只能上傳 5 張照片");return}S(e=>[...e,...t])},className:"hidden"})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("input",{type:"checkbox",id:"anonymous",checked:R,onChange:e=>D(e.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,r.jsx)("label",{htmlFor:"anonymous",className:"text-sm text-gray-700",children:"匿名發布評論"})]}),(0,r.jsxs)("div",{className:"flex gap-3 pt-4 border-t",children:[b&&(0,r.jsx)("button",{type:"button",onClick:b,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors",children:"取消"}),(0,r.jsx)("button",{type:"submit",disabled:!q,className:"flex-1 px-4 py-2 rounded-md font-medium transition-colors ".concat(q?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:U?"提交中...":"發布評論"})]})]})]})}var h=s(8982),g=s(4477);function b(){let e=(0,a.useRouter)(),t=(0,a.useParams)(),{user:s}=(0,m.a)(),{bookings:i}=(0,g.v)(),c=t.id,[d,o]=(0,l.useState)(!0),x=i.find(e=>e.id===c)||{id:c,serviceId:"service-1",guideId:"guide-1",status:"completed",details:{serviceId:"service-1",guideId:"guide-1",date:new Date("2024-01-15"),time:"09:00",guests:2,duration:4,contactInfo:{name:"張小明",email:"ming@example.com",phone:"0912345678"}},pricing:{basePrice:2e3,serviceFee:200,total:2200,currency:"TWD"},payment:{method:"credit_card",status:"completed"},createdAt:"2024-01-10T10:00:00Z",updatedAt:"2024-01-15T14:00:00Z",travelerId:(null==s?void 0:s.id)||"user-1"},b=()=>{o(!1)};return s?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4 mb-8",children:[(0,r.jsx)("button",{onClick:()=>e.back(),className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-full",children:(0,r.jsx)(n.Z,{className:"w-5 h-5"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"撰寫評論"}),(0,r.jsx)("p",{className:"text-gray-600",children:"分享您的體驗，幫助其他旅客"})]})]}),(0,r.jsx)("div",{className:"bg-white rounded-lg border p-6 mb-8",children:(0,r.jsxs)("div",{className:"flex items-start gap-4",children:[(0,r.jsx)("div",{className:"w-20 h-20 bg-gray-200 rounded-lg flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-gray-500 text-sm",children:"服務圖片"})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"台北市區導覽服務"}),(0,r.jsxs)("div",{className:"space-y-1 text-sm text-gray-600",children:[(0,r.jsxs)("p",{children:["預訂編號：",x.id]}),(0,r.jsxs)("p",{children:["服務日期：",x.details.date.toLocaleDateString("zh-TW")]}),(0,r.jsxs)("p",{children:["服務時間：",x.details.time]}),(0,r.jsxs)("p",{children:["參與人數：",x.details.guests," 人"]}),(0,r.jsxs)("p",{children:["服務時長：",x.details.duration," 小時"]})]})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsxs)("div",{className:"text-lg font-bold text-gray-900",children:["NT$ ",x.pricing.total.toLocaleString()]}),(0,r.jsxs)("div",{className:"text-sm text-green-600 flex items-center gap-1",children:[(0,r.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),"已完成"]})]})]})}),d&&(0,r.jsx)("div",{className:"mb-8",children:(0,r.jsx)(u,{serviceId:x.serviceId,guideId:x.guideId,bookingId:x.id,serviceName:"服務",guideName:"導遊",onSubmit:async e=>{b()},onCancel:b,onClose:b})}),!d&&(0,r.jsxs)("div",{className:"bg-white rounded-lg border p-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"其他用戶的評價"}),(0,r.jsx)(h.j,{targetId:x.serviceId,targetType:"service",showTitle:!1,showStatistics:!1,maxItems:5}),(0,r.jsx)("div",{className:"mt-6 pt-6 border-t text-center",children:(0,r.jsx)("button",{onClick:()=>e.push("/services/".concat(x.serviceId,"#reviews")),className:"text-blue-600 hover:text-blue-800 font-medium",children:"查看所有評論"})})]}),(0,r.jsxs)("div",{className:"flex gap-4 mt-8",children:[(0,r.jsx)("button",{onClick:()=>e.push("/bookings"),className:"flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"返回預訂列表"}),!d&&(0,r.jsx)("button",{onClick:()=>o(!0),className:"flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"重新撰寫評論"})]})]})}):(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"請先登入"}),(0,r.jsx)("button",{onClick:()=>e.push("/auth/login"),className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"前往登入"})]})})}}},function(e){e.O(0,[1216,1424,8982,1744],function(){return e(e.s=2240)}),_N_E=e.O()}]);