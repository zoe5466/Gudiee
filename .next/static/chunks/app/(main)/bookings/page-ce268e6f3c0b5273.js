(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1752],{5523:function(e,s,t){Promise.resolve().then(t.bind(t,4802))},4802:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return N}});var a=t(7437),l=t(2265),r=t(4033),n=t(2482),c=t(3523),i=t(8203),d=t(6141),o=t(5750),x=t(6142),m=t(2176),g=t(2245),u=t(8228),h=t(4477),b=t(7290),j=t(5022);function N(){let e=(0,r.useRouter)(),{user:s,isAuthenticated:t}=(0,u.a)(),{bookings:N,isLoading:f,error:p,fetchBookings:y,cancelBooking:w}=(0,h.v)(),{success:v,error:E}=(0,b.pm)(),[C,D]=(0,l.useState)("all"),[F,k]=(0,l.useState)("newest"),[Z,T]=(0,l.useState)(!1);(0,l.useEffect)(()=>{if(!t){e.push("/login");return}y()},[t,y,e]),(0,l.useEffect)(()=>{p&&E("載入失敗",p)},[p,E]);let A=N.filter(e=>"all"===C||e.status===C||e.status===C.toLowerCase()).sort((e,s)=>{switch(F){case"oldest":return new Date(e.createdAt).getTime()-new Date(s.createdAt).getTime();case"status":return e.status.localeCompare(s.status);case"date":return new Date(e.details.date).getTime()-new Date(s.details.date).getTime();default:return new Date(s.createdAt).getTime()-new Date(e.createdAt).getTime()}}),I=async e=>{if(confirm("確定要取消這個預訂嗎？"))try{await w(e,"用戶主動取消"),v("取消成功","預訂已成功取消")}catch(e){E("取消失敗","無法取消預訂，請聯繫客服")}},L=e=>({PENDING:"待確認",CONFIRMED:"已確認",COMPLETED:"已完成",CANCELLED:"已取消",REFUNDED:"已退款",pending:"待確認",confirmed:"已確認",completed:"已完成",cancelled:"已取消",refunded:"已退款"})[e]||e,R=e=>({PENDING:"bg-yellow-100 text-yellow-800",CONFIRMED:"bg-blue-100 text-blue-800",COMPLETED:"bg-green-100 text-green-800",CANCELLED:"bg-red-100 text-red-800",REFUNDED:"bg-gray-100 text-gray-800",pending:"bg-yellow-100 text-yellow-800",confirmed:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800",refunded:"bg-gray-100 text-gray-800"})[e]||"bg-gray-100 text-gray-800";return f?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,a.jsx)("div",{className:"container py-8",children:(0,a.jsx)("div",{className:"flex justify-center items-center py-20",children:(0,a.jsx)(j.gb,{size:"lg"})})})}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,a.jsxs)("div",{className:"container py-8",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"我的預訂"}),(0,a.jsx)("p",{className:"text-gray-600",children:"管理您的所有旅遊預訂"})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("button",{onClick:()=>T(!Z),className:"flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-lg hover:border-[#FF5A5F] transition-colors",children:[(0,a.jsx)(n.Z,{className:"w-4 h-4"}),"篩選",(0,a.jsx)(c.Z,{className:"w-4 h-4 transition-transform ".concat(Z?"rotate-180":"")})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["共 ",A.length," 個預訂"]})]}),(0,a.jsx)("div",{className:"flex items-center gap-4",children:(0,a.jsxs)("select",{value:F,onChange:e=>k(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-[#FF5A5F] focus:border-[#FF5A5F]",children:[(0,a.jsx)("option",{value:"newest",children:"最新的在前"}),(0,a.jsx)("option",{value:"oldest",children:"最舊的在前"}),(0,a.jsx)("option",{value:"date",children:"按服務日期"}),(0,a.jsx)("option",{value:"status",children:"按狀態"})]})})]}),Z&&(0,a.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-700 w-full mb-2",children:"狀態篩選："}),["all","PENDING","CONFIRMED","completed","cancelled"].map(e=>(0,a.jsx)("button",{onClick:()=>D(e),className:"px-3 py-1 rounded-full text-sm transition-colors ".concat(C===e?"bg-[#FF5A5F] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"all"===e?"全部":L(e)},e))]})})]}),A.length>0?(0,a.jsx)("div",{className:"space-y-4",children:A.map(s=>(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow",children:(0,a.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"台北文化導覽服務"}),(0,a.jsx)("span",{className:"inline-block px-2 py-1 rounded-full text-xs font-medium ".concat(R(s.status)),children:L(s.status)})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("div",{className:"text-xl font-bold text-gray-900",children:["NT$ ",s.pricing.total.toLocaleString()]}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["預訂編號：",s.id.slice(-6)]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm text-gray-600",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(i.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:new Date(s.details.date).toLocaleDateString("zh-TW")})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(d.Z,{className:"w-4 h-4"}),(0,a.jsxs)("span",{children:[s.details.duration," 小時"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(o.Z,{className:"w-4 h-4"}),(0,a.jsxs)("span",{children:[s.details.guests," 位旅客"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(x.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"台北市"})]})]}),s.details.specialRequests&&(0,a.jsx)("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg",children:(0,a.jsxs)("p",{className:"text-sm text-gray-700",children:[(0,a.jsx)("strong",{children:"特殊需求："})," ",s.details.specialRequests]})})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 lg:min-w-[200px]",children:["PENDING"===s.status&&(0,a.jsx)("button",{onClick:()=>I(s.id),className:"btn btn-secondary btn-sm w-full",children:"取消預訂"}),"CONFIRMED"===s.status&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("button",{onClick:()=>e.push("/messages?guide=".concat(s.guideId)),className:"btn btn-primary btn-sm w-full flex items-center justify-center gap-2",children:[(0,a.jsx)(m.Z,{className:"w-4 h-4"}),"聯繫地陪"]}),(0,a.jsx)("button",{onClick:()=>I(s.id),className:"btn btn-secondary btn-sm w-full",children:"取消預訂"})]}),"completed"===s.status&&!s.review&&(0,a.jsxs)("button",{onClick:()=>e.push("/bookings/".concat(s.id,"/review")),className:"btn btn-primary btn-sm w-full flex items-center justify-center gap-2",children:[(0,a.jsx)(g.Z,{className:"w-4 h-4"}),"撰寫評價"]}),s.review&&(0,a.jsxs)("div",{className:"text-center p-2 bg-green-50 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center justify-center gap-1 mb-1",children:[(0,a.jsx)(g.Z,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:s.review.rating})]}),(0,a.jsx)("p",{className:"text-xs text-gray-600",children:"已評價"})]}),(0,a.jsx)("button",{onClick:()=>e.push("/bookings/".concat(s.id)),className:"btn btn-ghost btn-sm w-full",children:"查看詳情"})]})]})},s.id))}):(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center",children:[(0,a.jsx)("div",{className:"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(i.Z,{className:"w-10 h-10 text-gray-400"})}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"all"===C?"還沒有任何預訂":"沒有".concat(L(C),"的預訂")}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:"all"===C?"開始探索精彩的旅遊體驗吧！":"試試調整篩選條件或建立新的預訂"}),"all"===C?(0,a.jsx)("button",{onClick:()=>e.push("/search"),className:"btn btn-primary",children:"探索服務"}):(0,a.jsx)("button",{onClick:()=>D("all"),className:"btn btn-secondary",children:"查看所有預訂"})]})]})})}},7290:function(e,s,t){"use strict";t.d(s,{pm:function(){return i}}),t(7437);var a=t(2265),l=t(3008),r=t(1981),n=t(2894),c=t(4056);function i(){let[e,s]=(0,a.useState)([]),t=e=>{let t=Math.random().toString(36).substr(2,9),a={id:t,duration:5e3,...e};return s(e=>[...e,a]),t};return{toasts:e,addToast:t,removeToast:e=>{s(s=>s.filter(s=>s.id!==e))},success:(e,s)=>t({type:"success",title:e,message:s}),error:(e,s)=>t({type:"error",title:e,message:s}),warning:(e,s)=>t({type:"warning",title:e,message:s}),info:(e,s)=>t({type:"info",title:e,message:s})}}l.Z,r.Z,n.Z,c.Z}},function(e){e.O(0,[1216,1424,1744],function(){return e(e.s=5523)}),_N_E=e.O()}]);