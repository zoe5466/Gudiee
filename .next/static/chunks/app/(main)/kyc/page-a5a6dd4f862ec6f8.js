(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9067],{8865:function(e,s,a){Promise.resolve().then(a.bind(a,1260))},1260:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return m}});var t=a(7437),l=a(2265),i=a(4033),d=a(8228),r=a(7290),c=a(5022),n=a(4563);function m(){let e=(0,i.useRouter)(),{user:s,isAuthenticated:a,isLoading:m}=(0,d.a)(),{success:x,error:o}=(0,r.pm)(),[h,u]=(0,l.useState)(1),[b,g]=(0,l.useState)(!1),[j,N]=(0,l.useState)({idNumber:"",birthDate:"",address:"",emergencyContact:"",idFrontImage:"",idBackImage:"",selfieImage:""}),[p,f]=(0,l.useState)({});(0,l.useEffect)(()=>{if(!m&&!a){e.push("/login");return}if(null==s?void 0:s.isKYCVerified){e.push("/profile");return}},[a,m,s,e]);let v=()=>{let e={};if(j.idNumber.trim()?/^[A-Z][1-2]\d{8}$/.test(j.idNumber.toUpperCase())||(e.idNumber="請輸入有效的身分證字號格式"):e.idNumber="請輸入身分證字號",j.birthDate){let s=new Date(j.birthDate).getFullYear();new Date().getFullYear()-s<18&&(e.birthDate="必須年滿18歲")}else e.birthDate="請選擇出生日期";return j.address.trim()||(e.address="請輸入聯絡地址"),f(e),0===Object.keys(e).length},y=()=>{let e={};return j.idFrontImage||(e.idFrontImage="請上傳身分證正面照片"),j.idBackImage||(e.idBackImage="請上傳身分證背面照片"),f(e),0===Object.keys(e).length},w=()=>{let e={};return j.selfieImage||(e.selfieImage="請上傳手持身分證的自拍照"),f(e),0===Object.keys(e).length},k=(e,s)=>{N(a=>({...a,[e]:s})),p[e]&&f(s=>({...s,[e]:void 0}))},C=async()=>{g(!0);try{if(!(await fetch("/api/kyc/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(j)})).ok)throw Error("提交失敗");x("提交成功","您的KYC申請已提交，我們將在24-48小時內完成審核"),e.push("/profile")}catch(e){o("提交失敗","無法提交KYC申請，請稍後再試")}finally{g(!1)}};return m||!s?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsx)(c.gb,{size:"lg"})}):(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 py-12",children:(0,t.jsx)("div",{className:"container max-w-4xl",children:(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden",children:[(0,t.jsxs)("div",{className:"bg-gradient-to-r from-[#FF5A5F] to-[#E1464A] px-6 py-8",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-white",children:"身分驗證 (KYC)"}),(0,t.jsx)("p",{className:"text-red-100 mt-2",children:"為了確保平台安全，請完成身分驗證程序"})]}),(0,t.jsxs)("div",{className:"px-6 py-4 bg-gray-50",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"驗證進度"}),(0,t.jsxs)("span",{className:"text-sm text-gray-500",children:["第 ",h," 步，共 3 步"]})]}),(0,t.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,t.jsx)("div",{className:"bg-[#FF5A5F] h-2 rounded-full transition-all duration-300",style:{width:"".concat(h/3*100,"%")}})})]}),(0,t.jsx)("div",{className:"p-6",children:(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsxs)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:["第",h,"步：",{1:"個人基本資料",2:"身分證明文件",3:"本人驗證照片"}[h]]}),1===h&&(0,t.jsx)("form",{className:"space-y-6",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"idNumber",className:"block text-sm font-medium text-gray-700",children:"身分證字號 *"}),(0,t.jsx)("input",{type:"text",id:"idNumber",name:"idNumber",value:j.idNumber,onChange:e=>k("idNumber",e.target.value.toUpperCase()),className:"input mt-1 w-full ".concat(p.idNumber?"border-red-500 focus:border-red-500 focus:ring-red-200":""),placeholder:"例：A123456789",maxLength:10}),p.idNumber&&(0,t.jsx)("p",{className:"mt-1 text-sm text-red-600",children:p.idNumber})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"birthDate",className:"block text-sm font-medium text-gray-700",children:"出生日期 *"}),(0,t.jsx)("input",{type:"date",id:"birthDate",name:"birthDate",value:j.birthDate,onChange:e=>k("birthDate",e.target.value),className:"input mt-1 w-full ".concat(p.birthDate?"border-red-500 focus:border-red-500 focus:ring-red-200":""),max:new Date(new Date().setFullYear(new Date().getFullYear()-18)).toISOString().split("T")[0]}),p.birthDate&&(0,t.jsx)("p",{className:"mt-1 text-sm text-red-600",children:p.birthDate})]}),(0,t.jsxs)("div",{className:"md:col-span-2",children:[(0,t.jsx)("label",{htmlFor:"address",className:"block text-sm font-medium text-gray-700",children:"聯絡地址 *"}),(0,t.jsx)("input",{type:"text",id:"address",name:"address",value:j.address,onChange:e=>k("address",e.target.value),className:"input mt-1 w-full ".concat(p.address?"border-red-500 focus:border-red-500 focus:ring-red-200":""),placeholder:"請輸入詳細地址（包含郵遞區號）"}),p.address&&(0,t.jsx)("p",{className:"mt-1 text-sm text-red-600",children:p.address})]}),(0,t.jsxs)("div",{className:"md:col-span-2",children:[(0,t.jsx)("label",{htmlFor:"emergencyContact",className:"block text-sm font-medium text-gray-700",children:"緊急聯絡人"}),(0,t.jsx)("input",{type:"text",id:"emergencyContact",name:"emergencyContact",value:j.emergencyContact,onChange:e=>k("emergencyContact",e.target.value),className:"input mt-1 w-full",placeholder:"姓名 + 電話 (選填)"})]})]})}),2===h&&(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"身分證正面 *"}),(0,t.jsx)(n.U,{value:j.idFrontImage,onChange:e=>k("idFrontImage",e),accept:"image/jpeg,image/png",maxSize:5,className:"h-48"}),p.idFrontImage&&(0,t.jsx)("p",{className:"mt-1 text-sm text-red-600",children:p.idFrontImage})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"身分證背面 *"}),(0,t.jsx)(n.U,{value:j.idBackImage,onChange:e=>k("idBackImage",e),accept:"image/jpeg,image/png",maxSize:5,className:"h-48"}),p.idBackImage&&(0,t.jsx)("p",{className:"mt-1 text-sm text-red-600",children:p.idBackImage})]})]}),(0,t.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsx)("svg",{className:"h-5 w-5 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20",children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),(0,t.jsxs)("div",{className:"ml-3",children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-yellow-800",children:"注意事項"}),(0,t.jsx)("div",{className:"mt-2 text-sm text-yellow-700",children:(0,t.jsxs)("ul",{className:"list-disc list-inside space-y-1",children:[(0,t.jsx)("li",{children:"請確保照片清晰，文字可清楚讀取"}),(0,t.jsx)("li",{children:"照片中不得有反光或陰影遮擋"}),(0,t.jsx)("li",{children:"支援格式：JPG、PNG，檔案大小不超過5MB"})]})})]})]})})]}),3===h&&(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"max-w-md mx-auto",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3 text-center",children:"手持身分證的自拍照 *"}),(0,t.jsx)(n.U,{value:j.selfieImage,onChange:e=>k("selfieImage",e),accept:"image/jpeg,image/png",maxSize:5,className:"h-64"}),p.selfieImage&&(0,t.jsx)("p",{className:"mt-1 text-sm text-red-600 text-center",children:p.selfieImage})]}),(0,t.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsx)("svg",{className:"h-5 w-5 text-blue-400",fill:"currentColor",viewBox:"0 0 20 20",children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),(0,t.jsxs)("div",{className:"ml-3",children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-blue-800",children:"拍照指引"}),(0,t.jsx)("div",{className:"mt-2 text-sm text-blue-700",children:(0,t.jsxs)("ul",{className:"list-disc list-inside space-y-1",children:[(0,t.jsx)("li",{children:"請手持身分證於胸前，確保身分證資訊清楚可見"}),(0,t.jsx)("li",{children:"請確保您的臉部完整入鏡，表情自然"}),(0,t.jsx)("li",{children:"光線充足，背景簡潔，避免反光或陰影"}),(0,t.jsx)("li",{children:"請勿戴帽子、口罩或太陽眼鏡"})]})})]})]})})]}),(0,t.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mt-6",children:(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsx)("svg",{className:"h-5 w-5 text-blue-400",fill:"currentColor",viewBox:"0 0 20 20",children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),(0,t.jsxs)("div",{className:"ml-3",children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-blue-800",children:"隱私保護承諾"}),(0,t.jsx)("div",{className:"mt-2 text-sm text-blue-700",children:(0,t.jsx)("p",{children:"您的個人資料將採用 SSL 加密傳輸，並嚴格遵循個人資料保護法規。 我們不會將您的資料用於身分驗證以外的用途。"})})]})]})}),(0,t.jsxs)("div",{className:"flex justify-between mt-8",children:[(0,t.jsx)("div",{children:h>1&&(0,t.jsx)("button",{type:"button",onClick:()=>{h>1&&u(e=>e-1)},className:"btn btn-ghost btn-md",children:"上一步"})}),(0,t.jsxs)("div",{className:"flex space-x-4",children:[(0,t.jsx)("button",{type:"button",onClick:()=>e.push("/profile"),className:"btn btn-ghost btn-md",children:"稍後完成"}),(0,t.jsx)("button",{type:"button",onClick:()=>{let e=!1;switch(h){case 1:e=v();break;case 2:e=y();break;case 3:e=w()}e&&h<3?u(e=>e+1):e&&3===h&&C()},disabled:b,className:"btn btn-primary btn-md disabled:opacity-50 disabled:cursor-not-allowed",children:b?(0,t.jsxs)("div",{className:"flex items-center justify-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"提交中..."]}):3===h?"提交驗證":"下一步"})]})]})]})})]})})})}}},function(e){e.O(0,[1216,811,1744],function(){return e(e.s=8865)}),_N_E=e.O()}]);