(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[694],{3588:function(e,r,t){Promise.resolve().then(t.bind(t,256))},256:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return g}});var i=t(7437),o=t(2265),a=t(4033),s=t(1396),n=t.n(s),l=t(3067),d=t(1981),c=t(1295),u=t(5589),m=t(7216),h=t(9670),f=t(8228);function g(){let e=(0,a.useRouter)(),r=(0,a.useSearchParams)(),{login:t,isLoading:s}=(0,f.a)(),[g,p]=(0,o.useState)({email:"",password:""}),[y,b]=(0,o.useState)(!1),[x,w]=(0,o.useState)({}),[j,v]=(0,o.useState)(0),k=r.get("redirect")||"/",S=()=>{let e={};return g.email?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(g.email)||(e.email="請輸入有效的電子郵件格式"):e.email="請輸入電子郵件",g.password?g.password.length<6&&(e.password="密碼至少需要6個字符"):e.password="請輸入密碼",w(e),0===Object.keys(e).length},C=async r=>{if(r.preventDefault(),S())try{await t(g.email,g.password),e.push(k)}catch(e){v(e=>e+1),w({general:j>=2?"登入失敗次數過多，請稍後再試或使用忘記密碼功能":"電子郵件或密碼錯誤"})}},z=e=>{alert("".concat(e," 登入功能開發中"))},T=(e,r)=>{p(t=>({...t,[e]:r})),x[e]&&w(r=>({...r,[e]:""})),x.general&&w(e=>({...e,general:""}))};return(0,i.jsxs)("div",{style:{minHeight:"100vh",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem"},children:[(0,i.jsxs)("button",{onClick:()=>e.push("/"),style:{position:"absolute",top:"2rem",left:"2rem",display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.75rem 1rem",backgroundColor:"rgba(255, 255, 255, 0.1)",color:"white",border:"none",borderRadius:"0.5rem",fontSize:"0.875rem",fontWeight:"500",cursor:"pointer",backdropFilter:"blur(10px)"},children:[(0,i.jsx)(l.Z,{style:{width:"1rem",height:"1rem"}}),"返回首頁"]}),(0,i.jsxs)("div",{style:{backgroundColor:"white",borderRadius:"1rem",padding:"2rem",width:"100%",maxWidth:"400px",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1)"},children:[(0,i.jsxs)("div",{style:{textAlign:"center",marginBottom:"2rem"},children:[(0,i.jsx)("h1",{style:{fontSize:"2rem",fontWeight:"700",color:"#111827",marginBottom:"0.5rem"},children:"歡迎回來"}),(0,i.jsx)("p",{style:{color:"#6b7280",fontSize:"0.875rem"},children:"登入您的 Guidee 帳戶"})]}),x.general&&(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.75rem",backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"0.5rem",marginBottom:"1.5rem"},children:[(0,i.jsx)(d.Z,{style:{width:"1rem",height:"1rem",color:"#ef4444"}}),(0,i.jsx)("span",{style:{fontSize:"0.875rem",color:"#dc2626"},children:x.general})]}),(0,i.jsxs)("form",{onSubmit:C,style:{marginBottom:"1.5rem"},children:[(0,i.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,i.jsx)("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"電子郵件"}),(0,i.jsxs)("div",{style:{position:"relative"},children:[(0,i.jsx)(c.Z,{style:{position:"absolute",left:"0.75rem",top:"50%",transform:"translateY(-50%)",width:"1rem",height:"1rem",color:"#9ca3af"}}),(0,i.jsx)("input",{type:"email",value:g.email,onChange:e=>T("email",e.target.value),placeholder:"your@email.com",style:{width:"100%",padding:"0.75rem 0.75rem 0.75rem 2.5rem",border:"1px solid ".concat(x.email?"#ef4444":"#e5e7eb"),borderRadius:"0.5rem",fontSize:"1rem",outline:"none",transition:"all 0.2s"},className:"focus:border-blue-500 focus:ring-2 focus:ring-blue-200"})]}),x.email&&(0,i.jsx)("p",{style:{marginTop:"0.25rem",fontSize:"0.875rem",color:"#ef4444"},children:x.email})]}),(0,i.jsxs)("div",{style:{marginBottom:"1.5rem"},children:[(0,i.jsx)("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"密碼"}),(0,i.jsxs)("div",{style:{position:"relative"},children:[(0,i.jsx)(u.Z,{style:{position:"absolute",left:"0.75rem",top:"50%",transform:"translateY(-50%)",width:"1rem",height:"1rem",color:"#9ca3af"}}),(0,i.jsx)("input",{type:y?"text":"password",value:g.password,onChange:e=>T("password",e.target.value),placeholder:"輸入您的密碼",style:{width:"100%",padding:"0.75rem 2.5rem 0.75rem 2.5rem",border:"1px solid ".concat(x.password?"#ef4444":"#e5e7eb"),borderRadius:"0.5rem",fontSize:"1rem",outline:"none",transition:"all 0.2s"},className:"focus:border-blue-500 focus:ring-2 focus:ring-blue-200"}),(0,i.jsx)("button",{type:"button",onClick:()=>b(!y),style:{position:"absolute",right:"0.75rem",top:"50%",transform:"translateY(-50%)",padding:"0.25rem",backgroundColor:"transparent",border:"none",cursor:"pointer"},children:y?(0,i.jsx)(m.Z,{style:{width:"1rem",height:"1rem",color:"#9ca3af"}}):(0,i.jsx)(h.Z,{style:{width:"1rem",height:"1rem",color:"#9ca3af"}})})]}),x.password&&(0,i.jsx)("p",{style:{marginTop:"0.25rem",fontSize:"0.875rem",color:"#ef4444"},children:x.password})]}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[(0,i.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[(0,i.jsx)("input",{type:"checkbox",style:{width:"1rem",height:"1rem",borderRadius:"0.25rem"}}),(0,i.jsx)("span",{style:{fontSize:"0.875rem",color:"#374151"},children:"記住我"})]}),(0,i.jsx)(n(),{href:"/auth/forgot-password",style:{fontSize:"0.875rem",color:"#3b82f6",textDecoration:"none"},className:"hover:underline",children:"忘記密碼？"})]}),(0,i.jsx)("button",{type:"submit",disabled:s,style:{width:"100%",padding:"0.75rem",backgroundColor:s?"#9ca3af":"#3b82f6",color:"white",border:"none",borderRadius:"0.5rem",fontSize:"1rem",fontWeight:"600",cursor:s?"not-allowed":"pointer",transition:"all 0.2s"},className:"hover:bg-blue-700",children:s?(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:[(0,i.jsx)("div",{style:{width:"1rem",height:"1rem",border:"2px solid rgba(255, 255, 255, 0.3)",borderTop:"2px solid white",borderRadius:"50%",animation:"spin 1s linear infinite"}}),"登入中..."]}):"登入"})]}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:"1.5rem"},children:[(0,i.jsx)("div",{style:{flex:1,height:"1px",backgroundColor:"#e5e7eb"}}),(0,i.jsx)("span",{style:{padding:"0 1rem",fontSize:"0.875rem",color:"#6b7280"},children:"或"}),(0,i.jsx)("div",{style:{flex:1,height:"1px",backgroundColor:"#e5e7eb"}})]}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginBottom:"1.5rem"},children:[(0,i.jsxs)("button",{onClick:()=>z("google"),style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.75rem",padding:"0.75rem",backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"0.5rem",fontSize:"0.875rem",fontWeight:"500",color:"#374151",cursor:"pointer",transition:"all 0.2s"},className:"hover:bg-gray-50",children:[(0,i.jsx)("div",{style:{width:"1.25rem",height:"1.25rem",backgroundColor:"#4285f4",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"0.75rem",fontWeight:"600"},children:"G"}),"使用 Google 登入"]}),(0,i.jsxs)("button",{onClick:()=>z("facebook"),style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.75rem",padding:"0.75rem",backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"0.5rem",fontSize:"0.875rem",fontWeight:"500",color:"#374151",cursor:"pointer",transition:"all 0.2s"},className:"hover:bg-gray-50",children:[(0,i.jsx)("div",{style:{width:"1.25rem",height:"1.25rem",backgroundColor:"#1877f2",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"0.75rem",fontWeight:"600"},children:"f"}),"使用 Facebook 登入"]})]}),(0,i.jsxs)("p",{style:{textAlign:"center",fontSize:"0.875rem",color:"#6b7280"},children:["還沒有帳戶？"," ",(0,i.jsx)(n(),{href:"/auth/register",style:{color:"#3b82f6",textDecoration:"none",fontWeight:"500"},className:"hover:underline",children:"立即註冊"})]})]})]})}},8228:function(e,r,t){"use strict";t.d(r,{a:function(){return a}});var i=t(4660),o=t(4810);let a=(0,i.Ue)()((0,o.tJ)((e,r)=>({user:null,token:null,refreshToken:null,isLoading:!1,isAuthenticated:!1,login:async(r,t)=>{e({isLoading:!0});try{var i,o,a,s;let n=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:r,password:t})}),l=await n.json();if(!n.ok||!l.success)throw Error(l.error||l.message||"登入失敗");let d={id:l.data.user.id,email:l.data.user.email,name:l.data.user.name,avatar:l.data.user.avatar,role:l.data.user.role.toLowerCase(),isEmailVerified:l.data.user.isEmailVerified,isKYCVerified:l.data.user.isKycVerified,createdAt:l.data.user.createdAt,permissions:l.data.user.permissions||[],profile:{phone:l.data.user.phone,bio:null===(i=l.data.user.userProfile)||void 0===i?void 0:i.bio,location:null===(o=l.data.user.userProfile)||void 0===o?void 0:o.location,languages:null===(a=l.data.user.userProfile)||void 0===a?void 0:a.languages,specialties:null===(s=l.data.user.userProfile)||void 0===s?void 0:s.specialties}};e({user:d,token:l.data.token,refreshToken:null,isAuthenticated:!0,isLoading:!1})}catch(r){throw e({isLoading:!1}),r}},register:async r=>{e({isLoading:!0});try{await new Promise(e=>setTimeout(e,1500));let t={id:Date.now().toString(),email:r.email,name:r.name,role:r.userType||"customer",isEmailVerified:!1,isKYCVerified:!1,createdAt:new Date().toISOString(),permissions:"guide"===r.userType?["user:read","guide:manage","booking:manage"]:["user:read","booking:create"],profile:{phone:r.phone}},i="mock-jwt-token-"+Date.now();e({user:t,token:i,refreshToken:"mock-refresh-token",isAuthenticated:!0,isLoading:!1})}catch(r){throw e({isLoading:!1}),r}},logout:async()=>{try{await fetch("/api/auth/logout",{method:"POST",credentials:"include"})}catch(e){}e({user:null,token:null,refreshToken:null,isAuthenticated:!1})},updateUser:async t=>{let{user:i,token:o}=r();if(!i||!o)throw Error("未登入");e({isLoading:!0});try{let r=await fetch("/api/users/profile",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(o)},body:JSON.stringify(t)});if(!r.ok)throw Error("更新失敗");let a=await r.json();e({user:{...i,...a},isLoading:!1})}catch(r){throw e({isLoading:!1}),r}},refreshAuth:async()=>{let{refreshToken:t}=r();if(t)try{let r=await fetch("/api/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:t})});if(!r.ok)throw Error("Token 刷新失敗");let i=await r.json();e({token:i.token,refreshToken:i.refreshToken})}catch(e){r().logout()}},initializeAuth:async()=>{try{let a=await fetch("/api/auth/me",{credentials:"include"});if(a.ok){let s=await a.json();if(s.success&&s.data.user){var r,t,i,o;let a={id:s.data.user.id,email:s.data.user.email,name:s.data.user.name,avatar:s.data.user.avatar,role:s.data.user.role.toLowerCase(),isEmailVerified:s.data.user.isEmailVerified,isKYCVerified:s.data.user.isKycVerified,createdAt:s.data.user.createdAt,permissions:s.data.user.permissions||[],profile:{phone:s.data.user.phone,bio:null===(r=s.data.user.userProfile)||void 0===r?void 0:r.bio,location:null===(t=s.data.user.userProfile)||void 0===t?void 0:t.location,languages:null===(i=s.data.user.userProfile)||void 0===i?void 0:i.languages,specialties:null===(o=s.data.user.userProfile)||void 0===o?void 0:o.specialties}};e({user:a,isAuthenticated:!0})}}}catch(e){}},setLoading:r=>{e({isLoading:r})},hasPermission:e=>{var t;let{user:i}=r();return!!i&&("GUIDE"===i.role||(null===(t=i.permissions)||void 0===t?void 0:t.includes(e))||!1)}}),{name:"guidee-auth",partialize:e=>({user:e.user,token:e.token,refreshToken:e.refreshToken,isAuthenticated:e.isAuthenticated})}))}},function(e){e.O(0,[1216,1744],function(){return e(e.s=3588)}),_N_E=e.O()}]);