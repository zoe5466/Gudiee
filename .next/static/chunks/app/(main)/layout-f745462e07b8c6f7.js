(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4095],{2938:function(e,r,t){Promise.resolve().then(t.bind(t,7347)),Promise.resolve().then(t.bind(t,7862))},7347:function(e,r,t){"use strict";t.r(r),t.d(r,{AuthInit:function(){return n}});var s=t(2265),i=t(8228);function n(){let{initializeAuth:e}=(0,i.a)();return(0,s.useEffect)(()=>{e()},[e]),null}},2851:function(e,r,t){"use strict";t.d(r,{W:function(){return m},j:function(){return h}});var s=t(7437),i=t(2265),n=t(4887),a=t(8956),o=t(2442),l=t(3523),d=t(4374),c=t(4784);function m(e){let{variant:r="dropdown",showFlag:t=!0,showNativeName:m=!0,className:h=""}=e,{locale:u,setLocale:x,t:g}=(0,c.Q)(),[b,f]=(0,i.useState)(!1),[p,y]=(0,i.useState)(!1),[j,v]=(0,i.useState)({top:0,left:0,width:0}),w=(0,i.useRef)(null),N=(0,i.useRef)(null);(0,i.useEffect)(()=>{y(!0)},[]),(0,i.useEffect)(()=>{let e=e=>{var r,t;let s=e.target,i=null===(r=N.current)||void 0===r?void 0:r.contains(s),n=null===(t=document.querySelector("[data-language-dropdown]"))||void 0===t?void 0:t.contains(s);i||n||f(!1)};if(b)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[b]);let k=()=>{if(N.current){let e=N.current.getBoundingClientRect();v({top:e.bottom+4,left:e.right-192,width:192})}},C=e=>{x(e),f(!1)},S=d.H8[u];return p?"inline"===r?(0,s.jsx)("div",{className:"flex gap-2 ".concat(h),children:Object.entries(d.H8).map(e=>{let[r,i]=e;return(0,s.jsxs)("button",{onClick:()=>C(r),style:{padding:"0.5rem 0.75rem",borderRadius:"0.375rem",border:"1px solid",borderColor:u===r?"#2563eb":"#e5e7eb",backgroundColor:u===r?"#eff6ff":"white",color:u===r?"#2563eb":"#6b7280",fontSize:"0.875rem",fontWeight:"500",cursor:"pointer",transition:"all 0.2s",display:"flex",alignItems:"center",gap:"0.5rem"},className:"hover:border-blue-300",children:[t&&(0,s.jsx)("span",{children:i.flag}),m&&(0,s.jsx)("span",{children:i.nativeName}),u===r&&(0,s.jsx)(o.Z,{style:{width:"0.875rem",height:"0.875rem"}})]},r)})}):(0,s.jsxs)("div",{ref:w,style:{position:"relative"},className:h,children:[(0,s.jsxs)("button",{ref:N,onClick:()=>{b||k(),f(!b)},style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0.75rem",backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"0.5rem",fontSize:"0.875rem",fontWeight:"500",color:"#374151",cursor:"pointer",transition:"all 0.2s",minWidth:"8rem"},className:"hover:bg-gray-50 hover:border-gray-300",children:[(0,s.jsx)(a.Z,{style:{width:"1rem",height:"1rem"}}),t&&(0,s.jsx)("span",{children:S.flag}),m&&(0,s.jsx)("span",{children:S.nativeName}),(0,s.jsx)(l.Z,{style:{width:"0.875rem",height:"0.875rem",marginLeft:"auto",transform:b?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"}})]}),b&&p&&(0,n.createPortal)((0,s.jsx)("div",{"data-language-dropdown":!0,style:{position:"fixed",top:j.top,left:j.left,width:j.width,backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"0.5rem",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1)",zIndex:1e4,overflow:"hidden"},children:Object.entries(d.H8).map(e=>{let[r,i]=e;return(0,s.jsxs)("button",{onClick:()=>C(r),style:{width:"100%",display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem",fontSize:"0.875rem",color:u===r?"#2563eb":"#374151",backgroundColor:u===r?"#f8fafc":"transparent",border:"none",cursor:"pointer",transition:"all 0.2s",textAlign:"left"},className:"hover:bg-gray-50",children:[t&&(0,s.jsx)("span",{style:{fontSize:"1.125rem"},children:i.flag}),(0,s.jsxs)("div",{style:{flex:1},children:[(0,s.jsx)("div",{style:{fontWeight:"500"},children:i.nativeName}),(0,s.jsx)("div",{style:{fontSize:"0.75rem",color:"#9ca3af"},children:i.name})]}),u===r&&(0,s.jsx)(o.Z,{style:{width:"1rem",height:"1rem",color:"#2563eb"}})]},r)})}),document.body)]}):(0,s.jsxs)("div",{className:"flex items-center gap-2 ".concat(h),children:[(0,s.jsx)(a.Z,{className:"w-4 h-4 text-gray-500"}),(0,s.jsx)("span",{className:"text-sm text-gray-500",children:"Loading..."})]})}function h(e){let{className:r=""}=e,{locale:t,setLocale:n}=(0,c.Q)(),[o,l]=(0,i.useState)(!1);if((0,i.useEffect)(()=>{l(!0)},[]),!o)return(0,s.jsx)("button",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"2.5rem",height:"2.5rem",backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"50%",cursor:"pointer",transition:"all 0.2s",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"},className:"hover:bg-gray-50 hover:scale-105 ".concat(r),children:(0,s.jsx)(a.Z,{className:"w-4 h-4 text-gray-500"})});let m=d.H8[t].flag;return(0,s.jsx)("button",{onClick:()=>{let e=["zh-TW","en"],r=(e.indexOf(t)+1)%e.length,s=e[r];s&&n(s)},style:{display:"flex",alignItems:"center",justifyContent:"center",width:"2.5rem",height:"2.5rem",backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"50%",fontSize:"1.125rem",cursor:"pointer",transition:"all 0.2s",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"},className:"hover:bg-gray-50 hover:scale-105 ".concat(r),title:"Switch to ".concat("zh-TW"===t?"English":"繁體中文"),children:m})}},7862:function(e,r,t){"use strict";t.r(r),t.d(r,{DualLayout:function(){return H}});var s=t(7437),i=t(4033),n=t(4660),a=t(4810);let o=(0,n.Ue)()((0,a.tJ)(e=>({mode:"traveler",switchMode:r=>e({mode:r})}),{name:"guidee-user-mode"}));var l=t(2265),d=t(1396),c=t.n(d),m=t(2169),h=t(5119),u=t(7619),x=t(2176),g=t(8244),b=t(1425),f=t(2549),p=t(8004),y=t(9409),j=t(7498);let v=l.forwardRef((e,r)=>{let{className:t,...i}=e;return(0,s.jsx)(j.fC,{className:(0,m.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...i,ref:r,children:(0,s.jsx)(j.bU,{className:(0,m.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})});v.displayName=j.fC.displayName;var w=t(6142),N=t(9057);function k(){let{mode:e,switchMode:r}=o();return(0,s.jsxs)("div",{className:"flex items-center space-x-3 bg-gray-50 rounded-full px-3 py-2",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(w.Z,{className:"w-4 h-4 ".concat("traveler"===e?"text-amber-600":"text-gray-400")}),(0,s.jsx)("span",{className:"text-xs font-medium ".concat("traveler"===e?"text-gray-900":"text-gray-500"),children:"旅客"})]}),(0,s.jsx)(v,{checked:"guide"===e,onCheckedChange:e=>{r(e?"guide":"traveler")},className:"data-[state=checked]:bg-amber-500"}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("span",{className:"text-xs font-medium ".concat("guide"===e?"text-gray-900":"text-gray-500"),children:"地陪"}),(0,s.jsx)(N.Z,{className:"w-4 h-4 ".concat("guide"===e?"text-amber-600":"text-gray-400")})]})]})}let C=[{title:"控制台",href:"/guide/dashboard",icon:h.Z},{title:"任務",href:"/guide/tasks",icon:u.Z},{title:"訊息",href:"/guide/messages",icon:x.Z},{title:"歷史",href:"/guide/orders",icon:g.Z},{title:"帳號",href:"/guide/account",icon:b.Z}];function S(){let e=(0,i.usePathname)(),[r,t]=(0,l.useState)(!1);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{className:"lg:hidden fixed top-4 left-4 z-50 p-2 bg-white rounded-lg shadow-md border border-gray-200",onClick:()=>t(!r),children:r?(0,s.jsx)(f.Z,{className:"w-5 h-5 text-gray-600"}):(0,s.jsx)(p.Z,{className:"w-5 h-5 text-gray-600"})}),r&&(0,s.jsx)("div",{className:"lg:hidden fixed inset-0 bg-black/20 z-40",onClick:()=>t(!1)}),(0,s.jsx)("aside",{className:(0,m.cn)("fixed left-0 top-0 z-40 h-screen w-64 bg-white border-r border-gray-200 transition-transform duration-200","lg:translate-x-0",r?"translate-x-0":"-translate-x-full"),children:(0,s.jsxs)("div",{className:"flex flex-col h-full",children:[(0,s.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-[#FF5A5F] to-[#E1464A] rounded-lg flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-white font-bold text-sm",children:"R"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-lg font-bold text-gray-900",children:"Guidee"}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"地陪控制台"})]})]})}),(0,s.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,s.jsx)(k,{})}),(0,s.jsx)("nav",{className:"flex-1 p-4 space-y-1",children:C.map(r=>{let i=e===r.href,n=r.icon;return(0,s.jsxs)(c(),{href:r.href,className:(0,m.cn)("flex items-center space-x-3 px-3 py-2 rounded-lg text-sm font-medium transition-colors duration-200",i?"bg-red-50 text-red-700 border-r-2 border-[#FF5A5F]":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"),onClick:()=>t(!1),children:[(0,s.jsx)(n,{className:"w-5 h-5"}),(0,s.jsx)("span",{children:r.title})]},r.href)})}),(0,s.jsx)("div",{className:"p-4 border-t border-gray-200",children:(0,s.jsxs)("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[(0,s.jsx)("div",{className:"w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center",children:(0,s.jsx)(b.Z,{className:"w-4 h-4 text-gray-600"})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"張小明"}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"專業地陪"})]}),(0,s.jsx)(y.Z,{className:"w-4 h-4 text-gray-400 hover:text-gray-600 cursor-pointer"})]})})]})})]})}var Z=t(1827),I=t(7810);let R=[{title:"探索",href:"/",icon:Z.Z},{title:"收藏",href:"/favorites",icon:I.Z},{title:"行程",href:"/tasks",icon:u.Z},{title:"訊息",href:"/chat",icon:x.Z},{title:"個人",href:"/profile",icon:b.Z}];function z(){let e=(0,i.usePathname)();return(0,s.jsx)("nav",{className:"fixed bottom-0 left-0 right-0 z-50 bg-white border-t border-gray-200",children:(0,s.jsx)("div",{className:"px-2 py-1",children:(0,s.jsx)("div",{className:"flex items-center justify-around",children:R.map(r=>{let t=e===r.href,i=r.icon;return(0,s.jsxs)(c(),{href:r.href,className:"flex flex-col items-center justify-center min-w-0 flex-1 py-2 px-1",children:[(0,s.jsx)(i,{className:(0,m.cn)("w-5 h-5 mb-1",t?"text-[#FF5A5F]":"text-gray-400")}),(0,s.jsx)("span",{className:(0,m.cn)("text-xs font-medium",t?"text-[#FF5A5F]":"text-gray-500"),children:r.title})]},r.href)})})})})}var F=t(2851),E=t(9865),D=t(5883),W=t(8228);function A(){var e,r,t,n,a;let[o,d]=(0,l.useState)(!1),c=(0,l.useRef)(null),m=(0,l.useRef)(null),{user:h,isAuthenticated:u,logout:x}=(0,W.a)(),g=(0,i.useRouter)();(0,l.useEffect)(()=>{function e(e){c.current&&!c.current.contains(e.target)&&m.current&&!m.current.contains(e.target)&&d(!1)}return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);let f=async()=>{try{await x(),d(!1),g.push("/")}catch(e){}},p=[{icon:(0,s.jsx)(b.Z,{className:"w-4 h-4"}),label:"個人資料",href:"/profile",onClick:()=>{g.push("/profile"),d(!1)}},{icon:(0,s.jsx)(E.Z,{className:"w-4 h-4"}),label:"我的預訂",href:"/my-bookings",onClick:()=>{g.push("/my-bookings"),d(!1)}},{icon:(0,s.jsx)(I.Z,{className:"w-4 h-4"}),label:"我的最愛",href:"/favorites",onClick:()=>{g.push("/favorites"),d(!1)}},{icon:(0,s.jsx)(y.Z,{className:"w-4 h-4"}),label:"設定",href:"/settings",onClick:()=>{g.push("/settings"),d(!1)}}];return u?(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)("button",{ref:m,onClick:()=>d(!o),className:"flex items-center border border-gray-300 rounded-full p-2 hover:shadow-md transition-shadow duration-200 bg-white",children:[(0,s.jsx)("div",{className:"w-6 h-6 bg-gray-500 rounded-full flex items-center justify-center text-white text-xs font-medium",children:(null==h?void 0:null===(r=h.name)||void 0===r?void 0:null===(e=r[0])||void 0===e?void 0:e.toUpperCase())||(null==h?void 0:null===(n=h.email)||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:t.toUpperCase())||"U"}),(0,s.jsx)("span",{className:"ml-2 text-sm font-medium text-gray-700 max-w-20 truncate hidden sm:block",children:(null==h?void 0:h.name)||(null==h?void 0:null===(a=h.email)||void 0===a?void 0:a.split("@")[0])})]}),o&&(0,s.jsxs)("div",{ref:c,className:"absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-50",children:[(0,s.jsxs)("div",{className:"px-4 py-3 border-b border-gray-100",children:[(0,s.jsx)("div",{className:"text-sm font-medium text-gray-900",children:null==h?void 0:h.name}),(0,s.jsx)("div",{className:"text-sm text-gray-500",children:null==h?void 0:h.email})]}),(0,s.jsx)("div",{className:"py-1",children:p.map((e,r)=>(0,s.jsxs)("button",{onClick:e.onClick,className:"w-full flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors",children:[e.icon,(0,s.jsx)("span",{className:"ml-3",children:e.label})]},r))}),(0,s.jsx)("div",{className:"border-t border-gray-100 py-1",children:(0,s.jsxs)("button",{onClick:f,className:"w-full flex items-center px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors",children:[(0,s.jsx)(D.Z,{className:"w-4 h-4"}),(0,s.jsx)("span",{className:"ml-3",children:"登出"})]})})]})]}):(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("button",{onClick:()=>g.push("/login"),className:"text-sm font-medium text-gray-900 hover:bg-gray-100 px-3 py-2 rounded-full transition-colors",children:"登入"}),(0,s.jsx)("button",{onClick:()=>g.push("/register"),className:"text-sm font-medium bg-[#FF5A5F] text-white hover:bg-[#E1464A] px-4 py-2 rounded-full transition-colors",children:"註冊"})]})}function _(){(0,i.useRouter)();let[e,r]=(0,l.useState)(!1),[t,n]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{n(!0);let e=()=>{r(window.scrollY>80)};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[]),(0,s.jsxs)("header",{className:"sticky top-0 z-50 bg-white transition-all duration-200 ".concat(e?"shadow-md border-b border-gray-200":"shadow-sm"),children:[" ",(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("div",{className:"px-6 lg:px-10 xl:px-20",children:(0,s.jsxs)("div",{className:"flex items-center justify-between h-20",children:[(0,s.jsx)("div",{className:"flex items-center",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-[#FF5A5F] to-[#E1464A] rounded-lg flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-white font-bold text-sm",children:"R"})}),(0,s.jsx)("span",{className:"ml-2 text-2xl font-bold text-[#FF5A5F] hidden sm:block",children:"guidee"})]})}),(0,s.jsx)("div",{className:"hidden lg:block",children:(0,s.jsxs)("div",{className:"flex items-center border border-gray-300 rounded-full shadow-sm hover:shadow-lg transition-all duration-200 bg-white",children:[(0,s.jsxs)("div",{className:"search-section border-r border-gray-200 rounded-l-full hover:bg-gray-50",children:[(0,s.jsx)("div",{className:"search-label",children:"地點"}),(0,s.jsx)("div",{className:"search-value",children:"隨處"})]}),(0,s.jsxs)("div",{className:"search-section border-r border-gray-200 hover:bg-gray-50",children:[(0,s.jsx)("div",{className:"search-label",children:"入住"}),(0,s.jsx)("div",{className:"search-value",children:"任何一週"})]}),(0,s.jsxs)("div",{className:"search-section hover:bg-gray-50 flex items-center",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("div",{className:"search-label",children:"旅客"}),(0,s.jsx)("div",{className:"search-value",children:"新增旅客"})]}),(0,s.jsx)("button",{className:"btn btn-primary btn-sm rounded-full w-8 h-8 !p-0 ml-3",children:(0,s.jsx)(Z.Z,{className:"w-4 h-4"})})]})]})}),(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)(c(),{href:"/auth/register",className:"hidden lg:block text-sm font-medium text-gray-900 hover:bg-gray-100 px-3 py-2 rounded-full transition-colors cursor-pointer",style:{textDecoration:"none"},children:"成為地陪"}),(0,s.jsx)(F.j,{}),(0,s.jsx)(A,{}),(0,s.jsx)("button",{className:"lg:hidden p-2 text-gray-600",children:(0,s.jsx)(Z.Z,{className:"w-5 h-5"})})]})]})}),(0,s.jsx)("div",{className:"hidden lg:block border-t border-gray-200",children:(0,s.jsx)("div",{className:"px-6 lg:px-10 xl:px-20",children:(0,s.jsx)("div",{className:"flex items-center space-x-8 py-4 overflow-x-auto",children:[{name:"文化",icon:"\uD83C\uDFDB️"},{name:"美食",icon:"\uD83C\uDF5C"},{name:"自然",icon:"\uD83C\uDFD4️"},{name:"城市",icon:"\uD83C\uDFD9️"},{name:"夜生活",icon:"\uD83C\uDF03"},{name:"購物",icon:"\uD83D\uDECD️"},{name:"歷史",icon:"\uD83C\uDFEF"},{name:"海岸",icon:"\uD83C\uDFD6️"}].map((e,r)=>(0,s.jsxs)("button",{className:"flex flex-col items-center min-w-max px-4 py-3 text-xs font-medium transition-colors hover:text-gray-900 ".concat(0===r?"text-gray-900 border-b-2 border-gray-900":"text-gray-500 hover:border-b-2 hover:border-gray-300"),children:[(0,s.jsx)("span",{className:"text-2xl mb-2",children:e.icon}),(0,s.jsx)("span",{children:e.name})]},r))})})}),t&&e&&(0,s.jsx)("div",{className:"lg:hidden px-6 py-3 border-t border-gray-200",children:(0,s.jsxs)("div",{className:"flex items-center bg-white border border-gray-300 rounded-full shadow-sm p-3",children:[(0,s.jsx)(Z.Z,{className:"w-5 h-5 text-gray-400 mr-3"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("div",{className:"text-sm font-medium text-gray-900",children:"隨處"}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:"任何一週 \xb7 新增旅客"})]}),(0,s.jsx)("div",{className:"w-8 h-8 border border-gray-300 rounded-full flex items-center justify-center",children:(0,s.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full"})})]})})]})]})}var T=t(5099),B=t(1841),L=t(6828);function P(e){let{className:r=""}=e,{user:t}=(0,W.a)(),[i,n]=(0,l.useState)(!1),[a,o]=(0,l.useState)(!1),[d,c]=(0,l.useState)(0);return((0,l.useEffect)(()=>{if(!i&&t){let e=setInterval(()=>{Math.random()>.9&&c(e=>e+1)},3e4);return()=>clearInterval(e)}},[i,t]),t)?(0,s.jsxs)(s.Fragment,{children:[!i&&(0,s.jsxs)("button",{onClick:()=>{n(!0),o(!1),c(0)},style:{position:"fixed",bottom:"2rem",right:"2rem",width:"3.5rem",height:"3.5rem",backgroundColor:"#3b82f6",border:"none",borderRadius:"50%",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1)",transition:"all 0.2s",zIndex:1e3},className:"hover:scale-105 hover:shadow-lg ".concat(r),children:[(0,s.jsx)(x.Z,{style:{width:"1.5rem",height:"1.5rem",color:"white"}}),d>0&&(0,s.jsx)("div",{style:{position:"absolute",top:"-0.25rem",right:"-0.25rem",width:"1.25rem",height:"1.25rem",backgroundColor:"#ef4444",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.75rem",fontWeight:"600",color:"white",border:"2px solid white"},children:d>9?"9+":d})]}),i&&(0,s.jsxs)("div",{style:{position:"fixed",bottom:"2rem",right:"2rem",width:"24rem",height:a?"auto":"32rem",backgroundColor:"white",borderRadius:"0.5rem",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1)",border:"1px solid #e5e7eb",zIndex:1e3,overflow:"hidden",transition:"all 0.3s ease-in-out"},children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"1rem",backgroundColor:"#3b82f6",color:"white"},children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[(0,s.jsx)("div",{style:{width:"2rem",height:"2rem",backgroundColor:"rgba(255, 255, 255, 0.2)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,s.jsx)(x.Z,{style:{width:"1rem",height:"1rem"}})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{style:{fontSize:"0.875rem",fontWeight:"600"},children:"客服中心"}),(0,s.jsx)("div",{style:{fontSize:"0.75rem",opacity:.9},children:"我們在線為您服務"})]})]}),(0,s.jsxs)("div",{style:{display:"flex",gap:"0.5rem"},children:[(0,s.jsx)("button",{onClick:()=>{o(!a)},style:{width:"1.5rem",height:"1.5rem",backgroundColor:"transparent",border:"none",borderRadius:"0.25rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:"white"},className:"hover:bg-white hover:bg-opacity-20",children:a?(0,s.jsx)(T.Z,{style:{width:"0.875rem",height:"0.875rem"}}):(0,s.jsx)(B.Z,{style:{width:"0.875rem",height:"0.875rem"}})}),(0,s.jsx)("button",{onClick:()=>{n(!1),o(!1)},style:{width:"1.5rem",height:"1.5rem",backgroundColor:"transparent",border:"none",borderRadius:"0.25rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:"white"},className:"hover:bg-white hover:bg-opacity-20",children:(0,s.jsx)(f.Z,{style:{width:"0.875rem",height:"0.875rem"}})})]})]}),!a&&(0,s.jsx)("div",{style:{height:"calc(32rem - 4rem)"},children:(0,s.jsx)(L.f,{recipientId:"support",recipientName:"客服中心",chatType:"customer_support"})})]})]}):null}var q=t(3021),O=t(2442),M=t(2601);function U(e){let{className:r=""}=e,{user:t}=(0,W.a)(),{permission:i,isSupported:n,isSubscribed:a,requestPermission:o,subscribe:d,unsubscribe:c,sendLocalNotification:m}=function(){let{user:e}=(0,W.a)(),[r,t]=(0,l.useState)({permission:"default",isSupported:!1,isSubscribed:!1});(0,l.useEffect)(()=>{let e="Notification"in window&&"serviceWorker"in navigator,r=e?Notification.permission:"denied";t(t=>({...t,isSupported:e,permission:r}))},[]),(0,l.useEffect)(()=>{r.isSupported&&(async()=>{try{let e=await navigator.serviceWorker.register("/sw.js"),r=await e.pushManager.getSubscription();t(e=>({...e,isSubscribed:!!r}))}catch(e){}})()},[r.isSupported]);let s=(0,l.useCallback)(async()=>{if(!r.isSupported)throw Error("瀏覽器不支援推送通知");try{let e=await Notification.requestPermission();return t(r=>({...r,permission:e})),e}catch(e){throw e}},[r.isSupported]),i=(0,l.useCallback)(async()=>{if(!r.isSupported||"granted"!==r.permission)throw Error("無法訂閱推送通知：權限被拒絕或不支援");try{let r=await navigator.serviceWorker.ready,s=await r.pushManager.getSubscription();if(!s){let e=M.env.NEXT_PUBLIC_VAPID_PUBLIC_KEY||"demo-key";s=await r.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:e})}return e&&await fetch("/api/notifications/subscribe",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e.id)},body:JSON.stringify({subscription:s,userId:e.id})}),t(e=>({...e,isSubscribed:!0})),s}catch(e){throw e}},[r.isSupported,r.permission,e]),n=(0,l.useCallback)(async()=>{if(r.isSupported)try{let r=await navigator.serviceWorker.ready,s=await r.pushManager.getSubscription();s&&(await s.unsubscribe(),e&&await fetch("/api/notifications/unsubscribe",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e.id)},body:JSON.stringify({userId:e.id})})),t(e=>({...e,isSubscribed:!1}))}catch(e){throw e}},[r.isSupported,e]),a=(0,l.useCallback)(e=>{if(r.isSupported&&"granted"===r.permission)try{let r=new Notification(e.title,{body:e.body,icon:e.icon||"/icon-192x192.png",badge:e.badge||"/badge-72x72.png",tag:e.tag,data:e.data,requireInteraction:e.requireInteraction||!1,silent:e.silent||!1});return r.onclick=t=>{var s;t.preventDefault(),window.focus(),(null===(s=e.data)||void 0===s?void 0:s.url)&&(window.location.href=e.data.url),r.close()},e.requireInteraction||setTimeout(()=>{r.close()},5e3),r}catch(e){return}},[r.isSupported,r.permission]),o={bookingConfirmed:(e,r)=>({title:"預訂確認",body:"您的預訂已被 ".concat(r," 確認！"),icon:"/icons/booking-confirmed.png",tag:"booking-".concat(e),data:{type:"booking_confirmed",bookingId:e,url:"/my-bookings"},requireInteraction:!0}),newMessage:e=>({title:"新訊息",body:"".concat(e," 發送了一條新訊息"),icon:"/icons/message.png",tag:"new-message",data:{type:"new_message",url:"/messages"}}),paymentSuccess:e=>({title:"付款成功",body:"您的付款 NT$ ".concat(e.toLocaleString()," 已成功處理"),icon:"/icons/payment-success.png",tag:"payment-success",data:{type:"payment_success",url:"/my-bookings"}}),reviewRequest:e=>({title:"評價邀請",body:"請為您的 ".concat(e," 體驗留下評價"),icon:"/icons/review.png",tag:"review-request",data:{type:"review_request",url:"/my-bookings"}}),guideNewBooking:(e,r)=>({title:"新預訂請求",body:"".concat(e," 預訂了您的「").concat(r,"」服務"),icon:"/icons/new-booking.png",tag:"new-booking",data:{type:"new_booking",url:"/guide-dashboard"},requireInteraction:!0})},d=(0,l.useCallback)((e,r)=>a(o.bookingConfirmed(e,r)),[a]),c=(0,l.useCallback)(e=>a(o.newMessage(e)),[a]),m=(0,l.useCallback)(e=>a(o.paymentSuccess(e)),[a]),h=(0,l.useCallback)(e=>a(o.reviewRequest(e)),[a]),u=(0,l.useCallback)((e,r)=>a(o.guideNewBooking(e,r)),[a]);return{permission:r.permission,isSupported:r.isSupported,isSubscribed:r.isSubscribed,requestPermission:s,subscribe:i,unsubscribe:n,sendLocalNotification:a,sendBookingConfirmation:d,sendNewMessageNotification:c,sendPaymentSuccessNotification:m,sendReviewRequestNotification:h,sendGuideNewBookingNotification:u,notificationTemplates:o}}(),[h,u]=(0,l.useState)(!1),[x,g]=(0,l.useState)(!1);(0,l.useEffect)(()=>{if(t&&n&&"default"===i){let e=setTimeout(()=>{u(!0)},3e3);return()=>clearTimeout(e)}},[t,n,i]);let b=async()=>{if(n){g(!0);try{let e=await o();"granted"===e&&(await d(),u(!1),setTimeout(()=>{m({title:"通知已啟用！",body:"您將收到預訂確認、新訊息等重要通知",icon:"/icons/notification-success.png",tag:"welcome-notification"})},1e3))}catch(e){}finally{g(!1)}}},p=async()=>{g(!0);try{await c(),u(!1)}catch(e){}finally{g(!1)}};return t&&n?(0,s.jsxs)(s.Fragment,{children:[h&&"granted"!==i&&(0,s.jsx)("div",{style:{position:"fixed",top:"1rem",right:"1rem",left:"1rem",maxWidth:"400px",marginLeft:"auto",marginRight:"auto",backgroundColor:"white",borderRadius:"0.5rem",padding:"1rem",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1)",border:"1px solid #e5e7eb",zIndex:1e3,animation:"slideInDown 0.3s ease-out"},className:r,children:(0,s.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",gap:"0.75rem"},children:[(0,s.jsx)("div",{style:{width:"2.5rem",height:"2.5rem",backgroundColor:"#3b82f6",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:(0,s.jsx)(q.Z,{style:{width:"1.25rem",height:"1.25rem",color:"white"}})}),(0,s.jsxs)("div",{style:{flex:1},children:[(0,s.jsx)("h3",{style:{fontSize:"1rem",fontWeight:"600",color:"#111827",marginBottom:"0.5rem"},children:"啟用通知功能"}),(0,s.jsx)("p",{style:{fontSize:"0.875rem",color:"#6b7280",marginBottom:"1rem",lineHeight:"1.5"},children:"接收預訂確認、新訊息和重要更新通知，讓您不錯過任何重要資訊。"}),(0,s.jsxs)("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[(0,s.jsxs)("button",{onClick:b,disabled:x,style:{padding:"0.5rem 1rem",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"0.375rem",fontSize:"0.875rem",fontWeight:"500",cursor:x?"not-allowed":"pointer",opacity:x?.6:1,display:"flex",alignItems:"center",gap:"0.5rem"},className:"hover:bg-blue-600",children:[x?(0,s.jsx)("div",{style:{width:"1rem",height:"1rem",border:"2px solid transparent",borderTop:"2px solid white",borderRadius:"50%",animation:"spin 1s linear infinite"}}):(0,s.jsx)(O.Z,{style:{width:"1rem",height:"1rem"}}),x?"啟用中...":"啟用通知"]}),(0,s.jsx)("button",{onClick:()=>u(!1),style:{padding:"0.5rem 1rem",backgroundColor:"transparent",color:"#6b7280",border:"1px solid #e5e7eb",borderRadius:"0.375rem",fontSize:"0.875rem",fontWeight:"500",cursor:"pointer"},className:"hover:bg-gray-50",children:"稍後再說"})]})]}),(0,s.jsx)("button",{onClick:()=>u(!1),style:{padding:"0.25rem",backgroundColor:"transparent",border:"none",borderRadius:"0.25rem",cursor:"pointer",flexShrink:0},className:"hover:bg-gray-100",children:(0,s.jsx)(f.Z,{style:{width:"1.25rem",height:"1.25rem",color:"#9ca3af"}})})]})}),(0,s.jsxs)("div",{style:{position:"fixed",top:"1rem",left:"1rem",zIndex:999},children:[(0,s.jsxs)("button",{onClick:()=>u(!h),style:{width:"2.5rem",height:"2.5rem",backgroundColor:"granted"===i?"#10b981":"#6b7280",border:"none",borderRadius:"50%",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)",transition:"all 0.2s"},className:"hover:scale-105",title:"granted"===i?"通知已啟用":"點擊啟用通知",children:[(0,s.jsx)(q.Z,{style:{width:"1.25rem",height:"1.25rem",color:"white"}}),"granted"===i&&a&&(0,s.jsx)("div",{style:{position:"absolute",top:"-0.125rem",right:"-0.125rem",width:"0.75rem",height:"0.75rem",backgroundColor:"#3b82f6",borderRadius:"50%",border:"2px solid white"}})]}),h&&"granted"===i&&(0,s.jsxs)("div",{style:{position:"absolute",top:"3rem",left:0,width:"280px",backgroundColor:"white",borderRadius:"0.5rem",padding:"1rem",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1)",border:"1px solid #e5e7eb"},children:[(0,s.jsxs)("div",{style:{fontSize:"1rem",fontWeight:"600",color:"#111827",marginBottom:"0.75rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,s.jsx)(y.Z,{style:{width:"1rem",height:"1rem"}}),"通知設定"]}),(0,s.jsxs)("div",{style:{padding:"0.75rem",backgroundColor:"#f0f9ff",borderRadius:"0.375rem",marginBottom:"1rem"},children:[(0,s.jsx)("div",{style:{fontSize:"0.875rem",fontWeight:"500",color:"#0369a1",marginBottom:"0.25rem"},children:"通知狀態：已啟用"}),(0,s.jsxs)("div",{style:{fontSize:"0.75rem",color:"#0284c7"},children:["訂閱狀態：",a?"已訂閱":"未訂閱"]})]}),(0,s.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[(0,s.jsx)("button",{onClick:()=>{"granted"===i&&m({title:"測試通知",body:"這是一個測試通知，確認通知功能正常運作",icon:"/icons/test-notification.png",tag:"test-notification"})},style:{padding:"0.5rem 0.75rem",backgroundColor:"#f3f4f6",border:"1px solid #e5e7eb",borderRadius:"0.375rem",fontSize:"0.875rem",cursor:"pointer",textAlign:"left"},className:"hover:bg-gray-100",children:"發送測試通知"}),(0,s.jsx)("button",{onClick:p,disabled:x,style:{padding:"0.5rem 0.75rem",backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"0.375rem",fontSize:"0.875rem",color:"#dc2626",cursor:x?"not-allowed":"pointer",textAlign:"left",opacity:x?.6:1},className:"hover:bg-red-100",children:x?"處理中...":"關閉通知"})]})]})]})]}):null}function H(e){let{children:r}=e,{mode:t}=o(),n=(0,i.usePathname)();return"guide"===t?(0,s.jsxs)("div",{className:"flex min-h-screen bg-gray-50",children:[(0,s.jsx)(S,{}),(0,s.jsx)("main",{className:"flex-1 lg:ml-80",children:(0,s.jsx)("div",{className:"min-h-screen",children:r})}),(0,s.jsx)(P,{}),(0,s.jsx)(U,{})]}):"/"===n?(0,s.jsx)(s.Fragment,{children:r}):(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)(_,{}),(0,s.jsx)("main",{className:(0,m.cn)("min-h-screen pt-16","pb-20"),children:r}),(0,s.jsx)(z,{}),(0,s.jsx)(P,{}),(0,s.jsx)(U,{})]})}},2169:function(e,r,t){"use strict";t.d(r,{cn:function(){return n}});var s=t(7042),i=t(4769);function n(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,i.m6)((0,s.W)(r))}}},function(e){e.O(0,[1216,4784,6828,1744],function(){return e(e.s=2938)}),_N_E=e.O()}]);