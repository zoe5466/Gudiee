(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6899],{1073:function(e,t,r){Promise.resolve().then(r.bind(r,2324))},2324:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return w}});var i=r(7437),s=r(2265),n=r(4033),l=r(8438),a=r(1291),o=r(7158),d=r(9764),c=r(7810),m=r(6142),h=r(2245),g=r(2176),u=r(9036),p=r(2505),x=r(8228),f=r(7290),b=r(5022),y=r(9578),j=r(5554),v=r(8982);function w(e){let{params:t}=e,r=(0,n.useRouter)(),{user:w,isAuthenticated:k}=(0,x.a)(),{success:C,error:N}=(0,f.pm)(),[S,F]=(0,s.useState)(null),[I,A]=(0,s.useState)(null),[R,z]=(0,s.useState)(2),[B,T]=(0,s.useState)(!0),[W,Z]=(0,s.useState)(!1),[D,E]=(0,s.useState)(!1),[H,_]=(0,s.useState)(0),[O,L]=(0,s.useState)(!1);(0,s.useEffect)(()=>{(async()=>{T(!0);try{let r=await fetch("/api/services/".concat(t.id));if(!r.ok)throw Error("服務不存在");let i=await r.json();if(i.success){var e;let t={id:i.data.id,title:i.data.title,description:i.data.description,location:i.data.location,price:i.data.price,rating:i.data.stats.averageRating,reviewCount:i.data.stats.totalReviews,duration:i.data.duration.toString(),maxGuests:i.data.maxGuests,images:i.data.images,guide:{id:i.data.guide.id,name:i.data.guide.name,avatar:i.data.guide.avatar||"https://images.unsplash.com/photo-1494790108755-2616b612b786?w=100&h=100&fit=crop&crop=face",rating:4.9,reviewCount:156,languages:i.data.guide.languages||["中文"],experience:"".concat(i.data.guide.experienceYears||3,"年導覽經驗"),specialties:i.data.guide.specialties||["專業導覽"],bio:i.data.guide.bio||"專業導遊，熱愛分享旅遊體驗"},highlights:i.data.highlights,reviews:i.data.reviews.map(e=>{var t,r;return{id:e.id,userName:(null===(t=e.reviewer)||void 0===t?void 0:t.name)||"匿名用戶",userAvatar:(null===(r=e.reviewer)||void 0===r?void 0:r.avatar)||"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop&crop=face",rating:e.rating,comment:e.comment,date:new Date(e.createdAt).toISOString().split("T")[0]}}),category:(null===(e=i.data.category)||void 0===e?void 0:e.name)||"旅遊導覽",isAvailable:"ACTIVE"===i.data.status,cancellationPolicy:i.data.cancellationPolicy,included:i.data.included,notIncluded:i.data.excluded};F(t)}else throw Error("載入失敗")}catch(e){N("載入失敗","無法載入服務詳情，請稍後再試"),r.push("/search")}finally{T(!1)}})()},[t.id,N,r]);let P=async()=>{if(!k){r.push("/login");return}try{E(!D),C(D?"已取消收藏":"已加入收藏","")}catch(e){N("操作失敗","請稍後再試")}},G=async()=>{if(!k){r.push("/login");return}if(!I){N("請選擇日期","預訂前請選擇服務日期");return}if(S){Z(!0);try{t.id,S.guide.id,I.toISOString(),parseInt(S.duration),S.price,parseInt(S.duration);let e=new URLSearchParams({serviceId:t.id,date:I.toISOString(),guests:R.toString()});r.push("/booking?".concat(e.toString()))}catch(e){N("預訂失敗","無法建立預訂，請稍後再試")}finally{Z(!1)}}},Y=async()=>{try{navigator.share?await navigator.share({title:null==S?void 0:S.title,text:null==S?void 0:S.description,url:window.location.href}):(await navigator.clipboard.writeText(window.location.href),C("已複製連結","連結已複製到剪貼板"))}catch(e){N("分享失敗","無法分享此服務")}};return B?(0,i.jsx)("div",{style:{minHeight:"100vh",background:"linear-gradient(to bottom right, #dbeafe, #ffffff, #e0e7ff)",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,i.jsx)(b.gb,{variant:"spinner",size:"lg"})}):S?(0,i.jsxs)("div",{style:{minHeight:"100vh",background:"linear-gradient(to bottom right, #dbeafe, #ffffff, #e0e7ff)"},children:[(0,i.jsx)(j.L6,{}),(0,i.jsxs)("main",{style:{backgroundColor:"white",borderRadius:"1rem 1rem 0 0",marginTop:"1rem"},children:[(0,i.jsxs)("div",{style:{position:"relative",height:"24rem",overflow:"hidden",borderRadius:"1rem 1rem 0 0"},children:[S?(0,i.jsx)("img",{src:S.images[H],alt:S.title,style:{width:"100%",height:"100%",objectFit:"cover",transition:"opacity 0.3s"}}):(0,i.jsx)("div",{style:{width:"100%",height:"100%",backgroundColor:"#f3f4f6",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,i.jsx)(l.Z,{style:{width:"4rem",height:"4rem",color:"#9ca3af"}})}),S&&S.images.length>1&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("button",{onClick:()=>_(e=>0===e?S.images.length-1:e-1),style:{position:"absolute",left:"0.5rem",top:"50%",transform:"translateY(-50%)",width:"2rem",height:"2rem",backgroundColor:"rgba(255, 255, 255, 0.9)",backdropFilter:"blur(4px)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",border:"none",cursor:"pointer",transition:"background-color 0.2s"},className:"hover:bg-white sm:left-4 sm:w-10 sm:h-10",children:(0,i.jsx)(a.Z,{style:{width:"1rem",height:"1rem",color:"#6b7280"},className:"sm:w-5 sm:h-5"})}),(0,i.jsx)("button",{onClick:()=>_(e=>e===S.images.length-1?0:e+1),style:{position:"absolute",right:"3rem",top:"50%",transform:"translateY(-50%)",width:"2rem",height:"2rem",backgroundColor:"rgba(255, 255, 255, 0.9)",backdropFilter:"blur(4px)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",border:"none",cursor:"pointer",transition:"background-color 0.2s"},className:"hover:bg-white sm:right-16 sm:w-10 sm:h-10",children:(0,i.jsx)(o.Z,{style:{width:"1rem",height:"1rem",color:"#6b7280"},className:"sm:w-5 sm:h-5"})}),(0,i.jsx)("div",{style:{position:"absolute",bottom:"1rem",left:"50%",transform:"translateX(-50%)",display:"flex",gap:"0.5rem"},children:S.images.map((e,t)=>(0,i.jsx)("button",{onClick:()=>_(t),style:{width:"0.5rem",height:"0.5rem",borderRadius:"50%",border:"none",cursor:"pointer",transition:"background-color 0.2s",backgroundColor:t===H?"white":"rgba(255, 255, 255, 0.5)"}},t))})]}),(0,i.jsxs)("div",{style:{position:"absolute",top:"0.5rem",right:"0.5rem",display:"flex",gap:"0.25rem"},className:"sm:top-4 sm:right-4 sm:gap-2",children:[(0,i.jsx)("button",{onClick:Y,style:{width:"2rem",height:"2rem",backgroundColor:"rgba(255, 255, 255, 0.9)",backdropFilter:"blur(4px)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",border:"none",cursor:"pointer",transition:"background-color 0.2s"},className:"hover:bg-white sm:w-10 sm:h-10",children:(0,i.jsx)(d.Z,{style:{width:"1rem",height:"1rem",color:"#6b7280"},className:"sm:w-5 sm:h-5"})}),(0,i.jsx)("button",{onClick:P,style:{width:"2rem",height:"2rem",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",border:"none",cursor:"pointer",transition:"all 0.2s",backgroundColor:D?"#ef4444":"rgba(255, 255, 255, 0.9)",backdropFilter:D?"none":"blur(4px)",color:D?"white":"#6b7280"},className:"hover:bg-white sm:w-10 sm:h-10",children:(0,i.jsx)(c.Z,{style:{width:"1rem",height:"1rem",fill:D?"currentColor":"none"},className:"sm:w-5 sm:h-5"})})]})]}),(0,i.jsx)("div",{style:{maxWidth:"1200px",margin:"0 auto",padding:"2rem 1.5rem"},children:(0,i.jsx)("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:"2rem"},children:(0,i.jsxs)("div",{style:{display:"grid",gap:"2rem"},className:"lg:grid-cols-[2fr_1fr]",children:[(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"2rem",order:2},className:"lg:order-1",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{style:{fontSize:"2.25rem",fontWeight:"700",color:"#111827",marginBottom:"1rem",lineHeight:"1.2"},children:S.title}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"1rem",fontSize:"0.875rem",color:"#6b7280",marginBottom:"1rem"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[(0,i.jsx)(m.Z,{style:{width:"1rem",height:"1rem"}}),(0,i.jsx)("span",{children:S.location})]}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[(0,i.jsx)(h.Z,{style:{width:"1rem",height:"1rem",fill:"#fbbf24",color:"#fbbf24"}}),(0,i.jsx)("span",{children:S.rating}),(0,i.jsxs)("span",{children:["(",S.reviewCount," 則評價)"]})]})]})]}),(0,i.jsx)("div",{style:{backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"1rem",padding:"1.5rem",boxShadow:"0 1px 3px 0 rgba(0, 0, 0, 0.1)"},children:(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},className:"sm:flex-row sm:items-center",children:[(0,i.jsx)("img",{src:S.guide.avatar,alt:S.guide.name,style:{width:"3rem",height:"3rem",borderRadius:"50%",objectFit:"cover"},className:"sm:w-16 sm:h-16"}),(0,i.jsxs)("div",{style:{flex:1},children:[(0,i.jsx)("h3",{style:{fontSize:"1.25rem",fontWeight:"600",color:"#111827"},children:S.guide.name}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.875rem",color:"#6b7280",marginBottom:"0.5rem"},children:[(0,i.jsx)(h.Z,{style:{width:"1rem",height:"1rem",fill:"#fbbf24",color:"#fbbf24"}}),(0,i.jsx)("span",{children:S.guide.rating}),(0,i.jsxs)("span",{children:["(",S.guide.reviewCount," 則評價)"]})]}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"1rem",fontSize:"0.875rem",color:"#6b7280"},children:[(0,i.jsx)("span",{children:S.guide.experience}),(0,i.jsx)("span",{children:"•"}),(0,i.jsx)("span",{children:S.guide.languages.join(", ")})]})]}),(0,i.jsxs)("button",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",padding:"0.75rem 1rem",backgroundColor:"#f3f4f6",color:"#374151",border:"none",borderRadius:"0.5rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:"500",transition:"background-color 0.2s",width:"100%"},className:"hover:bg-gray-200 sm:w-auto",children:[(0,i.jsx)(g.Z,{style:{width:"1rem",height:"1rem"}}),(0,i.jsx)("span",{className:"hidden sm:inline",children:"聯絡地陪"}),(0,i.jsx)("span",{className:"sm:hidden",children:"聯絡"})]})]})}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{style:{fontSize:"1.5rem",fontWeight:"600",color:"#111827",marginBottom:"1rem"},children:"關於此體驗"}),(0,i.jsx)("p",{style:{color:"#374151",lineHeight:"1.7"},children:S.description})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{style:{fontSize:"1.5rem",fontWeight:"600",color:"#111827",marginBottom:"1rem"},children:"體驗亮點"}),(0,i.jsx)("ul",{style:{display:"grid",gridTemplateColumns:"1fr",gap:"0.75rem"},className:"sm:grid-cols-2",children:S.highlights.map((e,t)=>(0,i.jsxs)("li",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[(0,i.jsx)("div",{style:{width:"0.5rem",height:"0.5rem",backgroundColor:"#FF5A5F",borderRadius:"50%"}}),(0,i.jsx)("span",{style:{color:"#374151"},children:e})]},t))})]}),(0,i.jsx)("div",{id:"reviews",children:(0,i.jsx)(v.j,{targetId:S.id,targetType:"service",showTitle:!0,showFilters:!0,showStatistics:!0})})]}),(0,i.jsx)("div",{style:{order:1},className:"lg:order-2",children:(0,i.jsxs)("div",{style:{backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"1rem",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)",padding:"1.5rem"},className:"lg:sticky lg:top-24",children:[(0,i.jsxs)("div",{style:{textAlign:"center",marginBottom:"1.5rem"},children:[(0,i.jsxs)("div",{style:{fontSize:"1.5rem",fontWeight:"700",color:"#111827"},className:"sm:text-3xl",children:["NT$ ",(null==S?void 0:S.price.toLocaleString())||0]}),(0,i.jsx)("div",{style:{color:"#6b7280"},children:"每小時"}),(null==S?void 0:S.duration)&&(0,i.jsxs)("div",{style:{fontSize:"0.875rem",color:"#6b7280",marginTop:"0.25rem"},children:["建議時長：",S.duration," 小時"]})]}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},className:"sm:grid sm:grid-cols-2 sm:gap-4 lg:flex lg:flex-col lg:gap-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"日期"}),(0,i.jsx)(y.M,{value:I||void 0,onChange:e=>A(e||null),minDate:new Date,className:"w-full",placeholder:"選擇日期"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"人數"}),(0,i.jsx)("select",{value:R,onChange:e=>z(parseInt(e.target.value)),style:{width:"100%",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"0.5rem",fontSize:"0.875rem",backgroundColor:"white"},children:S&&[...Array(S.maxGuests)].map((e,t)=>(0,i.jsxs)("option",{value:t+1,children:[t+1," 位旅客"]},t+1))})]}),(0,i.jsx)("div",{style:{paddingTop:"1rem"},className:"sm:col-span-2 lg:col-span-1",children:(0,i.jsx)("button",{onClick:G,disabled:W||!(null==S?void 0:S.isAvailable),style:{width:"100%",padding:"1rem",backgroundColor:(null==S?void 0:S.isAvailable)?"#FF5A5F":"#d1d5db",color:"white",border:"none",borderRadius:"0.5rem",fontSize:"1.125rem",fontWeight:"600",cursor:(null==S?void 0:S.isAvailable)?"pointer":"not-allowed",transition:"background-color 0.2s",opacity:!W&&(null==S?void 0:S.isAvailable)?1:.5},children:W?(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:[(0,i.jsx)("div",{style:{width:"1.25rem",height:"1.25rem",border:"2px solid transparent",borderTop:"2px solid white",borderRadius:"50%",animation:"spin 1s linear infinite"}}),"處理中..."]}):(null==S?void 0:S.isAvailable)?"立即預訂":"暫不可預訂"})}),(0,i.jsx)("div",{style:{textAlign:"center",fontSize:"0.875rem",color:"#6b7280"},children:"您不會被收費"})]}),(0,i.jsx)("div",{style:{marginTop:"1.5rem",paddingTop:"1.5rem",borderTop:"1px solid #e5e7eb"},children:(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"1rem",fontSize:"0.875rem",color:"#6b7280"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[(0,i.jsx)(u.Z,{style:{width:"1rem",height:"1rem",color:"#FF5A5F"}}),(0,i.jsx)("span",{children:"安全保障"})]}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[(0,i.jsx)(p.Z,{style:{width:"1rem",height:"1rem",color:"#FF5A5F"}}),(0,i.jsx)("span",{children:"品質保證"})]})]})})]})})]})})})]})]}):(0,i.jsx)("div",{style:{minHeight:"100vh",background:"linear-gradient(to bottom right, #dbeafe, #ffffff, #e0e7ff)",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,i.jsxs)("div",{style:{textAlign:"center"},children:[(0,i.jsx)("h1",{style:{fontSize:"1.5rem",fontWeight:"600",color:"#111827",marginBottom:"0.5rem"},children:"服務不存在"}),(0,i.jsx)("p",{style:{color:"#6b7280",marginBottom:"1.5rem"},children:"找不到您要查看的服務"}),(0,i.jsx)("button",{onClick:()=>r.push("/search"),style:{padding:"0.75rem 1.5rem",backgroundColor:"#FF5A5F",color:"white",borderRadius:"0.5rem",border:"none",cursor:"pointer",fontWeight:"500"},children:"返回搜尋"})]})})}},5554:function(e,t,r){"use strict";r.d(t,{L6:function(){return o},d8:function(){return l},us:function(){return a}});var i=r(7437),s=r(4033),n=r(1291);function l(e){let{showBackButton:t=!1,backButtonText:r="返回",showHomeButton:l=!0,homeButtonText:a="回到首頁",customBackAction:o}=e,d=(0,s.useRouter)();return(0,i.jsxs)(i.Fragment,{children:[l&&(0,i.jsx)("div",{style:{position:"absolute",top:"1rem",left:"1rem",zIndex:50},className:"sm:top-8 sm:left-8",children:(0,i.jsxs)("button",{onClick:()=>{d.push("/")},style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0.75rem",backgroundColor:"rgba(255, 255, 255, 0.9)",backdropFilter:"blur(10px)",borderRadius:"0.5rem",border:"1px solid rgba(255, 255, 255, 0.3)",cursor:"pointer",transition:"all 0.2s",fontSize:"0.75rem",fontWeight:"500",color:"#374151",boxShadow:"0 1px 3px 0 rgba(0, 0, 0, 0.1)"},className:"hover:bg-white hover:shadow-md sm:text-sm sm:px-4 sm:py-3",children:[(0,i.jsxs)("span",{className:"hidden sm:inline",children:["← ",a]}),(0,i.jsx)("span",{className:"sm:hidden",children:"← 首頁"})]})}),t&&(0,i.jsx)("div",{style:{maxWidth:"1200px",margin:"0 auto",padding:"1rem 1.5rem",paddingTop:l?"4rem":"1rem"},children:(0,i.jsxs)("button",{onClick:()=>{o?o():d.back()},style:{display:"flex",alignItems:"center",gap:"0.5rem",color:"#6b7280",background:"none",border:"none",cursor:"pointer",fontSize:"0.875rem",transition:"color 0.2s",padding:"0.5rem 0"},className:"hover:text-gray-900",children:[(0,i.jsx)(n.Z,{style:{width:"1.25rem",height:"1.25rem"}}),(0,i.jsx)("span",{children:r})]})})]})}function a(e){let{text:t="回到首頁"}=e;return(0,i.jsx)(l,{showHomeButton:!0,homeButtonText:t,showBackButton:!1})}function o(e){let{backButtonText:t="返回",homeButtonText:r="回到首頁",customBackAction:s}=e;return(0,i.jsx)(l,{showHomeButton:!0,showBackButton:!0,backButtonText:t,homeButtonText:r,customBackAction:s})}},5022:function(e,t,r){"use strict";r.d(t,{gb:function(){return n}});var i=r(7437);r(2265);var s=r(2169);function n(e){let{size:t="md",variant:r="spinner",className:n,text:l}=e,a={sm:"w-4 h-4",md:"w-6 h-6",lg:"w-8 h-8"},o={sm:"text-sm",md:"text-base",lg:"text-lg"};return"spinner"===r?(0,i.jsxs)("div",{className:(0,s.cn)("flex flex-col items-center justify-center",n),children:[(0,i.jsx)("div",{className:(0,s.cn)("animate-spin rounded-full border-2 border-gray-300 border-t-[#FF5A5F]",a[t])}),l&&(0,i.jsx)("p",{className:(0,s.cn)("mt-2 text-gray-600",o[t]),children:l})]}):"dots"===r?(0,i.jsxs)("div",{className:(0,s.cn)("flex flex-col items-center justify-center",n),children:[(0,i.jsx)("div",{className:"flex space-x-1",children:[0,1,2].map(e=>(0,i.jsx)("div",{className:(0,s.cn)("bg-[#FF5A5F] rounded-full animate-pulse","sm"===t?"w-2 h-2":"md"===t?"w-3 h-3":"w-4 h-4"),style:{animationDelay:"".concat(.2*e,"s"),animationDuration:"1.2s"}},e))}),l&&(0,i.jsx)("p",{className:(0,s.cn)("mt-2 text-gray-600",o[t]),children:l})]}):"pulse"===r?(0,i.jsxs)("div",{className:(0,s.cn)("flex flex-col items-center justify-center",n),children:[(0,i.jsx)("div",{className:(0,s.cn)("bg-[#FF5A5F] rounded-full animate-pulse",a[t])}),l&&(0,i.jsx)("p",{className:(0,s.cn)("mt-2 text-gray-600",o[t]),children:l})]}):null}}},function(e){e.O(0,[1216,8982,5991,1744],function(){return e(e.s=1073)}),_N_E=e.O()}]);