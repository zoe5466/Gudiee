(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7331,1248],{4364:function(e,s,t){Promise.resolve().then(t.bind(t,4220))},4220:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return v}});var r=t(7437),a=t(2265),i=t(4033),l=t(3021),n=t(9409),c=t(9883),d=t(5790),o=t(1298),m=t(5750),x=t(8203),u=t(2245),h=t(2176),g=t(1981),f=t(8783),p=t(6142),j=t(2457),y=t(8228),b=t(7290),N=t(5022);function v(){let e=(0,i.useRouter)(),{user:s,isAuthenticated:t}=(0,y.a)(),{error:v}=(0,b.pm)(),[w,F]=(0,a.useState)(!0),[A,k]=(0,a.useState)(null),[Z,T]=(0,a.useState)([]),[E,S]=(0,a.useState)([]),[C,L]=(0,a.useState)([]),[P,D]=(0,a.useState)("today");(0,a.useEffect)(()=>{if(!t){e.push("/login");return}O()},[t,e]);let O=async()=>{F(!0);try{k({todayEarnings:2400,monthlyOrders:28,customerRating:4.9,unreadMessages:3,totalEarnings:28500,completionRate:98,responseTime:"30分鐘",totalServices:156}),T([{id:"schedule-1",title:"台北101 & 信義區導覽",customer:"王小華",time:"14:00 - 17:00",duration:3,price:1500,status:"in_progress",location:"台北101"},{id:"schedule-2",title:"夜市美食體驗",customer:"李美玲",time:"19:00 - 21:00",duration:2,price:800,status:"upcoming",location:"士林夜市"}]),S([{id:"review-1",customerName:"王小華",customerAvatar:"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop&crop=face",rating:5,comment:"張導遊非常專業，帶我們走訪了很多私房景點，講解也很詳細有趣！",serviceTitle:"台北文化深度游",createdAt:"2024-01-16T10:30:00Z"},{id:"review-2",customerName:"李美玲",customerAvatar:"https://images.unsplash.com/photo-1494790108755-2616b612b786?w=100&h=100&fit=crop&crop=face",rating:5,comment:"行程安排很棒，時間控制得很好，推薦的餐廳也很道地！",serviceTitle:"夜市美食探索",createdAt:"2024-01-15T16:20:00Z"}]),L([{id:"action-1",type:"booking_request",title:"新的預訂請求",description:"陳先生想要預訂九份一日遊，2024年1月25日",priority:"high",createdAt:"2024-01-16T09:30:00Z"},{id:"action-2",type:"message",title:"客戶詢問",description:"張小姐詢問淡水行程的詳細內容",priority:"medium",createdAt:"2024-01-16T08:15:00Z"}])}catch(e){v("載入失敗","無法載入儀表板數據")}finally{F(!1)}},V=e=>({upcoming:"bg-blue-100 text-blue-800",in_progress:"bg-green-100 text-green-800",completed:"bg-gray-100 text-gray-800",cancelled:"bg-red-100 text-red-800"})[e],_=e=>({upcoming:"即將開始",in_progress:"進行中",completed:"已完成",cancelled:"已取消"})[e],z=e=>({high:"bg-red-100 text-red-800",medium:"bg-yellow-100 text-yellow-800",low:"bg-gray-100 text-gray-800"})[e];return w?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,r.jsx)("div",{className:"container py-8",children:(0,r.jsx)("div",{className:"flex justify-center items-center py-20",children:(0,r.jsx)(N.gb,{size:"lg"})})})}):(0,r.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,r.jsxs)("div",{className:"container py-8",children:[(0,r.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between mb-8",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:["歡迎回來，",(null==s?void 0:s.name)||"地陪朋友"," \uD83D\uDC4B"]}),(0,r.jsx)("p",{className:"text-gray-600",children:"今天準備迎接新的旅客了嗎？"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3 mt-4 lg:mt-0",children:[(0,r.jsxs)("select",{value:P,onChange:e=>D(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-[#FF5A5F] focus:border-[#FF5A5F]",children:[(0,r.jsx)("option",{value:"today",children:"今日"}),(0,r.jsx)("option",{value:"week",children:"本週"}),(0,r.jsx)("option",{value:"month",children:"本月"})]}),(0,r.jsx)("button",{className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",children:(0,r.jsx)(l.Z,{className:"w-5 h-5"})}),(0,r.jsx)("button",{className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",children:(0,r.jsx)(n.Z,{className:"w-5 h-5"})}),(0,r.jsxs)("button",{onClick:()=>e.push("/guide/services/create"),className:"flex items-center gap-2 px-4 py-2 bg-[#FF5A5F] text-white rounded-lg hover:bg-[#E1464A] transition-colors",children:[(0,r.jsx)(c.Z,{className:"w-4 h-4"}),"新增服務"]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"今日收入"}),(0,r.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:["NT$ ",null==A?void 0:A.todayEarnings.toLocaleString()]}),(0,r.jsxs)("p",{className:"text-sm text-green-600 mt-2 flex items-center",children:[(0,r.jsx)(d.Z,{className:"w-4 h-4 mr-1"}),"+12% 比昨日"]})]}),(0,r.jsx)("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:(0,r.jsx)(o.Z,{className:"w-6 h-6 text-green-600"})})]})}),(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"本月訂單"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:null==A?void 0:A.monthlyOrders}),(0,r.jsxs)("p",{className:"text-sm text-blue-600 mt-2 flex items-center",children:[(0,r.jsx)(m.Z,{className:"w-4 h-4 mr-1"}),"+8% 比上月"]})]}),(0,r.jsx)("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,r.jsx)(x.Z,{className:"w-6 h-6 text-blue-600"})})]})}),(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"客戶評分"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:null==A?void 0:A.customerRating}),(0,r.jsxs)("p",{className:"text-sm text-yellow-600 mt-2 flex items-center",children:[(0,r.jsx)(u.Z,{className:"w-4 h-4 mr-1 fill-current"}),null==A?void 0:A.completionRate,"% 完成率"]})]}),(0,r.jsx)("div",{className:"w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center",children:(0,r.jsx)(u.Z,{className:"w-6 h-6 text-yellow-600 fill-current"})})]})}),(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"未讀訊息"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:null==A?void 0:A.unreadMessages}),(0,r.jsxs)("p",{className:"text-sm text-purple-600 mt-2",children:["平均回覆：",null==A?void 0:A.responseTime]})]}),(0,r.jsx)("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:(0,r.jsx)(h.Z,{className:"w-6 h-6 text-purple-600"})})]})})]}),C.length>0&&(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-8",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[(0,r.jsx)(g.Z,{className:"w-5 h-5 text-orange-500 mr-2"}),"待處理事項 (",C.length,")"]}),(0,r.jsx)("button",{className:"text-sm text-[#FF5A5F] hover:text-[#E1464A] transition-colors",children:"查看全部"})]}),(0,r.jsx)("div",{className:"space-y-3",children:C.slice(0,3).map(e=>(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-200",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,r.jsx)("h4",{className:"font-medium text-gray-900",children:e.title}),(0,r.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(z(e.priority)),children:"high"===e.priority?"高":"medium"===e.priority?"中":"低"})]}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:e.description}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:new Date(e.createdAt).toLocaleString("zh-TW")})]}),(0,r.jsx)("button",{className:"ml-4 px-3 py-1 text-sm bg-[#FF5A5F] text-white rounded hover:bg-[#E1464A] transition-colors",children:"處理"})]},e.id))})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,r.jsx)("div",{className:"lg:col-span-2",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[(0,r.jsx)(x.Z,{className:"w-5 h-5 text-[#FF5A5F] mr-2"}),"今日行程"]}),(0,r.jsxs)("button",{onClick:()=>e.push("/guide/orders"),className:"text-sm text-[#FF5A5F] hover:text-[#E1464A] transition-colors flex items-center gap-1",children:["查看全部",(0,r.jsx)(f.Z,{className:"w-4 h-4"})]})]}),(0,r.jsx)("div",{className:"p-6",children:Z.length>0?(0,r.jsx)("div",{className:"space-y-4",children:Z.map(e=>(0,r.jsxs)("div",{className:"flex items-center p-4 border border-gray-200 rounded-lg hover:shadow-sm transition-shadow",children:[(0,r.jsx)("div",{className:"w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center mr-4",children:(0,r.jsx)(p.Z,{className:"w-6 h-6 text-gray-600"})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,r.jsx)("h4",{className:"font-medium text-gray-900",children:e.title}),(0,r.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(V(e.status)),children:_(e.status)})]}),(0,r.jsxs)("p",{className:"text-sm text-gray-600 mb-1",children:[e.time," • ",e.customer]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("span",{className:"text-sm text-gray-500 flex items-center",children:[(0,r.jsx)(p.Z,{className:"w-4 h-4 mr-1"}),e.location]}),(0,r.jsxs)("span",{className:"text-sm font-medium text-[#FF5A5F]",children:["NT$ ",e.price.toLocaleString()]})]})]}),(0,r.jsx)("button",{className:"ml-4 p-2 text-gray-400 hover:text-gray-600 transition-colors",children:(0,r.jsx)(f.Z,{className:"w-4 h-4"})})]},e.id))}):(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)(x.Z,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,r.jsx)("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"今日暫無行程"}),(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:"享受一個輕鬆的日子，或者查看明日安排"}),(0,r.jsx)("button",{className:"text-[#FF5A5F] hover:text-[#E1464A] transition-colors",children:"查看明日行程"})]})})]})}),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[(0,r.jsx)(u.Z,{className:"w-5 h-5 text-yellow-500 mr-2 fill-current"}),"最新評價"]}),(0,r.jsx)("button",{className:"text-sm text-[#FF5A5F] hover:text-[#E1464A] transition-colors",children:"查看全部"})]}),(0,r.jsx)("div",{className:"p-6",children:E.length>0?(0,r.jsx)("div",{className:"space-y-4",children:E.slice(0,2).map(e=>(0,r.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg",children:[(0,r.jsxs)("div",{className:"flex items-center mb-3",children:[(0,r.jsx)("img",{src:e.customerAvatar,alt:e.customerName,className:"w-8 h-8 rounded-full object-cover mr-3"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("div",{className:"font-medium text-gray-900",children:e.customerName}),(0,r.jsx)("div",{className:"flex items-center",children:[1,2,3,4,5].map(s=>(0,r.jsx)(u.Z,{className:"w-4 h-4 ".concat(s<=e.rating?"text-yellow-400 fill-current":"text-gray-300")},s))})]})]}),(0,r.jsxs)("p",{className:"text-sm text-gray-700 leading-relaxed",children:["“",e.comment,"”"]}),(0,r.jsxs)("p",{className:"text-xs text-gray-500 mt-2",children:[e.serviceTitle," • ",new Date(e.createdAt).toLocaleDateString("zh-TW")]})]},e.id))}):(0,r.jsxs)("div",{className:"text-center py-6",children:[(0,r.jsx)(u.Z,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),(0,r.jsx)("p",{className:"text-gray-600",children:"暫無新評價"})]})})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"快捷操作"}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("button",{onClick:()=>e.push("/guide/messages"),className:"w-full flex items-center justify-between p-3 text-left border border-gray-200 rounded-lg hover:border-[#FF5A5F] hover:bg-gray-50 transition-colors",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(h.Z,{className:"w-5 h-5 text-gray-600 mr-3"}),(0,r.jsx)("span",{className:"text-gray-900",children:"查看訊息"})]}),(0,r.jsx)(f.Z,{className:"w-4 h-4 text-gray-400"})]}),(0,r.jsxs)("button",{onClick:()=>e.push("/guide/orders"),className:"w-full flex items-center justify-between p-3 text-left border border-gray-200 rounded-lg hover:border-[#FF5A5F] hover:bg-gray-50 transition-colors",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(x.Z,{className:"w-5 h-5 text-gray-600 mr-3"}),(0,r.jsx)("span",{className:"text-gray-900",children:"管理訂單"})]}),(0,r.jsx)(f.Z,{className:"w-4 h-4 text-gray-400"})]}),(0,r.jsxs)("button",{onClick:()=>e.push("/guide/account"),className:"w-full flex items-center justify-between p-3 text-left border border-gray-200 rounded-lg hover:border-[#FF5A5F] hover:bg-gray-50 transition-colors",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(n.Z,{className:"w-5 h-5 text-gray-600 mr-3"}),(0,r.jsx)("span",{className:"text-gray-900",children:"帳戶設定"})]}),(0,r.jsx)(f.Z,{className:"w-4 h-4 text-gray-400"})]}),(0,r.jsxs)("button",{onClick:()=>e.push("/guide/analytics"),className:"w-full flex items-center justify-between p-3 text-left border border-gray-200 rounded-lg hover:border-[#FF5A5F] hover:bg-gray-50 transition-colors",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(j.Z,{className:"w-5 h-5 text-gray-600 mr-3"}),(0,r.jsx)("span",{className:"text-gray-900",children:"數據分析"})]}),(0,r.jsx)(f.Z,{className:"w-4 h-4 text-gray-400"})]})]})]})]})]})]})})}},5022:function(e,s,t){"use strict";t.d(s,{gb:function(){return i}});var r=t(7437);t(2265);var a=t(2169);function i(e){let{size:s="md",variant:t="spinner",className:i,text:l}=e,n={sm:"w-4 h-4",md:"w-6 h-6",lg:"w-8 h-8"},c={sm:"text-sm",md:"text-base",lg:"text-lg"};return"spinner"===t?(0,r.jsxs)("div",{className:(0,a.cn)("flex flex-col items-center justify-center",i),children:[(0,r.jsx)("div",{className:(0,a.cn)("animate-spin rounded-full border-2 border-gray-300 border-t-[#FF5A5F]",n[s])}),l&&(0,r.jsx)("p",{className:(0,a.cn)("mt-2 text-gray-600",c[s]),children:l})]}):"dots"===t?(0,r.jsxs)("div",{className:(0,a.cn)("flex flex-col items-center justify-center",i),children:[(0,r.jsx)("div",{className:"flex space-x-1",children:[0,1,2].map(e=>(0,r.jsx)("div",{className:(0,a.cn)("bg-[#FF5A5F] rounded-full animate-pulse","sm"===s?"w-2 h-2":"md"===s?"w-3 h-3":"w-4 h-4"),style:{animationDelay:"".concat(.2*e,"s"),animationDuration:"1.2s"}},e))}),l&&(0,r.jsx)("p",{className:(0,a.cn)("mt-2 text-gray-600",c[s]),children:l})]}):"pulse"===t?(0,r.jsxs)("div",{className:(0,a.cn)("flex flex-col items-center justify-center",i),children:[(0,r.jsx)("div",{className:(0,a.cn)("bg-[#FF5A5F] rounded-full animate-pulse",n[s])}),l&&(0,r.jsx)("p",{className:(0,a.cn)("mt-2 text-gray-600",c[s]),children:l})]}):null}},7290:function(e,s,t){"use strict";t.d(s,{pm:function(){return c}}),t(7437);var r=t(2265),a=t(3008),i=t(1981),l=t(2894),n=t(4056);function c(){let[e,s]=(0,r.useState)([]),t=e=>{let t=Math.random().toString(36).substr(2,9),r={id:t,duration:5e3,...e};return s(e=>[...e,r]),t};return{toasts:e,addToast:t,removeToast:e=>{s(s=>s.filter(s=>s.id!==e))},success:(e,s)=>t({type:"success",title:e,message:s}),error:(e,s)=>t({type:"error",title:e,message:s}),warning:(e,s)=>t({type:"warning",title:e,message:s}),info:(e,s)=>t({type:"info",title:e,message:s})}}a.Z,i.Z,l.Z,n.Z},2169:function(e,s,t){"use strict";t.d(s,{cn:function(){return i}});var r=t(7042),a=t(4769);function i(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,a.m6)((0,r.W)(s))}},8228:function(e,s,t){"use strict";t.d(s,{a:function(){return i}});var r=t(4660),a=t(4810);let i=(0,r.Ue)()((0,a.tJ)((e,s)=>({user:null,token:null,refreshToken:null,isLoading:!1,isAuthenticated:!1,login:async(s,t)=>{e({isLoading:!0});try{var r,a,i,l;let n=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:s,password:t})}),c=await n.json();if(!n.ok||!c.success)throw Error(c.error||c.message||"登入失敗");let d={id:c.data.user.id,email:c.data.user.email,name:c.data.user.name,avatar:c.data.user.avatar,role:c.data.user.role.toLowerCase(),isEmailVerified:c.data.user.isEmailVerified,isKYCVerified:c.data.user.isKycVerified,createdAt:c.data.user.createdAt,permissions:c.data.user.permissions||[],profile:{phone:c.data.user.phone,bio:null===(r=c.data.user.userProfile)||void 0===r?void 0:r.bio,location:null===(a=c.data.user.userProfile)||void 0===a?void 0:a.location,languages:null===(i=c.data.user.userProfile)||void 0===i?void 0:i.languages,specialties:null===(l=c.data.user.userProfile)||void 0===l?void 0:l.specialties}};e({user:d,token:c.data.token,refreshToken:null,isAuthenticated:!0,isLoading:!1})}catch(s){throw e({isLoading:!1}),s}},register:async s=>{e({isLoading:!0});try{await new Promise(e=>setTimeout(e,1500));let t={id:Date.now().toString(),email:s.email,name:s.name,role:s.userType||"customer",isEmailVerified:!1,isKYCVerified:!1,createdAt:new Date().toISOString(),permissions:"guide"===s.userType?["user:read","guide:manage","booking:manage"]:["user:read","booking:create"],profile:{phone:s.phone}},r="mock-jwt-token-"+Date.now();e({user:t,token:r,refreshToken:"mock-refresh-token",isAuthenticated:!0,isLoading:!1})}catch(s){throw e({isLoading:!1}),s}},logout:async()=>{try{await fetch("/api/auth/logout",{method:"POST",credentials:"include"})}catch(e){}e({user:null,token:null,refreshToken:null,isAuthenticated:!1})},updateUser:async t=>{let{user:r,token:a}=s();if(!r||!a)throw Error("未登入");e({isLoading:!0});try{let s=await fetch("/api/users/profile",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify(t)});if(!s.ok)throw Error("更新失敗");let i=await s.json();e({user:{...r,...i},isLoading:!1})}catch(s){throw e({isLoading:!1}),s}},refreshAuth:async()=>{let{refreshToken:t}=s();if(t)try{let s=await fetch("/api/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:t})});if(!s.ok)throw Error("Token 刷新失敗");let r=await s.json();e({token:r.token,refreshToken:r.refreshToken})}catch(e){s().logout()}},initializeAuth:async()=>{try{let i=await fetch("/api/auth/me",{credentials:"include"});if(i.ok){let l=await i.json();if(l.success&&l.data.user){var s,t,r,a;let i={id:l.data.user.id,email:l.data.user.email,name:l.data.user.name,avatar:l.data.user.avatar,role:l.data.user.role.toLowerCase(),isEmailVerified:l.data.user.isEmailVerified,isKYCVerified:l.data.user.isKycVerified,createdAt:l.data.user.createdAt,permissions:l.data.user.permissions||[],profile:{phone:l.data.user.phone,bio:null===(s=l.data.user.userProfile)||void 0===s?void 0:s.bio,location:null===(t=l.data.user.userProfile)||void 0===t?void 0:t.location,languages:null===(r=l.data.user.userProfile)||void 0===r?void 0:r.languages,specialties:null===(a=l.data.user.userProfile)||void 0===a?void 0:a.specialties}};e({user:i,isAuthenticated:!0})}}}catch(e){}},setLoading:s=>{e({isLoading:s})},hasPermission:e=>{var t;let{user:r}=s();return!!r&&("GUIDE"===r.role||(null===(t=r.permissions)||void 0===t?void 0:t.includes(e))||!1)}}),{name:"guidee-auth",partialize:e=>({user:e.user,token:e.token,refreshToken:e.refreshToken,isAuthenticated:e.isAuthenticated})}))}},function(e){e.O(0,[1216,1744],function(){return e(e.s=4364)}),_N_E=e.O()}]);