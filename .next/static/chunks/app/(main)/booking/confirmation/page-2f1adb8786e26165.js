(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9899],{776:function(e,r,i){Promise.resolve().then(i.bind(i,2788))},2788:function(e,r,i){"use strict";i.r(r),i.d(r,{default:function(){return j}});var t=i(7437),o=i(2265),s=i(4033),n=i(3008),a=i(6142),l=i(8203),d=i(6141),m=i(5750),c=i(1738),h=i(2741),u=i(1295),g=i(2882),f=i(5817),p=i(9764),x=i(3067),y=i(5554),b=i(8228);function j(){let e=(0,s.useRouter)(),r=(0,s.useSearchParams)(),{user:i}=(0,b.a)(),[j,v]=(0,o.useState)(null),[w,k]=(0,o.useState)(!0),S=r.get("id");return((0,o.useEffect)(()=>{if(!S){e.push("/");return}let r={id:S,serviceId:"1",serviceTitle:"台北101 & 信義區深度導覽",serviceImage:"https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400&h=300&fit=crop",guideName:"小美",guidePhone:"+886 912-345-678",guideEmail:"guide@example.com",guideAvatar:"https://images.unsplash.com/photo-1494790108755-2616b612b786?w=100&h=100&fit=crop&crop=face",date:"2024-02-15",time:"09:00",duration:"4小時",guests:2,location:"台北市信義區",totalAmount:1600,paymentMethod:"Credit Card",status:"confirmed",bookingReference:"GD"+Date.now().toString().slice(-8),specialRequests:"希望導遊可以協助拍照",customerInfo:{name:(null==i?void 0:i.name)||"訪客",email:(null==i?void 0:i.email)||"customer@example.com",phone:"+886 987-654-321"}};setTimeout(()=>{v(r),k(!1)},1e3)},[S,e,i]),w)?(0,t.jsx)("div",{style:{minHeight:"100vh",background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,t.jsx)("div",{style:{width:"3rem",height:"3rem",border:"3px solid rgba(255, 255, 255, 0.3)",borderTop:"3px solid white",borderRadius:"50%",animation:"spin 1s linear infinite"}})}):j?(0,t.jsxs)("div",{style:{minHeight:"100vh",background:"linear-gradient(135deg, #10b981 0%, #059669 100%)"},children:[(0,t.jsx)(y.us,{}),(0,t.jsxs)("div",{style:{maxWidth:"800px",margin:"0 auto",padding:"2rem 1rem"},children:[(0,t.jsxs)("div",{style:{backgroundColor:"white",borderRadius:"1rem",padding:"2rem",textAlign:"center",marginBottom:"1.5rem",border:"1px solid #e5e7eb"},children:[(0,t.jsx)("div",{style:{width:"4rem",height:"4rem",backgroundColor:"#10b981",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 1rem"},children:(0,t.jsx)(n.Z,{style:{width:"2rem",height:"2rem",color:"white"}})}),(0,t.jsx)("h1",{style:{fontSize:"2rem",fontWeight:"700",color:"#111827",marginBottom:"0.5rem"},children:"預訂成功！"}),(0,t.jsx)("p",{style:{fontSize:"1.125rem",color:"#6b7280",marginBottom:"1rem"},children:"您的預訂已確認，期待為您提供精彩的體驗"}),(0,t.jsxs)("div",{style:{display:"inline-flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"#f0fdf4",border:"1px solid #bbf7d0",borderRadius:"0.5rem",fontSize:"0.875rem",fontWeight:"500",color:"#059669"},children:["預訂編號：",j.bookingReference]})]}),(0,t.jsxs)("div",{style:{backgroundColor:"white",borderRadius:"1rem",border:"1px solid #e5e7eb",overflow:"hidden",marginBottom:"1.5rem"},children:[(0,t.jsxs)("div",{style:{display:"flex",gap:"1rem",padding:"1.5rem",borderBottom:"1px solid #f3f4f6"},children:[(0,t.jsx)("img",{src:j.serviceImage,alt:j.serviceTitle,style:{width:"100px",height:"100px",borderRadius:"0.5rem",objectFit:"cover"}}),(0,t.jsxs)("div",{style:{flex:1},children:[(0,t.jsx)("h3",{style:{fontSize:"1.25rem",fontWeight:"600",color:"#111827",marginBottom:"0.5rem"},children:j.serviceTitle}),(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",color:"#6b7280",fontSize:"0.875rem",marginBottom:"0.5rem"},children:[(0,t.jsx)(a.Z,{style:{width:"1rem",height:"1rem"}}),j.location]}),(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,t.jsx)("img",{src:j.guideAvatar,alt:j.guideName,style:{width:"1.5rem",height:"1.5rem",borderRadius:"50%",objectFit:"cover"}}),(0,t.jsxs)("span",{style:{fontSize:"0.875rem",color:"#6b7280"},children:["導遊：",j.guideName]})]})]})]}),(0,t.jsxs)("div",{style:{padding:"1.5rem"},children:[(0,t.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",marginBottom:"1.5rem"},children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.875rem",color:"#6b7280",marginBottom:"0.25rem"},children:[(0,t.jsx)(l.Z,{style:{width:"1rem",height:"1rem"}}),"預訂日期"]}),(0,t.jsx)("div",{style:{fontSize:"1rem",fontWeight:"500",color:"#111827"},children:new Date(j.date).toLocaleDateString("zh-TW",{year:"numeric",month:"long",day:"numeric",weekday:"long"})})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.875rem",color:"#6b7280",marginBottom:"0.25rem"},children:[(0,t.jsx)(d.Z,{style:{width:"1rem",height:"1rem"}}),"時間與時長"]}),(0,t.jsxs)("div",{style:{fontSize:"1rem",fontWeight:"500",color:"#111827"},children:[j.time," (",j.duration,")"]})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.875rem",color:"#6b7280",marginBottom:"0.25rem"},children:[(0,t.jsx)(m.Z,{style:{width:"1rem",height:"1rem"}}),"參加人數"]}),(0,t.jsxs)("div",{style:{fontSize:"1rem",fontWeight:"500",color:"#111827"},children:[j.guests," 位"]})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.875rem",color:"#6b7280",marginBottom:"0.25rem"},children:[(0,t.jsx)(c.Z,{style:{width:"1rem",height:"1rem"}}),"付款金額"]}),(0,t.jsxs)("div",{style:{fontSize:"1.25rem",fontWeight:"700",color:"#10b981"},children:["NT$ ",j.totalAmount.toLocaleString()]})]})]}),(0,t.jsxs)("div",{style:{padding:"1rem",backgroundColor:"#f8fafc",borderRadius:"0.5rem",marginBottom:"1rem"},children:[(0,t.jsx)("h4",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#374151",marginBottom:"0.75rem"},children:"聯絡資訊"}),(0,t.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:"0.75rem"},children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{style:{fontSize:"0.75rem",color:"#6b7280"},children:"姓名"}),(0,t.jsx)("div",{style:{fontSize:"0.875rem",fontWeight:"500",color:"#111827"},children:j.customerInfo.name})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{style:{fontSize:"0.75rem",color:"#6b7280"},children:"電子郵件"}),(0,t.jsx)("div",{style:{fontSize:"0.875rem",fontWeight:"500",color:"#111827"},children:j.customerInfo.email})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{style:{fontSize:"0.75rem",color:"#6b7280"},children:"聯絡電話"}),(0,t.jsx)("div",{style:{fontSize:"0.875rem",fontWeight:"500",color:"#111827"},children:j.customerInfo.phone})]})]})]}),j.specialRequests&&(0,t.jsxs)("div",{style:{padding:"1rem",backgroundColor:"#fef7ff",border:"1px solid #e9d5ff",borderRadius:"0.5rem"},children:[(0,t.jsx)("h4",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#374151",marginBottom:"0.5rem"},children:"特殊需求"}),(0,t.jsx)("p",{style:{fontSize:"0.875rem",color:"#6b7280"},children:j.specialRequests})]})]})]}),(0,t.jsxs)("div",{style:{backgroundColor:"white",borderRadius:"1rem",border:"1px solid #e5e7eb",padding:"1.5rem",marginBottom:"1.5rem"},children:[(0,t.jsx)("h3",{style:{fontSize:"1.125rem",fontWeight:"600",color:"#111827",marginBottom:"1rem"},children:"導遊聯絡資訊"}),(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:"1rem"},children:[(0,t.jsx)("img",{src:j.guideAvatar,alt:j.guideName,style:{width:"3rem",height:"3rem",borderRadius:"50%",objectFit:"cover"}}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{style:{fontSize:"1rem",fontWeight:"600",color:"#111827"},children:j.guideName}),(0,t.jsx)("div",{style:{fontSize:"0.875rem",color:"#6b7280"},children:"專業地陪導遊"})]})]}),(0,t.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem"},children:[(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,t.jsx)(h.Z,{style:{width:"1rem",height:"1rem",color:"#6b7280"}}),(0,t.jsx)("span",{style:{fontSize:"0.875rem",color:"#374151"},children:j.guidePhone})]}),(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,t.jsx)(u.Z,{style:{width:"1rem",height:"1rem",color:"#6b7280"}}),(0,t.jsx)("span",{style:{fontSize:"0.875rem",color:"#374151"},children:j.guideEmail})]})]})]}),(0,t.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",marginBottom:"2rem"},children:[(0,t.jsxs)("button",{onClick:()=>{e.push("/chat?guideId=".concat(null==j?void 0:j.serviceId))},style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",padding:"0.75rem 1.5rem",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"0.5rem",fontSize:"0.875rem",fontWeight:"500",cursor:"pointer"},children:[(0,t.jsx)(g.Z,{style:{width:"1rem",height:"1rem"}}),"聯絡導遊"]}),(0,t.jsxs)("button",{onClick:()=>{alert("票券下載功能開發中")},style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",padding:"0.75rem 1.5rem",backgroundColor:"white",color:"#374151",border:"1px solid #e5e7eb",borderRadius:"0.5rem",fontSize:"0.875rem",fontWeight:"500",cursor:"pointer"},children:[(0,t.jsx)(f.Z,{style:{width:"1rem",height:"1rem"}}),"下載票券"]}),(0,t.jsxs)("button",{onClick:()=>{navigator.share?navigator.share({title:"Guidee 預訂確認 - ".concat(null==j?void 0:j.serviceTitle),text:"我已成功預訂".concat(null==j?void 0:j.serviceTitle,"，期待這次的體驗！"),url:window.location.href}):(navigator.clipboard.writeText(window.location.href),alert("預訂連結已複製到剪貼板"))},style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",padding:"0.75rem 1.5rem",backgroundColor:"white",color:"#374151",border:"1px solid #e5e7eb",borderRadius:"0.5rem",fontSize:"0.875rem",fontWeight:"500",cursor:"pointer"},children:[(0,t.jsx)(p.Z,{style:{width:"1rem",height:"1rem"}}),"分享預訂"]}),(0,t.jsxs)("button",{onClick:()=>e.push("/profile/bookings"),style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",padding:"0.75rem 1.5rem",backgroundColor:"white",color:"#374151",border:"1px solid #e5e7eb",borderRadius:"0.5rem",fontSize:"0.875rem",fontWeight:"500",cursor:"pointer"},children:[(0,t.jsx)(x.Z,{style:{width:"1rem",height:"1rem"}}),"查看所有預訂"]})]}),(0,t.jsxs)("div",{style:{backgroundColor:"#fffbeb",border:"1px solid #fbbf24",borderRadius:"0.5rem",padding:"1rem"},children:[(0,t.jsx)("h4",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#92400e",marginBottom:"0.5rem"},children:"重要提醒"}),(0,t.jsxs)("ul",{style:{fontSize:"0.875rem",color:"#92400e",paddingLeft:"1.25rem"},children:[(0,t.jsx)("li",{children:"請於預訂日期前一天再次確認行程安排"}),(0,t.jsx)("li",{children:"如需取消或修改預訂，請提前24小時聯絡導遊"}),(0,t.jsx)("li",{children:"建議提前10-15分鐘到達集合地點"}),(0,t.jsx)("li",{children:"如遇天候不佳，導遊會主動聯絡安排替代方案"})]})]})]})]}):(0,t.jsx)("div",{style:{minHeight:"100vh",background:"linear-gradient(135deg, #ef4444 0%, #dc2626 100%)",display:"flex",alignItems:"center",justifyContent:"center",padding:"2rem"},children:(0,t.jsxs)("div",{style:{backgroundColor:"white",borderRadius:"1rem",padding:"2rem",textAlign:"center",maxWidth:"400px"},children:[(0,t.jsx)("h2",{style:{fontSize:"1.5rem",fontWeight:"600",color:"#111827",marginBottom:"1rem"},children:"找不到預訂資訊"}),(0,t.jsx)("p",{style:{color:"#6b7280",marginBottom:"1.5rem"},children:"請檢查您的預訂編號是否正確"}),(0,t.jsx)("button",{onClick:()=>e.push("/"),style:{padding:"0.75rem 1.5rem",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"0.5rem",fontSize:"0.875rem",fontWeight:"500",cursor:"pointer"},children:"返回首頁"})]})})}},5554:function(e,r,i){"use strict";i.d(r,{L6:function(){return l},d8:function(){return n},us:function(){return a}});var t=i(7437),o=i(4033),s=i(1291);function n(e){let{showBackButton:r=!1,backButtonText:i="返回",showHomeButton:n=!0,homeButtonText:a="回到首頁",customBackAction:l}=e,d=(0,o.useRouter)();return(0,t.jsxs)(t.Fragment,{children:[n&&(0,t.jsx)("div",{style:{position:"absolute",top:"1rem",left:"1rem",zIndex:50},className:"sm:top-8 sm:left-8",children:(0,t.jsxs)("button",{onClick:()=>{d.push("/")},style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0.75rem",backgroundColor:"rgba(255, 255, 255, 0.9)",backdropFilter:"blur(10px)",borderRadius:"0.5rem",border:"1px solid rgba(255, 255, 255, 0.3)",cursor:"pointer",transition:"all 0.2s",fontSize:"0.75rem",fontWeight:"500",color:"#374151",boxShadow:"0 1px 3px 0 rgba(0, 0, 0, 0.1)"},className:"hover:bg-white hover:shadow-md sm:text-sm sm:px-4 sm:py-3",children:[(0,t.jsxs)("span",{className:"hidden sm:inline",children:["← ",a]}),(0,t.jsx)("span",{className:"sm:hidden",children:"← 首頁"})]})}),r&&(0,t.jsx)("div",{style:{maxWidth:"1200px",margin:"0 auto",padding:"1rem 1.5rem",paddingTop:n?"4rem":"1rem"},children:(0,t.jsxs)("button",{onClick:()=>{l?l():d.back()},style:{display:"flex",alignItems:"center",gap:"0.5rem",color:"#6b7280",background:"none",border:"none",cursor:"pointer",fontSize:"0.875rem",transition:"color 0.2s",padding:"0.5rem 0"},className:"hover:text-gray-900",children:[(0,t.jsx)(s.Z,{style:{width:"1.25rem",height:"1.25rem"}}),(0,t.jsx)("span",{children:i})]})})]})}function a(e){let{text:r="回到首頁"}=e;return(0,t.jsx)(n,{showHomeButton:!0,homeButtonText:r,showBackButton:!1})}function l(e){let{backButtonText:r="返回",homeButtonText:i="回到首頁",customBackAction:o}=e;return(0,t.jsx)(n,{showHomeButton:!0,showBackButton:!0,backButtonText:r,homeButtonText:i,customBackAction:o})}},8228:function(e,r,i){"use strict";i.d(r,{a:function(){return s}});var t=i(4660),o=i(4810);let s=(0,t.Ue)()((0,o.tJ)((e,r)=>({user:null,token:null,refreshToken:null,isLoading:!1,isAuthenticated:!1,login:async(r,i)=>{e({isLoading:!0});try{var t,o,s,n;let a=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:r,password:i})}),l=await a.json();if(!a.ok||!l.success)throw Error(l.error||l.message||"登入失敗");let d={id:l.data.user.id,email:l.data.user.email,name:l.data.user.name,avatar:l.data.user.avatar,role:l.data.user.role.toLowerCase(),isEmailVerified:l.data.user.isEmailVerified,isKYCVerified:l.data.user.isKycVerified,createdAt:l.data.user.createdAt,permissions:l.data.user.permissions||[],profile:{phone:l.data.user.phone,bio:null===(t=l.data.user.userProfile)||void 0===t?void 0:t.bio,location:null===(o=l.data.user.userProfile)||void 0===o?void 0:o.location,languages:null===(s=l.data.user.userProfile)||void 0===s?void 0:s.languages,specialties:null===(n=l.data.user.userProfile)||void 0===n?void 0:n.specialties}};e({user:d,token:l.data.token,refreshToken:null,isAuthenticated:!0,isLoading:!1})}catch(r){throw e({isLoading:!1}),r}},register:async r=>{e({isLoading:!0});try{await new Promise(e=>setTimeout(e,1500));let i={id:Date.now().toString(),email:r.email,name:r.name,role:r.userType||"customer",isEmailVerified:!1,isKYCVerified:!1,createdAt:new Date().toISOString(),permissions:"guide"===r.userType?["user:read","guide:manage","booking:manage"]:["user:read","booking:create"],profile:{phone:r.phone}},t="mock-jwt-token-"+Date.now();e({user:i,token:t,refreshToken:"mock-refresh-token",isAuthenticated:!0,isLoading:!1})}catch(r){throw e({isLoading:!1}),r}},logout:async()=>{try{await fetch("/api/auth/logout",{method:"POST",credentials:"include"})}catch(e){}e({user:null,token:null,refreshToken:null,isAuthenticated:!1})},updateUser:async i=>{let{user:t,token:o}=r();if(!t||!o)throw Error("未登入");e({isLoading:!0});try{let r=await fetch("/api/users/profile",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(o)},body:JSON.stringify(i)});if(!r.ok)throw Error("更新失敗");let s=await r.json();e({user:{...t,...s},isLoading:!1})}catch(r){throw e({isLoading:!1}),r}},refreshAuth:async()=>{let{refreshToken:i}=r();if(i)try{let r=await fetch("/api/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:i})});if(!r.ok)throw Error("Token 刷新失敗");let t=await r.json();e({token:t.token,refreshToken:t.refreshToken})}catch(e){r().logout()}},initializeAuth:async()=>{try{let s=await fetch("/api/auth/me",{credentials:"include"});if(s.ok){let n=await s.json();if(n.success&&n.data.user){var r,i,t,o;let s={id:n.data.user.id,email:n.data.user.email,name:n.data.user.name,avatar:n.data.user.avatar,role:n.data.user.role.toLowerCase(),isEmailVerified:n.data.user.isEmailVerified,isKYCVerified:n.data.user.isKycVerified,createdAt:n.data.user.createdAt,permissions:n.data.user.permissions||[],profile:{phone:n.data.user.phone,bio:null===(r=n.data.user.userProfile)||void 0===r?void 0:r.bio,location:null===(i=n.data.user.userProfile)||void 0===i?void 0:i.location,languages:null===(t=n.data.user.userProfile)||void 0===t?void 0:t.languages,specialties:null===(o=n.data.user.userProfile)||void 0===o?void 0:o.specialties}};e({user:s,isAuthenticated:!0})}}}catch(e){}},setLoading:r=>{e({isLoading:r})},hasPermission:e=>{var i;let{user:t}=r();return!!t&&("GUIDE"===t.role||(null===(i=t.permissions)||void 0===i?void 0:i.includes(e))||!1)}}),{name:"guidee-auth",partialize:e=>({user:e.user,token:e.token,refreshToken:e.refreshToken,isAuthenticated:e.isAuthenticated})}))}},function(e){e.O(0,[1216,1744],function(){return e(e.s=776)}),_N_E=e.O()}]);