(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4040],{7936:function(e,r,i){Promise.resolve().then(i.bind(i,5520))},5520:function(e,r,i){"use strict";i.r(r),i.d(r,{default:function(){return u}});var t=i(7437),o=i(2265),a=i(1396),s=i.n(a),n=i(4033),l=i(8228),d=i(7290);function u(){let e=(0,n.useRouter)(),{login:r,isLoading:i}=(0,l.a)(),{success:a,error:u}=(0,d.pm)(),[c,m]=(0,o.useState)({email:"",password:"",rememberMe:!1}),[h,p]=(0,o.useState)({}),f=()=>{let e={};return c.email?/\S+@\S+\.\S+/.test(c.email)||(e.email="請輸入有效的電子郵件格式"):e.email="請輸入電子郵件",c.password?c.password.length<6&&(e.password="密碼必須至少6個字元"):e.password="請輸入密碼",p(e),0===Object.keys(e).length},g=e=>{let{name:r,value:i,type:t,checked:o}=e.target;m(e=>({...e,[r]:"checkbox"===t?o:i})),h[r]&&p(e=>({...e,[r]:void 0}))},b=async i=>{if(i.preventDefault(),f())try{await r(c.email,c.password),a("登入成功","歡迎回來！"),e.push("/")}catch(e){u("登入失敗","電子郵件或密碼錯誤，請重新嘗試")}};return(0,t.jsxs)("div",{style:{minHeight:"100vh",background:"linear-gradient(to bottom right, #dbeafe, #ffffff, #e0e7ff)",display:"flex",alignItems:"center",justifyContent:"center",padding:"3rem 1rem"},children:[(0,t.jsx)("div",{style:{position:"absolute",top:"2rem",left:"2rem",zIndex:10},children:(0,t.jsx)("button",{onClick:()=>e.push("/"),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.75rem 1rem",backgroundColor:"rgba(255, 255, 255, 0.9)",backdropFilter:"blur(10px)",borderRadius:"0.5rem",border:"1px solid rgba(255, 255, 255, 0.3)",cursor:"pointer",transition:"all 0.2s",fontSize:"0.875rem",fontWeight:"500",color:"#374151"},className:"hover:bg-white hover:shadow-md",children:"← 回到首頁"})}),(0,t.jsxs)("div",{style:{maxWidth:"26rem",width:"100%",backgroundColor:"white",borderRadius:"1rem",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)",border:"1px solid #f3f4f6",padding:"2rem",backdropFilter:"blur(10px)"},children:[(0,t.jsxs)("div",{style:{textAlign:"center",marginBottom:"2rem"},children:[(0,t.jsx)("div",{style:{margin:"0 auto 1.5rem",height:"3rem",width:"3rem",background:"linear-gradient(to right, #2563eb, #4f46e5)",borderRadius:"0.75rem",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1)"},children:(0,t.jsx)("span",{style:{color:"white",fontWeight:"bold",fontSize:"1.25rem"},children:"G"})}),(0,t.jsx)("h1",{style:{fontSize:"2rem",fontWeight:"700",color:"#111827",marginBottom:"0.5rem",lineHeight:"1.2"},children:"歡迎回來"}),(0,t.jsx)("p",{style:{color:"#6b7280",fontSize:"0.875rem"},children:"登入您的 Guidee 帳號"}),(0,t.jsxs)("div",{style:{marginTop:"1rem"},children:[(0,t.jsx)("span",{style:{color:"#6b7280",fontSize:"0.875rem"},children:"還沒有帳號？"})," ",(0,t.jsx)(s(),{href:"/register",style:{color:"#2563eb",fontWeight:"500",textDecoration:"none"},className:"hover:text-blue-700",children:"立即註冊"})]})]}),(0,t.jsxs)("form",{onSubmit:b,style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:[(0,t.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"email",style:{display:"block",fontSize:"0.875rem",fontWeight:"600",color:"#374151",marginBottom:"0.5rem"},children:"電子郵件"}),(0,t.jsx)("input",{id:"email",name:"email",type:"email",autoComplete:"email",value:c.email,onChange:g,style:{width:"100%",padding:"0.75rem 1rem",border:h.email?"1px solid #ef4444":"1px solid #e5e7eb",borderRadius:"0.5rem",fontSize:"1rem",transition:"all 0.2s",outline:"none",backgroundColor:"white"},className:"focus:border-blue-500 focus:ring-2 focus:ring-blue-200",placeholder:"輸入您的電子郵件地址"}),h.email&&(0,t.jsx)("p",{style:{marginTop:"0.25rem",fontSize:"0.875rem",color:"#ef4444"},children:h.email})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"password",style:{display:"block",fontSize:"0.875rem",fontWeight:"600",color:"#374151",marginBottom:"0.5rem"},children:"密碼"}),(0,t.jsx)("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",value:c.password,onChange:g,style:{width:"100%",padding:"0.75rem 1rem",border:h.password?"1px solid #ef4444":"1px solid #e5e7eb",borderRadius:"0.5rem",fontSize:"1rem",transition:"all 0.2s",outline:"none",backgroundColor:"white"},className:"focus:border-blue-500 focus:ring-2 focus:ring-blue-200",placeholder:"輸入您的密碼"}),h.password&&(0,t.jsx)("p",{style:{marginTop:"0.25rem",fontSize:"0.875rem",color:"#ef4444"},children:h.password})]})]}),(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,t.jsx)("input",{id:"rememberMe",name:"rememberMe",type:"checkbox",checked:c.rememberMe,onChange:g,style:{width:"1rem",height:"1rem",accentColor:"#2563eb",cursor:"pointer"}}),(0,t.jsx)("label",{htmlFor:"rememberMe",style:{fontSize:"0.875rem",color:"#374151",cursor:"pointer"},children:"記住我"})]}),(0,t.jsx)(s(),{href:"/forgot-password",style:{fontSize:"0.875rem",color:"#2563eb",textDecoration:"none",fontWeight:"500"},className:"hover:text-blue-700 hover:underline",children:"忘記密碼？"})]}),(0,t.jsx)("button",{type:"submit",disabled:i,style:{width:"100%",padding:"0.875rem 1.5rem",background:i?"#9ca3af":"linear-gradient(to right, #2563eb, #4f46e5)",color:"white",border:"none",borderRadius:"0.5rem",fontSize:"1rem",fontWeight:"600",cursor:i?"not-allowed":"pointer",transition:"all 0.2s",boxShadow:i?"none":"0 10px 15px -3px rgba(0, 0, 0, 0.1)",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},className:i?"":"hover:shadow-lg hover:scale-105",children:i?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{style:{width:"1.25rem",height:"1.25rem",border:"2px solid transparent",borderTop:"2px solid white",borderRadius:"50%",animation:"spin 1s linear infinite"}}),"登入中..."]}):"登入"}),(0,t.jsxs)("div",{style:{position:"relative"},children:[(0,t.jsx)("div",{style:{position:"absolute",inset:"0",display:"flex",alignItems:"center"},children:(0,t.jsx)("div",{style:{width:"100%",borderTop:"1px solid #e5e7eb"}})}),(0,t.jsx)("div",{style:{position:"relative",display:"flex",justifyContent:"center"},children:(0,t.jsx)("span",{style:{padding:"0 0.5rem",backgroundColor:"white",color:"#6b7280",fontSize:"0.875rem"},children:"或"})})]}),(0,t.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem"},children:[(0,t.jsx)("button",{type:"button",style:{padding:"0.75rem 1rem",border:"1px solid #e5e7eb",borderRadius:"0.5rem",backgroundColor:"white",cursor:"pointer",transition:"all 0.2s",fontSize:"0.875rem",fontWeight:"500",color:"#374151"},className:"hover:bg-gray-50 hover:border-gray-400",children:"Google"}),(0,t.jsx)("button",{type:"button",style:{padding:"0.75rem 1rem",border:"1px solid #e5e7eb",borderRadius:"0.5rem",backgroundColor:"white",cursor:"pointer",transition:"all 0.2s",fontSize:"0.875rem",fontWeight:"500",color:"#374151"},className:"hover:bg-gray-50 hover:border-gray-400",children:"Facebook"})]})]})]})]})}},7290:function(e,r,i){"use strict";i.d(r,{pm:function(){return l}}),i(7437);var t=i(2265),o=i(3008),a=i(1981),s=i(2894),n=i(4056);function l(){let[e,r]=(0,t.useState)([]),i=e=>{let i=Math.random().toString(36).substr(2,9),t={id:i,duration:5e3,...e};return r(e=>[...e,t]),i};return{toasts:e,addToast:i,removeToast:e=>{r(r=>r.filter(r=>r.id!==e))},success:(e,r)=>i({type:"success",title:e,message:r}),error:(e,r)=>i({type:"error",title:e,message:r}),warning:(e,r)=>i({type:"warning",title:e,message:r}),info:(e,r)=>i({type:"info",title:e,message:r})}}o.Z,a.Z,s.Z,n.Z},8228:function(e,r,i){"use strict";i.d(r,{a:function(){return a}});var t=i(4660),o=i(4810);let a=(0,t.Ue)()((0,o.tJ)((e,r)=>({user:null,token:null,refreshToken:null,isLoading:!1,isAuthenticated:!1,login:async(r,i)=>{e({isLoading:!0});try{var t,o,a,s;let n=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:r,password:i})}),l=await n.json();if(!n.ok||!l.success)throw Error(l.error||l.message||"登入失敗");let d={id:l.data.user.id,email:l.data.user.email,name:l.data.user.name,avatar:l.data.user.avatar,role:l.data.user.role.toLowerCase(),isEmailVerified:l.data.user.isEmailVerified,isKYCVerified:l.data.user.isKycVerified,createdAt:l.data.user.createdAt,permissions:l.data.user.permissions||[],profile:{phone:l.data.user.phone,bio:null===(t=l.data.user.userProfile)||void 0===t?void 0:t.bio,location:null===(o=l.data.user.userProfile)||void 0===o?void 0:o.location,languages:null===(a=l.data.user.userProfile)||void 0===a?void 0:a.languages,specialties:null===(s=l.data.user.userProfile)||void 0===s?void 0:s.specialties}};e({user:d,token:l.data.token,refreshToken:null,isAuthenticated:!0,isLoading:!1})}catch(r){throw e({isLoading:!1}),r}},register:async r=>{e({isLoading:!0});try{await new Promise(e=>setTimeout(e,1500));let i={id:Date.now().toString(),email:r.email,name:r.name,role:r.userType||"customer",isEmailVerified:!1,isKYCVerified:!1,createdAt:new Date().toISOString(),permissions:"guide"===r.userType?["user:read","guide:manage","booking:manage"]:["user:read","booking:create"],profile:{phone:r.phone}},t="mock-jwt-token-"+Date.now();e({user:i,token:t,refreshToken:"mock-refresh-token",isAuthenticated:!0,isLoading:!1})}catch(r){throw e({isLoading:!1}),r}},logout:async()=>{try{await fetch("/api/auth/logout",{method:"POST",credentials:"include"})}catch(e){}e({user:null,token:null,refreshToken:null,isAuthenticated:!1})},updateUser:async i=>{let{user:t,token:o}=r();if(!t||!o)throw Error("未登入");e({isLoading:!0});try{let r=await fetch("/api/users/profile",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(o)},body:JSON.stringify(i)});if(!r.ok)throw Error("更新失敗");let a=await r.json();e({user:{...t,...a},isLoading:!1})}catch(r){throw e({isLoading:!1}),r}},refreshAuth:async()=>{let{refreshToken:i}=r();if(i)try{let r=await fetch("/api/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:i})});if(!r.ok)throw Error("Token 刷新失敗");let t=await r.json();e({token:t.token,refreshToken:t.refreshToken})}catch(e){r().logout()}},initializeAuth:async()=>{try{let a=await fetch("/api/auth/me",{credentials:"include"});if(a.ok){let s=await a.json();if(s.success&&s.data.user){var r,i,t,o;let a={id:s.data.user.id,email:s.data.user.email,name:s.data.user.name,avatar:s.data.user.avatar,role:s.data.user.role.toLowerCase(),isEmailVerified:s.data.user.isEmailVerified,isKYCVerified:s.data.user.isKycVerified,createdAt:s.data.user.createdAt,permissions:s.data.user.permissions||[],profile:{phone:s.data.user.phone,bio:null===(r=s.data.user.userProfile)||void 0===r?void 0:r.bio,location:null===(i=s.data.user.userProfile)||void 0===i?void 0:i.location,languages:null===(t=s.data.user.userProfile)||void 0===t?void 0:t.languages,specialties:null===(o=s.data.user.userProfile)||void 0===o?void 0:o.specialties}};e({user:a,isAuthenticated:!0})}}}catch(e){}},setLoading:r=>{e({isLoading:r})},hasPermission:e=>{var i;let{user:t}=r();return!!t&&("GUIDE"===t.role||(null===(i=t.permissions)||void 0===i?void 0:i.includes(e))||!1)}}),{name:"guidee-auth",partialize:e=>({user:e.user,token:e.token,refreshToken:e.refreshToken,isAuthenticated:e.isAuthenticated})}))}},function(e){e.O(0,[1216,1744],function(){return e(e.s=7936)}),_N_E=e.O()}]);