(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9049],{5526:function(e,r,i){Promise.resolve().then(i.bind(i,8058))},8058:function(e,r,i){"use strict";i.r(r),i.d(r,{default:function(){return c}});var o=i(7437),t=i(2265),s=i(1396),a=i.n(s),n=i(4033),l=i(8228),d=i(7290);function c(){let e=(0,n.useRouter)(),{register:r,isLoading:i}=(0,l.a)(),{success:s,error:c}=(0,d.pm)(),[m,u]=(0,t.useState)({userType:"traveler",name:"",email:"",phone:"",password:"",confirmPassword:"",agreeTerms:!1}),[h,p]=(0,t.useState)({}),f=()=>{let e={};return m.name.trim()?m.name.trim().length<2&&(e.name="姓名至少需要2個字元"):e.name="請輸入姓名",m.email?/\S+@\S+\.\S+/.test(m.email)||(e.email="請輸入有效的電子郵件格式"):e.email="請輸入電子郵件",m.phone?/^09\d{8}$/.test(m.phone.replace(/\D/g,""))||(e.phone="請輸入有效的台灣手機號碼格式"):e.phone="請輸入手機號碼",m.password?m.password.length<8?e.password="密碼必須至少8個字元":/(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/.test(m.password)||(e.password="密碼必須包含大小寫字母和數字"):e.password="請輸入密碼",m.confirmPassword?m.password!==m.confirmPassword&&(e.confirmPassword="密碼確認不符"):e.confirmPassword="請確認密碼",m.agreeTerms||(e.agreeTerms="請同意服務條款和隱私政策"),p(e),0===Object.keys(e).length},g=e=>{let{name:r,value:i,type:o,checked:t}=e.target;u(e=>({...e,[r]:"checkbox"===o?t:i})),h[r]&&p(e=>({...e,[r]:void 0}))},b=async i=>{if(i.preventDefault(),f())try{await r({email:m.email,password:m.password,name:m.name,userType:"traveler"===m.userType?"customer":m.userType,phone:m.phone}),s("註冊成功","歡迎加入 Guidee，".concat(m.name,"！")),e.push("/")}catch(e){c("註冊失敗","請檢查輸入資料或稍後再試")}};return(0,o.jsxs)("div",{style:{minHeight:"100vh",background:"linear-gradient(to bottom right, #dbeafe, #ffffff, #e0e7ff)",display:"flex",alignItems:"center",justifyContent:"center",padding:"3rem 1rem"},children:[(0,o.jsx)("div",{style:{position:"absolute",top:"2rem",left:"2rem",zIndex:10},children:(0,o.jsx)("button",{onClick:()=>e.push("/"),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.75rem 1rem",backgroundColor:"rgba(255, 255, 255, 0.9)",backdropFilter:"blur(10px)",borderRadius:"0.5rem",border:"1px solid rgba(255, 255, 255, 0.3)",cursor:"pointer",transition:"all 0.2s",fontSize:"0.875rem",fontWeight:"500",color:"#374151"},className:"hover:bg-white hover:shadow-md",children:"← 回到首頁"})}),(0,o.jsxs)("div",{style:{maxWidth:"28rem",width:"100%",backgroundColor:"white",borderRadius:"1rem",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)",border:"1px solid #f3f4f6",padding:"2rem",backdropFilter:"blur(10px)"},children:[(0,o.jsxs)("div",{style:{textAlign:"center",marginBottom:"2rem"},children:[(0,o.jsx)("div",{style:{margin:"0 auto 1.5rem",height:"3rem",width:"3rem",background:"linear-gradient(to right, #2563eb, #4f46e5)",borderRadius:"0.75rem",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1)"},children:(0,o.jsx)("span",{style:{color:"white",fontWeight:"bold",fontSize:"1.25rem"},children:"G"})}),(0,o.jsx)("h1",{style:{fontSize:"2rem",fontWeight:"700",color:"#111827",marginBottom:"0.5rem",lineHeight:"1.2"},children:"加入 Guidee"}),(0,o.jsx)("p",{style:{color:"#6b7280",fontSize:"0.875rem"},children:"開始您的台灣旅遊體驗之旅"}),(0,o.jsxs)("div",{style:{marginTop:"1rem"},children:[(0,o.jsx)("span",{style:{color:"#6b7280",fontSize:"0.875rem"},children:"已經有帳號？"})," ",(0,o.jsx)(a(),{href:"/login",style:{color:"#2563eb",fontWeight:"500",textDecoration:"none"},className:"hover:text-blue-700",children:"立即登入"})]})]}),(0,o.jsxs)("form",{onSubmit:b,style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"600",color:"#374151",marginBottom:"0.75rem"},children:"我想要成為"}),(0,o.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[(0,o.jsxs)("label",{style:{position:"relative",cursor:"pointer"},children:[(0,o.jsx)("input",{type:"radio",name:"userType",value:"traveler",checked:"traveler"===m.userType,onChange:g,style:{position:"absolute",opacity:0}}),(0,o.jsxs)("div",{style:{border:"traveler"===m.userType?"2px solid #2563eb":"2px solid #e5e7eb",borderRadius:"0.75rem",padding:"1rem",textAlign:"center",backgroundColor:"traveler"===m.userType?"#eff6ff":"white",transition:"all 0.2s",cursor:"pointer"},className:"hover:border-blue-500",children:[(0,o.jsx)("div",{style:{fontSize:"1.5rem",marginBottom:"0.5rem"},children:"\uD83E\uDDF3"}),(0,o.jsx)("div",{style:{fontWeight:"600",color:"#111827",fontSize:"0.875rem"},children:"旅客"}),(0,o.jsx)("div",{style:{fontSize:"0.75rem",color:"#6b7280"},children:"尋找在地體驗"})]})]}),(0,o.jsxs)("label",{style:{position:"relative",cursor:"pointer"},children:[(0,o.jsx)("input",{type:"radio",name:"userType",value:"guide",checked:"guide"===m.userType,onChange:g,style:{position:"absolute",opacity:0}}),(0,o.jsxs)("div",{style:{border:"guide"===m.userType?"2px solid #2563eb":"2px solid #e5e7eb",borderRadius:"0.75rem",padding:"1rem",textAlign:"center",backgroundColor:"guide"===m.userType?"#eff6ff":"white",transition:"all 0.2s",cursor:"pointer"},className:"hover:border-blue-500",children:[(0,o.jsx)("div",{style:{fontSize:"1.5rem",marginBottom:"0.5rem"},children:"\uD83D\uDC68‍\uD83C\uDFEB"}),(0,o.jsx)("div",{style:{fontWeight:"600",color:"#111827",fontSize:"0.875rem"},children:"地陪"}),(0,o.jsx)("div",{style:{fontSize:"0.75rem",color:"#6b7280"},children:"分享在地知識"})]})]})]})]}),(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"name",style:{display:"block",fontSize:"0.875rem",fontWeight:"600",color:"#374151",marginBottom:"0.5rem"},children:"姓名"}),(0,o.jsx)("input",{id:"name",name:"name",type:"text",value:m.name,onChange:g,style:{width:"100%",padding:"0.75rem 1rem",border:h.name?"1px solid #ef4444":"1px solid #e5e7eb",borderRadius:"0.5rem",fontSize:"1rem",transition:"all 0.2s",outline:"none",backgroundColor:"white"},className:"focus:border-blue-500 focus:ring-2 focus:ring-blue-200",placeholder:"請輸入您的真實姓名"}),h.name&&(0,o.jsx)("p",{style:{marginTop:"0.25rem",fontSize:"0.875rem",color:"#ef4444"},children:h.name})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"email",style:{display:"block",fontSize:"0.875rem",fontWeight:"600",color:"#374151",marginBottom:"0.5rem"},children:"電子郵件"}),(0,o.jsx)("input",{id:"email",name:"email",type:"email",autoComplete:"email",value:m.email,onChange:g,style:{width:"100%",padding:"0.75rem 1rem",border:h.email?"1px solid #ef4444":"1px solid #e5e7eb",borderRadius:"0.5rem",fontSize:"1rem",transition:"all 0.2s",outline:"none",backgroundColor:"white"},className:"focus:border-blue-500 focus:ring-2 focus:ring-blue-200",placeholder:"請輸入電子郵件地址"}),h.email&&(0,o.jsx)("p",{style:{marginTop:"0.25rem",fontSize:"0.875rem",color:"#ef4444"},children:h.email})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"phone",style:{display:"block",fontSize:"0.875rem",fontWeight:"600",color:"#374151",marginBottom:"0.5rem"},children:"手機號碼"}),(0,o.jsx)("input",{id:"phone",name:"phone",type:"tel",value:m.phone,onChange:g,style:{width:"100%",padding:"0.75rem 1rem",border:h.phone?"1px solid #ef4444":"1px solid #e5e7eb",borderRadius:"0.5rem",fontSize:"1rem",transition:"all 0.2s",outline:"none",backgroundColor:"white"},className:"focus:border-blue-500 focus:ring-2 focus:ring-blue-200",placeholder:"請輸入手機號碼 (例：0912345678)"}),h.phone&&(0,o.jsx)("p",{style:{marginTop:"0.25rem",fontSize:"0.875rem",color:"#ef4444"},children:h.phone})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"password",style:{display:"block",fontSize:"0.875rem",fontWeight:"600",color:"#374151",marginBottom:"0.5rem"},children:"密碼"}),(0,o.jsx)("input",{id:"password",name:"password",type:"password",autoComplete:"new-password",value:m.password,onChange:g,style:{width:"100%",padding:"0.75rem 1rem",border:h.password?"1px solid #ef4444":"1px solid #e5e7eb",borderRadius:"0.5rem",fontSize:"1rem",transition:"all 0.2s",outline:"none",backgroundColor:"white"},className:"focus:border-blue-500 focus:ring-2 focus:ring-blue-200",placeholder:"至少 8 個字元，包含大小寫字母和數字"}),h.password&&(0,o.jsx)("p",{style:{marginTop:"0.25rem",fontSize:"0.875rem",color:"#ef4444"},children:h.password})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"confirmPassword",style:{display:"block",fontSize:"0.875rem",fontWeight:"600",color:"#374151",marginBottom:"0.5rem"},children:"確認密碼"}),(0,o.jsx)("input",{id:"confirmPassword",name:"confirmPassword",type:"password",value:m.confirmPassword,onChange:g,style:{width:"100%",padding:"0.75rem 1rem",border:h.confirmPassword?"1px solid #ef4444":"1px solid #e5e7eb",borderRadius:"0.5rem",fontSize:"1rem",transition:"all 0.2s",outline:"none",backgroundColor:"white"},className:"focus:border-blue-500 focus:ring-2 focus:ring-blue-200",placeholder:"請再次輸入密碼"}),h.confirmPassword&&(0,o.jsx)("p",{style:{marginTop:"0.25rem",fontSize:"0.875rem",color:"#ef4444"},children:h.confirmPassword})]})]}),(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",gap:"0.75rem"},children:[(0,o.jsx)("input",{id:"agreeTerms",name:"agreeTerms",type:"checkbox",checked:m.agreeTerms,onChange:g,style:{width:"1rem",height:"1rem",accentColor:"#2563eb",cursor:"pointer",marginTop:"0.125rem"}}),(0,o.jsxs)("label",{htmlFor:"agreeTerms",style:{fontSize:"0.875rem",color:"#374151",lineHeight:"1.4",cursor:"pointer"},children:["我同意"," ",(0,o.jsx)(a(),{href:"/terms",style:{color:"#2563eb",textDecoration:"none"},className:"hover:text-blue-700 hover:underline",children:"服務條款"})," ","和"," ",(0,o.jsx)(a(),{href:"/privacy",style:{color:"#2563eb",textDecoration:"none"},className:"hover:text-blue-700 hover:underline",children:"隱私政策"})]})]}),h.agreeTerms&&(0,o.jsx)("p",{style:{marginTop:"0.5rem",marginLeft:"1.75rem",fontSize:"0.875rem",color:"#ef4444"},children:h.agreeTerms})]}),(0,o.jsx)("button",{type:"submit",disabled:i,style:{width:"100%",padding:"0.875rem 1.5rem",background:i?"#9ca3af":"linear-gradient(to right, #2563eb, #4f46e5)",color:"white",border:"none",borderRadius:"0.5rem",fontSize:"1rem",fontWeight:"600",cursor:i?"not-allowed":"pointer",transition:"all 0.2s",boxShadow:i?"none":"0 10px 15px -3px rgba(0, 0, 0, 0.1)",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},className:i?"":"hover:shadow-lg hover:scale-105",children:i?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{style:{width:"1.25rem",height:"1.25rem",border:"2px solid transparent",borderTop:"2px solid white",borderRadius:"50%",animation:"spin 1s linear infinite"}}),"註冊中..."]}):"建立帳號"})]})]})]})}},7290:function(e,r,i){"use strict";i.d(r,{pm:function(){return l}}),i(7437);var o=i(2265),t=i(3008),s=i(1981),a=i(2894),n=i(4056);function l(){let[e,r]=(0,o.useState)([]),i=e=>{let i=Math.random().toString(36).substr(2,9),o={id:i,duration:5e3,...e};return r(e=>[...e,o]),i};return{toasts:e,addToast:i,removeToast:e=>{r(r=>r.filter(r=>r.id!==e))},success:(e,r)=>i({type:"success",title:e,message:r}),error:(e,r)=>i({type:"error",title:e,message:r}),warning:(e,r)=>i({type:"warning",title:e,message:r}),info:(e,r)=>i({type:"info",title:e,message:r})}}t.Z,s.Z,a.Z,n.Z},8228:function(e,r,i){"use strict";i.d(r,{a:function(){return s}});var o=i(4660),t=i(4810);let s=(0,o.Ue)()((0,t.tJ)((e,r)=>({user:null,token:null,refreshToken:null,isLoading:!1,isAuthenticated:!1,login:async(r,i)=>{e({isLoading:!0});try{var o,t,s,a;let n=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:r,password:i})}),l=await n.json();if(!n.ok||!l.success)throw Error(l.error||l.message||"登入失敗");let d={id:l.data.user.id,email:l.data.user.email,name:l.data.user.name,avatar:l.data.user.avatar,role:l.data.user.role.toLowerCase(),isEmailVerified:l.data.user.isEmailVerified,isKYCVerified:l.data.user.isKycVerified,createdAt:l.data.user.createdAt,permissions:l.data.user.permissions||[],profile:{phone:l.data.user.phone,bio:null===(o=l.data.user.userProfile)||void 0===o?void 0:o.bio,location:null===(t=l.data.user.userProfile)||void 0===t?void 0:t.location,languages:null===(s=l.data.user.userProfile)||void 0===s?void 0:s.languages,specialties:null===(a=l.data.user.userProfile)||void 0===a?void 0:a.specialties}};e({user:d,token:l.data.token,refreshToken:null,isAuthenticated:!0,isLoading:!1})}catch(r){throw e({isLoading:!1}),r}},register:async r=>{e({isLoading:!0});try{await new Promise(e=>setTimeout(e,1500));let i={id:Date.now().toString(),email:r.email,name:r.name,role:r.userType||"customer",isEmailVerified:!1,isKYCVerified:!1,createdAt:new Date().toISOString(),permissions:"guide"===r.userType?["user:read","guide:manage","booking:manage"]:["user:read","booking:create"],profile:{phone:r.phone}},o="mock-jwt-token-"+Date.now();e({user:i,token:o,refreshToken:"mock-refresh-token",isAuthenticated:!0,isLoading:!1})}catch(r){throw e({isLoading:!1}),r}},logout:async()=>{try{await fetch("/api/auth/logout",{method:"POST",credentials:"include"})}catch(e){}e({user:null,token:null,refreshToken:null,isAuthenticated:!1})},updateUser:async i=>{let{user:o,token:t}=r();if(!o||!t)throw Error("未登入");e({isLoading:!0});try{let r=await fetch("/api/users/profile",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify(i)});if(!r.ok)throw Error("更新失敗");let s=await r.json();e({user:{...o,...s},isLoading:!1})}catch(r){throw e({isLoading:!1}),r}},refreshAuth:async()=>{let{refreshToken:i}=r();if(i)try{let r=await fetch("/api/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:i})});if(!r.ok)throw Error("Token 刷新失敗");let o=await r.json();e({token:o.token,refreshToken:o.refreshToken})}catch(e){r().logout()}},initializeAuth:async()=>{try{let s=await fetch("/api/auth/me",{credentials:"include"});if(s.ok){let a=await s.json();if(a.success&&a.data.user){var r,i,o,t;let s={id:a.data.user.id,email:a.data.user.email,name:a.data.user.name,avatar:a.data.user.avatar,role:a.data.user.role.toLowerCase(),isEmailVerified:a.data.user.isEmailVerified,isKYCVerified:a.data.user.isKycVerified,createdAt:a.data.user.createdAt,permissions:a.data.user.permissions||[],profile:{phone:a.data.user.phone,bio:null===(r=a.data.user.userProfile)||void 0===r?void 0:r.bio,location:null===(i=a.data.user.userProfile)||void 0===i?void 0:i.location,languages:null===(o=a.data.user.userProfile)||void 0===o?void 0:o.languages,specialties:null===(t=a.data.user.userProfile)||void 0===t?void 0:t.specialties}};e({user:s,isAuthenticated:!0})}}}catch(e){}},setLoading:r=>{e({isLoading:r})},hasPermission:e=>{var i;let{user:o}=r();return!!o&&("GUIDE"===o.role||(null===(i=o.permissions)||void 0===i?void 0:i.includes(e))||!1)}}),{name:"guidee-auth",partialize:e=>({user:e.user,token:e.token,refreshToken:e.refreshToken,isAuthenticated:e.isAuthenticated})}))}},function(e){e.O(0,[1216,1744],function(){return e(e.s=5526)}),_N_E=e.O()}]);