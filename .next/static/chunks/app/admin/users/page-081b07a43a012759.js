(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9674],{2617:function(e,s,l){Promise.resolve().then(l.bind(l,4882))},4882:function(e,s,l){"use strict";l.r(s),l.d(s,{default:function(){return p}});var a=l(7437),t=l(2265),r=l(4033),i=l(7045),n=l(5671),c=l(575),d=l(3277),x=l(2782),o=l(5750),m=l(1827),h=l(3008),u=l(1295),f=l(9670),j=l(9617),g=l(1195),N=l(6142);function p(){var e,s,l,p,v;(0,r.useRouter)();let[b,y]=(0,t.useState)([]),[w,C]=(0,t.useState)([]),[P,Z]=(0,t.useState)(!0),[Y,k]=(0,t.useState)(""),[L,S]=(0,t.useState)("all"),[z,D]=(0,t.useState)(null),[O,E]=(0,t.useState)(!1);(0,t.useEffect)(()=>{R()},[]),(0,t.useEffect)(()=>{A()},[b,Y,L]);let R=async()=>{try{let e=await fetch("/api/admin/users");if(e.ok){let s=await e.json();y(s)}}catch(e){}finally{Z(!1)}},A=()=>{let e=b;Y&&(e=e.filter(e=>{var s,l,a;return e.email.toLowerCase().includes(Y.toLowerCase())||(null===(s=e.name)||void 0===s?void 0:s.toLowerCase().includes(Y.toLowerCase()))||(null===(a=e.userProfile)||void 0===a?void 0:null===(l=a.name)||void 0===l?void 0:l.toLowerCase().includes(Y.toLowerCase()))})),"all"!==L&&(e=e.filter(e=>e.role===L)),C(e)},T=e=>({admin:"管理員",guide:"地陪",customer:"客戶"})[e]||e,_=e=>({admin:"destructive",guide:"default",customer:"secondary"})[e]||"outline",I=async(e,s)=>{try{(await fetch("/api/admin/users/".concat(e),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:s})})).ok&&R()}catch(e){}};return P?(0,a.jsx)(i.AdminLayout,{children:(0,a.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"載入中..."})]})})}):(0,a.jsx)(i.AdminLayout,{children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[(0,a.jsx)(o.Z,{className:"h-8 w-8 mr-3"}),"用戶管理"]}),(0,a.jsx)("p",{className:"text-gray-600 mt-2",children:"管理註冊用戶、地陪和客戶資料"})]}),(0,a.jsxs)(n.Zb,{className:"mb-6",children:[(0,a.jsx)(n.Ol,{children:(0,a.jsx)(n.ll,{children:"搜索和篩選"})}),(0,a.jsx)(n.aY,{children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(m.Z,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),(0,a.jsx)(x.I,{placeholder:"搜索用戶 (姓名、電子郵件)",value:Y,onChange:e=>k(e.target.value),className:"pl-10"})]})}),(0,a.jsx)("div",{className:"md:w-48",children:(0,a.jsxs)("select",{value:L,onChange:e=>S(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary",children:[(0,a.jsx)("option",{value:"all",children:"所有角色"}),(0,a.jsx)("option",{value:"admin",children:"管理員"}),(0,a.jsx)("option",{value:"guide",children:"地陪"}),(0,a.jsx)("option",{value:"customer",children:"客戶"})]})})]})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6",children:[(0,a.jsx)(n.Zb,{children:(0,a.jsx)(n.aY,{className:"pt-6",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"總用戶數"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:b.length})]}),(0,a.jsx)(o.Z,{className:"h-8 w-8 text-gray-400"})]})})}),(0,a.jsx)(n.Zb,{children:(0,a.jsx)(n.aY,{className:"pt-6",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"地陪"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:b.filter(e=>"guide"===e.role).length})]}),(0,a.jsx)(d.Ct,{variant:"default",className:"text-xs",children:"地陪"})]})})}),(0,a.jsx)(n.Zb,{children:(0,a.jsx)(n.aY,{className:"pt-6",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"客戶"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:b.filter(e=>"customer"===e.role).length})]}),(0,a.jsx)(d.Ct,{variant:"secondary",className:"text-xs",children:"客戶"})]})})}),(0,a.jsx)(n.Zb,{children:(0,a.jsx)(n.aY,{className:"pt-6",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"已驗證"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:b.filter(e=>e.isEmailVerified).length})]}),(0,a.jsx)(h.Z,{className:"h-8 w-8 text-green-500"})]})})})]}),(0,a.jsxs)(n.Zb,{children:[(0,a.jsxs)(n.Ol,{children:[(0,a.jsxs)(n.ll,{children:["用戶列表 (",w.length,")"]}),(0,a.jsx)(n.SZ,{children:"點擊用戶查看詳細資料，或使用操作菜單管理用戶"})]}),(0,a.jsx)(n.aY,{children:(0,a.jsxs)("div",{className:"space-y-4",children:[w.map(e=>{var s,l,t,r,i;return(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4 flex-1",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-gray-300 rounded-full flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-sm font-semibold text-gray-600",children:(((null===(s=e.userProfile)||void 0===s?void 0:s.name)||e.name||e.email||"?")[0]||"?").toUpperCase()})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-gray-900",children:(null===(l=e.userProfile)||void 0===l?void 0:l.name)||e.name||"未設定"}),(0,a.jsx)(d.Ct,{variant:_(e.role),className:"text-xs",children:T(e.role)}),e.isEmailVerified&&(0,a.jsxs)(d.Ct,{variant:"success",className:"text-xs",children:[(0,a.jsx)(u.Z,{className:"h-3 w-3 mr-1"}),"已驗證"]}),e.isKycVerified&&(0,a.jsxs)(d.Ct,{variant:"success",className:"text-xs",children:[(0,a.jsx)(h.Z,{className:"h-3 w-3 mr-1"}),"KYC"]})]}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:e.email}),(null===(t=e.userProfile)||void 0===t?void 0:t.location)&&(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:["\uD83D\uDCCD ",e.userProfile.location]}),(null===(r=e.userProfile)||void 0===r?void 0:r.languages)&&e.userProfile.languages.length>0&&(0,a.jsxs)("div",{className:"flex flex-wrap gap-1 mt-1",children:[e.userProfile.languages.slice(0,3).map((e,s)=>(0,a.jsx)("span",{className:"text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded",children:e},s)),e.userProfile.languages.length>3&&(0,a.jsxs)("span",{className:"text-xs text-gray-500",children:["+",e.userProfile.languages.length-3," 更多"]})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:["註冊於 ",new Date(e.createdAt).toLocaleDateString("zh-TW")]}),(null===(i=e.userProfile)||void 0===i?void 0:i.experienceYears)&&(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:[e.userProfile.experienceYears," 年經驗"]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)(c.z,{variant:"outline",size:"sm",onClick:()=>{D(e),E(!0)},children:[(0,a.jsx)(f.Z,{className:"h-4 w-4 mr-1"}),"查看"]}),(0,a.jsxs)(c.z,{variant:"outline",size:"sm",onClick:()=>I(e.id,"edit"),children:[(0,a.jsx)(j.Z,{className:"h-4 w-4 mr-1"}),"編輯"]}),(0,a.jsxs)(c.z,{variant:"outline",size:"sm",onClick:()=>I(e.id,"suspend"),children:[(0,a.jsx)(g.Z,{className:"h-4 w-4 mr-1"}),"停用"]})]})]},e.id)}),0===w.length&&(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(o.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-500",children:"沒有找到符合條件的用戶"})]})]})})]}),O&&z&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"客戶詳細資料"}),(0,a.jsx)(c.z,{variant:"outline",size:"sm",onClick:()=>E(!1),children:"關閉"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[(0,a.jsxs)(n.Zb,{children:[(0,a.jsx)(n.Ol,{children:(0,a.jsx)(n.ll,{className:"text-lg",children:"基本資料"})}),(0,a.jsxs)(n.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-gray-300 rounded-full flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-xl font-bold text-gray-600",children:(((null===(e=z.userProfile)||void 0===e?void 0:e.name)||z.name||z.email||"?")[0]||"?").toUpperCase()})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:(null===(s=z.userProfile)||void 0===s?void 0:s.name)||z.name||"未設定"}),(0,a.jsx)("p",{className:"text-gray-600",children:z.email}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 mt-2",children:[(0,a.jsx)(d.Ct,{variant:_(z.role),children:T(z.role)}),z.isEmailVerified&&(0,a.jsxs)(d.Ct,{variant:"success",className:"text-xs",children:[(0,a.jsx)(h.Z,{className:"h-3 w-3 mr-1"}),"已驗證"]})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"註冊時間"}),(0,a.jsx)("p",{className:"text-sm font-medium",children:new Date(z.createdAt).toLocaleDateString("zh-TW",{year:"numeric",month:"long",day:"numeric"})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"最後登入"}),(0,a.jsx)("p",{className:"text-sm font-medium",children:z.lastLoginAt?new Date(z.lastLoginAt).toLocaleDateString("zh-TW"):"從未登入"})]})]})]})]}),(0,a.jsxs)(n.Zb,{children:[(0,a.jsx)(n.Ol,{children:(0,a.jsx)(n.ll,{className:"text-lg",children:"統計數據"})}),(0,a.jsx)(n.aY,{children:(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[(0,a.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:(null===(l=z.stats)||void 0===l?void 0:l.servicesCount)||0}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"提供服務"})]}),(0,a.jsxs)("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[(0,a.jsx)("p",{className:"text-2xl font-bold text-green-600",children:(null===(p=z.stats)||void 0===p?void 0:p.bookingsCount)||0}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"預訂記錄"})]}),(0,a.jsxs)("div",{className:"text-center p-4 bg-yellow-50 rounded-lg",children:[(0,a.jsx)("p",{className:"text-2xl font-bold text-yellow-600",children:(null===(v=z.stats)||void 0===v?void 0:v.reviewsCount)||0}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"評論數量"})]})]})})]})]}),z.userProfile&&(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)(n.Zb,{children:[(0,a.jsx)(n.Ol,{children:(0,a.jsx)(n.ll,{className:"text-lg",children:"個人檔案"})}),(0,a.jsxs)(n.aY,{className:"space-y-4",children:[z.userProfile.bio&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"個人簡介"}),(0,a.jsx)("p",{className:"text-sm bg-gray-50 p-3 rounded",children:z.userProfile.bio})]}),z.userProfile.location&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"所在地區"}),(0,a.jsxs)("p",{className:"text-sm flex items-center",children:[(0,a.jsx)(N.Z,{className:"h-4 w-4 mr-1 text-gray-400"}),z.userProfile.location]})]}),z.userProfile.experienceYears&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"經驗年數"}),(0,a.jsxs)("p",{className:"text-sm",children:[z.userProfile.experienceYears," 年"]})]})]})]}),(0,a.jsxs)(n.Zb,{children:[(0,a.jsx)(n.Ol,{children:(0,a.jsx)(n.ll,{className:"text-lg",children:"技能與語言"})}),(0,a.jsxs)(n.aY,{className:"space-y-4",children:[z.userProfile.languages&&z.userProfile.languages.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"語言能力"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:z.userProfile.languages.map((e,s)=>(0,a.jsx)(d.Ct,{variant:"secondary",className:"text-xs",children:e},s))})]}),z.userProfile.specialties&&z.userProfile.specialties.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"專業領域"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:z.userProfile.specialties.map((e,s)=>(0,a.jsx)(d.Ct,{variant:"outline",className:"text-xs",children:e},s))})]}),z.userProfile.certifications&&z.userProfile.certifications.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"認證資格"}),(0,a.jsx)("div",{className:"space-y-1",children:z.userProfile.certifications.map((e,s)=>(0,a.jsxs)("p",{className:"text-xs bg-green-50 text-green-700 p-2 rounded flex items-center",children:[(0,a.jsx)(h.Z,{className:"h-3 w-3 mr-1"}),e]},s))})]})]})]})]})]})})})]})})}},5671:function(e,s,l){"use strict";l.d(s,{Ol:function(){return n},SZ:function(){return d},Zb:function(){return i},aY:function(){return x},ll:function(){return c}});var a=l(7437),t=l(2265),r=l(2169);let i=t.forwardRef((e,s)=>{let{className:l,...t}=e;return(0,a.jsx)("div",{ref:s,className:(0,r.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",l),...t})});i.displayName="Card";let n=t.forwardRef((e,s)=>{let{className:l,...t}=e;return(0,a.jsx)("div",{ref:s,className:(0,r.cn)("flex flex-col space-y-1.5 p-6",l),...t})});n.displayName="CardHeader";let c=t.forwardRef((e,s)=>{let{className:l,children:t,...i}=e;return(0,a.jsx)("h3",{ref:s,className:(0,r.cn)("text-2xl font-semibold leading-none tracking-tight",l),...i,children:t})});c.displayName="CardTitle";let d=t.forwardRef((e,s)=>{let{className:l,...t}=e;return(0,a.jsx)("p",{ref:s,className:(0,r.cn)("text-sm text-muted-foreground",l),...t})});d.displayName="CardDescription";let x=t.forwardRef((e,s)=>{let{className:l,...t}=e;return(0,a.jsx)("div",{ref:s,className:(0,r.cn)("p-6 pt-0",l),...t})});x.displayName="CardContent",t.forwardRef((e,s)=>{let{className:l,...t}=e;return(0,a.jsx)("div",{ref:s,className:(0,r.cn)("flex items-center p-6 pt-0",l),...t})}).displayName="CardFooter"},2782:function(e,s,l){"use strict";l.d(s,{I:function(){return i}});var a=l(7437),t=l(2265),r=l(2169);let i=t.forwardRef((e,s)=>{let{className:l,type:i,error:n,label:c,icon:d,...x}=e,o=t.useId();return(0,a.jsxs)("div",{className:"space-y-2",children:[c&&(0,a.jsx)("label",{htmlFor:o,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:c}),(0,a.jsxs)("div",{className:"relative",children:[d&&(0,a.jsx)("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground",children:d}),(0,a.jsx)("input",{id:o,type:i,className:(0,r.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",d&&"pl-10",n&&"border-destructive focus-visible:ring-destructive",l),ref:s,...x})]}),n&&(0,a.jsx)("p",{className:"text-sm text-destructive",children:n})]})});i.displayName="Input"}},function(e){e.O(0,[1216,4784,7045,1744],function(){return e(e.s=2617)}),_N_E=e.O()}]);