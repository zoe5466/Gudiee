(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3579],{8001:function(e,s,a){Promise.resolve().then(a.bind(a,6632))},6632:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return C}});var l=a(7437),t=a(2265),r=a(4033),i=a(7045),n=a(5671),c=a(575),d=a(3277),o=a(2782),x=a(5750),m=a(1827),u=a(2527),f=a(9036),h=a(2245),j=a(1298),N=a(1981),p=a(6142),v=a(2505),g=a(6137),y=a(8203),b=a(9670),w=a(3056);function C(){let e=(0,r.useRouter)(),[s,a]=(0,t.useState)([]),[C,Z]=(0,t.useState)([]),[E,P]=(0,t.useState)(!0),[S,L]=(0,t.useState)(""),[k,V]=(0,t.useState)("all"),[D,A]=(0,t.useState)("all");(0,t.useEffect)(()=>{R()},[]),(0,t.useEffect)(()=>{T()},[s,S,k,D]);let R=async()=>{try{let e=await fetch("/api/admin/guides");if(e.ok){let s=await e.json();a(s)}}catch(e){}finally{P(!1)}},T=()=>{let e=s;S&&(e=e.filter(e=>{var s,a,l,t,r;return e.email.toLowerCase().includes(S.toLowerCase())||(null===(s=e.name)||void 0===s?void 0:s.toLowerCase().includes(S.toLowerCase()))||(null===(l=e.userProfile)||void 0===l?void 0:null===(a=l.name)||void 0===a?void 0:a.toLowerCase().includes(S.toLowerCase()))||(null===(r=e.userProfile)||void 0===r?void 0:null===(t=r.location)||void 0===t?void 0:t.toLowerCase().includes(S.toLowerCase()))})),"all"!==k&&(e=e.filter(e=>e.status.toLowerCase()===k.toLowerCase())),"verified"===D?e=e.filter(e=>e.isEmailVerified&&e.isKycVerified):"unverified"===D&&(e=e.filter(e=>!e.isEmailVerified||!e.isKycVerified)),Z(e)},z=e=>({ACTIVE:"活躍",SUSPENDED:"已停權",PENDING:"待審核"})[e]||e,I=e=>({ACTIVE:"default",SUSPENDED:"destructive",PENDING:"secondary"})[e]||"outline",Y=async(e,s)=>{try{(await fetch("/api/admin/users/".concat(e),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:s})})).ok&&R()}catch(e){}};return E?(0,l.jsx)(i.AdminLayout,{children:(0,l.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,l.jsx)("p",{className:"text-gray-600",children:"載入中..."})]})})}):(0,l.jsx)(i.AdminLayout,{children:(0,l.jsxs)("div",{className:"p-6",children:[(0,l.jsxs)("div",{className:"mb-8",children:[(0,l.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[(0,l.jsx)(x.Z,{className:"h-8 w-8 mr-3"}),"地陪管理"]}),(0,l.jsx)("p",{className:"text-gray-600 mt-2",children:"管理平台地陪資訊、認證狀態和營運數據"})]}),(0,l.jsxs)(n.Zb,{className:"mb-6",children:[(0,l.jsx)(n.Ol,{children:(0,l.jsx)(n.ll,{children:"搜索和篩選"})}),(0,l.jsx)(n.aY,{children:(0,l.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,l.jsx)("div",{className:"flex-1",children:(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)(m.Z,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),(0,l.jsx)(o.I,{placeholder:"搜索地陪 (姓名、電子郵件、地點)",value:S,onChange:e=>L(e.target.value),className:"pl-10"})]})}),(0,l.jsx)("div",{className:"md:w-40",children:(0,l.jsxs)("select",{value:k,onChange:e=>V(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary",children:[(0,l.jsx)("option",{value:"all",children:"所有狀態"}),(0,l.jsx)("option",{value:"active",children:"活躍"}),(0,l.jsx)("option",{value:"suspended",children:"已停權"}),(0,l.jsx)("option",{value:"pending",children:"待審核"})]})}),(0,l.jsx)("div",{className:"md:w-40",children:(0,l.jsxs)("select",{value:D,onChange:e=>A(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary",children:[(0,l.jsx)("option",{value:"all",children:"全部認證"}),(0,l.jsx)("option",{value:"verified",children:"已認證"}),(0,l.jsx)("option",{value:"unverified",children:"待認證"})]})})]})})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-6 mb-6",children:[(0,l.jsx)(n.Zb,{children:(0,l.jsx)(n.aY,{className:"pt-6",children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"總地陪數"}),(0,l.jsx)("p",{className:"text-2xl font-bold",children:s.length})]}),(0,l.jsx)(x.Z,{className:"h-8 w-8 text-gray-400"})]})})}),(0,l.jsx)(n.Zb,{children:(0,l.jsx)(n.aY,{className:"pt-6",children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"活躍地陪"}),(0,l.jsx)("p",{className:"text-2xl font-bold",children:s.filter(e=>"ACTIVE"===e.status).length})]}),(0,l.jsx)(u.Z,{className:"h-8 w-8 text-green-500"})]})})}),(0,l.jsx)(n.Zb,{children:(0,l.jsx)(n.aY,{className:"pt-6",children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"已認證"}),(0,l.jsx)("p",{className:"text-2xl font-bold",children:s.filter(e=>e.isEmailVerified&&e.isKycVerified).length})]}),(0,l.jsx)(f.Z,{className:"h-8 w-8 text-blue-500"})]})})}),(0,l.jsx)(n.Zb,{children:(0,l.jsx)(n.aY,{className:"pt-6",children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"平均評分"}),(0,l.jsx)("p",{className:"text-2xl font-bold",children:s.length>0?(s.reduce((e,s)=>e+s.stats.averageRating,0)/s.length).toFixed(1):"0.0"})]}),(0,l.jsx)(h.Z,{className:"h-8 w-8 text-yellow-500"})]})})}),(0,l.jsx)(n.Zb,{children:(0,l.jsx)(n.aY,{className:"pt-6",children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"總收入"}),(0,l.jsxs)("p",{className:"text-xl font-bold",children:["NT$ ",s.reduce((e,s)=>e+s.stats.totalEarnings,0).toLocaleString()]})]}),(0,l.jsx)(j.Z,{className:"h-8 w-8 text-gray-400"})]})})})]}),(0,l.jsxs)(n.Zb,{children:[(0,l.jsxs)(n.Ol,{children:[(0,l.jsxs)(n.ll,{children:["地陪列表 (",C.length,")"]}),(0,l.jsx)(n.SZ,{children:"點擊地陪查看詳細資料，或使用操作按鈕管理地陪狀態"})]}),(0,l.jsx)(n.aY,{children:(0,l.jsxs)("div",{className:"space-y-4",children:[C.map(s=>{var a,t,r,i,n;return(0,l.jsxs)("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-4 flex-1",children:[(0,l.jsx)("div",{className:"w-12 h-12 bg-gray-300 rounded-full flex items-center justify-center flex-shrink-0",children:(0,l.jsx)("span",{className:"text-sm font-semibold text-gray-600",children:(((null===(a=s.userProfile)||void 0===a?void 0:a.name)||s.name||s.email||"?")[0]||"?").toUpperCase()})}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-3 mb-1",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:(null===(t=s.userProfile)||void 0===t?void 0:t.name)||s.name||"未設定"}),(0,l.jsx)(d.Ct,{variant:I(s.status),className:"text-xs",children:z(s.status)}),s.isEmailVerified&&s.isKycVerified&&(0,l.jsxs)(d.Ct,{variant:"success",className:"text-xs",children:[(0,l.jsx)(f.Z,{className:"h-3 w-3 mr-1"}),"已認證"]}),(!s.isEmailVerified||!s.isKycVerified)&&(0,l.jsxs)(d.Ct,{variant:"secondary",className:"text-xs",children:[(0,l.jsx)(N.Z,{className:"h-3 w-3 mr-1"}),"待認證"]})]}),(0,l.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:s.email}),(0,l.jsxs)("div",{className:"flex flex-wrap gap-4 text-sm text-gray-500 mb-2",children:[(null===(r=s.userProfile)||void 0===r?void 0:r.location)&&(0,l.jsxs)("span",{className:"flex items-center",children:[(0,l.jsx)(p.Z,{className:"h-4 w-4 mr-1"}),s.userProfile.location]}),(null===(i=s.userProfile)||void 0===i?void 0:i.experienceYears)&&(0,l.jsxs)("span",{className:"flex items-center",children:[(0,l.jsx)(v.Z,{className:"h-4 w-4 mr-1"}),s.userProfile.experienceYears," 年經驗"]}),(null===(n=s.userProfile)||void 0===n?void 0:n.languages)&&s.userProfile.languages.length>0&&(0,l.jsxs)("span",{className:"flex items-center",children:[(0,l.jsx)(g.Z,{className:"h-4 w-4 mr-1"}),s.userProfile.languages.slice(0,2).join(", "),s.userProfile.languages.length>2&&" +".concat(s.userProfile.languages.length-2)]})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-4 text-sm",children:[(0,l.jsxs)("span",{className:"flex items-center text-blue-600",children:[(0,l.jsx)(y.Z,{className:"h-4 w-4 mr-1"}),s.stats.servicesCount," 個服務"]}),(0,l.jsxs)("span",{className:"flex items-center text-green-600",children:[(0,l.jsx)(j.Z,{className:"h-4 w-4 mr-1"}),"NT$ ",s.stats.totalEarnings.toLocaleString()]}),(0,l.jsxs)("span",{className:"flex items-center text-yellow-600",children:[(0,l.jsx)(h.Z,{className:"h-4 w-4 mr-1"}),s.stats.averageRating>0?s.stats.averageRating.toFixed(1):"N/A"]}),(0,l.jsxs)("span",{className:"text-gray-500",children:[s.stats.bookingsCount," 次預訂"]}),(0,l.jsxs)("span",{className:"text-gray-500",children:[s.stats.reviewsCount," 則評論"]})]})]}),(0,l.jsxs)("div",{className:"text-right text-xs text-gray-500",children:[(0,l.jsx)("p",{children:"註冊於"}),(0,l.jsx)("p",{children:new Date(s.createdAt).toLocaleDateString("zh-TW")}),s.lastLoginAt&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("p",{className:"mt-1",children:"最後活躍"}),(0,l.jsx)("p",{children:new Date(s.lastLoginAt).toLocaleDateString("zh-TW")})]})]})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2 ml-4",children:[(0,l.jsxs)(c.z,{variant:"outline",size:"sm",onClick:()=>e.push("/admin/users/".concat(s.id)),children:[(0,l.jsx)(b.Z,{className:"h-4 w-4 mr-1"}),"詳情"]}),"ACTIVE"===s.status&&(0,l.jsxs)(c.z,{variant:"outline",size:"sm",onClick:()=>Y(s.id,"suspend"),children:[(0,l.jsx)(w.Z,{className:"h-4 w-4 mr-1"}),"停權"]}),"SUSPENDED"===s.status&&(0,l.jsxs)(c.z,{variant:"default",size:"sm",onClick:()=>Y(s.id,"activate"),children:[(0,l.jsx)(u.Z,{className:"h-4 w-4 mr-1"}),"恢復"]}),!s.isKycVerified&&(0,l.jsxs)(c.z,{variant:"outline",size:"sm",onClick:()=>Y(s.id,"verify_kyc"),children:[(0,l.jsx)(f.Z,{className:"h-4 w-4 mr-1"}),"認證"]})]})]},s.id)}),0===C.length&&(0,l.jsxs)("div",{className:"text-center py-8",children:[(0,l.jsx)(x.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,l.jsx)("p",{className:"text-gray-500",children:"沒有找到符合條件的地陪"})]})]})})]})]})})}},5671:function(e,s,a){"use strict";a.d(s,{Ol:function(){return n},SZ:function(){return d},Zb:function(){return i},aY:function(){return o},ll:function(){return c}});var l=a(7437),t=a(2265),r=a(2169);let i=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,l.jsx)("div",{ref:s,className:(0,r.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...t})});i.displayName="Card";let n=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,l.jsx)("div",{ref:s,className:(0,r.cn)("flex flex-col space-y-1.5 p-6",a),...t})});n.displayName="CardHeader";let c=t.forwardRef((e,s)=>{let{className:a,children:t,...i}=e;return(0,l.jsx)("h3",{ref:s,className:(0,r.cn)("text-2xl font-semibold leading-none tracking-tight",a),...i,children:t})});c.displayName="CardTitle";let d=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,l.jsx)("p",{ref:s,className:(0,r.cn)("text-sm text-muted-foreground",a),...t})});d.displayName="CardDescription";let o=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,l.jsx)("div",{ref:s,className:(0,r.cn)("p-6 pt-0",a),...t})});o.displayName="CardContent",t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,l.jsx)("div",{ref:s,className:(0,r.cn)("flex items-center p-6 pt-0",a),...t})}).displayName="CardFooter"},2782:function(e,s,a){"use strict";a.d(s,{I:function(){return i}});var l=a(7437),t=a(2265),r=a(2169);let i=t.forwardRef((e,s)=>{let{className:a,type:i,error:n,label:c,icon:d,...o}=e,x=t.useId();return(0,l.jsxs)("div",{className:"space-y-2",children:[c&&(0,l.jsx)("label",{htmlFor:x,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:c}),(0,l.jsxs)("div",{className:"relative",children:[d&&(0,l.jsx)("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground",children:d}),(0,l.jsx)("input",{id:x,type:i,className:(0,r.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",d&&"pl-10",n&&"border-destructive focus-visible:ring-destructive",a),ref:s,...o})]}),n&&(0,l.jsx)("p",{className:"text-sm text-destructive",children:n})]})});i.displayName="Input"}},function(e){e.O(0,[1216,4784,7045,1744],function(){return e(e.s=8001)}),_N_E=e.O()}]);