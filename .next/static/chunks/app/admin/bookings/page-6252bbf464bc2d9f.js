(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9424],{824:function(e,s,t){Promise.resolve().then(t.bind(t,7036))},7036:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return C}});var a=t(7437),l=t(2265),r=t(4033),i=t(7045),n=t(5671),c=t(575),d=t(3277),o=t(2782),x=t(8203),m=t(4280),u=t(5817),h=t(1827),f=t(6141),j=t(3008),N=t(2104),v=t(1298),p=t(6142),g=t(7972),y=t(5750),b=t(2245),w=t(9670);function C(){let e=(0,r.useRouter)(),[s,t]=(0,l.useState)([]),[C,E]=(0,l.useState)([]),[D,L]=(0,l.useState)(!0),[Z,I]=(0,l.useState)(""),[k,P]=(0,l.useState)("all"),[S,R]=(0,l.useState)("all"),[O,A]=(0,l.useState)({start:"",end:""});(0,l.useEffect)(()=>{z()},[]),(0,l.useEffect)(()=>{T()},[s,Z,k,S,O]);let z=async()=>{try{let e=await fetch("/api/admin/bookings");if(e.ok){let s=await e.json();if(s.success){let e=s.bookings||s.data||[];t(Array.isArray(e)?e:[])}else t([])}else t([])}catch(e){t([])}finally{L(!1)}},T=()=>{let e=s;if(Z&&(e=e.filter(e=>{var s,t,a,l,r,i;return e.service.title.toLowerCase().includes(Z.toLowerCase())||(null===(s=e.traveler.name)||void 0===s?void 0:s.toLowerCase().includes(Z.toLowerCase()))||(null===(a=e.traveler.userProfile)||void 0===a?void 0:null===(t=a.name)||void 0===t?void 0:t.toLowerCase().includes(Z.toLowerCase()))||(null===(l=e.guide.name)||void 0===l?void 0:l.toLowerCase().includes(Z.toLowerCase()))||(null===(i=e.guide.userProfile)||void 0===i?void 0:null===(r=i.name)||void 0===r?void 0:r.toLowerCase().includes(Z.toLowerCase()))||e.id.toLowerCase().includes(Z.toLowerCase())})),"all"!==k&&(e=e.filter(e=>e.status.toLowerCase()===k.toLowerCase())),"all"!==S&&(e=e.filter(e=>{var s;return(null===(s=e.payment)||void 0===s?void 0:s.status.toLowerCase())===S.toLowerCase()})),O.start&&O.end){let s=new Date(O.start),t=new Date(O.end);e=e.filter(e=>{let a=new Date(e.bookingDate);return a>=s&&a<=t})}E(e)},_=e=>({PENDING:"待確認",CONFIRMED:"已確認",IN_PROGRESS:"進行中",COMPLETED:"已完成",CANCELLED:"已取消"})[e]||e,F=e=>({PENDING:"secondary",CONFIRMED:"default",IN_PROGRESS:"default",COMPLETED:"default",CANCELLED:"destructive"})[e]||"outline",G=e=>({PENDING:"待付款",PAID:"已付款",REFUNDED:"已退款",FAILED:"付款失敗"})[e]||e,M=e=>({PENDING:"secondary",PAID:"default",REFUNDED:"outline",FAILED:"destructive"})[e]||"outline",Y=async(e,s)=>{try{(await fetch("/api/admin/bookings/".concat(e),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:s})})).ok&&z()}catch(e){}};return D?(0,a.jsx)(i.AdminLayout,{children:(0,a.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"載入中..."})]})})}):(0,a.jsx)(i.AdminLayout,{children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("div",{className:"mb-8",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[(0,a.jsx)(x.Z,{className:"h-8 w-8 mr-3"}),"訂單管理"]}),(0,a.jsx)("p",{className:"text-gray-600 mt-2",children:"管理所有平台預訂和交易記錄"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)(c.z,{variant:"outline",onClick:()=>z(),children:[(0,a.jsx)(m.Z,{className:"h-4 w-4 mr-2"}),"重新整理"]}),(0,a.jsxs)(c.z,{variant:"outline",onClick:()=>{},children:[(0,a.jsx)(u.Z,{className:"h-4 w-4 mr-2"}),"匯出"]})]})]})}),(0,a.jsxs)(n.Zb,{className:"mb-6",children:[(0,a.jsx)(n.Ol,{children:(0,a.jsx)(n.ll,{children:"搜索和篩選"})}),(0,a.jsx)(n.aY,{children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[(0,a.jsx)("div",{className:"lg:col-span-2",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(h.Z,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),(0,a.jsx)(o.I,{placeholder:"搜索訂單 (ID、服務、客戶、地陪)",value:Z,onChange:e=>I(e.target.value),className:"pl-10"})]})}),(0,a.jsx)("div",{children:(0,a.jsxs)("select",{value:k,onChange:e=>P(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary",children:[(0,a.jsx)("option",{value:"all",children:"所有狀態"}),(0,a.jsx)("option",{value:"pending",children:"待確認"}),(0,a.jsx)("option",{value:"confirmed",children:"已確認"}),(0,a.jsx)("option",{value:"in_progress",children:"進行中"}),(0,a.jsx)("option",{value:"completed",children:"已完成"}),(0,a.jsx)("option",{value:"cancelled",children:"已取消"})]})}),(0,a.jsx)("div",{children:(0,a.jsxs)("select",{value:S,onChange:e=>R(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary",children:[(0,a.jsx)("option",{value:"all",children:"付款狀態"}),(0,a.jsx)("option",{value:"pending",children:"待付款"}),(0,a.jsx)("option",{value:"paid",children:"已付款"}),(0,a.jsx)("option",{value:"refunded",children:"已退款"}),(0,a.jsx)("option",{value:"failed",children:"付款失敗"})]})}),(0,a.jsx)("div",{children:(0,a.jsx)("input",{type:"date",value:O.start,onChange:e=>A(s=>({...s,start:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"})})]})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-6 mb-6",children:[(0,a.jsx)(n.Zb,{children:(0,a.jsx)(n.aY,{className:"pt-6",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"總訂單數"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:s.length})]}),(0,a.jsx)(x.Z,{className:"h-8 w-8 text-gray-400"})]})})}),(0,a.jsx)(n.Zb,{children:(0,a.jsx)(n.aY,{className:"pt-6",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"待確認"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:s.filter(e=>"PENDING"===e.status).length})]}),(0,a.jsx)(f.Z,{className:"h-8 w-8 text-yellow-500"})]})})}),(0,a.jsx)(n.Zb,{children:(0,a.jsx)(n.aY,{className:"pt-6",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"已完成"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:s.filter(e=>"COMPLETED"===e.status).length})]}),(0,a.jsx)(j.Z,{className:"h-8 w-8 text-green-500"})]})})}),(0,a.jsx)(n.Zb,{children:(0,a.jsx)(n.aY,{className:"pt-6",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"已取消"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:s.filter(e=>"CANCELLED"===e.status).length})]}),(0,a.jsx)(N.Z,{className:"h-8 w-8 text-red-500"})]})})}),(0,a.jsx)(n.Zb,{children:(0,a.jsx)(n.aY,{className:"pt-6",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"總收入"}),(0,a.jsxs)("p",{className:"text-xl font-bold",children:["NT$ ",s.filter(e=>"COMPLETED"===e.status).reduce((e,s)=>e+s.totalAmount,0).toLocaleString()]})]}),(0,a.jsx)(v.Z,{className:"h-8 w-8 text-gray-400"})]})})})]}),(0,a.jsxs)(n.Zb,{children:[(0,a.jsxs)(n.Ol,{children:[(0,a.jsxs)(n.ll,{children:["訂單列表 (",C.length,")"]}),(0,a.jsx)(n.SZ,{children:"點擊訂單查看詳細資料，或使用操作按鈕管理訂單狀態"})]}),(0,a.jsx)(n.aY,{children:(0,a.jsxs)("div",{className:"space-y-4",children:[C.map(s=>{var t,l;return(0,a.jsx)("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:s.service.title}),(0,a.jsx)(d.Ct,{variant:F(s.status),className:"text-xs",children:_(s.status)}),s.payment&&(0,a.jsx)(d.Ct,{variant:M(s.payment.status),className:"text-xs",children:G(s.payment.status)})]}),(0,a.jsxs)("div",{className:"text-right text-xs text-gray-500",children:[(0,a.jsxs)("p",{children:["訂單 #",s.id.slice(0,8)]}),(0,a.jsx)("p",{children:new Date(s.createdAt).toLocaleDateString("zh-TW")})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-3",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,a.jsx)(p.Z,{className:"h-4 w-4 mr-2"}),s.service.location]}),(0,a.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,a.jsx)(f.Z,{className:"h-4 w-4 mr-2"}),s.service.durationHours," 小時"]}),(0,a.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,a.jsx)(x.Z,{className:"h-4 w-4 mr-2"}),new Date(s.bookingDate).toLocaleDateString("zh-TW")]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,a.jsx)(g.Z,{className:"h-4 w-4 mr-2"}),"客戶: ",(null===(t=s.traveler.userProfile)||void 0===t?void 0:t.name)||s.traveler.name]}),(0,a.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,a.jsx)(g.Z,{className:"h-4 w-4 mr-2"}),"地陪: ",(null===(l=s.guide.userProfile)||void 0===l?void 0:l.name)||s.guide.name]}),(0,a.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,a.jsx)(y.Z,{className:"h-4 w-4 mr-2"}),s.guests," 人"]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,a.jsx)(v.Z,{className:"h-4 w-4 mr-2"}),"NT$ ",s.totalAmount.toLocaleString()]}),s.payment&&(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:[s.payment.method,s.payment.transactionId&&" - ".concat(s.payment.transactionId)]}),s.review&&(0,a.jsxs)("div",{className:"flex items-center text-sm text-yellow-600",children:[(0,a.jsx)(b.Z,{className:"h-4 w-4 mr-1 fill-current"}),s.review.rating,"/5"]})]})]}),s.notes&&(0,a.jsxs)("div",{className:"text-sm text-gray-600 bg-gray-50 p-2 rounded mt-2",children:[(0,a.jsx)("strong",{children:"備註:"})," ",s.notes]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 ml-4",children:[(0,a.jsxs)(c.z,{variant:"outline",size:"sm",onClick:()=>e.push("/admin/bookings/".concat(s.id)),children:[(0,a.jsx)(w.Z,{className:"h-4 w-4 mr-1"}),"詳情"]}),"PENDING"===s.status&&(0,a.jsxs)(c.z,{variant:"default",size:"sm",onClick:()=>Y(s.id,"confirm"),children:[(0,a.jsx)(j.Z,{className:"h-4 w-4 mr-1"}),"確認"]}),"CONFIRMED"===s.status&&(0,a.jsxs)(c.z,{variant:"outline",size:"sm",onClick:()=>Y(s.id,"cancel"),children:[(0,a.jsx)(N.Z,{className:"h-4 w-4 mr-1"}),"取消"]}),"COMPLETED"===s.status&&!s.review&&(0,a.jsxs)(c.z,{variant:"outline",size:"sm",onClick:()=>Y(s.id,"request_review"),children:[(0,a.jsx)(b.Z,{className:"h-4 w-4 mr-1"}),"請求評價"]})]})]})},s.id)}),0===C.length&&(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(x.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-500",children:"沒有找到符合條件的訂單"})]})]})})]})]})})}},5671:function(e,s,t){"use strict";t.d(s,{Ol:function(){return n},SZ:function(){return d},Zb:function(){return i},aY:function(){return o},ll:function(){return c}});var a=t(7437),l=t(2265),r=t(2169);let i=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)("div",{ref:s,className:(0,r.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...l})});i.displayName="Card";let n=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)("div",{ref:s,className:(0,r.cn)("flex flex-col space-y-1.5 p-6",t),...l})});n.displayName="CardHeader";let c=l.forwardRef((e,s)=>{let{className:t,children:l,...i}=e;return(0,a.jsx)("h3",{ref:s,className:(0,r.cn)("text-2xl font-semibold leading-none tracking-tight",t),...i,children:l})});c.displayName="CardTitle";let d=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)("p",{ref:s,className:(0,r.cn)("text-sm text-muted-foreground",t),...l})});d.displayName="CardDescription";let o=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)("div",{ref:s,className:(0,r.cn)("p-6 pt-0",t),...l})});o.displayName="CardContent",l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)("div",{ref:s,className:(0,r.cn)("flex items-center p-6 pt-0",t),...l})}).displayName="CardFooter"},2782:function(e,s,t){"use strict";t.d(s,{I:function(){return i}});var a=t(7437),l=t(2265),r=t(2169);let i=l.forwardRef((e,s)=>{let{className:t,type:i,error:n,label:c,icon:d,...o}=e,x=l.useId();return(0,a.jsxs)("div",{className:"space-y-2",children:[c&&(0,a.jsx)("label",{htmlFor:x,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:c}),(0,a.jsxs)("div",{className:"relative",children:[d&&(0,a.jsx)("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground",children:d}),(0,a.jsx)("input",{id:x,type:i,className:(0,r.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",d&&"pl-10",n&&"border-destructive focus-visible:ring-destructive",t),ref:s,...o})]}),n&&(0,a.jsx)("p",{className:"text-sm text-destructive",children:n})]})});i.displayName="Input"}},function(e){e.O(0,[1216,4784,7045,1744],function(){return e(e.s=824)}),_N_E=e.O()}]);