"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8982],{8982:function(e,t,s){s.d(t,{j:function(){return Z}});var a=s(7437),r=s(2265),i=s(2176),l=s(7972),n=s(9036),c=s(2245),d=s(6141),o=s(290),m=s(4035),x=s(9868),g=s(3505),h=s(5022),u=s(4660),p=s(4810);let v=(0,u.Ue)()((0,p.tJ)((e,t)=>({reviews:[],userReviews:[],statistics:{},isLoading:!1,isSubmitting:!1,error:null,filters:{sortBy:"newest"},currentPage:1,totalPages:1,pageSize:10,fetchReviews:async(s,a)=>{e({isLoading:!0,error:null});try{await new Promise(e=>setTimeout(e,1e3));let r=Array.from({length:15},(e,t)=>({id:"review-".concat(s,"-").concat(t+1),serviceId:"service"===a?s:"service-".concat(Math.floor(5*Math.random())+1),guideId:"guide"===a?s:"guide-".concat(Math.floor(10*Math.random())+1),userId:"user-".concat(Math.floor(100*Math.random())+1),bookingId:"booking-".concat(Math.floor(1e3*Math.random())+1),rating:Math.floor(5*Math.random())+1,comment:["非常棒的體驗！導遊很專業，行程安排得很好。","服務態度很好，但是時間安排有點緊湊。","超級推薦！導遊知識豐富，而且很幽默。","價格合理，服務品質很不錯。","導遊很準時，講解詳細，整體體驗很滿意。"][Math.floor(5*Math.random())],photos:Math.random()>.7?["/images/review-".concat(t+1,"-1.jpg"),"/images/review-".concat(t+1,"-2.jpg")]:void 0,pros:Math.random()>.5?["專業知識","準時","親切"]:void 0,cons:Math.random()>.8?["時間安排緊湊"]:void 0,isVerified:Math.random()>.3,isAnonymous:Math.random()>.8,helpful:Math.floor(20*Math.random()),reported:Math.floor(3*Math.random()),response:Math.random()>.6?{content:"感謝您的評價！我們會繼續努力提供更好的服務。",authorId:"guide"===a?s:"admin-1",authorType:"guide"===a?"guide":"admin",createdAt:new Date(Date.now()-6048e5*Math.random()).toISOString()}:void 0,tags:Math.random()>.5?["專業","準時","親切"]:void 0,createdAt:new Date(Date.now()-2592e6*Math.random()).toISOString(),updatedAt:new Date(Date.now()-1296e6*Math.random()).toISOString(),status:"approved"})),i={averageRating:r.reduce((e,t)=>e+t.rating,0)/r.length,totalReviews:r.length,ratingDistribution:r.reduce((e,t)=>(e[t.rating]=(e[t.rating]||0)+1,e),{}),totalHelpful:r.reduce((e,t)=>e+t.helpful,0),verifiedReviewsCount:r.filter(e=>e.isVerified).length,responseRate:r.filter(e=>e.response).length/r.length*100,tags:r.reduce((e,t)=>{var s;return null===(s=t.tags)||void 0===s||s.forEach(t=>{e[t]=(e[t]||0)+1}),e},{})};e({reviews:r,statistics:{...t().statistics,[s]:i},isLoading:!1})}catch(t){e({error:t instanceof Error?t.message:"載入評論失敗",isLoading:!1})}},fetchUserReviews:async t=>{e({isLoading:!0,error:null});try{await new Promise(e=>setTimeout(e,800));let s=Array.from({length:5},(e,s)=>({id:"user-review-".concat(t,"-").concat(s+1),serviceId:"service-".concat(Math.floor(5*Math.random())+1),guideId:"guide-".concat(Math.floor(10*Math.random())+1),userId:t,bookingId:"booking-".concat(Math.floor(1e3*Math.random())+1),rating:Math.floor(5*Math.random())+1,comment:"很棒的體驗！",isVerified:!0,isAnonymous:Math.random()>.7,helpful:Math.floor(10*Math.random()),reported:0,tags:["專業","準時"],createdAt:new Date(Date.now()-5184e6*Math.random()).toISOString(),updatedAt:new Date().toISOString(),status:"approved"}));e({userReviews:s,isLoading:!1})}catch(t){e({error:t instanceof Error?t.message:"載入用戶評論失敗",isLoading:!1})}},submitReview:async t=>{e({isSubmitting:!0,error:null});try{await new Promise(e=>setTimeout(e,1500));let s={...t,id:"review-".concat(Date.now()),helpful:0,reported:0,status:"pending",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};e(e=>({reviews:[s,...e.reviews],userReviews:[s,...e.userReviews],isSubmitting:!1}))}catch(t){throw e({error:t instanceof Error?t.message:"提交評論失敗",isSubmitting:!1}),t}},updateReview:async(t,s)=>{e({isSubmitting:!0,error:null});try{await new Promise(e=>setTimeout(e,1e3)),e(e=>({reviews:e.reviews.map(e=>e.id===t?{...e,...s,updatedAt:new Date().toISOString()}:e),userReviews:e.userReviews.map(e=>e.id===t?{...e,...s,updatedAt:new Date().toISOString()}:e),isSubmitting:!1}))}catch(t){throw e({error:t instanceof Error?t.message:"更新評論失敗",isSubmitting:!1}),t}},deleteReview:async t=>{e({isSubmitting:!0,error:null});try{await new Promise(e=>setTimeout(e,800)),e(e=>({reviews:e.reviews.filter(e=>e.id!==t),userReviews:e.userReviews.filter(e=>e.id!==t),isSubmitting:!1}))}catch(t){throw e({error:t instanceof Error?t.message:"刪除評論失敗",isSubmitting:!1}),t}},reportReview:async(t,s)=>{try{await new Promise(e=>setTimeout(e,500)),e(e=>({reviews:e.reviews.map(e=>e.id===t?{...e,reported:e.reported+1}:e)}))}catch(t){throw e({error:t instanceof Error?t.message:"檢舉失敗"}),t}},markHelpful:async t=>{try{await new Promise(e=>setTimeout(e,300)),e(e=>({reviews:e.reviews.map(e=>e.id===t?{...e,helpful:e.helpful+1}:e)}))}catch(t){throw e({error:t instanceof Error?t.message:"標記有用失敗"}),t}},respondToReview:async(t,s)=>{e({isSubmitting:!0,error:null});try{await new Promise(e=>setTimeout(e,1e3));let a={content:s,authorId:"current-user-id",authorType:"guide",createdAt:new Date().toISOString()};e(e=>({reviews:e.reviews.map(e=>e.id===t?{...e,response:a,updatedAt:new Date().toISOString()}:e),isSubmitting:!1}))}catch(t){throw e({error:t instanceof Error?t.message:"回覆評論失敗",isSubmitting:!1}),t}},setFilters:t=>{e(e=>({filters:{...e.filters,...t},currentPage:1}))},setPage:t=>{e({currentPage:t})},resetFilters:()=>{e({filters:{sortBy:"newest"},currentPage:1})}}),{name:"guidee-reviews",partialize:e=>({userReviews:e.userReviews,statistics:e.statistics})}));var f=s(8228),j=s(5790),b=s(5750);function w(e){let{statistics:t,size:s="md",showDetails:r=!0,className:i=""}=e,l={sm:{container:"p-3",rating:"text-2xl",stars:"w-4 h-4",text:"text-sm"},md:{container:"p-4",rating:"text-3xl",stars:"w-5 h-5",text:"text-base"},lg:{container:"p-6",rating:"text-4xl",stars:"w-6 h-6",text:"text-lg"}}[s];return(0,a.jsxs)("div",{className:"bg-white rounded-lg border ".concat(l.container," ").concat(i),children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"font-bold text-gray-900 ".concat(l.rating),children:t.averageRating.toFixed(1)}),(0,a.jsx)("div",{className:"flex justify-center mb-1",children:((e,t)=>{let s=Math.floor(e),r=e%1>=.5;return(0,a.jsx)("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(e=>(0,a.jsx)(c.Z,{className:"".concat(t," ").concat(e<=s?"text-yellow-400 fill-yellow-400":e===s+1&&r?"text-yellow-400 fill-yellow-400":"text-gray-300")},e))})})(t.averageRating,l.stars)}),(0,a.jsxs)("div",{className:"text-gray-600 ".concat(l.text),children:[t.totalReviews," 則評論"]})]}),r&&(0,a.jsxs)("div",{className:"flex-1 grid grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"flex justify-center mb-1",children:(0,a.jsx)(n.Z,{className:"w-5 h-5 text-green-600"})}),(0,a.jsxs)("div",{className:"text-sm font-medium text-gray-900",children:[Math.round(t.verifiedReviewsCount/t.totalReviews*100),"%"]}),(0,a.jsx)("div",{className:"text-xs text-gray-600",children:"已驗證"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"flex justify-center mb-1",children:(0,a.jsx)(j.Z,{className:"w-5 h-5 text-blue-600"})}),(0,a.jsxs)("div",{className:"text-sm font-medium text-gray-900",children:[Math.round(t.responseRate),"%"]}),(0,a.jsx)("div",{className:"text-xs text-gray-600",children:"回覆率"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"flex justify-center mb-1",children:(0,a.jsx)(b.Z,{className:"w-5 h-5 text-purple-600"})}),(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:t.totalHelpful}),(0,a.jsx)("div",{className:"text-xs text-gray-600",children:"有用"})]})]})]}),r&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"評分分佈"}),[5,4,3,2,1].map(e=>{let s=t.ratingDistribution[e]||0,r=t.totalReviews>0?s/t.totalReviews*100:0;return(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 w-12",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:e}),(0,a.jsx)(c.Z,{className:"w-3 h-3 text-yellow-400 fill-yellow-400"})]}),(0,a.jsx)("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:(0,a.jsx)("div",{className:"bg-yellow-400 h-2 rounded-full transition-all duration-300",style:{width:"".concat(r,"%")}})}),(0,a.jsx)("div",{className:"text-sm text-gray-600 w-8 text-right",children:s})]},e)})]}),r&&Object.keys(t.tags).length>0&&(0,a.jsxs)("div",{className:"mt-4 pt-4 border-t",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"服務特色"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:Object.entries(t.tags).sort((e,t)=>{let[,s]=e,[,a]=t;return a-s}).slice(0,6).map(e=>{let[t,s]=e;return(0,a.jsxs)("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:[t," (",s,")"]},t)})})]})]})}var y=s(2482),N=s(3523),R=s(2549),S=s(8438),M=s(8203);function k(e){var t,s,l;let{filters:d,onFiltersChange:o,onReset:m,totalReviews:x,availableTags:g=[],className:h=""}=e,[u,p]=(0,r.useState)(!1),[v,f]=(0,r.useState)(!1),j=(0,r.useRef)(null);(0,r.useEffect)(()=>{let e=e=>{j.current&&!j.current.contains(e.target)&&(p(!1),f(!1))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let b=e=>{let t=d.tags||[],s=t.includes(e)?t.filter(t=>t!==e):[...t,e];o({tags:0===s.length?void 0:s})},w=()=>{let e=0;return d.rating&&d.rating.length<5&&e++,void 0!==d.verified&&e++,d.withPhotos&&e++,d.withResponse&&e++,d.tags&&d.tags.length>0&&e++,d.dateRange&&e++,e},k=w()>0;return(0,a.jsxs)("div",{className:"relative ".concat(h),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("select",{value:d.sortBy,onChange:e=>o({sortBy:e.target.value}),className:"px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[{value:"newest",label:"最新發布"},{value:"oldest",label:"最早發布"},{value:"highest",label:"評分最高"},{value:"lowest",label:"評分最低"},{value:"helpful",label:"最有用"}].map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))}),(0,a.jsxs)("button",{onClick:()=>p(!u),className:"flex items-center gap-2 px-3 py-2 border rounded-md text-sm transition-colors ".concat(k?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-300 text-gray-700 hover:bg-gray-50"),children:[(0,a.jsx)(y.Z,{className:"w-4 h-4"}),"篩選",k&&(0,a.jsx)("span",{className:"bg-blue-500 text-white rounded-full w-5 h-5 text-xs flex items-center justify-center",children:w()}),(0,a.jsx)(N.Z,{className:"w-4 h-4"})]}),k&&(0,a.jsx)("button",{onClick:m,className:"text-sm text-gray-500 hover:text-gray-700",children:"清除篩選"})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["共 ",x," 則評論"]})]}),u&&(0,a.jsx)("div",{ref:j,className:"absolute top-full left-0 mt-2 w-96 bg-white border border-gray-200 rounded-lg shadow-lg z-50",children:(0,a.jsxs)("div",{className:"p-4 space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900",children:"篩選選項"}),(0,a.jsx)("button",{onClick:()=>p(!1),className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)(R.Z,{className:"w-4 h-4"})})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"text-sm font-medium text-gray-700 mb-3 flex items-center gap-2",children:[(0,a.jsx)(c.Z,{className:"w-4 h-4"}),"評分"]}),(0,a.jsx)("div",{className:"space-y-2",children:[{value:[5],label:"5 星"},{value:[4,5],label:"4 星以上"},{value:[3,4,5],label:"3 星以上"},{value:[2,3,4,5],label:"2 星以上"},{value:[1,2,3,4,5],label:"全部評分"}].map(e=>{var t;return(0,a.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,a.jsx)("input",{type:"radio",name:"rating",checked:5===e.value.length?!d.rating||5===d.rating.length:JSON.stringify(null===(t=d.rating)||void 0===t?void 0:t.sort((e,t)=>t-e))===JSON.stringify(e.value),onChange:()=>o({rating:5===e.value.length?void 0:e.value}),className:"text-blue-600"}),(0,a.jsx)("span",{className:"text-sm text-gray-700",children:e.label})]},e.label)})})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"text-sm font-medium text-gray-700 mb-3 flex items-center gap-2",children:[(0,a.jsx)(n.Z,{className:"w-4 h-4"}),"驗證狀態"]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,a.jsx)("input",{type:"radio",name:"verified",checked:void 0===d.verified,onChange:()=>o({verified:void 0}),className:"text-blue-600"}),(0,a.jsx)("span",{className:"text-sm text-gray-700",children:"全部"})]}),(0,a.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,a.jsx)("input",{type:"radio",name:"verified",checked:!0===d.verified,onChange:()=>o({verified:!0}),className:"text-blue-600"}),(0,a.jsx)("span",{className:"text-sm text-gray-700",children:"僅已驗證"})]}),(0,a.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,a.jsx)("input",{type:"radio",name:"verified",checked:!1===d.verified,onChange:()=>o({verified:!1}),className:"text-blue-600"}),(0,a.jsx)("span",{className:"text-sm text-gray-700",children:"僅未驗證"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"附加內容"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:d.withPhotos||!1,onChange:e=>o({withPhotos:e.target.checked||void 0}),className:"text-blue-600"}),(0,a.jsx)(S.Z,{className:"w-4 h-4 text-gray-500"}),(0,a.jsx)("span",{className:"text-sm text-gray-700",children:"有照片"})]}),(0,a.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:d.withResponse||!1,onChange:e=>o({withResponse:e.target.checked||void 0}),className:"text-blue-600"}),(0,a.jsx)(i.Z,{className:"w-4 h-4 text-gray-500"}),(0,a.jsx)("span",{className:"text-sm text-gray-700",children:"有回覆"})]})]})]}),g.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"服務特色"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2 max-h-32 overflow-y-auto",children:g.map(e=>{var t;return(0,a.jsx)("button",{onClick:()=>b(e),className:"px-2 py-1 rounded-full text-sm border transition-colors ".concat((null===(t=d.tags)||void 0===t?void 0:t.includes(e))?"bg-blue-100 border-blue-300 text-blue-700":"bg-gray-50 border-gray-200 text-gray-700 hover:bg-gray-100"),children:e},e)})})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"text-sm font-medium text-gray-700 mb-3 flex items-center gap-2",children:[(0,a.jsx)(M.Z,{className:"w-4 h-4"}),"日期範圍"]}),(0,a.jsx)("button",{onClick:()=>f(!v),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm text-left hover:bg-gray-50",children:d.dateRange?"".concat(d.dateRange.start.toLocaleDateString()," - ").concat(d.dateRange.end.toLocaleDateString()):"選擇日期範圍"}),v&&(0,a.jsxs)("div",{className:"mt-2 p-3 border border-gray-200 rounded-md bg-gray-50",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-600 mb-1",children:"開始日期"}),(0,a.jsx)("input",{type:"date",value:(null===(t=d.dateRange)||void 0===t?void 0:t.start.toISOString().split("T")[0])||"",onChange:e=>{var t;o({dateRange:{start:new Date(e.target.value),end:(null===(t=d.dateRange)||void 0===t?void 0:t.end)||new Date}})},className:"w-full px-2 py-1 border border-gray-300 rounded text-xs"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-600 mb-1",children:"結束日期"}),(0,a.jsx)("input",{type:"date",value:(null===(s=d.dateRange)||void 0===s?void 0:s.end.toISOString().split("T")[0])||"",onChange:e=>{var t;let s=new Date(e.target.value);o({dateRange:{start:(null===(t=d.dateRange)||void 0===t?void 0:t.start)||new Date,end:s}})},className:"w-full px-2 py-1 border border-gray-300 rounded text-xs"})]})]}),(0,a.jsx)("button",{onClick:()=>{o({dateRange:void 0}),f(!1)},className:"mt-2 text-xs text-gray-500 hover:text-gray-700",children:"清除日期範圍"})]})]})]})}),k&&(0,a.jsxs)("div",{className:"flex flex-wrap gap-2 mt-3",children:[d.rating&&d.rating.length<5&&(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:[1===d.rating.length?"".concat(d.rating[0]," 星"):"".concat(Math.min(...d.rating),"-").concat(Math.max(...d.rating)," 星"),(0,a.jsx)("button",{onClick:()=>o({rating:void 0}),className:"hover:text-blue-600",children:(0,a.jsx)(R.Z,{className:"w-3 h-3"})})]}),void 0!==d.verified&&(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full",children:[d.verified?"已驗證":"未驗證",(0,a.jsx)("button",{onClick:()=>o({verified:void 0}),className:"hover:text-green-600",children:(0,a.jsx)(R.Z,{className:"w-3 h-3"})})]}),d.withPhotos&&(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded-full",children:["有照片",(0,a.jsx)("button",{onClick:()=>o({withPhotos:void 0}),className:"hover:text-purple-600",children:(0,a.jsx)(R.Z,{className:"w-3 h-3"})})]}),d.withResponse&&(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-orange-100 text-orange-800 text-xs rounded-full",children:["有回覆",(0,a.jsx)("button",{onClick:()=>o({withResponse:void 0}),className:"hover:text-orange-600",children:(0,a.jsx)(R.Z,{className:"w-3 h-3"})})]}),null===(l=d.tags)||void 0===l?void 0:l.map(e=>(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded-full",children:[e,(0,a.jsx)("button",{onClick:()=>b(e),className:"hover:text-gray-600",children:(0,a.jsx)(R.Z,{className:"w-3 h-3"})})]},e)),d.dateRange&&(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-indigo-100 text-indigo-800 text-xs rounded-full",children:[d.dateRange.start.toLocaleDateString()," - ",d.dateRange.end.toLocaleDateString(),(0,a.jsx)("button",{onClick:()=>o({dateRange:void 0}),className:"hover:text-indigo-600",children:(0,a.jsx)(R.Z,{className:"w-3 h-3"})})]})]})]})}var D=s(7290);function Z(e){let{targetId:t,targetType:s,showTitle:u=!0,showFilters:p=!0,showStatistics:j=!0,maxItems:b,className:y=""}=e,{user:N}=(0,f.a)(),{success:R,error:S}=(0,D.pm)(),{reviews:M,statistics:Z,isLoading:C,filters:A,fetchReviews:I,markHelpful:T,reportReview:P,respondToReview:O,setFilters:E,resetFilters:L}=v(),[z,B]=(0,r.useState)([]),[V,F]=(0,r.useState)(null),[_,H]=(0,r.useState)("");(0,r.useEffect)(()=>{I(t,s)},[t,s,I]),(0,r.useEffect)(()=>{let e=[...M];switch(A.rating&&A.rating.length<5&&(e=e.filter(e=>A.rating.includes(e.rating))),void 0!==A.verified&&(e=e.filter(e=>e.isVerified===A.verified)),A.withPhotos&&(e=e.filter(e=>e.photos&&e.photos.length>0)),A.withResponse&&(e=e.filter(e=>e.response)),A.tags&&A.tags.length>0&&(e=e.filter(e=>e.tags&&A.tags.some(t=>e.tags.includes(t)))),A.dateRange&&(e=e.filter(e=>{let t=new Date(e.createdAt);return t>=A.dateRange.start&&t<=A.dateRange.end})),A.sortBy){case"newest":e.sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime());break;case"oldest":e.sort((e,t)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime());break;case"highest":e.sort((e,t)=>t.rating-e.rating);break;case"lowest":e.sort((e,t)=>e.rating-t.rating);break;case"helpful":e.sort((e,t)=>t.helpful-e.helpful)}b&&(e=e.slice(0,b)),B(e)},[M,A,b]);let J=e=>{let t=new Date(e),s=(new Date().getTime()-t.getTime())/36e5;return s<24?"".concat(Math.floor(s)," 小時前"):s<168?"".concat(Math.floor(s/24)," 天前"):t.toLocaleDateString("zh-TW",{year:"numeric",month:"long",day:"numeric"})},U=async e=>{try{await T(e),R("標記成功","感謝您的回饋")}catch(e){S("操作失敗","請稍後再試")}},W=async e=>{let t=prompt("請說明檢舉原因：");if(t)try{await P(e,t),R("檢舉成功","我們會盡快處理")}catch(e){S("檢舉失敗","請稍後再試")}},q=async e=>{if(_.trim())try{await O(e,_.trim()),F(null),H(""),R("回覆成功","感謝您的回覆")}catch(e){S("回覆失敗","請稍後再試")}},G=Z[t],K=G?Object.keys(G.tags):[];return C?(0,a.jsx)(h.gb,{}):(0,a.jsxs)("div",{className:y,children:[u&&G&&(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"用戶評價"}),(0,a.jsxs)("span",{className:"text-sm text-gray-500",children:["共 ",G.totalReviews," 則評論"]})]}),j&&(0,a.jsx)(w,{statistics:G,size:"lg",className:"mb-6"})]}),p&&(0,a.jsx)(k,{filters:A,onFiltersChange:E,onReset:L,totalReviews:M.length,availableTags:K,className:"mb-6"}),0===z.length?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("div",{className:"text-gray-400 mb-4",children:(0,a.jsx)(i.Z,{className:"w-12 h-12 mx-auto"})}),(0,a.jsx)("p",{className:"text-gray-500",children:"暫無符合條件的評論"})]}):(0,a.jsx)("div",{className:"space-y-6",children:z.map(e=>(0,a.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-gray-300 rounded-full flex items-center justify-center",children:(0,a.jsx)(l.Z,{className:"w-5 h-5 text-gray-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"font-medium text-gray-900",children:e.isAnonymous?"匿名用戶":"用戶 ".concat(e.userId.slice(-4))}),e.isVerified&&(0,a.jsx)(n.Z,{className:"w-4 h-4 text-green-600"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,a.jsx)("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(t=>(0,a.jsx)(c.Z,{className:"w-4 h-4 ".concat(t<=e.rating?"text-yellow-400 fill-yellow-400":"text-gray-300")},t))}),(0,a.jsxs)("span",{className:"text-sm text-gray-500 flex items-center gap-1",children:[(0,a.jsx)(d.Z,{className:"w-3 h-3"}),J(e.createdAt)]})]})]})]}),(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)("button",{className:"p-1 text-gray-400 hover:text-gray-600",children:(0,a.jsx)(o.Z,{className:"w-4 h-4"})})})]}),(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)("p",{className:"text-gray-700 leading-relaxed",children:e.comment})}),e.tags&&e.tags.length>0&&(0,a.jsx)("div",{className:"flex flex-wrap gap-2 mb-4",children:e.tags.map(e=>(0,a.jsx)("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:e},e))}),(e.pros||e.cons)&&(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.pros&&e.pros.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-green-700 mb-2",children:"優點"}),(0,a.jsx)("ul",{className:"space-y-1",children:e.pros.map((e,t)=>(0,a.jsxs)("li",{className:"text-sm text-gray-600 flex items-start gap-2",children:[(0,a.jsx)("span",{className:"text-green-500 mt-1",children:"+"}),e]},t))})]}),e.cons&&e.cons.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-red-700 mb-2",children:"建議改進"}),(0,a.jsx)("ul",{className:"space-y-1",children:e.cons.map((e,t)=>(0,a.jsxs)("li",{className:"text-sm text-gray-600 flex items-start gap-2",children:[(0,a.jsx)("span",{className:"text-red-500 mt-1",children:"-"}),e]},t))})]})]}),e.photos&&e.photos.length>0&&(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,a.jsx)(m.Z,{className:"w-4 h-4 text-gray-500"}),(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"評論照片"})]}),(0,a.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3",children:e.photos.map((e,t)=>(0,a.jsx)("img",{src:e,alt:"評論照片 ".concat(t+1),className:"w-full h-24 object-cover rounded-lg border"},t))})]}),e.response&&(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)(i.Z,{className:"w-4 h-4 text-blue-600"}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-900",children:"guide"===e.response.authorType?"導遊回覆":"官方回覆"}),(0,a.jsx)("span",{className:"text-sm text-gray-500",children:J(e.response.createdAt)})]}),(0,a.jsx)("p",{className:"text-sm text-gray-700",children:e.response.content})]}),V===e.id&&(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 mb-4",children:[(0,a.jsx)("textarea",{value:_,onChange:e=>H(e.target.value),placeholder:"撰寫回覆...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3}),(0,a.jsxs)("div",{className:"flex gap-2 mt-3",children:[(0,a.jsx)("button",{onClick:()=>q(e.id),disabled:!_.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed",children:"發布回覆"}),(0,a.jsx)("button",{onClick:()=>{F(null),H("")},className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50",children:"取消"})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("button",{onClick:()=>U(e.id),className:"flex items-center gap-2 text-gray-500 hover:text-blue-600 transition-colors",children:[(0,a.jsx)(x.Z,{className:"w-4 h-4"}),(0,a.jsxs)("span",{className:"text-sm",children:["有用 (",e.helpful,")"]})]}),N&&"service"===s&&!e.response&&(0,a.jsxs)("button",{onClick:()=>F(e.id),className:"flex items-center gap-2 text-gray-500 hover:text-green-600 transition-colors",children:[(0,a.jsx)(i.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"text-sm",children:"回覆"})]})]}),(0,a.jsxs)("button",{onClick:()=>W(e.id),className:"flex items-center gap-1 text-gray-400 hover:text-red-600 transition-colors",children:[(0,a.jsx)(g.Z,{className:"w-3 h-3"}),(0,a.jsx)("span",{className:"text-xs",children:"檢舉"})]})]})]},e.id))})]})}},7290:function(e,t,s){s.d(t,{pm:function(){return c}}),s(7437);var a=s(2265),r=s(3008),i=s(1981),l=s(2894),n=s(4056);function c(){let[e,t]=(0,a.useState)([]),s=e=>{let s=Math.random().toString(36).substr(2,9),a={id:s,duration:5e3,...e};return t(e=>[...e,a]),s};return{toasts:e,addToast:s,removeToast:e=>{t(t=>t.filter(t=>t.id!==e))},success:(e,t)=>s({type:"success",title:e,message:t}),error:(e,t)=>s({type:"error",title:e,message:t}),warning:(e,t)=>s({type:"warning",title:e,message:t}),info:(e,t)=>s({type:"info",title:e,message:t})}}r.Z,i.Z,l.Z,n.Z}}]);