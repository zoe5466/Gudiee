"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5991],{9578:function(e,t,r){r.d(t,{M:function(){return d}});var i=r(7437),n=r(2265),o=r(8203),a=r(1291),s=r(7158),l=r(2169);function d(e){let{value:t,onChange:r,placeholder:d="選擇日期",disabled:u=!1,className:c,minDate:h,maxDate:p,label:g,required:f=!1}=e,[m,b]=n.useState(!1),[y,x]=n.useState(t?new Date(t.getFullYear(),t.getMonth()):new Date),[w,v]=n.useState("center"),k=n.useRef(null),j=n.useRef(null);n.useEffect(()=>{let e=e=>{k.current&&!k.current.contains(e.target)&&b(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),n.useEffect(()=>{if(m&&j.current){let e=j.current.getBoundingClientRect(),t=window.innerWidth,r=e.left+e.width/2-160,i=e.left+e.width/2+160;r<20?v("left"):i>t-20?v("right"):v("center")}},[m]);let C=e=>!!h&&e<h||!!p&&e>p,T=e=>{C(e)||(r(e),b(!1))},S=e=>{x(t=>{let r=new Date(t);return"prev"===e?r.setMonth(t.getMonth()-1):r.setMonth(t.getMonth()+1),r})},A=(e=>{let t=e.getFullYear(),r=e.getMonth(),i=new Date(t,r,1),n=new Date(t,r+1,0).getDate(),o=i.getDay(),a=[];for(let e=0;e<o;e++)a.push(null);for(let e=1;e<=n;e++)a.push(new Date(t,r,e));return a})(y);return(0,i.jsxs)("div",{className:(0,l.cn)("relative",c),children:[g&&(0,i.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[g,f&&(0,i.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),(0,i.jsxs)("button",{ref:j,type:"button",onClick:()=>!u&&b(!m),disabled:u,style:{width:"100%",padding:"0.75rem 1rem",border:m?"1px solid #3b82f6":"1px solid #e5e7eb",borderRadius:"0.5rem",backgroundColor:"white",display:"flex",alignItems:"center",justifyContent:"space-between",cursor:u?"not-allowed":"pointer",transition:"all 0.2s",opacity:u?.5:1,fontSize:"1rem",textAlign:"left"},className:m?"ring-2 ring-blue-200":"hover:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200 focus:border-blue-500",children:[(0,i.jsx)("span",{style:{color:t?"#111827":"#6b7280",fontWeight:t?"500":"400"},children:t?t.toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit"}):d}),(0,i.jsx)(o.Z,{style:{width:"18px",height:"18px",color:"#6b7280",flexShrink:0}})]}),m&&(0,i.jsxs)("div",{ref:k,style:{position:"absolute",top:"calc(100% + 0.125rem)",left:"center"===w?"50%":"left"===w?"0":"auto",right:"right"===w?"0":"auto",transform:"center"===w?"translateX(-50%)":"none",backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"0.75rem",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)",zIndex:50,padding:"1.5rem",width:"320px"},children:[(0,i.jsx)("div",{style:{position:"absolute",top:"-6px",left:"center"===w?"50%":"left"===w?"40px":"auto",right:"right"===w?"40px":"auto",transform:"center"===w?"translateX(-50%)":"none",width:0,height:0,borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderBottom:"6px solid white"}}),(0,i.jsx)("div",{style:{position:"absolute",top:"-7px",left:"center"===w?"50%":"left"===w?"40px":"auto",right:"right"===w?"40px":"auto",transform:"center"===w?"translateX(-50%)":"none",width:0,height:0,borderLeft:"7px solid transparent",borderRight:"7px solid transparent",borderBottom:"7px solid #e5e7eb"}}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"1.5rem"},children:[(0,i.jsx)("button",{type:"button",onClick:()=>S("prev"),style:{padding:"0.5rem",borderRadius:"0.5rem",border:"none",backgroundColor:"transparent",cursor:"pointer",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},className:"hover:bg-gray-100",children:(0,i.jsx)(a.Z,{style:{width:"18px",height:"18px",color:"#374151"}})}),(0,i.jsx)("h3",{style:{fontSize:"1.125rem",fontWeight:"600",color:"#111827",textAlign:"center"},children:y.toLocaleDateString("zh-TW",{year:"numeric",month:"long"})}),(0,i.jsx)("button",{type:"button",onClick:()=>S("next"),style:{padding:"0.5rem",borderRadius:"0.5rem",border:"none",backgroundColor:"transparent",cursor:"pointer",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},className:"hover:bg-gray-100",children:(0,i.jsx)(s.Z,{style:{width:"18px",height:"18px",color:"#374151"}})})]}),(0,i.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:"0.25rem",marginBottom:"1rem"},children:["日","一","二","三","四","五","六"].map(e=>(0,i.jsx)("div",{style:{textAlign:"center",fontSize:"0.875rem",fontWeight:"600",color:"#6b7280",padding:"0.75rem 0"},children:e},e))}),(0,i.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:"0.25rem"},children:A.map((e,r)=>{if(!e)return(0,i.jsx)("div",{style:{padding:"0.75rem 0"}},r);let n=t&&e.toDateString()===t.toDateString(),o=e.toDateString()===new Date().toDateString(),a=C(e);return(0,i.jsx)("button",{type:"button",onClick:()=>T(e),disabled:a,style:{textAlign:"center",fontSize:"0.875rem",padding:"0.75rem 0",borderRadius:"0.5rem",border:"none",cursor:a?"not-allowed":"pointer",transition:"all 0.2s",fontWeight:n?"600":o?"500":"400",backgroundColor:n?"#FF5A5F":o?"#f3f4f6":"transparent",color:n?"white":a?"#d1d5db":o?"#111827":"#374151"},className:a||n?"":"hover:bg-blue-50 hover:text-blue-600",children:e.getDate()},r)})}),(0,i.jsx)("div",{style:{marginTop:"1.5rem",paddingTop:"1rem",borderTop:"1px solid #e5e7eb"},children:(0,i.jsx)("button",{type:"button",onClick:()=>T(new Date),style:{width:"100%",textAlign:"center",fontSize:"0.875rem",color:"#FF5A5F",fontWeight:"500",padding:"0.5rem",borderRadius:"0.5rem",border:"none",backgroundColor:"transparent",cursor:"pointer",transition:"all 0.2s"},className:"hover:bg-red-50 hover:text-red-600",children:"今天"})})]})]})}},2169:function(e,t,r){r.d(t,{cn:function(){return o}});var i=r(7042),n=r(4769);function o(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,n.m6)((0,i.W)(t))}},8228:function(e,t,r){r.d(t,{a:function(){return o}});var i=r(4660),n=r(4810);let o=(0,i.Ue)()((0,n.tJ)((e,t)=>({user:null,token:null,refreshToken:null,isLoading:!1,isAuthenticated:!1,login:async(t,r)=>{e({isLoading:!0});try{var i,n,o,a;let s=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:t,password:r})}),l=await s.json();if(!s.ok||!l.success)throw Error(l.error||l.message||"登入失敗");let d={id:l.data.user.id,email:l.data.user.email,name:l.data.user.name,avatar:l.data.user.avatar,role:l.data.user.role.toLowerCase(),isEmailVerified:l.data.user.isEmailVerified,isKYCVerified:l.data.user.isKycVerified,createdAt:l.data.user.createdAt,permissions:l.data.user.permissions||[],profile:{phone:l.data.user.phone,bio:null===(i=l.data.user.userProfile)||void 0===i?void 0:i.bio,location:null===(n=l.data.user.userProfile)||void 0===n?void 0:n.location,languages:null===(o=l.data.user.userProfile)||void 0===o?void 0:o.languages,specialties:null===(a=l.data.user.userProfile)||void 0===a?void 0:a.specialties}};e({user:d,token:l.data.token,refreshToken:null,isAuthenticated:!0,isLoading:!1})}catch(t){throw e({isLoading:!1}),t}},register:async t=>{e({isLoading:!0});try{await new Promise(e=>setTimeout(e,1500));let r={id:Date.now().toString(),email:t.email,name:t.name,role:t.userType||"customer",isEmailVerified:!1,isKYCVerified:!1,createdAt:new Date().toISOString(),permissions:"guide"===t.userType?["user:read","guide:manage","booking:manage"]:["user:read","booking:create"],profile:{phone:t.phone}},i="mock-jwt-token-"+Date.now();e({user:r,token:i,refreshToken:"mock-refresh-token",isAuthenticated:!0,isLoading:!1})}catch(t){throw e({isLoading:!1}),t}},logout:async()=>{try{await fetch("/api/auth/logout",{method:"POST",credentials:"include"})}catch(e){}e({user:null,token:null,refreshToken:null,isAuthenticated:!1})},updateUser:async r=>{let{user:i,token:n}=t();if(!i||!n)throw Error("未登入");e({isLoading:!0});try{let t=await fetch("/api/users/profile",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n)},body:JSON.stringify(r)});if(!t.ok)throw Error("更新失敗");let o=await t.json();e({user:{...i,...o},isLoading:!1})}catch(t){throw e({isLoading:!1}),t}},refreshAuth:async()=>{let{refreshToken:r}=t();if(r)try{let t=await fetch("/api/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:r})});if(!t.ok)throw Error("Token 刷新失敗");let i=await t.json();e({token:i.token,refreshToken:i.refreshToken})}catch(e){t().logout()}},initializeAuth:async()=>{try{let o=await fetch("/api/auth/me",{credentials:"include"});if(o.ok){let a=await o.json();if(a.success&&a.data.user){var t,r,i,n;let o={id:a.data.user.id,email:a.data.user.email,name:a.data.user.name,avatar:a.data.user.avatar,role:a.data.user.role.toLowerCase(),isEmailVerified:a.data.user.isEmailVerified,isKYCVerified:a.data.user.isKycVerified,createdAt:a.data.user.createdAt,permissions:a.data.user.permissions||[],profile:{phone:a.data.user.phone,bio:null===(t=a.data.user.userProfile)||void 0===t?void 0:t.bio,location:null===(r=a.data.user.userProfile)||void 0===r?void 0:r.location,languages:null===(i=a.data.user.userProfile)||void 0===i?void 0:i.languages,specialties:null===(n=a.data.user.userProfile)||void 0===n?void 0:n.specialties}};e({user:o,isAuthenticated:!0})}}}catch(e){}},setLoading:t=>{e({isLoading:t})},hasPermission:e=>{var r;let{user:i}=t();return!!i&&("admin"===i.role||(null===(r=i.permissions)||void 0===r?void 0:r.includes(e))||!1)}}),{name:"guidee-auth",partialize:e=>({user:e.user,token:e.token,refreshToken:e.refreshToken,isAuthenticated:e.isAuthenticated})}))}}]);