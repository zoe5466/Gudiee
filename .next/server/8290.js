exports.id=8290,exports.ids=[8290],exports.modules={23376:(e,t,r)=>{Promise.resolve().then(r.bind(r,88600)),Promise.resolve().then(r.bind(r,61929))},88600:(e,t,r)=>{"use strict";r.r(t),r.d(t,{AuthInit:()=>n});var s=r(3729),i=r(2582);function n(){let{initializeAuth:e}=(0,i.a)();return(0,s.useEffect)(()=>{e()},[e]),null}},62046:(e,t,r)=>{"use strict";r.d(t,{f:()=>h});var s=r(95344),i=r(3729),n=r(40626),a=r(88209),o=r(62093),l=r(14513),d=r(66062),c=r(36135),m=r(2582);class u{constructor(e){this.listeners={},this.connected=!1,setTimeout(()=>{this.connected=!0,this.emit("open"),e.includes("support")&&setTimeout(()=>{this.emit("message",{data:JSON.stringify({type:"message",data:{id:"auto-reply-1",content:"您好！我是 Guidee 客服，有什麼可以幫助您的嗎？",timestamp:new Date().toISOString(),sender:{id:"support",name:"客服中心",role:"support"},type:"text",status:"sent"}})})},1e3)},500)}on(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}off(e,t){this.listeners[e]&&(this.listeners[e]=this.listeners[e].filter(e=>e!==t))}emit(e,t){this.listeners[e]&&this.listeners[e].forEach(e=>e(t))}send(e){this.connected&&(setTimeout(()=>{this.emit("message",{data:JSON.stringify({type:"status",messageId:JSON.parse(e).messageId,status:"delivered"})})},500),"support"===JSON.parse(e).recipient&&Math.random()>.3&&setTimeout(()=>{let e=["我了解您的問題，讓我為您查詢一下。","感謝您的詢問，我會盡快為您處理。","請稍等，我正在為您安排相關人員。","這個問題很常見，讓我為您詳細說明。"];this.emit("message",{data:JSON.stringify({type:"message",data:{id:`reply-${Date.now()}`,content:e[Math.floor(Math.random()*e.length)],timestamp:new Date().toISOString(),sender:{id:"support",name:"客服中心",role:"support"},type:"text",status:"sent"}})})},1e3+2e3*Math.random()))}close(){this.connected=!1,this.emit("close")}get readyState(){return this.connected?1:0}}function h({recipientId:e,recipientName:t,recipientAvatar:r,chatType:h,onClose:g,className:x=""}){let{user:p}=(0,m.a)(),{messages:f,isConnected:b,isLoading:y,sendMessage:j,markAsRead:v,startTyping:w,stopTyping:N}=function(e,t){let{user:r}=(0,m.a)(),[s,n]=(0,i.useState)({messages:[],isConnected:!1,isLoading:!0,unreadCount:0}),a=(0,i.useRef)(null),o=(0,i.useRef)(null);(0,i.useEffect)(()=>{if(!r)return;let s=new u(`ws://localhost:3001/chat/${t}/${e}`);a.current=s;let i=()=>{n(e=>({...e,isConnected:!0,isLoading:!1}))},o=e=>{try{let t=JSON.parse(e.data);switch(t.type){case"message":let s={...t.data,timestamp:new Date(t.data.timestamp)};n(e=>({...e,messages:[...e.messages,s],unreadCount:s.sender.id!==r.id?e.unreadCount+1:e.unreadCount}));break;case"status":n(e=>({...e,messages:e.messages.map(e=>e.id===t.messageId?{...e,status:t.status}:e)}))}}catch(e){}},l=()=>{n(e=>({...e,isConnected:!1}))},d=e=>{n(e=>({...e,isConnected:!1,isLoading:!1}))};return s.on("open",i),s.on("message",o),s.on("close",l),s.on("error",d),()=>{s.off("open",i),s.off("message",o),s.off("close",l),s.off("error",d),s.close()}},[r,e,t]);let l=(0,i.useCallback)(async t=>{if(!a.current||!r)return;let s=`msg-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,i={id:s,content:t.content,timestamp:new Date,sender:{id:r.id,name:r.name,avatar:r.profile?.avatar,role:"guide"===r.role?"guide":"user"},type:t.type,status:"sending",metadata:t.metadata};n(e=>({...e,messages:[...e.messages,i]}));try{a.current.send(JSON.stringify({messageId:s,recipient:e,content:t.content,type:t.type,metadata:t.metadata})),setTimeout(()=>{n(e=>({...e,messages:e.messages.map(e=>e.id===s?{...e,status:"sent"}:e)}))},100)}catch(e){throw n(e=>({...e,messages:e.messages.map(e=>e.id===s?{...e,status:"sending"}:e)})),e}},[r,e]),d=(0,i.useCallback)(()=>{n(e=>({...e,unreadCount:0,messages:e.messages.map(e=>e.sender.id!==r?.id&&"read"!==e.status?{...e,status:"read"}:e)}))},[r]),c=(0,i.useCallback)(()=>{a.current&&(o.current&&clearTimeout(o.current),a.current.send(JSON.stringify({type:"typing",recipient:e,isTyping:!0})),o.current=setTimeout(()=>{h()},3e3))},[e]),h=(0,i.useCallback)(()=>{a.current&&(o.current&&(clearTimeout(o.current),o.current=null),a.current.send(JSON.stringify({type:"typing",recipient:e,isTyping:!1})))},[e]);return(0,i.useEffect)(()=>()=>{o.current&&clearTimeout(o.current)},[]),{messages:s.messages,isConnected:s.isConnected,isLoading:s.isLoading,unreadCount:s.unreadCount,sendMessage:l,markAsRead:d,startTyping:c,stopTyping:h}}(e,h),[C,k]=(0,i.useState)(""),[S,I]=(0,i.useState)(!1),D=(0,i.useRef)(null),R=(0,i.useRef)(null);(0,i.useEffect)(()=>{D.current?.scrollIntoView({behavior:"smooth"})},[f]),(0,i.useEffect)(()=>{v()},[f,v]);let z=e=>{k(e),e.trim()&&!S?(I(!0),w()):!e.trim()&&S&&(I(!1),N())},Z=async()=>{let e=C.trim();if(e)try{await j({content:e,type:"text"}),k(""),I(!1),N(),R.current?.focus()}catch(e){}},F=e=>new Intl.DateTimeFormat("zh-TW",{hour:"2-digit",minute:"2-digit"}).format(e),T=e=>{let t=new Date,r=new Date(e);if(r.toDateString()===t.toDateString())return"今天";let s=new Date(t);return(s.setDate(s.getDate()-1),r.toDateString()===s.toDateString())?"昨天":new Intl.DateTimeFormat("zh-TW",{month:"long",day:"numeric"}).format(r)},E=e=>{switch(e){case"sending":return s.jsx("div",{style:{width:"0.75rem",height:"0.75rem",border:"1px solid #9ca3af",borderTop:"1px solid transparent",borderRadius:"50%",animation:"spin 1s linear infinite"}});case"sent":return s.jsx("span",{style:{color:"#9ca3af"},children:"✓"});case"delivered":return s.jsx("span",{style:{color:"#3b82f6"},children:"✓✓"});case"read":return s.jsx("span",{style:{color:"#10b981"},children:"✓✓"});default:return null}};return y?s.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"400px",backgroundColor:"#f9fafb",borderRadius:"0.5rem"},children:(0,s.jsxs)("div",{style:{textAlign:"center",color:"#6b7280"},children:[s.jsx("div",{style:{width:"2rem",height:"2rem",border:"2px solid #e5e7eb",borderTop:"2px solid #3b82f6",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto 0.5rem"}}),"連接聊天室中..."]})}):(0,s.jsxs)("div",{style:{display:"flex",flexDirection:"column",height:"500px",backgroundColor:"white",borderRadius:"0.5rem",border:"1px solid #e5e7eb",overflow:"hidden"},className:x,children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"1rem",backgroundColor:"#f8fafc",borderBottom:"1px solid #e5e7eb"},children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[s.jsx("div",{style:{width:"2.5rem",height:"2.5rem",backgroundColor:r?"transparent":"#e5e7eb",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1rem",fontWeight:"600",color:"#6b7280",backgroundImage:r?`url(${r})`:void 0,backgroundSize:"cover",backgroundPosition:"center"},children:!r&&t.charAt(0).toUpperCase()}),(0,s.jsxs)("div",{children:[s.jsx("div",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#111827"},children:t}),(0,s.jsxs)("div",{style:{fontSize:"0.75rem",color:b?"#10b981":"#ef4444",display:"flex",alignItems:"center",gap:"0.25rem"},children:[s.jsx("div",{style:{width:"0.5rem",height:"0.5rem",backgroundColor:b?"#10b981":"#ef4444",borderRadius:"50%"}}),b?"線上":"離線"]})]})]}),(0,s.jsxs)("div",{style:{display:"flex",gap:"0.5rem"},children:[s.jsx("button",{style:{width:"2rem",height:"2rem",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"transparent",border:"none",borderRadius:"0.25rem",cursor:"pointer"},className:"hover:bg-gray-200",children:s.jsx(n.Z,{style:{width:"1rem",height:"1rem",color:"#6b7280"}})}),s.jsx("button",{style:{width:"2rem",height:"2rem",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"transparent",border:"none",borderRadius:"0.25rem",cursor:"pointer"},className:"hover:bg-gray-200",children:s.jsx(a.Z,{style:{width:"1rem",height:"1rem",color:"#6b7280"}})}),s.jsx("button",{style:{width:"2rem",height:"2rem",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"transparent",border:"none",borderRadius:"0.25rem",cursor:"pointer"},className:"hover:bg-gray-200",children:s.jsx(o.Z,{style:{width:"1rem",height:"1rem",color:"#6b7280"}})}),g&&s.jsx("button",{onClick:g,style:{width:"2rem",height:"2rem",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"transparent",border:"none",borderRadius:"0.25rem",cursor:"pointer"},className:"hover:bg-gray-200",children:s.jsx(l.Z,{style:{width:"1rem",height:"1rem",color:"#6b7280"}})})]})]}),s.jsx("div",{style:{flex:1,overflowY:"auto",padding:"1rem",backgroundColor:"#f9fafb"},children:0===f.length?s.jsx("div",{style:{textAlign:"center",color:"#6b7280",fontSize:"0.875rem",marginTop:"2rem"},children:"開始對話吧！"}):(0,s.jsxs)(s.Fragment,{children:[f.map((e,t)=>{let r=e.sender.id===p?.id,i=0===t||T(f[t-1]?.timestamp||new Date)!==T(e.timestamp);return(0,s.jsxs)("div",{children:[i&&s.jsx("div",{style:{textAlign:"center",margin:"1rem 0 0.5rem",fontSize:"0.75rem",color:"#9ca3af"},children:T(e.timestamp)}),(0,s.jsxs)("div",{style:{display:"flex",flexDirection:r?"row-reverse":"row",alignItems:"flex-end",gap:"0.5rem",marginBottom:"0.75rem"},children:[!r&&s.jsx("div",{style:{width:"1.75rem",height:"1.75rem",backgroundColor:e.sender.avatar?"transparent":"#e5e7eb",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.75rem",fontWeight:"600",color:"#6b7280",backgroundImage:e.sender.avatar?`url(${e.sender.avatar})`:void 0,backgroundSize:"cover",backgroundPosition:"center",flexShrink:0},children:!e.sender.avatar&&e.sender.name.charAt(0).toUpperCase()}),(0,s.jsxs)("div",{style:{maxWidth:"70%",display:"flex",flexDirection:"column",alignItems:r?"flex-end":"flex-start"},children:[s.jsx("div",{style:{padding:"0.75rem 1rem",backgroundColor:r?"#3b82f6":"white",color:r?"white":"#111827",borderRadius:r?"1rem 1rem 0.25rem 1rem":"1rem 1rem 1rem 0.25rem",border:r?"none":"1px solid #e5e7eb",fontSize:"0.875rem",lineHeight:"1.5",wordBreak:"break-word"},children:e.content}),(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",marginTop:"0.25rem",fontSize:"0.75rem",color:"#9ca3af"},children:[s.jsx("span",{children:F(e.timestamp)}),r&&E(e.status)]})]})]})]},e.id)}),s.jsx("div",{ref:D})]})}),s.jsx("div",{style:{padding:"1rem",backgroundColor:"white",borderTop:"1px solid #e5e7eb"},children:(0,s.jsxs)("div",{style:{display:"flex",alignItems:"flex-end",gap:"0.5rem"},children:[s.jsx("button",{style:{padding:"0.5rem",backgroundColor:"transparent",border:"none",borderRadius:"0.25rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},className:"hover:bg-gray-100",children:s.jsx(d.Z,{style:{width:"1.25rem",height:"1.25rem",color:"#6b7280"}})}),s.jsx("div",{style:{flex:1,position:"relative"},children:s.jsx("textarea",{ref:R,value:C,onChange:e=>z(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),Z())},placeholder:"輸入訊息...",style:{width:"100%",maxHeight:"6rem",padding:"0.75rem",border:"1px solid #e5e7eb",borderRadius:"1.5rem",fontSize:"0.875rem",resize:"none",outline:"none",backgroundColor:"#f9fafb"},className:"focus:border-blue-500 focus:ring-1 focus:ring-blue-500",rows:1,disabled:!b})}),s.jsx("button",{onClick:Z,disabled:!C.trim()||!b,style:{padding:"0.75rem",backgroundColor:C.trim()&&b?"#3b82f6":"#e5e7eb",border:"none",borderRadius:"50%",cursor:C.trim()&&b?"pointer":"not-allowed",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s"},className:"hover:scale-105",children:s.jsx(c.Z,{style:{width:"1.125rem",height:"1.125rem",color:C.trim()&&b?"white":"#9ca3af"}})})]})})]})}},61929:(e,t,r)=>{"use strict";r.r(t),r.d(t,{DualLayout:()=>J});var s=r(95344),i=r(22254),n=r(43158),a=r(67023);let o=(0,n.Ue)()((0,a.tJ)(e=>({mode:"traveler",switchMode:t=>e({mode:t})}),{name:"guidee-user-mode"}));var l=r(3729),d=r(20783),c=r.n(d),m=r(11453),u=r(2273),h=r(23425),g=r(35851),x=r(96213),p=r(18822),f=r(14513),b=r(98200),y=r(13746),j=r(96251);let v=l.forwardRef(({className:e,...t},r)=>s.jsx(j.fC,{className:(0,m.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",e),...t,ref:r,children:s.jsx(j.bU,{className:(0,m.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));v.displayName=j.fC.displayName;var w=r(80508),N=r(98026);function C(){let{mode:e,switchMode:t}=o();return(0,s.jsxs)("div",{className:"flex items-center space-x-3 bg-gray-50 rounded-full px-3 py-2",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[s.jsx(w.Z,{className:`w-4 h-4 ${"traveler"===e?"text-amber-600":"text-gray-400"}`}),s.jsx("span",{className:`text-xs font-medium ${"traveler"===e?"text-gray-900":"text-gray-500"}`,children:"旅客"})]}),s.jsx(v,{checked:"guide"===e,onCheckedChange:e=>{t(e?"guide":"traveler")},className:"data-[state=checked]:bg-amber-500"}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[s.jsx("span",{className:`text-xs font-medium ${"guide"===e?"text-gray-900":"text-gray-500"}`,children:"地陪"}),s.jsx(N.Z,{className:`w-4 h-4 ${"guide"===e?"text-amber-600":"text-gray-400"}`})]})]})}let k=[{title:"控制台",href:"/guide/dashboard",icon:u.Z},{title:"任務",href:"/guide/tasks",icon:h.Z},{title:"訊息",href:"/guide/messages",icon:g.Z},{title:"歷史",href:"/guide/orders",icon:x.Z},{title:"帳號",href:"/guide/account",icon:p.Z}];function S(){let e=(0,i.usePathname)(),[t,r]=(0,l.useState)(!1);return(0,s.jsxs)(s.Fragment,{children:[s.jsx("button",{className:"lg:hidden fixed top-4 left-4 z-50 p-2 bg-white rounded-lg shadow-md border border-gray-200",onClick:()=>r(!t),children:t?s.jsx(f.Z,{className:"w-5 h-5 text-gray-600"}):s.jsx(b.Z,{className:"w-5 h-5 text-gray-600"})}),t&&s.jsx("div",{className:"lg:hidden fixed inset-0 bg-black/20 z-40",onClick:()=>r(!1)}),s.jsx("aside",{className:(0,m.cn)("fixed left-0 top-0 z-40 h-screen w-64 bg-white border-r border-gray-200 transition-transform duration-200","lg:translate-x-0",t?"translate-x-0":"-translate-x-full"),children:(0,s.jsxs)("div",{className:"flex flex-col h-full",children:[s.jsx("div",{className:"p-6 border-b border-gray-200",children:(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-[#FF5A5F] to-[#E1464A] rounded-lg flex items-center justify-center",children:s.jsx("span",{className:"text-white font-bold text-sm",children:"R"})}),(0,s.jsxs)("div",{children:[s.jsx("h1",{className:"text-lg font-bold text-gray-900",children:"Guidee"}),s.jsx("p",{className:"text-xs text-gray-500",children:"地陪控制台"})]})]})}),s.jsx("div",{className:"p-4 border-b border-gray-200",children:s.jsx(C,{})}),s.jsx("nav",{className:"flex-1 p-4 space-y-1",children:k.map(t=>{let i=e===t.href,n=t.icon;return(0,s.jsxs)(c(),{href:t.href,className:(0,m.cn)("flex items-center space-x-3 px-3 py-2 rounded-lg text-sm font-medium transition-colors duration-200",i?"bg-red-50 text-red-700 border-r-2 border-[#FF5A5F]":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"),onClick:()=>r(!1),children:[s.jsx(n,{className:"w-5 h-5"}),s.jsx("span",{children:t.title})]},t.href)})}),s.jsx("div",{className:"p-4 border-t border-gray-200",children:(0,s.jsxs)("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[s.jsx("div",{className:"w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center",children:s.jsx(p.Z,{className:"w-4 h-4 text-gray-600"})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-sm font-medium text-gray-900",children:"張小明"}),s.jsx("p",{className:"text-xs text-gray-500",children:"專業地陪"})]}),s.jsx(y.Z,{className:"w-4 h-4 text-gray-400 hover:text-gray-600 cursor-pointer"})]})})]})})]})}var I=r(28765),D=r(51354);let R=[{title:"探索",href:"/",icon:I.Z},{title:"收藏",href:"/favorites",icon:D.Z},{title:"行程",href:"/tasks",icon:h.Z},{title:"訊息",href:"/chat",icon:g.Z},{title:"個人",href:"/profile",icon:p.Z}];function z(){let e=(0,i.usePathname)();return s.jsx("nav",{className:"fixed bottom-0 left-0 right-0 z-50 bg-white border-t border-gray-200",children:s.jsx("div",{className:"px-2 py-1",children:s.jsx("div",{className:"flex items-center justify-around",children:R.map(t=>{let r=e===t.href,i=t.icon;return(0,s.jsxs)(c(),{href:t.href,className:"flex flex-col items-center justify-center min-w-0 flex-1 py-2 px-1",children:[s.jsx(i,{className:(0,m.cn)("w-5 h-5 mb-1",r?"text-[#FF5A5F]":"text-gray-400")}),s.jsx("span",{className:(0,m.cn)("text-xs font-medium",r?"text-[#FF5A5F]":"text-gray-500"),children:t.title})]},t.href)})})})})}var Z=r(16676),F=r(63211),T=r(48120),E=r(2582);function $(){let[e,t]=(0,l.useState)(!1),r=(0,l.useRef)(null),n=(0,l.useRef)(null),{user:a,isAuthenticated:o,logout:d}=(0,E.a)(),c=(0,i.useRouter)();(0,l.useEffect)(()=>{function e(e){r.current&&!r.current.contains(e.target)&&n.current&&!n.current.contains(e.target)&&t(!1)}return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);let m=async()=>{try{await d(),t(!1),c.push("/")}catch(e){}},u=[{icon:s.jsx(p.Z,{className:"w-4 h-4"}),label:"個人資料",href:"/profile",onClick:()=>{c.push("/profile"),t(!1)}},{icon:s.jsx(F.Z,{className:"w-4 h-4"}),label:"我的預訂",href:"/my-bookings",onClick:()=>{c.push("/my-bookings"),t(!1)}},{icon:s.jsx(D.Z,{className:"w-4 h-4"}),label:"我的最愛",href:"/favorites",onClick:()=>{c.push("/favorites"),t(!1)}},{icon:s.jsx(y.Z,{className:"w-4 h-4"}),label:"設定",href:"/settings",onClick:()=>{c.push("/settings"),t(!1)}}];return o?(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)("button",{ref:n,onClick:()=>t(!e),className:"flex items-center border border-gray-300 rounded-full p-2 hover:shadow-md transition-shadow duration-200 bg-white",children:[s.jsx("div",{className:"w-6 h-6 bg-gray-500 rounded-full flex items-center justify-center text-white text-xs font-medium",children:a?.name?.[0]?.toUpperCase()||a?.email?.[0]?.toUpperCase()||"U"}),s.jsx("span",{className:"ml-2 text-sm font-medium text-gray-700 max-w-20 truncate hidden sm:block",children:a?.name||a?.email?.split("@")[0]})]}),e&&(0,s.jsxs)("div",{ref:r,className:"absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-50",children:[(0,s.jsxs)("div",{className:"px-4 py-3 border-b border-gray-100",children:[s.jsx("div",{className:"text-sm font-medium text-gray-900",children:a?.name}),s.jsx("div",{className:"text-sm text-gray-500",children:a?.email})]}),s.jsx("div",{className:"py-1",children:u.map((e,t)=>(0,s.jsxs)("button",{onClick:e.onClick,className:"w-full flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors",children:[e.icon,s.jsx("span",{className:"ml-3",children:e.label})]},t))}),s.jsx("div",{className:"border-t border-gray-100 py-1",children:(0,s.jsxs)("button",{onClick:m,className:"w-full flex items-center px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors",children:[s.jsx(T.Z,{className:"w-4 h-4"}),s.jsx("span",{className:"ml-3",children:"登出"})]})})]})]}):(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[s.jsx("button",{onClick:()=>c.push("/login"),className:"text-sm font-medium text-gray-900 hover:bg-gray-100 px-3 py-2 rounded-full transition-colors",children:"登入"}),s.jsx("button",{onClick:()=>c.push("/register"),className:"text-sm font-medium bg-[#FF5A5F] text-white hover:bg-[#E1464A] px-4 py-2 rounded-full transition-colors",children:"註冊"})]})}function A(){(0,i.useRouter)();let[e,t]=(0,l.useState)(!1),[r,n]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{n(!0);let e=()=>{t(window.scrollY>80)};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[]),(0,s.jsxs)("header",{className:`sticky top-0 z-50 bg-white transition-all duration-200 ${e?"shadow-md border-b border-gray-200":"shadow-sm"}`,children:[" ",(0,s.jsxs)("div",{className:"relative",children:[s.jsx("div",{className:"px-6 lg:px-10 xl:px-20",children:(0,s.jsxs)("div",{className:"flex items-center justify-between h-20",children:[s.jsx("div",{className:"flex items-center",children:(0,s.jsxs)("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-[#FF5A5F] to-[#E1464A] rounded-lg flex items-center justify-center",children:s.jsx("span",{className:"text-white font-bold text-sm",children:"R"})}),s.jsx("span",{className:"ml-2 text-2xl font-bold text-[#FF5A5F] hidden sm:block",children:"guidee"})]})}),s.jsx("div",{className:"hidden lg:block",children:(0,s.jsxs)("div",{className:"flex items-center border border-gray-300 rounded-full shadow-sm hover:shadow-lg transition-all duration-200 bg-white",children:[(0,s.jsxs)("div",{className:"search-section border-r border-gray-200 rounded-l-full hover:bg-gray-50",children:[s.jsx("div",{className:"search-label",children:"地點"}),s.jsx("div",{className:"search-value",children:"隨處"})]}),(0,s.jsxs)("div",{className:"search-section border-r border-gray-200 hover:bg-gray-50",children:[s.jsx("div",{className:"search-label",children:"入住"}),s.jsx("div",{className:"search-value",children:"任何一週"})]}),(0,s.jsxs)("div",{className:"search-section hover:bg-gray-50 flex items-center",children:[(0,s.jsxs)("div",{className:"flex-1",children:[s.jsx("div",{className:"search-label",children:"旅客"}),s.jsx("div",{className:"search-value",children:"新增旅客"})]}),s.jsx("button",{className:"btn btn-primary btn-sm rounded-full w-8 h-8 !p-0 ml-3",children:s.jsx(I.Z,{className:"w-4 h-4"})})]})]})}),(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[s.jsx(c(),{href:"/auth/register",className:"hidden lg:block text-sm font-medium text-gray-900 hover:bg-gray-100 px-3 py-2 rounded-full transition-colors cursor-pointer",style:{textDecoration:"none"},children:"成為地陪"}),s.jsx(Z.j,{}),s.jsx($,{}),s.jsx("button",{className:"lg:hidden p-2 text-gray-600",children:s.jsx(I.Z,{className:"w-5 h-5"})})]})]})}),s.jsx("div",{className:"hidden lg:block border-t border-gray-200",children:s.jsx("div",{className:"px-6 lg:px-10 xl:px-20",children:s.jsx("div",{className:"flex items-center space-x-8 py-4 overflow-x-auto",children:[{name:"文化",icon:"\uD83C\uDFDB️"},{name:"美食",icon:"\uD83C\uDF5C"},{name:"自然",icon:"\uD83C\uDFD4️"},{name:"城市",icon:"\uD83C\uDFD9️"},{name:"夜生活",icon:"\uD83C\uDF03"},{name:"購物",icon:"\uD83D\uDECD️"},{name:"歷史",icon:"\uD83C\uDFEF"},{name:"海岸",icon:"\uD83C\uDFD6️"}].map((e,t)=>(0,s.jsxs)("button",{className:`flex flex-col items-center min-w-max px-4 py-3 text-xs font-medium transition-colors hover:text-gray-900 ${0===t?"text-gray-900 border-b-2 border-gray-900":"text-gray-500 hover:border-b-2 hover:border-gray-300"}`,children:[s.jsx("span",{className:"text-2xl mb-2",children:e.icon}),s.jsx("span",{children:e.name})]},t))})})}),r&&e&&s.jsx("div",{className:"lg:hidden px-6 py-3 border-t border-gray-200",children:(0,s.jsxs)("div",{className:"flex items-center bg-white border border-gray-300 rounded-full shadow-sm p-3",children:[s.jsx(I.Z,{className:"w-5 h-5 text-gray-400 mr-3"}),(0,s.jsxs)("div",{className:"flex-1",children:[s.jsx("div",{className:"text-sm font-medium text-gray-900",children:"隨處"}),s.jsx("div",{className:"text-xs text-gray-500",children:"任何一週 \xb7 新增旅客"})]}),s.jsx("div",{className:"w-8 h-8 border border-gray-300 rounded-full flex items-center justify-center",children:s.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full"})})]})})]})]})}var W=r(24540),P=r(55560),O=r(62046);function B({className:e=""}){let{user:t}=(0,E.a)(),[r,i]=(0,l.useState)(!1),[n,a]=(0,l.useState)(!1),[o,d]=(0,l.useState)(0);return((0,l.useEffect)(()=>{if(!r&&t){let e=setInterval(()=>{Math.random()>.9&&d(e=>e+1)},3e4);return()=>clearInterval(e)}},[r,t]),t)?(0,s.jsxs)(s.Fragment,{children:[!r&&(0,s.jsxs)("button",{onClick:()=>{i(!0),a(!1),d(0)},style:{position:"fixed",bottom:"2rem",right:"2rem",width:"3.5rem",height:"3.5rem",backgroundColor:"#3b82f6",border:"none",borderRadius:"50%",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1)",transition:"all 0.2s",zIndex:1e3},className:`hover:scale-105 hover:shadow-lg ${e}`,children:[s.jsx(g.Z,{style:{width:"1.5rem",height:"1.5rem",color:"white"}}),o>0&&s.jsx("div",{style:{position:"absolute",top:"-0.25rem",right:"-0.25rem",width:"1.25rem",height:"1.25rem",backgroundColor:"#ef4444",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.75rem",fontWeight:"600",color:"white",border:"2px solid white"},children:o>9?"9+":o})]}),r&&(0,s.jsxs)("div",{style:{position:"fixed",bottom:"2rem",right:"2rem",width:"24rem",height:n?"auto":"32rem",backgroundColor:"white",borderRadius:"0.5rem",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1)",border:"1px solid #e5e7eb",zIndex:1e3,overflow:"hidden",transition:"all 0.3s ease-in-out"},children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"1rem",backgroundColor:"#3b82f6",color:"white"},children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[s.jsx("div",{style:{width:"2rem",height:"2rem",backgroundColor:"rgba(255, 255, 255, 0.2)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(g.Z,{style:{width:"1rem",height:"1rem"}})}),(0,s.jsxs)("div",{children:[s.jsx("div",{style:{fontSize:"0.875rem",fontWeight:"600"},children:"客服中心"}),s.jsx("div",{style:{fontSize:"0.75rem",opacity:.9},children:"我們在線為您服務"})]})]}),(0,s.jsxs)("div",{style:{display:"flex",gap:"0.5rem"},children:[s.jsx("button",{onClick:()=>{a(!n)},style:{width:"1.5rem",height:"1.5rem",backgroundColor:"transparent",border:"none",borderRadius:"0.25rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:"white"},className:"hover:bg-white hover:bg-opacity-20",children:n?s.jsx(W.Z,{style:{width:"0.875rem",height:"0.875rem"}}):s.jsx(P.Z,{style:{width:"0.875rem",height:"0.875rem"}})}),s.jsx("button",{onClick:()=>{i(!1),a(!1)},style:{width:"1.5rem",height:"1.5rem",backgroundColor:"transparent",border:"none",borderRadius:"0.25rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:"white"},className:"hover:bg-white hover:bg-opacity-20",children:s.jsx(f.Z,{style:{width:"0.875rem",height:"0.875rem"}})})]})]}),!n&&s.jsx("div",{style:{height:"calc(32rem - 4rem)"},children:s.jsx(O.f,{recipientId:"support",recipientName:"客服中心",chatType:"customer_support"})})]})]}):null}var L=r(33037),M=r(62312);function U({className:e=""}){let{user:t}=(0,E.a)(),{permission:r,isSupported:i,isSubscribed:n,requestPermission:a,subscribe:o,unsubscribe:d,sendLocalNotification:c}=function(){let{user:e}=(0,E.a)(),[t,r]=(0,l.useState)({permission:"default",isSupported:!1,isSubscribed:!1});(0,l.useEffect)(()=>{let e="Notification"in window&&"serviceWorker"in navigator,t=e?Notification.permission:"denied";r(r=>({...r,isSupported:e,permission:t}))},[]),(0,l.useEffect)(()=>{t.isSupported&&(async()=>{try{let e=await navigator.serviceWorker.register("/sw.js"),t=await e.pushManager.getSubscription();r(e=>({...e,isSubscribed:!!t}))}catch(e){}})()},[t.isSupported]);let s=(0,l.useCallback)(async()=>{if(!t.isSupported)throw Error("瀏覽器不支援推送通知");try{let e=await Notification.requestPermission();return r(t=>({...t,permission:e})),e}catch(e){throw e}},[t.isSupported]),i=(0,l.useCallback)(async()=>{if(!t.isSupported||"granted"!==t.permission)throw Error("無法訂閱推送通知：權限被拒絕或不支援");try{let t=await navigator.serviceWorker.ready,s=await t.pushManager.getSubscription();if(!s){let e=process.env.NEXT_PUBLIC_VAPID_PUBLIC_KEY||"demo-key";s=await t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:e})}return e&&await fetch("/api/notifications/subscribe",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.id}`},body:JSON.stringify({subscription:s,userId:e.id})}),r(e=>({...e,isSubscribed:!0})),s}catch(e){throw e}},[t.isSupported,t.permission,e]),n=(0,l.useCallback)(async()=>{if(t.isSupported)try{let t=await navigator.serviceWorker.ready,s=await t.pushManager.getSubscription();s&&(await s.unsubscribe(),e&&await fetch("/api/notifications/unsubscribe",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.id}`},body:JSON.stringify({userId:e.id})})),r(e=>({...e,isSubscribed:!1}))}catch(e){throw e}},[t.isSupported,e]),a=(0,l.useCallback)(e=>{if(t.isSupported&&"granted"===t.permission)try{let t=new Notification(e.title,{body:e.body,icon:e.icon||"/icon-192x192.png",badge:e.badge||"/badge-72x72.png",tag:e.tag,data:e.data,requireInteraction:e.requireInteraction||!1,silent:e.silent||!1});return t.onclick=r=>{r.preventDefault(),window.focus(),e.data?.url&&(window.location.href=e.data.url),t.close()},e.requireInteraction||setTimeout(()=>{t.close()},5e3),t}catch(e){return}},[t.isSupported,t.permission]),o={bookingConfirmed:(e,t)=>({title:"預訂確認",body:`您的預訂已被 ${t} 確認！`,icon:"/icons/booking-confirmed.png",tag:`booking-${e}`,data:{type:"booking_confirmed",bookingId:e,url:"/my-bookings"},requireInteraction:!0}),newMessage:e=>({title:"新訊息",body:`${e} 發送了一條新訊息`,icon:"/icons/message.png",tag:"new-message",data:{type:"new_message",url:"/messages"}}),paymentSuccess:e=>({title:"付款成功",body:`您的付款 NT$ ${e.toLocaleString()} 已成功處理`,icon:"/icons/payment-success.png",tag:"payment-success",data:{type:"payment_success",url:"/my-bookings"}}),reviewRequest:e=>({title:"評價邀請",body:`請為您的 ${e} 體驗留下評價`,icon:"/icons/review.png",tag:"review-request",data:{type:"review_request",url:"/my-bookings"}}),guideNewBooking:(e,t)=>({title:"新預訂請求",body:`${e} 預訂了您的「${t}」服務`,icon:"/icons/new-booking.png",tag:"new-booking",data:{type:"new_booking",url:"/guide-dashboard"},requireInteraction:!0})},d=(0,l.useCallback)((e,t)=>a(o.bookingConfirmed(e,t)),[a]),c=(0,l.useCallback)(e=>a(o.newMessage(e)),[a]),m=(0,l.useCallback)(e=>a(o.paymentSuccess(e)),[a]),u=(0,l.useCallback)(e=>a(o.reviewRequest(e)),[a]),h=(0,l.useCallback)((e,t)=>a(o.guideNewBooking(e,t)),[a]);return{permission:t.permission,isSupported:t.isSupported,isSubscribed:t.isSubscribed,requestPermission:s,subscribe:i,unsubscribe:n,sendLocalNotification:a,sendBookingConfirmation:d,sendNewMessageNotification:c,sendPaymentSuccessNotification:m,sendReviewRequestNotification:u,sendGuideNewBookingNotification:h,notificationTemplates:o}}(),[m,u]=(0,l.useState)(!1),[h,g]=(0,l.useState)(!1);(0,l.useEffect)(()=>{if(t&&i&&"default"===r){let e=setTimeout(()=>{u(!0)},3e3);return()=>clearTimeout(e)}},[t,i,r]);let x=async()=>{if(i){g(!0);try{let e=await a();"granted"===e&&(await o(),u(!1),setTimeout(()=>{c({title:"通知已啟用！",body:"您將收到預訂確認、新訊息等重要通知",icon:"/icons/notification-success.png",tag:"welcome-notification"})},1e3))}catch(e){}finally{g(!1)}}},p=async()=>{g(!0);try{await d(),u(!1)}catch(e){}finally{g(!1)}};return t&&i?(0,s.jsxs)(s.Fragment,{children:[m&&"granted"!==r&&s.jsx("div",{style:{position:"fixed",top:"1rem",right:"1rem",left:"1rem",maxWidth:"400px",marginLeft:"auto",marginRight:"auto",backgroundColor:"white",borderRadius:"0.5rem",padding:"1rem",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1)",border:"1px solid #e5e7eb",zIndex:1e3,animation:"slideInDown 0.3s ease-out"},className:e,children:(0,s.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",gap:"0.75rem"},children:[s.jsx("div",{style:{width:"2.5rem",height:"2.5rem",backgroundColor:"#3b82f6",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:s.jsx(L.Z,{style:{width:"1.25rem",height:"1.25rem",color:"white"}})}),(0,s.jsxs)("div",{style:{flex:1},children:[s.jsx("h3",{style:{fontSize:"1rem",fontWeight:"600",color:"#111827",marginBottom:"0.5rem"},children:"啟用通知功能"}),s.jsx("p",{style:{fontSize:"0.875rem",color:"#6b7280",marginBottom:"1rem",lineHeight:"1.5"},children:"接收預訂確認、新訊息和重要更新通知，讓您不錯過任何重要資訊。"}),(0,s.jsxs)("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[(0,s.jsxs)("button",{onClick:x,disabled:h,style:{padding:"0.5rem 1rem",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"0.375rem",fontSize:"0.875rem",fontWeight:"500",cursor:h?"not-allowed":"pointer",opacity:h?.6:1,display:"flex",alignItems:"center",gap:"0.5rem"},className:"hover:bg-blue-600",children:[h?s.jsx("div",{style:{width:"1rem",height:"1rem",border:"2px solid transparent",borderTop:"2px solid white",borderRadius:"50%",animation:"spin 1s linear infinite"}}):s.jsx(M.Z,{style:{width:"1rem",height:"1rem"}}),h?"啟用中...":"啟用通知"]}),s.jsx("button",{onClick:()=>u(!1),style:{padding:"0.5rem 1rem",backgroundColor:"transparent",color:"#6b7280",border:"1px solid #e5e7eb",borderRadius:"0.375rem",fontSize:"0.875rem",fontWeight:"500",cursor:"pointer"},className:"hover:bg-gray-50",children:"稍後再說"})]})]}),s.jsx("button",{onClick:()=>u(!1),style:{padding:"0.25rem",backgroundColor:"transparent",border:"none",borderRadius:"0.25rem",cursor:"pointer",flexShrink:0},className:"hover:bg-gray-100",children:s.jsx(f.Z,{style:{width:"1.25rem",height:"1.25rem",color:"#9ca3af"}})})]})}),(0,s.jsxs)("div",{style:{position:"fixed",top:"1rem",left:"1rem",zIndex:999},children:[(0,s.jsxs)("button",{onClick:()=>u(!m),style:{width:"2.5rem",height:"2.5rem",backgroundColor:"granted"===r?"#10b981":"#6b7280",border:"none",borderRadius:"50%",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)",transition:"all 0.2s"},className:"hover:scale-105",title:"granted"===r?"通知已啟用":"點擊啟用通知",children:[s.jsx(L.Z,{style:{width:"1.25rem",height:"1.25rem",color:"white"}}),"granted"===r&&n&&s.jsx("div",{style:{position:"absolute",top:"-0.125rem",right:"-0.125rem",width:"0.75rem",height:"0.75rem",backgroundColor:"#3b82f6",borderRadius:"50%",border:"2px solid white"}})]}),m&&"granted"===r&&(0,s.jsxs)("div",{style:{position:"absolute",top:"3rem",left:0,width:"280px",backgroundColor:"white",borderRadius:"0.5rem",padding:"1rem",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1)",border:"1px solid #e5e7eb"},children:[(0,s.jsxs)("div",{style:{fontSize:"1rem",fontWeight:"600",color:"#111827",marginBottom:"0.75rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[s.jsx(y.Z,{style:{width:"1rem",height:"1rem"}}),"通知設定"]}),(0,s.jsxs)("div",{style:{padding:"0.75rem",backgroundColor:"#f0f9ff",borderRadius:"0.375rem",marginBottom:"1rem"},children:[s.jsx("div",{style:{fontSize:"0.875rem",fontWeight:"500",color:"#0369a1",marginBottom:"0.25rem"},children:"通知狀態：已啟用"}),(0,s.jsxs)("div",{style:{fontSize:"0.75rem",color:"#0284c7"},children:["訂閱狀態：",n?"已訂閱":"未訂閱"]})]}),(0,s.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[s.jsx("button",{onClick:()=>{"granted"===r&&c({title:"測試通知",body:"這是一個測試通知，確認通知功能正常運作",icon:"/icons/test-notification.png",tag:"test-notification"})},style:{padding:"0.5rem 0.75rem",backgroundColor:"#f3f4f6",border:"1px solid #e5e7eb",borderRadius:"0.375rem",fontSize:"0.875rem",cursor:"pointer",textAlign:"left"},className:"hover:bg-gray-100",children:"發送測試通知"}),s.jsx("button",{onClick:p,disabled:h,style:{padding:"0.5rem 0.75rem",backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"0.375rem",fontSize:"0.875rem",color:"#dc2626",cursor:h?"not-allowed":"pointer",textAlign:"left",opacity:h?.6:1},className:"hover:bg-red-100",children:h?"處理中...":"關閉通知"})]})]})]})]}):null}function J({children:e}){let{mode:t}=o(),r=(0,i.usePathname)();return"guide"===t?(0,s.jsxs)("div",{className:"flex min-h-screen bg-gray-50",children:[s.jsx(S,{}),s.jsx("main",{className:"flex-1 lg:ml-80",children:s.jsx("div",{className:"min-h-screen",children:e})}),s.jsx(B,{}),s.jsx(U,{})]}):"/"===r?s.jsx(s.Fragment,{children:e}):(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[s.jsx(A,{}),s.jsx("main",{className:(0,m.cn)("min-h-screen pt-16","pb-20"),children:e}),s.jsx(z,{}),s.jsx(B,{}),s.jsx(U,{})]})}},11808:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h});var s=r(25036),i=r(86843);let n=(0,i.createProxy)(String.raw`/Users/zoechang/projects/Guidee/src/components/layout/dual-layout.tsx`),{__esModule:a,$$typeof:o}=n;n.default;let l=(0,i.createProxy)(String.raw`/Users/zoechang/projects/Guidee/src/components/layout/dual-layout.tsx#DualLayout`),d=(0,i.createProxy)(String.raw`/Users/zoechang/projects/Guidee/src/components/auth/auth-init.tsx`),{__esModule:c,$$typeof:m}=d;d.default;let u=(0,i.createProxy)(String.raw`/Users/zoechang/projects/Guidee/src/components/auth/auth-init.tsx#AuthInit`);function h({children:e}){return(0,s.jsxs)(s.Fragment,{children:[s.jsx(u,{}),s.jsx(l,{children:e})]})}}};