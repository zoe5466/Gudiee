(()=>{var e={};e.id=4031,e.ids=[4031],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},82176:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>s.a,__next_app__:()=>g,originalPathname:()=>m,pages:()=>c,routeModule:()=>h,tree:()=>d});var o=t(50482),i=t(69108),n=t(62563),s=t.n(n),a=t(68300),l={};for(let e in a)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>a[e]);t.d(r,l);let d=["",{children:["(main)",{children:["my-bookings",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,30849)),"/Users/zoechang/projects/Guidee/src/app/(main)/my-bookings/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,11808)),"/Users/zoechang/projects/Guidee/src/app/(main)/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,69361,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,98890)),"/Users/zoechang/projects/Guidee/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,69361,23)),"next/dist/client/components/not-found-error"]}],c=["/Users/zoechang/projects/Guidee/src/app/(main)/my-bookings/page.tsx"],m="/(main)/my-bookings/page",g={require:t,loadChunk:()=>Promise.resolve()},h=new o.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/(main)/my-bookings/page",pathname:"/my-bookings",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},15016:(e,r,t)=>{Promise.resolve().then(t.bind(t,26203))},26203:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>f});var o=t(95344),i=t(3729),n=t(22254),s=t(66138),a=t(62312),l=t(14513),d=t(55794),c=t(25545),m=t(89895),g=t(76755),h=t(2582),u=t(30149),p=t(4792),x=t(58378);function f(){let e=(0,n.useRouter)(),{isAuthenticated:r,user:t}=(0,h.a)(),{bookings:f,fetchBookings:b,cancelBooking:y,submitReview:j,isLoading:k}=(0,u.v)(),[w,v]=(0,i.useState)("all"),[S,B]=(0,i.useState)(!1),[z,C]=(0,i.useState)(null),[N,P]=(0,i.useState)(5),[W,E]=(0,i.useState)(""),[R,I]=(0,i.useState)(!1),[L,T]=(0,i.useState)(null),[_,A]=(0,i.useState)("");(0,i.useEffect)(()=>{if(!r){e.push("/login?redirect=/my-bookings");return}b()},[r,e,b]);let $=e=>{let r={pending:{text:"待確認",color:"bg-yellow-100 text-yellow-800",icon:s.Z},confirmed:{text:"已確認",color:"bg-blue-100 text-blue-800",icon:a.Z},completed:{text:"已完成",color:"bg-green-100 text-green-800",icon:a.Z},cancelled:{text:"已取消",color:"bg-red-100 text-red-800",icon:l.Z},refunded:{text:"已退款",color:"bg-gray-100 text-gray-800",icon:l.Z}},t=r[e]||r.pending,i=t.icon;return(0,o.jsxs)("span",{style:{display:"inline-flex",alignItems:"center",gap:"0.25rem",padding:"0.25rem 0.5rem",borderRadius:"9999px",fontSize:"0.75rem",fontWeight:"500"},className:t.color,children:[o.jsx(i,{style:{width:"0.75rem",height:"0.75rem"}}),t.text]})},q=f.filter(e=>"all"===w||e.status===w),Z=async()=>{if(L)try{await y(L,_),I(!1),T(null),A("")}catch(e){}},F=async()=>{if(z)try{await j(z,N,W),B(!1),C(null),P(5),E("")}catch(e){}};return r?(0,o.jsxs)("div",{style:{minHeight:"100vh",background:"linear-gradient(to bottom right, #dbeafe, #ffffff, #e0e7ff)",paddingTop:"2rem",paddingBottom:"2rem"},children:[o.jsx(p.L6,{}),(0,o.jsxs)("div",{style:{maxWidth:"64rem",margin:"0 auto",padding:"0 1rem"},children:[(0,o.jsxs)("div",{style:{marginBottom:"2rem"},children:[o.jsx("h1",{style:{fontSize:"2rem",fontWeight:"700",color:"#111827",marginBottom:"0.5rem"},children:"我的預訂"}),o.jsx("p",{style:{color:"#6b7280"},children:"管理您的所有導覽預訂"})]}),o.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"2rem",flexWrap:"wrap"},children:[{key:"all",label:"全部"},{key:"pending",label:"待確認"},{key:"confirmed",label:"已確認"},{key:"completed",label:"已完成"},{key:"cancelled",label:"已取消"}].map(e=>o.jsx("button",{onClick:()=>v(e.key),style:{padding:"0.5rem 1rem",borderRadius:"0.5rem",fontSize:"0.875rem",fontWeight:"500",border:"1px solid",cursor:"pointer",transition:"all 0.2s",...w===e.key?{backgroundColor:"#2563eb",borderColor:"#2563eb",color:"white"}:{backgroundColor:"white",borderColor:"#e5e7eb",color:"#374151"}},className:w!==e.key?"hover:bg-gray-50":"",children:e.label},e.key))}),k?o.jsx(x.gb,{}):0===q.length?(0,o.jsxs)("div",{style:{textAlign:"center",padding:"3rem",backgroundColor:"white",borderRadius:"1rem",boxShadow:"0 1px 3px 0 rgba(0, 0, 0, 0.1)"},children:[o.jsx("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:"\uD83D\uDCC5"}),o.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:"600",color:"#111827",marginBottom:"0.5rem"},children:"all"===w?"暫無預訂記錄":`暫無${"pending"===w?"待確認":"confirmed"===w?"已確認":"completed"===w?"已完成":"已取消"}的預訂`}),o.jsx("p",{style:{color:"#6b7280",marginBottom:"1.5rem"},children:"開始探索精彩的導覽服務吧！"}),o.jsx("button",{onClick:()=>e.push("/search"),style:{padding:"0.75rem 1.5rem",background:"linear-gradient(to right, #2563eb, #4f46e5)",color:"white",border:"none",borderRadius:"0.5rem",fontSize:"0.875rem",fontWeight:"500",cursor:"pointer",transition:"all 0.2s"},className:"hover:shadow-lg",children:"瀏覽服務"})]}):o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:q.map(e=>(0,o.jsxs)("div",{style:{backgroundColor:"white",borderRadius:"1rem",padding:"1.5rem",boxShadow:"0 1px 3px 0 rgba(0, 0, 0, 0.1)",border:"1px solid #f3f4f6"},children:[(0,o.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"1rem"},children:[o.jsx("div",{style:{flex:1},children:(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.5rem"},children:[(0,o.jsxs)("h3",{style:{fontSize:"1.125rem",fontWeight:"600",color:"#111827"},children:["預訂 #",e.id]}),$(e.status)]})}),(0,o.jsxs)("div",{style:{textAlign:"right"},children:[(0,o.jsxs)("div",{style:{fontSize:"1.25rem",fontWeight:"700",color:"#111827"},children:["NT$ ",e.pricing.total.toLocaleString()]}),o.jsx("div",{style:{fontSize:"0.875rem",color:"#6b7280"},children:e.pricing.currency})]})]}),(0,o.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",marginBottom:"1rem"},children:[(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[o.jsx(d.Z,{style:{width:"1rem",height:"1rem",color:"#6b7280"}}),o.jsx("span",{style:{fontSize:"0.875rem",color:"#374151"},children:new Date(e.details.date).toLocaleDateString("zh-TW")})]}),(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[o.jsx(c.Z,{style:{width:"1rem",height:"1rem",color:"#6b7280"}}),(0,o.jsxs)("span",{style:{fontSize:"0.875rem",color:"#374151"},children:[e.details.time," (",e.details.duration,"小時)"]})]}),(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[o.jsx(m.Z,{style:{width:"1rem",height:"1rem",color:"#6b7280"}}),(0,o.jsxs)("span",{style:{fontSize:"0.875rem",color:"#374151"},children:[e.details.guests," 人"]})]})]}),(0,o.jsxs)("div",{style:{marginBottom:"1rem",padding:"0.75rem",backgroundColor:"#f9fafb",borderRadius:"0.5rem"},children:[o.jsx("div",{style:{fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.25rem"},children:"聯絡資訊"}),(0,o.jsxs)("div",{style:{fontSize:"0.875rem",color:"#6b7280"},children:[e.details.contactInfo.name," • ",e.details.contactInfo.email," • ",e.details.contactInfo.phone]})]}),e.details.specialRequests&&(0,o.jsxs)("div",{style:{marginBottom:"1rem",padding:"0.75rem",backgroundColor:"#fef3c7",borderRadius:"0.5rem"},children:[o.jsx("div",{style:{fontSize:"0.875rem",fontWeight:"500",color:"#92400e",marginBottom:"0.25rem"},children:"特殊要求"}),o.jsx("div",{style:{fontSize:"0.875rem",color:"#92400e"},children:e.details.specialRequests})]}),e.review&&(0,o.jsxs)("div",{style:{marginBottom:"1rem",padding:"0.75rem",backgroundColor:"#ecfdf5",borderRadius:"0.5rem"},children:[(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[o.jsx(g.Z,{style:{width:"1rem",height:"1rem",color:"#f59e0b",fill:"#f59e0b"}}),(0,o.jsxs)("span",{style:{fontSize:"0.875rem",fontWeight:"500",color:"#065f46"},children:["您的評價: ",e.review.rating,"/5"]})]}),o.jsx("div",{style:{fontSize:"0.875rem",color:"#065f46"},children:e.review.comment})]}),(0,o.jsxs)("div",{style:{display:"flex",gap:"0.75rem",flexWrap:"wrap"},children:["confirmed"===e.status&&o.jsx("button",{onClick:()=>{T(e.id),I(!0)},style:{padding:"0.5rem 1rem",border:"1px solid #dc2626",borderRadius:"0.375rem",color:"#dc2626",backgroundColor:"white",fontSize:"0.875rem",fontWeight:"500",cursor:"pointer",transition:"all 0.2s"},className:"hover:bg-red-50",children:"取消預訂"}),"completed"===e.status&&!e.review&&(0,o.jsxs)("button",{onClick:()=>{C(e.id),B(!0)},style:{padding:"0.5rem 1rem",background:"linear-gradient(to right, #2563eb, #4f46e5)",color:"white",border:"none",borderRadius:"0.375rem",fontSize:"0.875rem",fontWeight:"500",cursor:"pointer",transition:"all 0.2s"},className:"hover:shadow-md",children:[o.jsx(g.Z,{style:{width:"0.875rem",height:"0.875rem",marginRight:"0.25rem",display:"inline"}}),"撰寫評價"]})]})]},e.id))})]}),R&&o.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem",zIndex:50},children:(0,o.jsxs)("div",{style:{backgroundColor:"white",borderRadius:"1rem",padding:"1.5rem",maxWidth:"28rem",width:"100%"},children:[o.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:"600",color:"#111827",marginBottom:"1rem"},children:"取消預訂"}),o.jsx("p",{style:{color:"#6b7280",marginBottom:"1rem"},children:"您確定要取消這個預訂嗎？此操作無法撤銷。"}),(0,o.jsxs)("div",{style:{marginBottom:"1.5rem"},children:[o.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"取消原因 (選填)"}),o.jsx("textarea",{value:_,onChange:e=>A(e.target.value),placeholder:"請簡述取消原因...",style:{width:"100%",padding:"0.75rem",border:"1px solid #e5e7eb",borderRadius:"0.5rem",fontSize:"0.875rem",outline:"none",resize:"vertical",minHeight:"4rem"},className:"focus:border-blue-500 focus:ring-2 focus:ring-blue-200"})]}),(0,o.jsxs)("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[o.jsx("button",{onClick:()=>{I(!1),T(null),A("")},style:{padding:"0.5rem 1rem",border:"1px solid #e5e7eb",borderRadius:"0.375rem",color:"#374151",backgroundColor:"white",fontSize:"0.875rem",fontWeight:"500",cursor:"pointer",transition:"all 0.2s"},className:"hover:bg-gray-50",children:"取消"}),o.jsx("button",{onClick:Z,style:{padding:"0.5rem 1rem",backgroundColor:"#dc2626",color:"white",border:"none",borderRadius:"0.375rem",fontSize:"0.875rem",fontWeight:"500",cursor:"pointer",transition:"all 0.2s"},className:"hover:bg-red-700",children:"確認取消"})]})]})}),S&&o.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem",zIndex:50},children:(0,o.jsxs)("div",{style:{backgroundColor:"white",borderRadius:"1rem",padding:"1.5rem",maxWidth:"28rem",width:"100%"},children:[o.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:"600",color:"#111827",marginBottom:"1rem"},children:"撰寫評價"}),(0,o.jsxs)("div",{style:{marginBottom:"1rem"},children:[o.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"評分"}),o.jsx("div",{style:{display:"flex",gap:"0.25rem"},children:[1,2,3,4,5].map(e=>o.jsx("button",{onClick:()=>P(e),style:{padding:"0.5rem",border:"none",backgroundColor:"transparent",cursor:"pointer"},children:o.jsx(g.Z,{style:{width:"1.5rem",height:"1.5rem",color:e<=N?"#f59e0b":"#e5e7eb",fill:e<=N?"#f59e0b":"none"}})},e))})]}),(0,o.jsxs)("div",{style:{marginBottom:"1.5rem"},children:[o.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"評價內容"}),o.jsx("textarea",{value:W,onChange:e=>E(e.target.value),placeholder:"分享您的體驗...",style:{width:"100%",padding:"0.75rem",border:"1px solid #e5e7eb",borderRadius:"0.5rem",fontSize:"0.875rem",outline:"none",resize:"vertical",minHeight:"6rem"},className:"focus:border-blue-500 focus:ring-2 focus:ring-blue-200"})]}),(0,o.jsxs)("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[o.jsx("button",{onClick:()=>{B(!1),C(null),P(5),E("")},style:{padding:"0.5rem 1rem",border:"1px solid #e5e7eb",borderRadius:"0.375rem",color:"#374151",backgroundColor:"white",fontSize:"0.875rem",fontWeight:"500",cursor:"pointer",transition:"all 0.2s"},className:"hover:bg-gray-50",children:"取消"}),o.jsx("button",{onClick:F,disabled:!W.trim(),style:{padding:"0.5rem 1rem",background:W.trim()?"linear-gradient(to right, #2563eb, #4f46e5)":"#9ca3af",color:"white",border:"none",borderRadius:"0.375rem",fontSize:"0.875rem",fontWeight:"500",cursor:W.trim()?"pointer":"not-allowed",transition:"all 0.2s"},className:W.trim()?"hover:shadow-md":"",children:"提交評價"})]})]})})]}):o.jsx(x.gb,{})}},4792:(e,r,t)=>{"use strict";t.d(r,{L6:()=>l,d8:()=>s,us:()=>a});var o=t(95344),i=t(22254),n=t(71532);function s({showBackButton:e=!1,backButtonText:r="返回",showHomeButton:t=!0,homeButtonText:s="回到首頁",customBackAction:a}){let l=(0,i.useRouter)();return(0,o.jsxs)(o.Fragment,{children:[t&&o.jsx("div",{style:{position:"absolute",top:"1rem",left:"1rem",zIndex:50},className:"sm:top-8 sm:left-8",children:(0,o.jsxs)("button",{onClick:()=>{l.push("/")},style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0.75rem",backgroundColor:"rgba(255, 255, 255, 0.9)",backdropFilter:"blur(10px)",borderRadius:"0.5rem",border:"1px solid rgba(255, 255, 255, 0.3)",cursor:"pointer",transition:"all 0.2s",fontSize:"0.75rem",fontWeight:"500",color:"#374151",boxShadow:"0 1px 3px 0 rgba(0, 0, 0, 0.1)"},className:"hover:bg-white hover:shadow-md sm:text-sm sm:px-4 sm:py-3",children:[(0,o.jsxs)("span",{className:"hidden sm:inline",children:["← ",s]}),o.jsx("span",{className:"sm:hidden",children:"← 首頁"})]})}),e&&o.jsx("div",{style:{maxWidth:"1200px",margin:"0 auto",padding:"1rem 1.5rem",paddingTop:t?"4rem":"1rem"},children:(0,o.jsxs)("button",{onClick:()=>{a?a():l.back()},style:{display:"flex",alignItems:"center",gap:"0.5rem",color:"#6b7280",background:"none",border:"none",cursor:"pointer",fontSize:"0.875rem",transition:"color 0.2s",padding:"0.5rem 0"},className:"hover:text-gray-900",children:[o.jsx(n.Z,{style:{width:"1.25rem",height:"1.25rem"}}),o.jsx("span",{children:r})]})})]})}function a({text:e="回到首頁"}){return o.jsx(s,{showHomeButton:!0,homeButtonText:e,showBackButton:!1})}function l({backButtonText:e="返回",homeButtonText:r="回到首頁",customBackAction:t}){return o.jsx(s,{showHomeButton:!0,showBackButton:!0,backButtonText:e,homeButtonText:r,customBackAction:t})}},58378:(e,r,t)=>{"use strict";t.d(r,{gb:()=>n});var o=t(95344);t(3729);var i=t(11453);function n({size:e="md",variant:r="spinner",className:t,text:n}){let s={sm:"w-4 h-4",md:"w-6 h-6",lg:"w-8 h-8"},a={sm:"text-sm",md:"text-base",lg:"text-lg"};return"spinner"===r?(0,o.jsxs)("div",{className:(0,i.cn)("flex flex-col items-center justify-center",t),children:[o.jsx("div",{className:(0,i.cn)("animate-spin rounded-full border-2 border-gray-300 border-t-[#FF5A5F]",s[e])}),n&&o.jsx("p",{className:(0,i.cn)("mt-2 text-gray-600",a[e]),children:n})]}):"dots"===r?(0,o.jsxs)("div",{className:(0,i.cn)("flex flex-col items-center justify-center",t),children:[o.jsx("div",{className:"flex space-x-1",children:[0,1,2].map(r=>o.jsx("div",{className:(0,i.cn)("bg-[#FF5A5F] rounded-full animate-pulse","sm"===e?"w-2 h-2":"md"===e?"w-3 h-3":"w-4 h-4"),style:{animationDelay:`${.2*r}s`,animationDuration:"1.2s"}},r))}),n&&o.jsx("p",{className:(0,i.cn)("mt-2 text-gray-600",a[e]),children:n})]}):"pulse"===r?(0,o.jsxs)("div",{className:(0,i.cn)("flex flex-col items-center justify-center",t),children:[o.jsx("div",{className:(0,i.cn)("bg-[#FF5A5F] rounded-full animate-pulse",s[e])}),n&&o.jsx("p",{className:(0,i.cn)("mt-2 text-gray-600",a[e]),children:n})]}):null}},30149:(e,r,t)=>{"use strict";t.d(r,{v:()=>n});var o=t(43158),i=t(2582);let n=(0,o.Ue)((e,r)=>({currentBooking:null,bookingStep:"details",bookings:[],isLoading:!1,error:null,paymentIntent:null,isProcessingPayment:!1,initializeBooking:(r,t)=>{e({currentBooking:{serviceId:r,guideId:t,guests:2},bookingStep:"details",error:null})},updateBookingDetails:r=>{e(e=>({currentBooking:e.currentBooking?{...e.currentBooking,...r}:r}))},setBookingStep:r=>{e({bookingStep:r})},createBooking:async()=>{let{currentBooking:t}=r();if(!t)throw Error("沒有預訂資料");let{token:o}=i.a.getState();if(!o)throw Error("請先登入");e({isLoading:!0,error:null});try{let r=await fetch("/api/bookings",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(t)});if(!r.ok)throw Error("建立預訂失敗");let i=await r.json();return e({paymentIntent:i.paymentIntent,bookingStep:"payment",isLoading:!1}),i.bookingId}catch(r){throw e({error:r instanceof Error?r.message:"建立預訂時發生錯誤",isLoading:!1}),r}},processPayment:async(r,t)=>{let{token:o}=i.a.getState();if(!o)throw Error("請先登入");e({isProcessingPayment:!0,error:null});try{let i=await fetch("/api/bookings/payment",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({bookingId:r,paymentMethodId:t})});if(!i.ok)throw Error("支付處理失敗");let n=await i.json();if("succeeded"===n.status)e({bookingStep:"confirmation",isProcessingPayment:!1});else throw Error("支付未成功")}catch(r){throw e({error:r instanceof Error?r.message:"支付處理時發生錯誤",isProcessingPayment:!1}),r}},confirmBooking:async t=>{let{token:o}=i.a.getState();if(!o)throw Error("請先登入");e({isLoading:!0,error:null});try{if(!(await fetch(`/api/bookings/${t}/confirm`,{method:"POST",headers:{Authorization:`Bearer ${o}`}})).ok)throw Error("確認預訂失敗");await r().fetchBookings(),e({isLoading:!1})}catch(r){throw e({error:r instanceof Error?r.message:"確認預訂時發生錯誤",isLoading:!1}),r}},cancelBooking:async(t,o)=>{let{token:n}=i.a.getState();if(!n)throw Error("請先登入");e({isLoading:!0,error:null});try{if(!(await fetch(`/api/bookings/${t}/cancel`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({reason:o})})).ok)throw Error("取消預訂失敗");await r().fetchBookings(),e({isLoading:!1})}catch(r){throw e({error:r instanceof Error?r.message:"取消預訂時發生錯誤",isLoading:!1}),r}},fetchBookings:async()=>{let{token:r}=i.a.getState();if(!r)throw Error("請先登入");e({isLoading:!0,error:null});try{let t=await fetch("/api/bookings",{headers:{Authorization:`Bearer ${r}`}});if(!t.ok)throw Error("獲取預訂列表失敗");let o=await t.json();e({bookings:o.bookings,isLoading:!1})}catch(r){e({error:r instanceof Error?r.message:"獲取預訂列表時發生錯誤",isLoading:!1})}},submitReview:async(t,o,n)=>{let{token:s}=i.a.getState();if(!s)throw Error("請先登入");e({isLoading:!0,error:null});try{if(!(await fetch(`/api/bookings/${t}/review`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({rating:o,comment:n})})).ok)throw Error("提交評價失敗");await r().fetchBookings(),e({isLoading:!1})}catch(r){throw e({error:r instanceof Error?r.message:"提交評價時發生錯誤",isLoading:!1}),r}},clearCurrentBooking:()=>{e({currentBooking:null,bookingStep:"details",paymentIntent:null,error:null})},setError:r=>{e({error:r})}}))},30849:(e,r,t)=>{"use strict";t.r(r),t.d(r,{$$typeof:()=>n,__esModule:()=>i,default:()=>s});let o=(0,t(86843).createProxy)(String.raw`/Users/zoechang/projects/Guidee/src/app/(main)/my-bookings/page.tsx`),{__esModule:i,$$typeof:n}=o,s=o.default}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[1216,8039,4757,8290],()=>t(82176));module.exports=o})();