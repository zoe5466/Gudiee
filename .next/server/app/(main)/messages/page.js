(()=>{var e={};e.id=2103,e.ids=[2103],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3609:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>n.a,__next_app__:()=>x,originalPathname:()=>m,pages:()=>o,routeModule:()=>u,tree:()=>c});var a=t(50482),r=t(69108),i=t(62563),n=t.n(i),l=t(68300),d={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>l[e]);t.d(s,d);let c=["",{children:["(main)",{children:["messages",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,91868)),"/Users/zoechang/projects/Guidee/src/app/(main)/messages/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,11808)),"/Users/zoechang/projects/Guidee/src/app/(main)/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,69361,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,98890)),"/Users/zoechang/projects/Guidee/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,69361,23)),"next/dist/client/components/not-found-error"]}],o=["/Users/zoechang/projects/Guidee/src/app/(main)/messages/page.tsx"],m="/(main)/messages/page",x={require:t,loadChunk:()=>Promise.resolve()},u=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/(main)/messages/page",pathname:"/messages",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},98151:(e,s,t)=>{Promise.resolve().then(t.bind(t,98589))},98589:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>N});var a=t(95344),r=t(3729),i=t(22254),n=t(82958),l=t(62312),d=t(67711),c=t(28765),o=t(63024),m=t(40626),x=t(88209),u=t(1560),p=t(66062),g=t(20016),h=t(94174),y=t(36135),f=t(2582),j=t(72032),v=t(58378);function N(){let e=(0,i.useRouter)(),s=(0,i.useSearchParams)(),{user:t,isAuthenticated:N}=(0,f.a)(),{error:b}=(0,j.pm)(),[w,F]=(0,r.useState)([]),[Z,I]=(0,r.useState)(null),[A,P]=(0,r.useState)([]),[S,_]=(0,r.useState)(""),[T,C]=(0,r.useState)(""),[z,q]=(0,r.useState)(!0),[E,$]=(0,r.useState)(!1),[M,G]=(0,r.useState)(!1),D=(0,r.useRef)(null);(0,r.useEffect)(()=>{if(!N){e.push("/login");return}let t=s.get("guide");t&&R(t),L()},[N,e,s]),(0,r.useEffect)(()=>{let e=()=>{G(window.innerWidth<768)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,r.useEffect)(()=>{k()},[A]);let k=()=>{D.current?.scrollIntoView({behavior:"smooth"})},L=async()=>{q(!0);try{let e=[{id:"conv-1",participantId:"guide-1",participantName:"小美",participantAvatar:"https://images.unsplash.com/photo-1494790108755-2616b612b786?w=100&h=100&fit=crop&crop=face",participantRole:"guide",unreadCount:2,isOnline:!0,lastMessage:{id:"msg-1",content:"期待與您一起探索台北！",senderId:"guide-1",receiverId:t?.id||"",timestamp:"2024-01-16T10:30:00Z",type:"text",status:"read"}},{id:"conv-2",participantId:"guide-2",participantName:"阿明",participantAvatar:"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop&crop=face",participantRole:"guide",unreadCount:0,isOnline:!1,lastSeen:"2024-01-16T08:00:00Z",lastMessage:{id:"msg-2",content:"九份的行程我們明天確認",senderId:t?.id||"",receiverId:"guide-2",timestamp:"2024-01-15T16:20:00Z",type:"text",status:"read"}}];F(e),!Z&&e.length>0&&(I(e[0]?.id||null),e[0]?.id&&O(e[0].id))}catch(e){b("載入失敗","無法載入對話列表")}finally{q(!1)}},O=async e=>{try{let e=[{id:"msg-1",content:"您好！我是小美，很高興為您提供台北導覽服務",senderId:"guide-1",receiverId:t?.id||"",timestamp:"2024-01-16T09:00:00Z",type:"text",status:"read"},{id:"msg-2",content:"您好！我想詢問台北101的導覽行程",senderId:t?.id||"",receiverId:"guide-1",timestamp:"2024-01-16T09:15:00Z",type:"text",status:"read"},{id:"msg-3",content:"沒問題！我可以為您安排4小時的深度導覽，包含台北101觀景台和信義商圈",senderId:"guide-1",receiverId:t?.id||"",timestamp:"2024-01-16T09:18:00Z",type:"text",status:"read"},{id:"msg-4",content:"期待與您一起探索台北！",senderId:"guide-1",receiverId:t?.id||"",timestamp:"2024-01-16T10:30:00Z",type:"text",status:"delivered"}];P(e)}catch(e){b("載入失敗","無法載入訊息")}},R=async e=>{let s=w.find(s=>s.participantId===e);s&&(I(s.id),O(s.id))},U=async()=>{if(!S.trim()||!Z||E)return;$(!0);let e={id:`msg-${Date.now()}`,content:S.trim(),senderId:t?.id||"",receiverId:w.find(e=>e.id===Z)?.participantId||"",timestamp:new Date().toISOString(),type:"text",status:"sending"};P(s=>[...s,e]),_("");try{await new Promise(e=>setTimeout(e,1e3)),P(s=>s.map(s=>s.id===e.id?{...s,status:"sent"}:s))}catch(s){P(s=>s.filter(s=>s.id!==e.id)),b("發送失敗","訊息發送失敗，請重試")}finally{$(!1)}},W=e=>{switch(e){case"sending":return a.jsx(n.Z,{className:"w-3 h-3 text-gray-400"});case"sent":return a.jsx(l.Z,{className:"w-3 h-3 text-gray-400"});case"delivered":return a.jsx(d.Z,{className:"w-3 h-3 text-gray-400"});case"read":return a.jsx(d.Z,{className:"w-3 h-3 text-blue-500"});default:return null}},H=w.filter(e=>e.participantName.toLowerCase().includes(T.toLowerCase())),K=w.find(e=>e.id===Z);return z?a.jsx("div",{className:"min-h-screen bg-gray-50",children:a.jsx("div",{className:"container py-8",children:a.jsx("div",{className:"flex justify-center items-center py-20",children:a.jsx(v.gb,{size:"lg"})})})}):a.jsx("div",{className:"min-h-screen bg-gray-50",children:(0,a.jsxs)("div",{className:"container py-8",children:[(0,a.jsxs)("div",{className:"mb-6",children:[a.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"訊息中心"}),a.jsx("p",{className:"text-gray-600",children:"與地陪即時溝通，規劃完美行程"})]}),a.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",style:{height:"600px"},children:(0,a.jsxs)("div",{className:"flex h-full",children:[(0,a.jsxs)("div",{className:`border-r border-gray-200 ${M&&Z?"hidden":"w-full md:w-1/3"}`,children:[a.jsx("div",{className:"p-4 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"relative",children:[a.jsx(c.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),a.jsx("input",{type:"text",placeholder:"搜尋對話...",value:T,onChange:e=>C(e.target.value),className:"w-full pl-9 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-[#FF5A5F] focus:border-[#FF5A5F]"})]})}),a.jsx("div",{className:"overflow-y-auto",style:{height:"calc(100% - 73px)"},children:H.length>0?a.jsx("div",{className:"divide-y divide-gray-200",children:H.map(e=>a.jsx("div",{onClick:()=>{I(e.id),O(e.id)},className:`p-4 cursor-pointer hover:bg-gray-50 transition-colors ${Z===e.id?"bg-blue-50 border-r-2 border-[#FF5A5F]":""}`,children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsxs)("div",{className:"relative",children:[a.jsx("img",{src:e.participantAvatar,alt:e.participantName,className:"w-12 h-12 rounded-full object-cover"}),e.isOnline&&a.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white"})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("h3",{className:"text-sm font-medium text-gray-900 truncate",children:e.participantName}),(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[e.lastMessage&&a.jsx("span",{className:"text-xs text-gray-500",children:new Date(e.lastMessage.timestamp).toLocaleTimeString("zh-TW",{hour:"2-digit",minute:"2-digit"})}),e.unreadCount>0&&a.jsx("div",{className:"bg-[#FF5A5F] text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:e.unreadCount})]})]}),a.jsx("p",{className:"text-sm text-gray-600 truncate mt-1",children:e.lastMessage?.content||"開始新對話"})]})]})},e.id))}):a.jsx("div",{className:"p-8 text-center text-gray-500",children:a.jsx("p",{children:"沒有找到對話"})})})]}),a.jsx("div",{className:`flex flex-col ${M&&!Z?"hidden":"flex-1"}`,children:K?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 bg-gray-50",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[M&&a.jsx("button",{onClick:()=>I(null),className:"p-1 hover:bg-gray-200 rounded",children:a.jsx(o.Z,{className:"w-5 h-5"})}),a.jsx("img",{src:K.participantAvatar,alt:K.participantName,className:"w-10 h-10 rounded-full object-cover"}),(0,a.jsxs)("div",{children:[a.jsx("h3",{className:"font-medium text-gray-900",children:K.participantName}),a.jsx("p",{className:"text-sm text-gray-600",children:K.isOnline?"線上":`最後上線 ${K.lastSeen?new Date(K.lastSeen).toLocaleString("zh-TW"):"未知"}`})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[a.jsx("button",{className:"p-2 hover:bg-gray-200 rounded-full",children:a.jsx(m.Z,{className:"w-5 h-5 text-gray-600"})}),a.jsx("button",{className:"p-2 hover:bg-gray-200 rounded-full",children:a.jsx(x.Z,{className:"w-5 h-5 text-gray-600"})}),a.jsx("button",{className:"p-2 hover:bg-gray-200 rounded-full",children:a.jsx(u.Z,{className:"w-5 h-5 text-gray-600"})})]})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",style:{height:"calc(100% - 140px)"},children:[A.map(e=>a.jsx("div",{className:`flex ${e.senderId===t?.id?"justify-end":"justify-start"}`,children:(0,a.jsxs)("div",{className:`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${e.senderId===t?.id?"bg-[#FF5A5F] text-white":"bg-gray-100 text-gray-900"}`,children:[a.jsx("p",{className:"text-sm",children:e.content}),(0,a.jsxs)("div",{className:`flex items-center justify-end mt-1 space-x-1 ${e.senderId===t?.id?"text-red-200":"text-gray-500"}`,children:[a.jsx("span",{className:"text-xs",children:new Date(e.timestamp).toLocaleTimeString("zh-TW",{hour:"2-digit",minute:"2-digit"})}),e.senderId===t?.id&&W(e.status)]})]})},e.id)),a.jsx("div",{ref:D})]}),a.jsx("div",{className:"p-4 border-t border-gray-200 bg-gray-50",children:(0,a.jsxs)("div",{className:"flex items-end space-x-2",children:[a.jsx("button",{className:"p-2 text-gray-500 hover:text-gray-700",children:a.jsx(p.Z,{className:"w-5 h-5"})}),a.jsx("button",{className:"p-2 text-gray-500 hover:text-gray-700",children:a.jsx(g.Z,{className:"w-5 h-5"})}),a.jsx("div",{className:"flex-1 relative",children:a.jsx("textarea",{value:S,onChange:e=>_(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),U())},placeholder:"輸入訊息...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-[#FF5A5F] focus:border-[#FF5A5F]",rows:1,style:{minHeight:"40px",maxHeight:"100px"}})}),a.jsx("button",{className:"p-2 text-gray-500 hover:text-gray-700",children:a.jsx(h.Z,{className:"w-5 h-5"})}),a.jsx("button",{onClick:U,disabled:!S.trim()||E,className:"p-2 bg-[#FF5A5F] text-white rounded-lg hover:bg-[#E1464A] disabled:opacity-50 disabled:cursor-not-allowed",children:a.jsx(y.Z,{className:"w-5 h-5"})})]})})]}):a.jsx("div",{className:"flex-1 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center text-gray-500",children:[a.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:a.jsx(y.Z,{className:"w-8 h-8 text-gray-400"})}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"選擇對話開始聊天"}),a.jsx("p",{className:"text-gray-600",children:"與地陪即時溝通，規劃完美的旅行體驗"})]})})})]})})]})})}},58378:(e,s,t)=>{"use strict";t.d(s,{gb:()=>i});var a=t(95344);t(3729);var r=t(11453);function i({size:e="md",variant:s="spinner",className:t,text:i}){let n={sm:"w-4 h-4",md:"w-6 h-6",lg:"w-8 h-8"},l={sm:"text-sm",md:"text-base",lg:"text-lg"};return"spinner"===s?(0,a.jsxs)("div",{className:(0,r.cn)("flex flex-col items-center justify-center",t),children:[a.jsx("div",{className:(0,r.cn)("animate-spin rounded-full border-2 border-gray-300 border-t-[#FF5A5F]",n[e])}),i&&a.jsx("p",{className:(0,r.cn)("mt-2 text-gray-600",l[e]),children:i})]}):"dots"===s?(0,a.jsxs)("div",{className:(0,r.cn)("flex flex-col items-center justify-center",t),children:[a.jsx("div",{className:"flex space-x-1",children:[0,1,2].map(s=>a.jsx("div",{className:(0,r.cn)("bg-[#FF5A5F] rounded-full animate-pulse","sm"===e?"w-2 h-2":"md"===e?"w-3 h-3":"w-4 h-4"),style:{animationDelay:`${.2*s}s`,animationDuration:"1.2s"}},s))}),i&&a.jsx("p",{className:(0,r.cn)("mt-2 text-gray-600",l[e]),children:i})]}):"pulse"===s?(0,a.jsxs)("div",{className:(0,r.cn)("flex flex-col items-center justify-center",t),children:[a.jsx("div",{className:(0,r.cn)("bg-[#FF5A5F] rounded-full animate-pulse",n[e])}),i&&a.jsx("p",{className:(0,r.cn)("mt-2 text-gray-600",l[e]),children:i})]}):null}},72032:(e,s,t)=>{"use strict";t.d(s,{pm:()=>d}),t(95344);var a=t(3729),r=t(7060),i=t(66138),n=t(45961),l=t(91991);function d(){let[e,s]=(0,a.useState)([]),t=e=>{let t=Math.random().toString(36).substr(2,9),a={id:t,duration:5e3,...e};return s(e=>[...e,a]),t};return{toasts:e,addToast:t,removeToast:e=>{s(s=>s.filter(s=>s.id!==e))},success:(e,s)=>t({type:"success",title:e,message:s}),error:(e,s)=>t({type:"error",title:e,message:s}),warning:(e,s)=>t({type:"warning",title:e,message:s}),info:(e,s)=>t({type:"info",title:e,message:s})}}r.Z,i.Z,n.Z,l.Z},91868:(e,s,t)=>{"use strict";t.r(s),t.d(s,{$$typeof:()=>i,__esModule:()=>r,default:()=>n});let a=(0,t(86843).createProxy)(String.raw`/Users/zoechang/projects/Guidee/src/app/(main)/messages/page.tsx`),{__esModule:r,$$typeof:i}=a,n=a.default}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),a=s.X(0,[1216,8039,4757,8290],()=>t(3609));module.exports=a})();