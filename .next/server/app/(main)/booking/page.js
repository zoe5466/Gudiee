(()=>{var e={};e.id=9215,e.ids=[9215],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},80117:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>s.a,__next_app__:()=>h,originalPathname:()=>m,pages:()=>c,routeModule:()=>g,tree:()=>d});var i=t(50482),o=t(69108),n=t(62563),s=t.n(n),a=t(68300),l={};for(let e in a)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>a[e]);t.d(r,l);let d=["",{children:["(main)",{children:["booking",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,49725)),"/Users/zoechang/projects/Guidee/src/app/(main)/booking/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,11808)),"/Users/zoechang/projects/Guidee/src/app/(main)/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,69361,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,98890)),"/Users/zoechang/projects/Guidee/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,69361,23)),"next/dist/client/components/not-found-error"]}],c=["/Users/zoechang/projects/Guidee/src/app/(main)/booking/page.tsx"],m="/(main)/booking/page",h={require:t,loadChunk:()=>Promise.resolve()},g=new i.AppPageRouteModule({definition:{kind:o.x.APP_PAGE,page:"/(main)/booking/page",pathname:"/booking",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},54194:(e,r,t)=>{Promise.resolve().then(t.bind(t,5699))},5699:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>b});var i=t(95344),o=t(3729),n=t(22254),s=t(55794),a=t(89895),l=t(25545),d=t(62312),c=t(30149),m=t(2582),h=t(58378),g=t(4792),p=t(85674),u=t(66138),x=t(47958);let f=[{id:"credit_card",type:"credit_card",name:"信用卡/金融卡",icon:"\uD83D\uDCB3"},{id:"apple_pay",type:"apple_pay",name:"Apple Pay",icon:"\uD83C\uDF4E"},{id:"google_pay",type:"google_pay",name:"Google Pay",icon:"\uD83C\uDD56"},{id:"line_pay",type:"line_pay",name:"LINE Pay",icon:"\uD83D\uDCAC"}];function y({amount:e,currency:r="TWD",onPaymentSuccess:t,onPaymentError:n,isLoading:s=!1,className:a=""}){let[l,c]=(0,o.useState)(f[0]),[m,h]=(0,o.useState)({cardNumber:"",expiryDate:"",cvv:"",cardholderName:"",billingAddress:{country:"TW",city:"",address:"",postalCode:""}}),[g,y]=(0,o.useState)({}),[b,j]=(0,o.useState)(!1),v=e=>{let r=e.replace(/\s+/g,"").replace(/[^0-9]/gi,""),t=r.match(/\d{4,16}/g),i=t&&t[0]||"",o=[];for(let e=0,r=i.length;e<r;e+=4)o.push(i.substring(e,e+4));return o.length?o.join(" "):r},w=e=>{let r=e.replace(/\s+/g,"").replace(/[^0-9]/gi,"");return r.length>=2?r.substring(0,2)+"/"+r.substring(2,4):r},k=()=>{let e={};return"credit_card"!==l.type||((!m.cardNumber||m.cardNumber.replace(/\s/g,"").length<16)&&(e.cardNumber="請輸入有效的卡號"),m.expiryDate&&/^\d{2}\/\d{2}$/.test(m.expiryDate)||(e.expiryDate="請輸入有效的到期日 (MM/YY)"),(!m.cvv||m.cvv.length<3)&&(e.cvv="請輸入有效的安全碼"),m.cardholderName.trim()||(e.cardholderName="請輸入持卡人姓名")),y(e),0===Object.keys(e).length},S=(e,r)=>{if(h(t=>({...t,[e]:r})),g[e]){let r={...g};delete r[e],y(r)}},C=async()=>{if(k()){j(!0);try{await new Promise(e=>setTimeout(e,2e3));let e=`tx_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;t(e)}catch(e){n("支付處理失敗，請稍後再試")}finally{j(!1)}}};return(0,i.jsxs)("div",{className:a,children:[i.jsx("div",{style:{backgroundColor:"#f8fafc",padding:"1.5rem",borderRadius:"0.75rem",marginBottom:"2rem",border:"1px solid #e2e8f0"},children:(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsx("span",{style:{fontSize:"1.125rem",fontWeight:"500",color:"#475569"},children:"應付金額"}),(0,i.jsxs)("span",{style:{fontSize:"2rem",fontWeight:"700",color:"#0f172a"},children:[r," ",e.toLocaleString()]})]})}),(0,i.jsxs)("div",{style:{marginBottom:"2rem"},children:[i.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:"600",color:"#0f172a",marginBottom:"1rem"},children:"選擇付款方式"}),i.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"0.75rem"},children:f.map(e=>(0,i.jsxs)("button",{onClick:()=>c(e),style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"1rem",border:`2px solid ${l.id===e.id?"#3b82f6":"#e2e8f0"}`,borderRadius:"0.5rem",backgroundColor:l.id===e.id?"#eff6ff":"white",cursor:"pointer",transition:"all 0.2s",fontSize:"0.875rem",fontWeight:"500",color:"#374151"},className:"hover:border-blue-300",children:[i.jsx("span",{style:{fontSize:"1.25rem"},children:e.icon}),i.jsx("span",{children:e.name}),l.id===e.id&&i.jsx(d.Z,{style:{width:"1rem",height:"1rem",color:"#3b82f6",marginLeft:"auto"}})]},e.id))})]}),"credit_card"===l.type&&(0,i.jsxs)("div",{style:{marginBottom:"2rem"},children:[(0,i.jsxs)("h3",{style:{fontSize:"1.125rem",fontWeight:"600",color:"#0f172a",marginBottom:"1rem"},children:[i.jsx(p.Z,{style:{width:"1.25rem",height:"1.25rem",display:"inline",marginRight:"0.5rem"}}),"信用卡資訊"]}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[(0,i.jsxs)("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"卡號 *"}),i.jsx("input",{type:"text",value:m.cardNumber,onChange:e=>S("cardNumber",v(e.target.value)),placeholder:"1234 5678 9012 3456",maxLength:19,style:{width:"100%",padding:"0.75rem",border:`1px solid ${g.cardNumber?"#ef4444":"#d1d5db"}`,borderRadius:"0.5rem",fontSize:"1rem",outline:"none",transition:"all 0.2s"},className:"focus:border-blue-500 focus:ring-2 focus:ring-blue-200"}),g.cardNumber&&(0,i.jsxs)("p",{style:{marginTop:"0.25rem",fontSize:"0.875rem",color:"#ef4444",display:"flex",alignItems:"center",gap:"0.25rem"},children:[i.jsx(u.Z,{style:{width:"0.875rem",height:"0.875rem"}}),g.cardNumber]})]}),(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[(0,i.jsxs)("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"到期日 *"}),i.jsx("input",{type:"text",value:m.expiryDate,onChange:e=>S("expiryDate",w(e.target.value)),placeholder:"MM/YY",maxLength:5,style:{width:"100%",padding:"0.75rem",border:`1px solid ${g.expiryDate?"#ef4444":"#d1d5db"}`,borderRadius:"0.5rem",fontSize:"1rem",outline:"none",transition:"all 0.2s"},className:"focus:border-blue-500 focus:ring-2 focus:ring-blue-200"}),g.expiryDate&&i.jsx("p",{style:{marginTop:"0.25rem",fontSize:"0.875rem",color:"#ef4444"},children:g.expiryDate})]}),(0,i.jsxs)("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"安全碼 *"}),i.jsx("input",{type:"text",value:m.cvv,onChange:e=>S("cvv",e.target.value.replace(/\D/g,"").slice(0,4)),placeholder:"123",maxLength:4,style:{width:"100%",padding:"0.75rem",border:`1px solid ${g.cvv?"#ef4444":"#d1d5db"}`,borderRadius:"0.5rem",fontSize:"1rem",outline:"none",transition:"all 0.2s"},className:"focus:border-blue-500 focus:ring-2 focus:ring-blue-200"}),g.cvv&&i.jsx("p",{style:{marginTop:"0.25rem",fontSize:"0.875rem",color:"#ef4444"},children:g.cvv})]})]}),(0,i.jsxs)("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"持卡人姓名 *"}),i.jsx("input",{type:"text",value:m.cardholderName,onChange:e=>S("cardholderName",e.target.value),placeholder:"如卡片上所示",style:{width:"100%",padding:"0.75rem",border:`1px solid ${g.cardholderName?"#ef4444":"#d1d5db"}`,borderRadius:"0.5rem",fontSize:"1rem",outline:"none",transition:"all 0.2s"},className:"focus:border-blue-500 focus:ring-2 focus:ring-blue-200"}),g.cardholderName&&i.jsx("p",{style:{marginTop:"0.25rem",fontSize:"0.875rem",color:"#ef4444"},children:g.cardholderName})]})]})]}),"credit_card"!==l.type&&(0,i.jsxs)("div",{style:{backgroundColor:"#f8fafc",padding:"2rem",borderRadius:"0.75rem",marginBottom:"2rem",textAlign:"center"},children:[i.jsx("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:l.icon}),i.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:"600",color:"#0f172a",marginBottom:"0.5rem"},children:l.name}),(0,i.jsxs)("p",{style:{color:"#64748b"},children:["點擊「確認付款」後將跳轉到 ",l.name," 付款頁面"]})]}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"1rem",backgroundColor:"#f0fdf4",borderRadius:"0.5rem",marginBottom:"2rem",border:"1px solid #bbf7d0"},children:[i.jsx(x.Z,{style:{width:"1.25rem",height:"1.25rem",color:"#16a34a"}}),i.jsx("span",{style:{fontSize:"0.875rem",color:"#166534",fontWeight:"500"},children:"您的付款資訊受到 SSL 加密保護"})]}),i.jsx("button",{onClick:C,disabled:s||b,style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",padding:"1rem 1.5rem",backgroundColor:s||b?"#9ca3af":"#2563eb",color:"white",border:"none",borderRadius:"0.75rem",fontSize:"1.125rem",fontWeight:"600",cursor:s||b?"not-allowed":"pointer",transition:"all 0.2s",boxShadow:s||b?"none":"0 10px 15px -3px rgba(0, 0, 0, 0.1)"},className:s||b?"":"hover:bg-blue-700 hover:shadow-lg",children:b?(0,i.jsxs)(i.Fragment,{children:[i.jsx("div",{style:{width:"1.25rem",height:"1.25rem",border:"2px solid transparent",borderTop:"2px solid white",borderRadius:"50%",animation:"spin 1s linear infinite"}}),"處理中..."]}):(0,i.jsxs)(i.Fragment,{children:[i.jsx(x.Z,{style:{width:"1.25rem",height:"1.25rem"}}),"確認付款 ",r," ",e.toLocaleString()]})})]})}function b(){let e=(0,n.useRouter)(),{isAuthenticated:r,user:t}=(0,m.a)(),{currentBooking:p,bookingStep:u,setBookingStep:x,updateBookingDetails:f,createBooking:b,isLoading:j}=(0,c.v)();(0,o.useEffect)(()=>{if(!r){e.push("/login?redirect=/booking");return}},[r,e]);let[v,w]=(0,o.useState)({name:t?.name||"",email:t?.email||"",phone:t?.profile?.phone||""});(0,o.useEffect)(()=>{t&&w({name:t.name||"",email:t.email||"",phone:t.profile?.phone||""})},[t]);let[k,S]=(0,o.useState)(""),C={id:p?.serviceId||"1",title:"台北101 & 信義區深度導覽",price:800,duration:4,guide:{name:"小美",avatar:"https://images.unsplash.com/photo-1494790108755-2616b612b786?w=200&h=200&fit=crop&crop=face"}},N=async()=>{try{await b(),x("payment")}catch(e){}},z=async e=>{try{x("confirmation")}catch(e){}};return j?i.jsx("div",{style:{minHeight:"100vh",background:"linear-gradient(to bottom right, #dbeafe, #ffffff, #e0e7ff)",display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(h.gb,{variant:"spinner",size:"lg"})}):p?(0,i.jsxs)("div",{style:{minHeight:"100vh",background:"linear-gradient(to bottom right, #dbeafe, #ffffff, #e0e7ff)"},children:[i.jsx(g.L6,{}),i.jsx("div",{style:{backgroundColor:"white",borderBottom:"1px solid #e5e7eb",marginTop:"4rem",borderRadius:"1rem 1rem 0 0"},children:i.jsx("div",{style:{maxWidth:"1200px",margin:"0 auto",padding:"1.5rem"},children:i.jsx("h1",{style:{fontSize:"1.875rem",fontWeight:"700",color:"#111827"},children:"確認預訂"})})}),i.jsx("div",{style:{backgroundColor:"white",borderBottom:"1px solid #e5e7eb"},children:i.jsx("div",{style:{maxWidth:"1200px",margin:"0 auto",padding:"1rem"},className:"sm:p-6",children:(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"1rem",flexWrap:"wrap"},className:"sm:gap-8 sm:flex-nowrap",children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",color:"details"===u?"#FF5A5F":"#9ca3af",fontSize:"0.875rem"},className:"sm:gap-2 sm:text-base",children:[i.jsx("div",{style:{width:"1.5rem",height:"1.5rem",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.75rem",fontWeight:"500",backgroundColor:"details"===u?"#FF5A5F":"#e5e7eb",color:"details"===u?"white":"#6b7280"},className:"sm:w-8 sm:h-8 sm:text-sm",children:"1"}),i.jsx("span",{className:"hidden sm:inline",children:"預訂詳情"})]}),i.jsx("div",{style:{width:"2rem",height:"2px",backgroundColor:"details"!==u?"#FF5A5F":"#e5e7eb"},className:"sm:w-16"}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",color:"payment"===u?"#FF5A5F":"#9ca3af",fontSize:"0.875rem"},className:"sm:gap-2 sm:text-base",children:[i.jsx("div",{style:{width:"1.5rem",height:"1.5rem",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.75rem",fontWeight:"500",backgroundColor:"payment"===u?"#FF5A5F":"#e5e7eb",color:"payment"===u?"white":"#6b7280"},className:"sm:w-8 sm:h-8 sm:text-sm",children:"2"}),i.jsx("span",{className:"hidden sm:inline",children:"付款方式"})]}),i.jsx("div",{style:{width:"2rem",height:"2px",backgroundColor:"confirmation"===u?"#FF5A5F":"#e5e7eb"},className:"sm:w-16"}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",color:"confirmation"===u?"#FF5A5F":"#9ca3af",fontSize:"0.875rem"},className:"sm:gap-2 sm:text-base",children:[i.jsx("div",{style:{width:"1.5rem",height:"1.5rem",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.75rem",fontWeight:"500",backgroundColor:"confirmation"===u?"#FF5A5F":"#e5e7eb",color:"confirmation"===u?"white":"#6b7280"},className:"sm:w-8 sm:h-8 sm:text-sm",children:"3"}),i.jsx("span",{className:"hidden sm:inline",children:"預訂確認"})]})]})})}),i.jsx("div",{style:{maxWidth:"1200px",margin:"0 auto",padding:"1rem"},className:"sm:p-8",children:(0,i.jsxs)("div",{style:{display:"grid",gap:"2rem"},className:"lg:grid-cols-[2fr_1fr]",children:[(0,i.jsxs)("div",{style:{order:2},className:"lg:order-1",children:["details"===u&&(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:[(0,i.jsxs)("div",{style:{backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"1rem",padding:"1.5rem",boxShadow:"0 1px 3px 0 rgba(0, 0, 0, 0.1)"},children:[i.jsx("h2",{style:{fontSize:"1.25rem",fontWeight:"600",color:"#111827",marginBottom:"1.5rem"},children:"預訂詳情"}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"1rem",marginBottom:"1.5rem"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",color:"#374151"},children:[i.jsx(s.Z,{style:{width:"1.25rem",height:"1.25rem",color:"#9ca3af"}}),i.jsx("span",{children:p.date?.toLocaleDateString("zh-TW")})]}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",color:"#374151"},children:[i.jsx(a.Z,{style:{width:"1.25rem",height:"1.25rem",color:"#9ca3af"}}),(0,i.jsxs)("span",{children:[p.guests," 位旅客"]})]}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",color:"#374151"},children:[i.jsx(l.Z,{style:{width:"1.25rem",height:"1.25rem",color:"#9ca3af"}}),(0,i.jsxs)("span",{children:[p.duration," 小時"]})]})]})]}),(0,i.jsxs)("div",{style:{backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"1rem",padding:"1.5rem",boxShadow:"0 1px 3px 0 rgba(0, 0, 0, 0.1)"},children:[i.jsx("h2",{style:{fontSize:"1.25rem",fontWeight:"600",color:"#111827",marginBottom:"1.5rem"},children:"聯絡資訊"}),(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:"1rem",marginBottom:"1.5rem"},className:"sm:grid-cols-2",children:[(0,i.jsxs)("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"姓名 *"}),i.jsx("input",{type:"text",value:v.name,onChange:e=>w(r=>({...r,name:e.target.value})),style:{width:"100%",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"0.5rem",fontSize:"0.875rem"},required:!0})]}),(0,i.jsxs)("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"電子郵件 *"}),i.jsx("input",{type:"email",value:v.email,onChange:e=>w(r=>({...r,email:e.target.value})),style:{width:"100%",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"0.5rem",fontSize:"0.875rem"},required:!0})]}),(0,i.jsxs)("div",{className:"sm:col-span-2",children:[i.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"手機號碼 *"}),i.jsx("input",{type:"tel",value:v.phone,onChange:e=>w(r=>({...r,phone:e.target.value})),style:{width:"100%",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"0.5rem",fontSize:"0.875rem"},required:!0})]})]})]}),(0,i.jsxs)("div",{style:{backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"1rem",padding:"1.5rem",boxShadow:"0 1px 3px 0 rgba(0, 0, 0, 0.1)"},children:[i.jsx("h2",{style:{fontSize:"1.25rem",fontWeight:"600",color:"#111827",marginBottom:"1.5rem"},children:"特殊需求"}),i.jsx("textarea",{value:k,onChange:e=>S(e.target.value),style:{width:"100%",minHeight:"100px",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"0.5rem",fontSize:"0.875rem",resize:"vertical"},placeholder:"有任何特殊需求或備註嗎？（選填）"})]}),i.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"1rem"},children:i.jsx("button",{onClick:()=>{"details"===u&&(f({contactInfo:v,specialRequests:k}),x("payment"))},disabled:!v.name||!v.email||!v.phone,style:{padding:"0.75rem 2rem",backgroundColor:v.name&&v.email&&v.phone?"#FF5A5F":"#d1d5db",color:"white",border:"none",borderRadius:"0.5rem",cursor:v.name&&v.email&&v.phone?"pointer":"not-allowed",fontWeight:"500",opacity:v.name&&v.email&&v.phone?1:.5},children:"繼續"})})]}),"payment"===u&&i.jsx("div",{style:{backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"1rem",padding:"1.5rem",boxShadow:"0 1px 3px 0 rgba(0, 0, 0, 0.1)"},children:i.jsx(y,{amount:C.price*(p?.duration||4)*(p?.guests||2)+Math.round(C.price*(p?.duration||4)*(p?.guests||2)*.1),currency:"NT$",onPaymentSuccess:z,onPaymentError:e=>{},isLoading:j})}),"confirmation"!==u&&(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"1rem",marginTop:"1rem"},className:"sm:flex-row sm:justify-between",children:[i.jsx("button",{onClick:()=>x("details"),style:{padding:"0.75rem 2rem",backgroundColor:"#f3f4f6",color:"#374151",border:"none",borderRadius:"0.5rem",cursor:"pointer",fontWeight:"500"},children:"返回"}),i.jsx("button",{onClick:N,style:{padding:"0.75rem 2rem",backgroundColor:"#FF5A5F",color:"white",border:"none",borderRadius:"0.5rem",cursor:"pointer",fontWeight:"500"},children:"確認付款"})]}),"confirmation"===u&&i.jsx("div",{children:(0,i.jsxs)("div",{style:{backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"1rem",padding:"2rem",boxShadow:"0 1px 3px 0 rgba(0, 0, 0, 0.1)",textAlign:"center"},children:[i.jsx("div",{style:{width:"4rem",height:"4rem",backgroundColor:"#dcfce7",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 1rem"},children:i.jsx(d.Z,{style:{width:"2rem",height:"2rem",color:"#16a34a"}})}),i.jsx("h2",{style:{fontSize:"1.5rem",fontWeight:"600",color:"#111827",marginBottom:"0.5rem"},children:"預訂成功！"}),i.jsx("p",{style:{color:"#6b7280",marginBottom:"1.5rem"},children:"您的預訂已確認，地陪將在 24 小時內與您聯繫。"}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"1rem",alignItems:"center"},className:"sm:flex-row sm:justify-center",children:[i.jsx("button",{onClick:()=>e.push("/profile"),style:{padding:"0.75rem 1.5rem",backgroundColor:"#f3f4f6",color:"#374151",border:"none",borderRadius:"0.5rem",cursor:"pointer",fontWeight:"500"},children:"查看預訂記錄"}),i.jsx("button",{onClick:()=>e.push("/search"),style:{padding:"0.75rem 1.5rem",backgroundColor:"#FF5A5F",color:"white",border:"none",borderRadius:"0.5rem",cursor:"pointer",fontWeight:"500"},children:"繼續探索"})]})]})})]}),i.jsx("div",{style:{order:1},className:"lg:order-2",children:(0,i.jsxs)("div",{style:{backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"1rem",padding:"1.5rem",boxShadow:"0 1px 3px 0 rgba(0, 0, 0, 0.1)"},className:"lg:sticky lg:top-24",children:[i.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:"600",color:"#111827",marginBottom:"1rem"},children:"預訂摘要"}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",marginBottom:"1.5rem"},children:[i.jsx("img",{src:C.guide.avatar,alt:C.guide.name,style:{width:"3rem",height:"3rem",borderRadius:"0.5rem",objectFit:"cover"}}),(0,i.jsxs)("div",{style:{flex:1},children:[i.jsx("h4",{style:{fontWeight:"500",color:"#111827",fontSize:"0.875rem"},children:C.title}),(0,i.jsxs)("p",{style:{fontSize:"0.875rem",color:"#6b7280"},children:["地陪：",C.guide.name]})]})]}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginBottom:"1.5rem",paddingBottom:"1.5rem",borderBottom:"1px solid #e5e7eb"},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.875rem"},children:[i.jsx("span",{style:{color:"#6b7280"},children:"日期："}),i.jsx("span",{style:{color:"#111827"},children:p.date?.toLocaleDateString("zh-TW")})]}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.875rem"},children:[i.jsx("span",{style:{color:"#6b7280"},children:"人數："}),(0,i.jsxs)("span",{style:{color:"#111827"},children:[p.guests," 位"]})]}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.875rem"},children:[i.jsx("span",{style:{color:"#6b7280"},children:"時長："}),(0,i.jsxs)("span",{style:{color:"#111827"},children:[p.duration," 小時"]})]})]}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginBottom:"1.5rem"},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.875rem"},children:[i.jsx("span",{style:{color:"#6b7280"},children:"服務費用："}),(0,i.jsxs)("span",{style:{color:"#111827"},children:["NT$ ",(C.price*(p.duration||1)).toLocaleString()]})]}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.875rem"},children:[i.jsx("span",{style:{color:"#6b7280"},children:"平台服務費："}),(0,i.jsxs)("span",{style:{color:"#111827"},children:["NT$ ",Math.round(C.price*(p.duration||1)*.1).toLocaleString()]})]})]}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"1.125rem",fontWeight:"600",color:"#111827",paddingTop:"1rem",borderTop:"1px solid #e5e7eb"},children:[i.jsx("span",{children:"總計："}),(0,i.jsxs)("span",{children:["NT$ ",Math.round(C.price*(p.duration||1)*1.1).toLocaleString()]})]})]})})]})})]}):i.jsx("div",{style:{minHeight:"100vh",background:"linear-gradient(to bottom right, #dbeafe, #ffffff, #e0e7ff)",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,i.jsxs)("div",{style:{textAlign:"center"},children:[i.jsx("h2",{style:{fontSize:"1.25rem",fontWeight:"600",color:"#111827",marginBottom:"1rem"},children:"沒有找到預訂資料"}),i.jsx("button",{onClick:()=>e.push("/search"),style:{padding:"0.75rem 1.5rem",backgroundColor:"#FF5A5F",color:"white",borderRadius:"0.5rem",border:"none",cursor:"pointer",fontWeight:"500"},children:"回到搜尋"})]})})}},4792:(e,r,t)=>{"use strict";t.d(r,{L6:()=>l,d8:()=>s,us:()=>a});var i=t(95344),o=t(22254),n=t(71532);function s({showBackButton:e=!1,backButtonText:r="返回",showHomeButton:t=!0,homeButtonText:s="回到首頁",customBackAction:a}){let l=(0,o.useRouter)();return(0,i.jsxs)(i.Fragment,{children:[t&&i.jsx("div",{style:{position:"absolute",top:"1rem",left:"1rem",zIndex:50},className:"sm:top-8 sm:left-8",children:(0,i.jsxs)("button",{onClick:()=>{l.push("/")},style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0.75rem",backgroundColor:"rgba(255, 255, 255, 0.9)",backdropFilter:"blur(10px)",borderRadius:"0.5rem",border:"1px solid rgba(255, 255, 255, 0.3)",cursor:"pointer",transition:"all 0.2s",fontSize:"0.75rem",fontWeight:"500",color:"#374151",boxShadow:"0 1px 3px 0 rgba(0, 0, 0, 0.1)"},className:"hover:bg-white hover:shadow-md sm:text-sm sm:px-4 sm:py-3",children:[(0,i.jsxs)("span",{className:"hidden sm:inline",children:["← ",s]}),i.jsx("span",{className:"sm:hidden",children:"← 首頁"})]})}),e&&i.jsx("div",{style:{maxWidth:"1200px",margin:"0 auto",padding:"1rem 1.5rem",paddingTop:t?"4rem":"1rem"},children:(0,i.jsxs)("button",{onClick:()=>{a?a():l.back()},style:{display:"flex",alignItems:"center",gap:"0.5rem",color:"#6b7280",background:"none",border:"none",cursor:"pointer",fontSize:"0.875rem",transition:"color 0.2s",padding:"0.5rem 0"},className:"hover:text-gray-900",children:[i.jsx(n.Z,{style:{width:"1.25rem",height:"1.25rem"}}),i.jsx("span",{children:r})]})})]})}function a({text:e="回到首頁"}){return i.jsx(s,{showHomeButton:!0,homeButtonText:e,showBackButton:!1})}function l({backButtonText:e="返回",homeButtonText:r="回到首頁",customBackAction:t}){return i.jsx(s,{showHomeButton:!0,showBackButton:!0,backButtonText:e,homeButtonText:r,customBackAction:t})}},58378:(e,r,t)=>{"use strict";t.d(r,{gb:()=>n});var i=t(95344);t(3729);var o=t(11453);function n({size:e="md",variant:r="spinner",className:t,text:n}){let s={sm:"w-4 h-4",md:"w-6 h-6",lg:"w-8 h-8"},a={sm:"text-sm",md:"text-base",lg:"text-lg"};return"spinner"===r?(0,i.jsxs)("div",{className:(0,o.cn)("flex flex-col items-center justify-center",t),children:[i.jsx("div",{className:(0,o.cn)("animate-spin rounded-full border-2 border-gray-300 border-t-[#FF5A5F]",s[e])}),n&&i.jsx("p",{className:(0,o.cn)("mt-2 text-gray-600",a[e]),children:n})]}):"dots"===r?(0,i.jsxs)("div",{className:(0,o.cn)("flex flex-col items-center justify-center",t),children:[i.jsx("div",{className:"flex space-x-1",children:[0,1,2].map(r=>i.jsx("div",{className:(0,o.cn)("bg-[#FF5A5F] rounded-full animate-pulse","sm"===e?"w-2 h-2":"md"===e?"w-3 h-3":"w-4 h-4"),style:{animationDelay:`${.2*r}s`,animationDuration:"1.2s"}},r))}),n&&i.jsx("p",{className:(0,o.cn)("mt-2 text-gray-600",a[e]),children:n})]}):"pulse"===r?(0,i.jsxs)("div",{className:(0,o.cn)("flex flex-col items-center justify-center",t),children:[i.jsx("div",{className:(0,o.cn)("bg-[#FF5A5F] rounded-full animate-pulse",s[e])}),n&&i.jsx("p",{className:(0,o.cn)("mt-2 text-gray-600",a[e]),children:n})]}):null}},30149:(e,r,t)=>{"use strict";t.d(r,{v:()=>n});var i=t(43158),o=t(2582);let n=(0,i.Ue)((e,r)=>({currentBooking:null,bookingStep:"details",bookings:[],isLoading:!1,error:null,paymentIntent:null,isProcessingPayment:!1,initializeBooking:(r,t)=>{e({currentBooking:{serviceId:r,guideId:t,guests:2},bookingStep:"details",error:null})},updateBookingDetails:r=>{e(e=>({currentBooking:e.currentBooking?{...e.currentBooking,...r}:r}))},setBookingStep:r=>{e({bookingStep:r})},createBooking:async()=>{let{currentBooking:t}=r();if(!t)throw Error("沒有預訂資料");let{token:i}=o.a.getState();if(!i)throw Error("請先登入");e({isLoading:!0,error:null});try{let r=await fetch("/api/bookings",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify(t)});if(!r.ok)throw Error("建立預訂失敗");let o=await r.json();return e({paymentIntent:o.paymentIntent,bookingStep:"payment",isLoading:!1}),o.bookingId}catch(r){throw e({error:r instanceof Error?r.message:"建立預訂時發生錯誤",isLoading:!1}),r}},processPayment:async(r,t)=>{let{token:i}=o.a.getState();if(!i)throw Error("請先登入");e({isProcessingPayment:!0,error:null});try{let o=await fetch("/api/bookings/payment",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify({bookingId:r,paymentMethodId:t})});if(!o.ok)throw Error("支付處理失敗");let n=await o.json();if("succeeded"===n.status)e({bookingStep:"confirmation",isProcessingPayment:!1});else throw Error("支付未成功")}catch(r){throw e({error:r instanceof Error?r.message:"支付處理時發生錯誤",isProcessingPayment:!1}),r}},confirmBooking:async t=>{let{token:i}=o.a.getState();if(!i)throw Error("請先登入");e({isLoading:!0,error:null});try{if(!(await fetch(`/api/bookings/${t}/confirm`,{method:"POST",headers:{Authorization:`Bearer ${i}`}})).ok)throw Error("確認預訂失敗");await r().fetchBookings(),e({isLoading:!1})}catch(r){throw e({error:r instanceof Error?r.message:"確認預訂時發生錯誤",isLoading:!1}),r}},cancelBooking:async(t,i)=>{let{token:n}=o.a.getState();if(!n)throw Error("請先登入");e({isLoading:!0,error:null});try{if(!(await fetch(`/api/bookings/${t}/cancel`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({reason:i})})).ok)throw Error("取消預訂失敗");await r().fetchBookings(),e({isLoading:!1})}catch(r){throw e({error:r instanceof Error?r.message:"取消預訂時發生錯誤",isLoading:!1}),r}},fetchBookings:async()=>{let{token:r}=o.a.getState();if(!r)throw Error("請先登入");e({isLoading:!0,error:null});try{let t=await fetch("/api/bookings",{headers:{Authorization:`Bearer ${r}`}});if(!t.ok)throw Error("獲取預訂列表失敗");let i=await t.json();e({bookings:i.bookings,isLoading:!1})}catch(r){e({error:r instanceof Error?r.message:"獲取預訂列表時發生錯誤",isLoading:!1})}},submitReview:async(t,i,n)=>{let{token:s}=o.a.getState();if(!s)throw Error("請先登入");e({isLoading:!0,error:null});try{if(!(await fetch(`/api/bookings/${t}/review`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({rating:i,comment:n})})).ok)throw Error("提交評價失敗");await r().fetchBookings(),e({isLoading:!1})}catch(r){throw e({error:r instanceof Error?r.message:"提交評價時發生錯誤",isLoading:!1}),r}},clearCurrentBooking:()=>{e({currentBooking:null,bookingStep:"details",paymentIntent:null,error:null})},setError:r=>{e({error:r})}}))},49725:(e,r,t)=>{"use strict";t.r(r),t.d(r,{$$typeof:()=>n,__esModule:()=>o,default:()=>s});let i=(0,t(86843).createProxy)(String.raw`/Users/zoechang/projects/Guidee/src/app/(main)/booking/page.tsx`),{__esModule:o,$$typeof:n}=i,s=i.default}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),i=r.X(0,[1216,8039,4757,8290],()=>t(80117));module.exports=i})();