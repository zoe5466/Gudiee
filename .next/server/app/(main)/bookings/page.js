(()=>{var e={};e.id=1752,e.ids=[1752],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},45262:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>g,originalPathname:()=>m,pages:()=>d,routeModule:()=>x,tree:()=>c});var r=s(50482),a=s(69108),n=s(62563),i=s.n(n),o=s(68300),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);s.d(t,l);let c=["",{children:["(main)",{children:["bookings",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,68750)),"/Users/zoechang/projects/Guidee/src/app/(main)/bookings/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,11808)),"/Users/zoechang/projects/Guidee/src/app/(main)/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,69361,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,98890)),"/Users/zoechang/projects/Guidee/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,69361,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/zoechang/projects/Guidee/src/app/(main)/bookings/page.tsx"],m="/(main)/bookings/page",g={require:s,loadChunk:()=>Promise.resolve()},x=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/(main)/bookings/page",pathname:"/bookings",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},88897:(e,t,s)=>{Promise.resolve().then(s.bind(s,24991))},24991:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>b});var r=s(95344),a=s(3729),n=s(22254),i=s(17418),o=s(25390),l=s(55794),c=s(25545),d=s(89895),m=s(80508),g=s(35851),x=s(76755),u=s(2582),h=s(30149),p=s(72032),f=s(58378);function b(){let e=(0,n.useRouter)(),{user:t,isAuthenticated:s}=(0,u.a)(),{bookings:b,isLoading:y,error:j,fetchBookings:w,cancelBooking:N}=(0,h.v)(),{success:v,error:k}=(0,p.pm)(),[E,P]=(0,a.useState)("all"),[S,C]=(0,a.useState)("newest"),[F,L]=(0,a.useState)(!1);(0,a.useEffect)(()=>{if(!s){e.push("/login");return}w()},[s,w,e]),(0,a.useEffect)(()=>{j&&k("載入失敗",j)},[j,k]);let A=b.filter(e=>"all"===E||e.status===E).sort((e,t)=>{switch(S){case"oldest":return new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime();case"status":return e.status.localeCompare(t.status);case"date":return new Date(e.details.date).getTime()-new Date(t.details.date).getTime();default:return new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()}}),B=async e=>{if(confirm("確定要取消這個預訂嗎？"))try{await N(e,"用戶主動取消"),v("取消成功","預訂已成功取消")}catch(e){k("取消失敗","無法取消預訂，請聯繫客服")}},D=e=>({PENDING:"待確認",CONFIRMED:"已確認",COMPLETED:"已完成",CANCELLED:"已取消",REFUNDED:"已退款"})[e]||e,T=e=>({PENDING:"bg-yellow-100 text-yellow-800",CONFIRMED:"bg-blue-100 text-blue-800",COMPLETED:"bg-green-100 text-green-800",CANCELLED:"bg-red-100 text-red-800",REFUNDED:"bg-gray-100 text-gray-800"})[e]||"bg-gray-100 text-gray-800";return y?r.jsx("div",{className:"min-h-screen bg-gray-50",children:r.jsx("div",{className:"container py-8",children:r.jsx("div",{className:"flex justify-center items-center py-20",children:r.jsx(f.gb,{size:"lg"})})})}):r.jsx("div",{className:"min-h-screen bg-gray-50",children:(0,r.jsxs)("div",{className:"container py-8",children:[(0,r.jsxs)("div",{className:"mb-8",children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"我的預訂"}),r.jsx("p",{className:"text-gray-600",children:"管理您的所有旅遊預訂"})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsxs)("button",{onClick:()=>L(!F),className:"flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-lg hover:border-[#FF5A5F] transition-colors",children:[r.jsx(i.Z,{className:"w-4 h-4"}),"篩選",r.jsx(o.Z,{className:`w-4 h-4 transition-transform ${F?"rotate-180":""}`})]}),(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:["共 ",A.length," 個預訂"]})]}),r.jsx("div",{className:"flex items-center gap-4",children:(0,r.jsxs)("select",{value:S,onChange:e=>C(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-[#FF5A5F] focus:border-[#FF5A5F]",children:[r.jsx("option",{value:"newest",children:"最新的在前"}),r.jsx("option",{value:"oldest",children:"最舊的在前"}),r.jsx("option",{value:"date",children:"按服務日期"}),r.jsx("option",{value:"status",children:"按狀態"})]})})]}),F&&r.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:(0,r.jsxs)("div",{className:"flex flex-wrap gap-2",children:[r.jsx("h3",{className:"text-sm font-medium text-gray-700 w-full mb-2",children:"狀態篩選："}),["all","pending","confirmed","completed","cancelled"].map(e=>r.jsx("button",{onClick:()=>P(e),className:`px-3 py-1 rounded-full text-sm transition-colors ${E===e?"bg-[#FF5A5F] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"all"===e?"全部":D(e)},e))]})})]}),A.length>0?r.jsx("div",{className:"space-y-4",children:A.map(t=>r.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow",children:(0,r.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-4",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"台北文化導覽服務"}),r.jsx("span",{className:`inline-block px-2 py-1 rounded-full text-xs font-medium ${T(t.status)}`,children:D(t.status)})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsxs)("div",{className:"text-xl font-bold text-gray-900",children:["NT$ ",t.pricing.total.toLocaleString()]}),(0,r.jsxs)("div",{className:"text-sm text-gray-500",children:["預訂編號：",t.id.slice(-6)]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm text-gray-600",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx(l.Z,{className:"w-4 h-4"}),r.jsx("span",{children:new Date(t.details.date).toLocaleDateString("zh-TW")})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx(c.Z,{className:"w-4 h-4"}),(0,r.jsxs)("span",{children:[t.details.duration," 小時"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx(d.Z,{className:"w-4 h-4"}),(0,r.jsxs)("span",{children:[t.details.guests," 位旅客"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx(m.Z,{className:"w-4 h-4"}),r.jsx("span",{children:"台北市"})]})]}),t.details.specialRequests&&r.jsx("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg",children:(0,r.jsxs)("p",{className:"text-sm text-gray-700",children:[r.jsx("strong",{children:"特殊需求："})," ",t.details.specialRequests]})})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-2 lg:min-w-[200px]",children:["pending"===t.status&&r.jsx("button",{onClick:()=>B(t.id),className:"btn btn-secondary btn-sm w-full",children:"取消預訂"}),"confirmed"===t.status&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("button",{onClick:()=>e.push(`/messages?guide=${t.guideId}`),className:"btn btn-primary btn-sm w-full flex items-center justify-center gap-2",children:[r.jsx(g.Z,{className:"w-4 h-4"}),"聯繫地陪"]}),r.jsx("button",{onClick:()=>B(t.id),className:"btn btn-secondary btn-sm w-full",children:"取消預訂"})]}),"completed"===t.status&&!t.review&&(0,r.jsxs)("button",{onClick:()=>e.push(`/bookings/${t.id}/review`),className:"btn btn-primary btn-sm w-full flex items-center justify-center gap-2",children:[r.jsx(x.Z,{className:"w-4 h-4"}),"撰寫評價"]}),t.review&&(0,r.jsxs)("div",{className:"text-center p-2 bg-green-50 rounded-lg",children:[(0,r.jsxs)("div",{className:"flex items-center justify-center gap-1 mb-1",children:[r.jsx(x.Z,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"}),r.jsx("span",{className:"text-sm font-medium",children:t.review.rating})]}),r.jsx("p",{className:"text-xs text-gray-600",children:"已評價"})]}),r.jsx("button",{onClick:()=>e.push(`/bookings/${t.id}`),className:"btn btn-ghost btn-sm w-full",children:"查看詳情"})]})]})},t.id))}):(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center",children:[r.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:r.jsx(l.Z,{className:"w-10 h-10 text-gray-400"})}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"all"===E?"還沒有任何預訂":`沒有${D(E)}的預訂`}),r.jsx("p",{className:"text-gray-600 mb-6",children:"all"===E?"開始探索精彩的旅遊體驗吧！":"試試調整篩選條件或建立新的預訂"}),"all"===E?r.jsx("button",{onClick:()=>e.push("/search"),className:"btn btn-primary",children:"探索服務"}):r.jsx("button",{onClick:()=>P("all"),className:"btn btn-secondary",children:"查看所有預訂"})]})]})})}},58378:(e,t,s)=>{"use strict";s.d(t,{gb:()=>n});var r=s(95344);s(3729);var a=s(11453);function n({size:e="md",variant:t="spinner",className:s,text:n}){let i={sm:"w-4 h-4",md:"w-6 h-6",lg:"w-8 h-8"},o={sm:"text-sm",md:"text-base",lg:"text-lg"};return"spinner"===t?(0,r.jsxs)("div",{className:(0,a.cn)("flex flex-col items-center justify-center",s),children:[r.jsx("div",{className:(0,a.cn)("animate-spin rounded-full border-2 border-gray-300 border-t-[#FF5A5F]",i[e])}),n&&r.jsx("p",{className:(0,a.cn)("mt-2 text-gray-600",o[e]),children:n})]}):"dots"===t?(0,r.jsxs)("div",{className:(0,a.cn)("flex flex-col items-center justify-center",s),children:[r.jsx("div",{className:"flex space-x-1",children:[0,1,2].map(t=>r.jsx("div",{className:(0,a.cn)("bg-[#FF5A5F] rounded-full animate-pulse","sm"===e?"w-2 h-2":"md"===e?"w-3 h-3":"w-4 h-4"),style:{animationDelay:`${.2*t}s`,animationDuration:"1.2s"}},t))}),n&&r.jsx("p",{className:(0,a.cn)("mt-2 text-gray-600",o[e]),children:n})]}):"pulse"===t?(0,r.jsxs)("div",{className:(0,a.cn)("flex flex-col items-center justify-center",s),children:[r.jsx("div",{className:(0,a.cn)("bg-[#FF5A5F] rounded-full animate-pulse",i[e])}),n&&r.jsx("p",{className:(0,a.cn)("mt-2 text-gray-600",o[e]),children:n})]}):null}},72032:(e,t,s)=>{"use strict";s.d(t,{pm:()=>l}),s(95344);var r=s(3729),a=s(7060),n=s(66138),i=s(45961),o=s(91991);function l(){let[e,t]=(0,r.useState)([]),s=e=>{let s=Math.random().toString(36).substr(2,9),r={id:s,duration:5e3,...e};return t(e=>[...e,r]),s};return{toasts:e,addToast:s,removeToast:e=>{t(t=>t.filter(t=>t.id!==e))},success:(e,t)=>s({type:"success",title:e,message:t}),error:(e,t)=>s({type:"error",title:e,message:t}),warning:(e,t)=>s({type:"warning",title:e,message:t}),info:(e,t)=>s({type:"info",title:e,message:t})}}a.Z,n.Z,i.Z,o.Z},30149:(e,t,s)=>{"use strict";s.d(t,{v:()=>n});var r=s(43158),a=s(2582);let n=(0,r.Ue)((e,t)=>({currentBooking:null,bookingStep:"details",bookings:[],isLoading:!1,error:null,paymentIntent:null,isProcessingPayment:!1,initializeBooking:(t,s)=>{e({currentBooking:{serviceId:t,guideId:s,guests:2},bookingStep:"details",error:null})},updateBookingDetails:t=>{e(e=>({currentBooking:e.currentBooking?{...e.currentBooking,...t}:t}))},setBookingStep:t=>{e({bookingStep:t})},createBooking:async()=>{let{currentBooking:s}=t();if(!s)throw Error("沒有預訂資料");let{token:r}=a.a.getState();if(!r)throw Error("請先登入");e({isLoading:!0,error:null});try{let t=await fetch("/api/bookings",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(s)});if(!t.ok)throw Error("建立預訂失敗");let a=await t.json();return e({paymentIntent:a.paymentIntent,bookingStep:"payment",isLoading:!1}),a.bookingId}catch(t){throw e({error:t instanceof Error?t.message:"建立預訂時發生錯誤",isLoading:!1}),t}},processPayment:async(t,s)=>{let{token:r}=a.a.getState();if(!r)throw Error("請先登入");e({isProcessingPayment:!0,error:null});try{let a=await fetch("/api/bookings/payment",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({bookingId:t,paymentMethodId:s})});if(!a.ok)throw Error("支付處理失敗");let n=await a.json();if("succeeded"===n.status)e({bookingStep:"confirmation",isProcessingPayment:!1});else throw Error("支付未成功")}catch(t){throw e({error:t instanceof Error?t.message:"支付處理時發生錯誤",isProcessingPayment:!1}),t}},confirmBooking:async s=>{let{token:r}=a.a.getState();if(!r)throw Error("請先登入");e({isLoading:!0,error:null});try{if(!(await fetch(`/api/bookings/${s}/confirm`,{method:"POST",headers:{Authorization:`Bearer ${r}`}})).ok)throw Error("確認預訂失敗");await t().fetchBookings(),e({isLoading:!1})}catch(t){throw e({error:t instanceof Error?t.message:"確認預訂時發生錯誤",isLoading:!1}),t}},cancelBooking:async(s,r)=>{let{token:n}=a.a.getState();if(!n)throw Error("請先登入");e({isLoading:!0,error:null});try{if(!(await fetch(`/api/bookings/${s}/cancel`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({reason:r})})).ok)throw Error("取消預訂失敗");await t().fetchBookings(),e({isLoading:!1})}catch(t){throw e({error:t instanceof Error?t.message:"取消預訂時發生錯誤",isLoading:!1}),t}},fetchBookings:async()=>{let{token:t}=a.a.getState();if(!t)throw Error("請先登入");e({isLoading:!0,error:null});try{let s=await fetch("/api/bookings",{headers:{Authorization:`Bearer ${t}`}});if(!s.ok)throw Error("獲取預訂列表失敗");let r=await s.json();e({bookings:r.bookings,isLoading:!1})}catch(t){e({error:t instanceof Error?t.message:"獲取預訂列表時發生錯誤",isLoading:!1})}},submitReview:async(s,r,n)=>{let{token:i}=a.a.getState();if(!i)throw Error("請先登入");e({isLoading:!0,error:null});try{if(!(await fetch(`/api/bookings/${s}/review`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify({rating:r,comment:n})})).ok)throw Error("提交評價失敗");await t().fetchBookings(),e({isLoading:!1})}catch(t){throw e({error:t instanceof Error?t.message:"提交評價時發生錯誤",isLoading:!1}),t}},clearCurrentBooking:()=>{e({currentBooking:null,bookingStep:"details",paymentIntent:null,error:null})},setError:t=>{e({error:t})}}))},68750:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>n,__esModule:()=>a,default:()=>i});let r=(0,s(86843).createProxy)(String.raw`/Users/zoechang/projects/Guidee/src/app/(main)/bookings/page.tsx`),{__esModule:a,$$typeof:n}=r,i=r.default}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[1216,8039,4757,8290],()=>s(45262));module.exports=r})();