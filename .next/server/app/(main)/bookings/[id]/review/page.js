(()=>{var e={};e.id=3471,e.ids=[3471],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},75490:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>g,pages:()=>d,routeModule:()=>x,tree:()=>c});var s=r(50482),a=r(69108),i=r(62563),n=r.n(i),o=r(68300),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);r.d(t,l);let c=["",{children:["(main)",{children:["bookings",{children:["[id]",{children:["review",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,48019)),"/Users/zoechang/projects/Guidee/src/app/(main)/bookings/[id]/review/page.tsx"]}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,11808)),"/Users/zoechang/projects/Guidee/src/app/(main)/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,69361,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,98890)),"/Users/zoechang/projects/Guidee/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,69361,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/zoechang/projects/Guidee/src/app/(main)/bookings/[id]/review/page.tsx"],g="/(main)/bookings/[id]/review/page",m={require:r,loadChunk:()=>Promise.resolve()},x=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/(main)/bookings/[id]/review/page",pathname:"/bookings/[id]/review",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},3346:(e,t,r)=>{Promise.resolve().then(r.bind(r,66119))},66119:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>p});var s=r(95344),a=r(3729),i=r(22254),n=r(63024),o=r(14513),l=r(76755),c=r(51838),d=r(18452),g=r(3380),m=r(2582);function x({bookingId:e,serviceId:t,serviceName:r,guideName:i,guideId:n,onSubmit:x,onCancel:u,onClose:h,isLoading:p=!1,className:b=""}){let{user:y}=(0,m.a)(),[f,j]=(0,a.useState)(0),[v,N]=(0,a.useState)(0),[w,k]=(0,a.useState)(""),[S,P]=(0,a.useState)([]),[C,E]=(0,a.useState)([""]),[L,B]=(0,a.useState)([""]),[I,$]=(0,a.useState)(!1),[_,T]=(0,a.useState)([]),[z,A]=(0,a.useState)(!1),O=(0,a.useRef)(null),q=e=>{P(t=>t.filter((t,r)=>r!==e))},Z=e=>{"pros"===e?E(e=>[...e,""]):B(e=>[...e,""])},U=(e,t)=>{"pros"===e?E(e=>e.filter((e,r)=>r!==t)):B(e=>e.filter((e,r)=>r!==t))},G=(e,t,r)=>{"pros"===e?E(e=>e.map((e,s)=>s===t?r:e)):B(e=>e.map((e,s)=>s===t?r:e))},R=e=>{T(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},M=async r=>{if(r.preventDefault(),!y){alert("請先登入");return}if(0===f){alert("請選擇評分");return}if(w.trim().length<10){alert("評論內容至少需要 10 個字符");return}A(!0);try{await x({serviceId:t,guideId:n,userId:y.id,bookingId:e,rating:f,comment:w.trim(),photos:S.map(e=>URL.createObjectURL(e)),pros:C.filter(e=>e.trim()).length>0?C.filter(e=>e.trim()):void 0,cons:L.filter(e=>e.trim()).length>0?L.filter(e=>e.trim()):void 0,isVerified:!0,isAnonymous:I,helpful:0,reported:0,tags:_.length>0?_:void 0}),alert("評論提交成功！感謝您的寶貴意見！"),h?.()}catch(e){alert("提交失敗，請稍後再試")}finally{A(!1)}},D=f>0&&w.trim().length>=10&&!z;return(0,s.jsxs)("div",{className:`bg-white rounded-lg shadow-lg border p-6 ${b}`,children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"撰寫評論"}),h&&s.jsx("button",{onClick:h,className:"p-1 text-gray-400 hover:text-gray-600 rounded-full hover:bg-gray-100",children:s.jsx(o.Z,{className:"w-5 h-5"})})]}),(0,s.jsxs)("form",{onSubmit:M,className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:["整體評分 ",s.jsx("span",{className:"text-red-500",children:"*"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[[1,2,3,4,5].map(e=>s.jsx("button",{type:"button",onMouseEnter:()=>N(e),onMouseLeave:()=>N(0),onClick:()=>j(e),className:"p-1 transition-transform hover:scale-110",children:s.jsx(l.Z,{className:`w-8 h-8 ${e<=(v||f)?"text-yellow-400 fill-yellow-400":"text-gray-300"}`})},e)),s.jsx("span",{className:"ml-3 text-sm text-gray-600",children:f>0&&(0,s.jsxs)(s.Fragment,{children:[f," 星 - ",5===f?"極好":4===f?"很好":3===f?"一般":2===f?"不好":"很差"]})})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["詳細評論 ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("textarea",{value:w,onChange:e=>k(e.target.value),placeholder:"請分享您的體驗，幫助其他旅客了解這項服務...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:4,minLength:10,maxLength:1e3}),(0,s.jsxs)("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[s.jsx("span",{children:"最少 10 個字符"}),(0,s.jsxs)("span",{children:[w.length,"/1000"]})]})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"服務特色標籤"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:["專業","準時","親切","知識豐富","溝通良好","行程豐富","價格合理","服務周到","安全可靠","幽默風趣","攝影技術好","語言能力強"].map(e=>s.jsx("button",{type:"button",onClick:()=>R(e),className:`px-3 py-1 rounded-full text-sm border transition-colors ${_.includes(e)?"bg-blue-100 border-blue-300 text-blue-700":"bg-gray-50 border-gray-200 text-gray-700 hover:bg-gray-100"}`,children:e},e))})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"服務優點"}),(0,s.jsxs)("button",{type:"button",onClick:()=>Z("pros"),className:"flex items-center gap-1 text-sm text-blue-600 hover:text-blue-800",children:[s.jsx(c.Z,{className:"w-4 h-4"}),"新增"]})]}),s.jsx("div",{className:"space-y-2",children:C.map((e,t)=>(0,s.jsxs)("div",{className:"flex gap-2",children:[s.jsx("input",{type:"text",value:e,onChange:e=>G("pros",t,e.target.value),placeholder:"例如：導遊很專業",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),C.length>1&&s.jsx("button",{type:"button",onClick:()=>U("pros",t),className:"p-2 text-gray-400 hover:text-red-600",children:s.jsx(d.Z,{className:"w-4 h-4"})})]},t))})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"改進建議"}),(0,s.jsxs)("button",{type:"button",onClick:()=>Z("cons"),className:"flex items-center gap-1 text-sm text-blue-600 hover:text-blue-800",children:[s.jsx(c.Z,{className:"w-4 h-4"}),"新增"]})]}),s.jsx("div",{className:"space-y-2",children:L.map((e,t)=>(0,s.jsxs)("div",{className:"flex gap-2",children:[s.jsx("input",{type:"text",value:e,onChange:e=>G("cons",t,e.target.value),placeholder:"例如：時間安排可以更彈性",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),L.length>1&&s.jsx("button",{type:"button",onClick:()=>U("cons",t),className:"p-2 text-gray-400 hover:text-red-600",children:s.jsx(d.Z,{className:"w-4 h-4"})})]},t))})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"上傳照片 (最多 5 張)"}),(0,s.jsxs)("div",{className:"space-y-3",children:[S.length>0&&s.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-3",children:S.map((e,t)=>(0,s.jsxs)("div",{className:"relative group",children:[s.jsx("img",{src:URL.createObjectURL(e),alt:`評論照片 ${t+1}`,className:"w-full h-20 object-cover rounded-lg border"}),s.jsx("button",{type:"button",onClick:()=>q(t),className:"absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:s.jsx(o.Z,{className:"w-3 h-3"})})]},t))}),S.length<5&&(0,s.jsxs)("button",{type:"button",onClick:()=>O.current?.click(),className:"w-full border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-400 hover:bg-blue-50 transition-colors",children:[s.jsx(g.Z,{className:"w-6 h-6 mx-auto mb-2 text-gray-400"}),(0,s.jsxs)("span",{className:"text-sm text-gray-600",children:["點擊上傳照片 (",S.length,"/5)"]})]}),s.jsx("input",{ref:O,type:"file",multiple:!0,accept:"image/*",onChange:e=>{let t=Array.from(e.target.files||[]).filter(e=>e.type.startsWith("image/"));if(t.length+S.length>5){alert("最多只能上傳 5 張照片");return}P(e=>[...e,...t])},className:"hidden"})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[s.jsx("input",{type:"checkbox",id:"anonymous",checked:I,onChange:e=>$(e.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),s.jsx("label",{htmlFor:"anonymous",className:"text-sm text-gray-700",children:"匿名發布評論"})]}),(0,s.jsxs)("div",{className:"flex gap-3 pt-4 border-t",children:[h&&s.jsx("button",{type:"button",onClick:h,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors",children:"取消"}),s.jsx("button",{type:"submit",disabled:!D,className:`flex-1 px-4 py-2 rounded-md font-medium transition-colors ${D?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:z?"提交中...":"發布評論"})]})]})]})}var u=r(47913),h=r(30149);function p(){let e=(0,i.useRouter)(),t=(0,i.useParams)(),{user:r}=(0,m.a)(),{bookings:o}=(0,h.v)(),l=t.id,[c,d]=(0,a.useState)(!0),g=o.find(e=>e.id===l)||{id:l,serviceId:"service-1",guideId:"guide-1",status:"completed",details:{serviceId:"service-1",guideId:"guide-1",date:new Date("2024-01-15"),time:"09:00",guests:2,duration:4,contactInfo:{name:"張小明",email:"ming@example.com",phone:"0912345678"}},pricing:{basePrice:2e3,serviceFee:200,total:2200,currency:"TWD"},payment:{method:"credit_card",status:"completed"},createdAt:"2024-01-10T10:00:00Z",updatedAt:"2024-01-15T14:00:00Z",travelerId:r?.id||"user-1"};return r?s.jsx("div",{className:"min-h-screen bg-gray-50",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4 mb-8",children:[s.jsx("button",{onClick:()=>e.back(),className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-full",children:s.jsx(n.Z,{className:"w-5 h-5"})}),(0,s.jsxs)("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"撰寫評論"}),s.jsx("p",{className:"text-gray-600",children:"分享您的體驗，幫助其他旅客"})]})]}),s.jsx("div",{className:"bg-white rounded-lg border p-6 mb-8",children:(0,s.jsxs)("div",{className:"flex items-start gap-4",children:[s.jsx("div",{className:"w-20 h-20 bg-gray-200 rounded-lg flex items-center justify-center",children:s.jsx("span",{className:"text-gray-500 text-sm",children:"服務圖片"})}),(0,s.jsxs)("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"台北市區導覽服務"}),(0,s.jsxs)("div",{className:"space-y-1 text-sm text-gray-600",children:[(0,s.jsxs)("p",{children:["預訂編號：",g.id]}),(0,s.jsxs)("p",{children:["服務日期：",g.details.date.toLocaleDateString("zh-TW")]}),(0,s.jsxs)("p",{children:["服務時間：",g.details.time]}),(0,s.jsxs)("p",{children:["參與人數：",g.details.guests," 人"]}),(0,s.jsxs)("p",{children:["服務時長：",g.details.duration," 小時"]})]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsxs)("div",{className:"text-lg font-bold text-gray-900",children:["NT$ ",g.pricing.total.toLocaleString()]}),(0,s.jsxs)("div",{className:"text-sm text-green-600 flex items-center gap-1",children:[s.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),"已完成"]})]})]})}),c&&s.jsx("div",{className:"mb-8",children:s.jsx(x,{serviceId:g.serviceId,guideId:g.guideId,bookingId:g.id,onClose:()=>{d(!1)}})}),!c&&(0,s.jsxs)("div",{className:"bg-white rounded-lg border p-6",children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"其他用戶的評價"}),s.jsx(u.j,{targetId:g.serviceId,targetType:"service",showTitle:!1,showStatistics:!1,maxItems:5}),s.jsx("div",{className:"mt-6 pt-6 border-t text-center",children:s.jsx("button",{onClick:()=>e.push(`/services/${g.serviceId}#reviews`),className:"text-blue-600 hover:text-blue-800 font-medium",children:"查看所有評論"})})]}),(0,s.jsxs)("div",{className:"flex gap-4 mt-8",children:[s.jsx("button",{onClick:()=>e.push("/bookings"),className:"flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"返回預訂列表"}),!c&&s.jsx("button",{onClick:()=>d(!0),className:"flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"重新撰寫評論"})]})]})}):s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"請先登入"}),s.jsx("button",{onClick:()=>e.push("/auth/login"),className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"前往登入"})]})})}},30149:(e,t,r)=>{"use strict";r.d(t,{v:()=>i});var s=r(43158),a=r(2582);let i=(0,s.Ue)((e,t)=>({currentBooking:null,bookingStep:"details",bookings:[],isLoading:!1,error:null,paymentIntent:null,isProcessingPayment:!1,initializeBooking:(t,r)=>{e({currentBooking:{serviceId:t,guideId:r,guests:2},bookingStep:"details",error:null})},updateBookingDetails:t=>{e(e=>({currentBooking:e.currentBooking?{...e.currentBooking,...t}:t}))},setBookingStep:t=>{e({bookingStep:t})},createBooking:async()=>{let{currentBooking:r}=t();if(!r)throw Error("沒有預訂資料");let{token:s}=a.a.getState();if(!s)throw Error("請先登入");e({isLoading:!0,error:null});try{let t=await fetch("/api/bookings",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify(r)});if(!t.ok)throw Error("建立預訂失敗");let a=await t.json();return e({paymentIntent:a.paymentIntent,bookingStep:"payment",isLoading:!1}),a.bookingId}catch(t){throw e({error:t instanceof Error?t.message:"建立預訂時發生錯誤",isLoading:!1}),t}},processPayment:async(t,r)=>{let{token:s}=a.a.getState();if(!s)throw Error("請先登入");e({isProcessingPayment:!0,error:null});try{let a=await fetch("/api/bookings/payment",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({bookingId:t,paymentMethodId:r})});if(!a.ok)throw Error("支付處理失敗");let i=await a.json();if("succeeded"===i.status)e({bookingStep:"confirmation",isProcessingPayment:!1});else throw Error("支付未成功")}catch(t){throw e({error:t instanceof Error?t.message:"支付處理時發生錯誤",isProcessingPayment:!1}),t}},confirmBooking:async r=>{let{token:s}=a.a.getState();if(!s)throw Error("請先登入");e({isLoading:!0,error:null});try{if(!(await fetch(`/api/bookings/${r}/confirm`,{method:"POST",headers:{Authorization:`Bearer ${s}`}})).ok)throw Error("確認預訂失敗");await t().fetchBookings(),e({isLoading:!1})}catch(t){throw e({error:t instanceof Error?t.message:"確認預訂時發生錯誤",isLoading:!1}),t}},cancelBooking:async(r,s)=>{let{token:i}=a.a.getState();if(!i)throw Error("請先登入");e({isLoading:!0,error:null});try{if(!(await fetch(`/api/bookings/${r}/cancel`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify({reason:s})})).ok)throw Error("取消預訂失敗");await t().fetchBookings(),e({isLoading:!1})}catch(t){throw e({error:t instanceof Error?t.message:"取消預訂時發生錯誤",isLoading:!1}),t}},fetchBookings:async()=>{let{token:t}=a.a.getState();if(!t)throw Error("請先登入");e({isLoading:!0,error:null});try{let r=await fetch("/api/bookings",{headers:{Authorization:`Bearer ${t}`}});if(!r.ok)throw Error("獲取預訂列表失敗");let s=await r.json();e({bookings:s.bookings,isLoading:!1})}catch(t){e({error:t instanceof Error?t.message:"獲取預訂列表時發生錯誤",isLoading:!1})}},submitReview:async(r,s,i)=>{let{token:n}=a.a.getState();if(!n)throw Error("請先登入");e({isLoading:!0,error:null});try{if(!(await fetch(`/api/bookings/${r}/review`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({rating:s,comment:i})})).ok)throw Error("提交評價失敗");await t().fetchBookings(),e({isLoading:!1})}catch(t){throw e({error:t instanceof Error?t.message:"提交評價時發生錯誤",isLoading:!1}),t}},clearCurrentBooking:()=>{e({currentBooking:null,bookingStep:"details",paymentIntent:null,error:null})},setError:t=>{e({error:t})}}))},48019:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$$typeof:()=>i,__esModule:()=>a,default:()=>n});let s=(0,r(86843).createProxy)(String.raw`/Users/zoechang/projects/Guidee/src/app/(main)/bookings/[id]/review/page.tsx`),{__esModule:a,$$typeof:i}=s,n=s.default}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[1216,8039,4757,8290,7913],()=>r(75490));module.exports=s})();