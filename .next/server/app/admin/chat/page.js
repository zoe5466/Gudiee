(()=>{var e={};e.id=3425,e.ids=[3425],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},80995:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>i.a,__next_app__:()=>o,originalPathname:()=>m,pages:()=>x,routeModule:()=>h,tree:()=>d});var a=t(50482),r=t(69108),l=t(62563),i=t.n(l),n=t(68300),c={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>n[e]);t.d(s,c);let d=["",{children:["admin",{children:["chat",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,21168)),"/Users/zoechang/projects/Guidee/src/app/admin/chat/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,58185)),"/Users/zoechang/projects/Guidee/src/app/admin/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,98890)),"/Users/zoechang/projects/Guidee/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,69361,23)),"next/dist/client/components/not-found-error"]}],x=["/Users/zoechang/projects/Guidee/src/app/admin/chat/page.tsx"],m="/admin/chat/page",o={require:t,loadChunk:()=>Promise.resolve()},h=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/admin/chat/page",pathname:"/admin/chat",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},43755:(e,s,t)=>{Promise.resolve().then(t.bind(t,50694))},50694:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>T});var a=t(95344),r=t(3729),l=t(62455),i=t(23673),n=t(5094),c=t(46540),d=t(2690),x=t(19591),m=t(25545),o=t(35851),h=t(38852),u=t(66138),p=t(36313),g=t(7060),j=t(79200),N=t(46064),f=t(24963),v=t(28765),b=t(18822),y=t(79355),w=t(53148),E=t(15366),A=t(36135);function T(){let{t:e}=(0,l.Q)(),[s,t]=(0,r.useState)([]),[T,L]=(0,r.useState)({totalChats:0,unreadChats:0,pendingChats:0,resolvedChats:0,averageResponseTime:"0 "+e("admin.chat_management.minutes"),todayMessages:0}),[C,R]=(0,r.useState)(null),[Z,_]=(0,r.useState)(""),[P,S]=(0,r.useState)(!0),[D,G]=(0,r.useState)(""),[I,z]=(0,r.useState)("ALL"),[O,U]=(0,r.useState)("ALL");(0,r.useEffect)(()=>{(async()=>{S(!0);try{await Promise.all([M(),k()])}catch(e){}finally{S(!1)}})()},[]);let M=async()=>{try{let e=new URLSearchParams;"ALL"!==I&&e.append("status",I),"ALL"!==O&&e.append("category",O);let s=await fetch(`/api/admin/chat?${e}`);if(!s.ok)throw Error("Failed to fetch chats");let a=await s.json();a.success?(t(a.chats||[]),a.stats&&L(a.stats)):t([{id:"1",userId:"user1",userType:"USER",userName:"張小明",userAvatar:"",message:"您好，我想詢問關於台北一日遊的服務，請問有什麼推薦的行程嗎？",timestamp:"2025-01-21T10:30:00Z",status:"SENT",priority:"NORMAL",category:"GENERAL",replies:[]},{id:"2",userId:"user2",userType:"USER",userName:"李美華",userAvatar:"",message:"我昨天預訂的服務還沒有收到確認，能幫我查看一下嗎？訂單編號是 #GD2025001",timestamp:"2025-01-21T09:15:00Z",status:"READ",priority:"HIGH",category:"BOOKING",replies:[{id:"reply1",adminId:"admin1",adminName:"客服小王",message:"您好李小姐，我已經查到您的訂單，正在為您處理中，預計今天下午會有確認通知。",timestamp:"2025-01-21T09:45:00Z"}]},{id:"3",userId:"guide1",userType:"GUIDE",userName:"陳導遊",userAvatar:"",message:"管理員您好，我想申請提高服務費用，因為最近油價上漲，希望能調整價格。",timestamp:"2025-01-21T08:20:00Z",status:"REPLIED",priority:"NORMAL",category:"FEEDBACK",replies:[]},{id:"4",userId:"user4",userType:"USER",userName:"王先生",userAvatar:"",message:"我對昨天的服務不太滿意，地陪遲到了30分鐘，希望能得到合理的處理。",timestamp:"2025-01-21T07:45:00Z",status:"SENT",priority:"URGENT",category:"COMPLAINT",replies:[]},{id:"5",userId:"user5",userType:"USER",userName:"劉小姐",userAvatar:"",message:"付款後一直沒有收到收據，請幫我處理一下，謝謝！",timestamp:"2025-01-20T16:30:00Z",status:"READ",priority:"HIGH",category:"PAYMENT",replies:[]}])}catch(e){t([{id:"1",userId:"user1",userType:"USER",userName:"張小明",userAvatar:"",message:"您好，我想詢問關於台北一日遊的服務，請問有什麼推薦的行程嗎？",timestamp:"2025-01-21T10:30:00Z",status:"SENT",priority:"NORMAL",category:"GENERAL",replies:[]}])}},k=async()=>{try{L({totalChats:127,unreadChats:23,pendingChats:15,resolvedChats:89,averageResponseTime:"12 "+e("admin.chat_management.minutes"),todayMessages:34})}catch(e){}},q=async()=>{if(Z.trim()&&C)try{let e=await fetch(`/api/admin/chat/${C.id}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:Z})});if(!e.ok)throw Error("Failed to send reply");let a=await e.json();if(a.success&&a.reply){let e=s.map(e=>e.id===C.id?{...e,status:"REPLIED",replies:[...e.replies||[],a.reply]}:e);t(e),R({...C,status:"REPLIED",replies:[...C.replies||[],a.reply]}),_("")}else throw Error(a.error||"Failed to send reply")}catch(e){alert("發送回覆失敗，請重試")}},Y=e=>{t(s.map(s=>s.id===e&&"SENT"===s.status?{...s,status:"READ"}:s))},$=e=>{switch(e){case"URGENT":return"bg-red-500";case"HIGH":return"bg-orange-500";case"NORMAL":return"bg-blue-500";default:return"bg-gray-500"}},F=e=>{switch(e){case"GENERAL":return"一般詢問";case"BOOKING":return"預訂相關";case"PAYMENT":return"付款問題";case"COMPLAINT":return"客訴";case"FEEDBACK":return"建議回饋";default:return"其他"}},B=e=>{switch(e){case"SENT":return"text-red-600 bg-red-50";case"READ":return"text-orange-600 bg-orange-50";case"REPLIED":return"text-green-600 bg-green-50";default:return"text-gray-600 bg-gray-50"}},H=s.filter(e=>{let s=e.userName.toLowerCase().includes(D.toLowerCase())||e.message.toLowerCase().includes(D.toLowerCase()),t="ALL"===I||"UNREAD"===I&&"SENT"===e.status||"PENDING"===I&&"READ"===e.status||"RESOLVED"===I&&"REPLIED"===e.status,a="ALL"===O||e.category===O;return s&&t&&a});return P?a.jsx("div",{className:"flex items-center justify-center h-96",children:(0,a.jsxs)("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:e("admin.common.loading")})]})}):(0,a.jsxs)("div",{className:"space-y-8",children:[a.jsx("div",{className:"bg-gradient-to-r from-white/90 to-purple-50/50 backdrop-blur-sm rounded-2xl p-8 shadow-sm border border-slate-200/50",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[a.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-slate-900 to-purple-600 bg-clip-text text-transparent",children:e("admin.chat_management.title")}),a.jsx("p",{className:"text-slate-600 mt-3 text-lg",children:"管理用戶諮詢、投訴和支援請求"}),(0,a.jsxs)("div",{className:"flex items-center mt-4 text-sm text-slate-500",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[a.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mr-2 animate-pulse"}),a.jsx("span",{children:"即時監控中"})]}),(0,a.jsxs)("div",{className:"ml-6 flex items-center",children:[a.jsx(m.Z,{className:"w-4 h-4 mr-1"}),(0,a.jsxs)("span",{children:["平均回覆時間：",T.averageResponseTime]})]})]})]}),a.jsx("div",{className:"hidden lg:block",children:a.jsx("div",{className:"w-20 h-20 bg-gradient-to-r from-purple-500 to-pink-600 rounded-2xl flex items-center justify-center shadow-lg",children:a.jsx(o.Z,{className:"w-10 h-10 text-white"})})})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4",children:[a.jsx(i.Zb,{className:"bg-gradient-to-br from-blue-500 to-blue-600 text-white border-0 shadow-lg",children:a.jsx(i.aY,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-blue-100 text-sm",children:e("admin.chat_management.active_conversations")}),a.jsx("p",{className:"text-2xl font-bold",children:T.totalChats})]}),a.jsx(h.Z,{className:"h-8 w-8 text-blue-200"})]})})}),a.jsx(i.Zb,{className:"bg-gradient-to-br from-red-500 to-red-600 text-white border-0 shadow-lg",children:a.jsx(i.aY,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-red-100 text-sm",children:e("admin.chat_management.pending_messages")}),a.jsx("p",{className:"text-2xl font-bold",children:T.unreadChats})]}),a.jsx(u.Z,{className:"h-8 w-8 text-red-200"})]})})}),a.jsx(i.Zb,{className:"bg-gradient-to-br from-orange-500 to-orange-600 text-white border-0 shadow-lg",children:a.jsx(i.aY,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-orange-100 text-sm",children:"待處理"}),a.jsx("p",{className:"text-2xl font-bold",children:T.pendingChats})]}),a.jsx(p.Z,{className:"h-8 w-8 text-orange-200"})]})})}),a.jsx(i.Zb,{className:"bg-gradient-to-br from-green-500 to-green-600 text-white border-0 shadow-lg",children:a.jsx(i.aY,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-green-100 text-sm",children:"已解決"}),a.jsx("p",{className:"text-2xl font-bold",children:T.resolvedChats})]}),a.jsx(g.Z,{className:"h-8 w-8 text-green-200"})]})})}),a.jsx(i.Zb,{className:"bg-gradient-to-br from-purple-500 to-purple-600 text-white border-0 shadow-lg",children:a.jsx(i.aY,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-purple-100 text-sm",children:e("admin.chat_management.avg_response_time")}),a.jsx("p",{className:"text-xl font-bold",children:T.averageResponseTime})]}),a.jsx(j.Z,{className:"h-8 w-8 text-purple-200"})]})})}),a.jsx(i.Zb,{className:"bg-gradient-to-br from-indigo-500 to-indigo-600 text-white border-0 shadow-lg",children:a.jsx(i.aY,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-indigo-100 text-sm",children:"今日訊息"}),a.jsx("p",{className:"text-2xl font-bold",children:T.todayMessages})]}),a.jsx(N.Z,{className:"h-8 w-8 text-indigo-200"})]})})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[a.jsx("div",{className:"lg:col-span-1",children:(0,a.jsxs)(i.Zb,{className:"h-[800px] flex flex-col",children:[(0,a.jsxs)(i.Ol,{className:"pb-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx(i.ll,{className:"text-xl font-bold",children:"對話列表"}),(0,a.jsxs)(n.z,{size:"sm",variant:"outline",onClick:M,children:[a.jsx(f.Z,{className:"h-4 w-4 mr-2"}),"重新整理"]})]}),(0,a.jsxs)("div",{className:"space-y-3 mt-4",children:[(0,a.jsxs)("div",{className:"relative",children:[a.jsx(v.Z,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),a.jsx(c.I,{placeholder:e("admin.chat_management.search_conversations"),value:D,onChange:e=>G(e.target.value),className:"pl-10"})]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsxs)("select",{value:I,onChange:e=>z(e.target.value),className:"flex-1 p-2 border border-gray-200 rounded-lg text-sm",children:[a.jsx("option",{value:"ALL",children:e("admin.chat_management.all_status")}),a.jsx("option",{value:"UNREAD",children:"未讀"}),a.jsx("option",{value:"PENDING",children:"待處理"}),a.jsx("option",{value:"RESOLVED",children:"已解決"})]}),(0,a.jsxs)("select",{value:O,onChange:e=>U(e.target.value),className:"flex-1 p-2 border border-gray-200 rounded-lg text-sm",children:[a.jsx("option",{value:"ALL",children:"所有分類"}),a.jsx("option",{value:"GENERAL",children:"一般詢問"}),a.jsx("option",{value:"BOOKING",children:"預訂相關"}),a.jsx("option",{value:"PAYMENT",children:"付款問題"}),a.jsx("option",{value:"COMPLAINT",children:"客訴"}),a.jsx("option",{value:"FEEDBACK",children:"建議回饋"})]})]})]})]}),a.jsx(i.aY,{className:"flex-1 overflow-y-auto p-0",children:a.jsx("div",{className:"space-y-2 p-4",children:H.map(e=>(0,a.jsxs)("div",{className:`p-4 rounded-xl border cursor-pointer transition-all hover:shadow-md ${C?.id===e.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>{R(e),"SENT"===e.status&&Y(e.id)},children:[(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center",children:a.jsx(b.Z,{className:"h-5 w-5 text-white"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[a.jsx("p",{className:"text-sm font-semibold text-gray-900 truncate",children:e.userName}),a.jsx(x.Ct,{variant:"outline",className:`text-xs ${"GUIDE"===e.userType?"border-green-500 text-green-700":"border-blue-500 text-blue-700"}`,children:"GUIDE"===e.userType?"地陪":"用戶"})]}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:F(e.category)})]})]}),(0,a.jsxs)("div",{className:"flex flex-col items-end space-y-2",children:[a.jsx("div",{className:`w-3 h-3 rounded-full ${$(e.priority)}`}),a.jsx(x.Ct,{className:`text-xs ${B(e.status)}`,children:"SENT"===e.status?"未讀":"READ"===e.status?"已讀":"已回覆"})]})]}),a.jsx("p",{className:"text-sm text-gray-600 mt-3 line-clamp-2",children:e.message}),(0,a.jsxs)("div",{className:"flex items-center justify-between mt-3",children:[a.jsx("span",{className:"text-xs text-gray-400",children:new Date(e.timestamp).toLocaleString("zh-TW")}),e.replies&&e.replies.length>0&&(0,a.jsxs)("span",{className:"text-xs text-blue-600",children:[e.replies.length," 則回覆"]})]})]},e.id))})})]})}),a.jsx("div",{className:"lg:col-span-2",children:a.jsx(i.Zb,{className:"h-[800px] flex flex-col",children:C?(0,a.jsxs)(a.Fragment,{children:[a.jsx(i.Ol,{className:"border-b",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[a.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center",children:a.jsx(b.Z,{className:"h-6 w-6 text-white"})}),(0,a.jsxs)("div",{children:[a.jsx("h3",{className:"text-lg font-semibold",children:C.userName}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 mt-1",children:[a.jsx(x.Ct,{variant:"outline",className:"text-xs",children:"GUIDE"===C.userType?"地陪":"用戶"}),a.jsx(x.Ct,{className:`text-xs ${B(C.status)}`,children:"SENT"===C.status?"未讀":"READ"===C.status?"已讀":"已回覆"}),a.jsx("span",{className:`w-2 h-2 rounded-full ${$(C.priority)}`}),a.jsx("span",{className:"text-xs text-gray-500",children:F(C.category)})]})]})]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsxs)(n.z,{size:"sm",variant:"outline",children:[a.jsx(y.Z,{className:"h-4 w-4 mr-2"}),"封存"]}),(0,a.jsxs)(n.z,{size:"sm",variant:"outline",children:[a.jsx(w.Z,{className:"h-4 w-4 mr-2"}),"查看用戶"]})]})]})}),a.jsx(i.aY,{className:"flex-1 overflow-y-auto p-6",children:(0,a.jsxs)("div",{className:"space-y-6",children:[a.jsx("div",{className:"bg-gray-50 rounded-2xl p-6",children:(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[a.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center",children:a.jsx(b.Z,{className:"h-5 w-5 text-white"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[a.jsx("span",{className:"font-semibold text-gray-900",children:C.userName}),a.jsx("span",{className:"text-xs text-gray-500",children:new Date(C.timestamp).toLocaleString("zh-TW")})]}),a.jsx("p",{className:"text-gray-700 leading-relaxed",children:C.message})]})]})}),C.replies?.map(e=>a.jsx("div",{className:"bg-blue-50 rounded-2xl p-6",children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-green-500 to-blue-500 rounded-full flex items-center justify-center",children:a.jsx(E.Z,{className:"h-5 w-5 text-white"})}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[a.jsx("span",{className:"font-semibold text-gray-900",children:e.adminName}),a.jsx(x.Ct,{variant:"outline",className:"text-xs border-green-500 text-green-700",children:"管理員"}),a.jsx("span",{className:"text-xs text-gray-500",children:new Date(e.timestamp).toLocaleString("zh-TW")})]}),a.jsx("p",{className:"text-gray-700 leading-relaxed",children:e.message})]})]})},e.id))]})}),a.jsx("div",{className:"border-t p-6",children:(0,a.jsxs)("div",{className:"space-y-4",children:[a.jsx(d.g,{placeholder:e("admin.chat_management.send_message"),value:Z,onChange:e=>_(e.target.value),rows:3,className:"resize-none"}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsxs)(n.z,{size:"sm",variant:"outline",children:[a.jsx(y.Z,{className:"h-4 w-4 mr-2"}),"封存對話"]}),a.jsx(n.z,{size:"sm",variant:"outline",children:e("admin.chat_management.resolve")})]}),(0,a.jsxs)(n.z,{onClick:q,disabled:!Z.trim(),children:[a.jsx(A.Z,{className:"h-4 w-4 mr-2"}),"發送回覆"]})]})]})})]}):a.jsx("div",{className:"flex-1 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center text-gray-500",children:[a.jsx(o.Z,{className:"h-16 w-16 mx-auto mb-4 text-gray-300"}),a.jsx("h3",{className:"text-lg font-medium mb-2",children:"選擇一個對話"}),a.jsx("p",{className:"text-sm",children:"從左側選擇對話開始管理客戶服務"})]})})})})]})]})}},21168:(e,s,t)=>{"use strict";t.r(s),t.d(s,{$$typeof:()=>l,__esModule:()=>r,default:()=>i});let a=(0,t(86843).createProxy)(String.raw`/Users/zoechang/projects/Guidee/src/app/admin/chat/page.tsx`),{__esModule:r,$$typeof:l}=a,i=a.default}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),a=s.X(0,[1216,8039,4471,7585],()=>t(80995));module.exports=a})();