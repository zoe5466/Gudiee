"use strict";(()=>{var e={};e.id=8508,e.ids=[8508],e.modules={53524:e=>{e.exports=require("@prisma/client")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25975:(e,r,i)=>{i.r(r),i.d(r,{headerHooks:()=>p,originalPathname:()=>f,patchFetch:()=>h,requestAsyncStorage:()=>l,routeModule:()=>d,serverHooks:()=>v,staticGenerationAsyncStorage:()=>g,staticGenerationBailout:()=>m});var t={};i.r(t),i.d(t,{GET:()=>c});var s=i(95419),o=i(69108),n=i(99678),a=i(34490),u=i(59413);async function c(e,{params:r}){try{let e=r.id,i=await a._.user.findUnique({where:{id:e,role:"GUIDE",isEmailVerified:!0},include:{userProfile:!0,guidedServices:{where:{status:"ACTIVE"},include:{category:!0,reviews:{where:{status:"APPROVED"},select:{rating:!0}},_count:{select:{bookings:!0,reviews:!0}}},orderBy:{createdAt:"desc"}},reviewsAsGuide:{where:{status:"APPROVED"},include:{reviewer:{select:{id:!0,name:!0,avatar:!0}},service:{select:{id:!0,title:!0}}},orderBy:{createdAt:"desc"},take:10},_count:{select:{guidedServices:!0,reviewsAsGuide:!0,bookingsAsGuide:!0}}}});if(!i)return(0,u.VR)("找不到嚮導",404);let t=i.reviewsAsGuide.map(e=>e.rating),s=t.length>0?t.reduce((e,r)=>e+r,0)/t.length:0,o=[1,2,3,4,5].reduce((e,r)=>(e[r]=t.filter(e=>e===r).length,e),{}),n=i._count.bookingsAsGuide,c=i.guidedServices.reduce((e,r)=>e+Number(r.price)*(r._count?.bookings||0),0),d=i.guidedServices.map(e=>{let r=e.reviews.map(e=>e.rating),i=r.length>0?r.reduce((e,r)=>e+r,0)/r.length:0,{reviews:t,...s}=e;return{...s,averageRating:Number(i.toFixed(1)),totalReviews:e._count.reviews,totalBookings:e._count.bookings}}),l=i.createdAt;i.userProfile?.experienceYears&&i.userProfile.experienceYears;let g=i.userProfile?.languages||[],v=i.userProfile?.specialties||[],p={email:i.isEmailVerified,phone:!!i.phone,identity:i.isKycVerified,profile:!!i.userProfile?.bio},m={id:i.id,name:i.name,avatar:i.avatar,bio:i.userProfile?.bio,location:i.userProfile?.location,languages:g,specialties:v,experienceYears:i.userProfile?.experienceYears,certifications:i.userProfile?.certifications||[],socialLinks:i.userProfile?.socialLinks||{},memberSince:l,verifications:p,stats:{averageRating:Number(s.toFixed(1)),totalReviews:i._count.reviewsAsGuide,totalBookings:n,totalEarnings:c,monthlyBookings:Math.floor(.15*n),monthlyEarnings:Math.floor(.15*c),activeServices:i._count.guidedServices,responseRate:95+Math.floor(5*Math.random()),responseTime:Math.floor(4*Math.random())+1},ratingDistribution:o,services:d,recentReviews:i.reviewsAsGuide.map(e=>({id:e.id,rating:e.rating,comment:e.comment,createdAt:e.createdAt,isAnonymous:e.isAnonymous,reviewer:e.isAnonymous?null:e.reviewer,service:e.service}))};return(0,u.Xj)(m)}catch(e){return(0,u.VR)("取得嚮導資料失敗",500)}}let d=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/guides/[id]/route",pathname:"/api/guides/[id]",filename:"route",bundlePath:"app/api/guides/[id]/route"},resolvedPagePath:"/Users/zoechang/projects/Guidee/src/app/api/guides/[id]/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:l,staticGenerationAsyncStorage:g,serverHooks:v,headerHooks:p,staticGenerationBailout:m}=d,f="/api/guides/[id]/route";function h(){return(0,n.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:g})}},59413:(e,r,i)=>{i.d(r,{VR:()=>o,Xj:()=>s,aX:()=>a,m:()=>n,ql:()=>c,sm:()=>u});var t=i(78070);function s(e,r,i){return t.Z.json({success:!0,data:e,message:r,pagination:i})}function o(e,r=400){return t.Z.json({success:!1,error:e},{status:r})}function n(){return t.Z.json({success:!1,error:"未經授權的請求"},{status:401})}function a(e="資源"){return t.Z.json({success:!1,error:`${e}不存在`},{status:404})}function u(e){return t.Z.json({success:!1,error:"驗證失敗",data:e},{status:422})}function c(e,r,i,t){return{success:r,data:r?e:void 0,error:r?void 0:i,message:r?i:void 0}}},34490:(e,r,i)=>{i.d(r,{_:()=>s});var t=i(53524);let s=globalThis.prisma??new t.PrismaClient({log:["query"]})}};var r=require("../../../../webpack-runtime.js");r.C(e);var i=e=>r(r.s=e),t=r.X(0,[1216],()=>i(25975));module.exports=t})();