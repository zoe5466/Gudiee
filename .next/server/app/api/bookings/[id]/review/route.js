"use strict";(()=>{var e={};e.id=1447,e.ids=[1447],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},12781:e=>{e.exports=require("stream")},73837:e=>{e.exports=require("util")},34394:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>f,originalPathname:()=>w,patchFetch:()=>j,requestAsyncStorage:()=>g,routeModule:()=>l,serverHooks:()=>v,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>h});var i={};t.r(i),t.d(i,{POST:()=>p});var s=t(95419),o=t(69108),a=t(99678),n=t(78070),u=t(46082),d=t.n(u);let c=[{id:"1",serviceId:"1",guideId:"guide-1",travelerId:"1",status:"confirmed",details:{serviceId:"1",guideId:"guide-1",date:new Date("2024-02-01"),time:"10:00",guests:2,duration:4,specialRequests:"希望能介紹更多歷史背景",contactInfo:{name:"測試用戶",email:"user@guidee.com",phone:"0912345678"}},pricing:{basePrice:3200,serviceFee:320,total:3520,currency:"TWD"},payment:{method:"credit_card",status:"completed",transactionId:"tx_123456789"},createdAt:"2024-01-15T10:00:00.000Z",updatedAt:"2024-01-15T10:30:00.000Z"}];async function p(e,{params:r}){try{let t=function(e){try{let r=e.headers.get("authorization");if(!r?.startsWith("Bearer "))return null;let t=r.substring(7);return d().verify(t,process.env.JWT_SECRET||"fallback-secret")}catch{return null}}(e);if(!t)return n.Z.json({error:"未授權訪問"},{status:401});let i=r.id,{rating:s,comment:o}=await e.json();if(!s||s<1||s>5)return n.Z.json({error:"評分必須在 1-5 之間"},{status:400});if(!o||0===o.trim().length)return n.Z.json({error:"請提供評價內容"},{status:400});let a=c.find(e=>e.id===i);if(!a)return n.Z.json({error:"找不到預訂"},{status:404});if(a.travelerId!==t.userId)return n.Z.json({error:"只有預訂者可以提交評價"},{status:403});if("completed"!==a.status)return n.Z.json({error:"只能評價已完成的預訂"},{status:400});if(a.review)return n.Z.json({error:"您已經對此預訂進行過評價"},{status:400});return a.review={rating:Number(s),comment:o.trim(),createdAt:new Date().toISOString()},a.updatedAt=new Date().toISOString(),n.Z.json({message:"評價提交成功",review:a.review})}catch(e){return n.Z.json({error:"服務器錯誤"},{status:500})}}let l=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/bookings/[id]/review/route",pathname:"/api/bookings/[id]/review",filename:"route",bundlePath:"app/api/bookings/[id]/review/route"},resolvedPagePath:"/Users/zoechang/projects/Guidee/src/app/api/bookings/[id]/review/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:g,staticGenerationAsyncStorage:m,serverHooks:v,headerHooks:f,staticGenerationBailout:h}=l,w="/api/bookings/[id]/review/route";function j(){return(0,a.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:m})}}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),i=r.X(0,[1216],()=>t(34394));module.exports=i})();