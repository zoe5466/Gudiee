"use strict";(()=>{var e={};e.id=9602,e.ids=[9602],e.modules={53524:e=>{e.exports=require("@prisma/client")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},60586:(e,t,a)=>{a.r(t),a.d(t,{headerHooks:()=>h,originalPathname:()=>k,patchFetch:()=>y,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>g,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>v});var s={};a.r(s),a.d(s,{GET:()=>d});var r=a(95419),n=a(69108),o=a(99678),i=a(78070),u=a(34490),c=a(59413);async function d(e){try{let t=new URL(e.url),a=parseInt(t.searchParams.get("page")||"1"),s=parseInt(t.searchParams.get("limit")||"20"),r=t.searchParams.get("status");t.searchParams.get("paymentStatus");let n=t.searchParams.get("startDate"),o=t.searchParams.get("endDate"),c={};r&&"all"!==r&&(c.status=r.toUpperCase()),n&&o&&(c.bookingDate={gte:new Date(n),lte:new Date(o)});let d=(await u._.booking.findMany({where:c,include:{service:{select:{id:!0,title:!0,location:!0,price:!0,durationHours:!0}},traveler:{select:{id:!0,name:!0,email:!0,phone:!0,userProfile:{select:{bio:!0,location:!0}}}},guide:{select:{id:!0,name:!0,phone:!0,userProfile:{select:{bio:!0,location:!0}}}},payments:{select:{status:!0,paymentMethod:!0,providerPaymentId:!0},orderBy:{createdAt:"desc"},take:1},reviews:{select:{id:!0,rating:!0,comment:!0},take:1}},orderBy:{createdAt:"desc"},skip:(a-1)*s,take:s})).map(e=>({id:e.id,bookingDate:e.bookingDate,guests:e.guests,totalAmount:e.totalAmount,status:e.status,createdAt:e.createdAt,notes:e.specialRequests,service:e.service,traveler:e.traveler,guide:e.guide,payment:e.payments.length>0?{status:e.payments[0].status,method:e.payments[0].paymentMethod,transactionId:e.payments[0].providerPaymentId}:null,review:e.reviews[0]||null})),l=await u._.booking.count({where:c});return i.Z.json({success:!0,bookings:d,pagination:{page:a,limit:s,total:l,totalPages:Math.ceil(l/s)}})}catch(e){return i.Z.json((0,c.ql)(null,!1,"獲取訂單列表失敗","INTERNAL_ERROR"),{status:500})}}let l=new r.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/admin/bookings/route",pathname:"/api/admin/bookings",filename:"route",bundlePath:"app/api/admin/bookings/route"},resolvedPagePath:"/Users/zoechang/projects/Guidee/src/app/api/admin/bookings/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:p,staticGenerationAsyncStorage:m,serverHooks:g,headerHooks:h,staticGenerationBailout:v}=l,k="/api/admin/bookings/route";function y(){return(0,o.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:m})}},59413:(e,t,a)=>{a.d(t,{VR:()=>n,Xj:()=>r,aX:()=>i,m:()=>o,ql:()=>c,sm:()=>u});var s=a(78070);function r(e,t,a){return s.Z.json({success:!0,data:e,message:t,pagination:a})}function n(e,t=400){return s.Z.json({success:!1,error:e},{status:t})}function o(){return s.Z.json({success:!1,error:"未經授權的請求"},{status:401})}function i(e="資源"){return s.Z.json({success:!1,error:`${e}不存在`},{status:404})}function u(e){return s.Z.json({success:!1,error:"驗證失敗",data:e},{status:422})}function c(e,t,a,s){return{success:t,data:t?e:void 0,error:t?void 0:a,message:t?a:void 0}}},34490:(e,t,a)=>{a.d(t,{_:()=>r});var s=a(53524);let r=globalThis.prisma??new s.PrismaClient({log:["query"]})}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),s=t.X(0,[1216],()=>a(60586));module.exports=s})();