"use strict";(()=>{var e={};e.id=5212,e.ids=[5212],e.modules={53524:e=>{e.exports=require("@prisma/client")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},53303:(e,t,i)=>{i.r(t),i.d(t,{headerHooks:()=>h,originalPathname:()=>y,patchFetch:()=>f,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>g,staticGenerationAsyncStorage:()=>l,staticGenerationBailout:()=>w});var a={};i.r(a),i.d(a,{GET:()=>u,POST:()=>d});var r=i(95419),s=i(69108),n=i(99678),o=i(78070);let c=new(i(53524)).PrismaClient;async function u(e){try{let e=await c.supportTicket.count({where:{status:"SENT"}}),t=await c.service.count({where:{status:"DRAFT"}}),i=await c.booking.count({where:{status:"PENDING"}}),a=[];return e>0&&a.push({id:"chat-notifications",title:`${e} 則新的客服訊息`,message:`有 ${e} 則新的客服訊息需要回覆`,type:"chat",priority:"high",timestamp:new Date().toISOString(),action:"/admin/chat",read:!1}),t>0&&a.push({id:"service-approval",title:`${t} 項服務待審核`,message:`有 ${t} 項服務需要審核`,type:"service",priority:"medium",timestamp:new Date().toISOString(),action:"/admin/services",read:!1}),i>0&&a.push({id:"booking-pending",title:`${i} 筆預訂待處理`,message:`有 ${i} 筆預訂需要確認`,type:"booking",priority:"medium",timestamp:new Date().toISOString(),action:"/admin/bookings",read:!1}),(await c.booking.findMany({where:{createdAt:{gte:new Date(Date.now()-864e5)}},include:{traveler:{include:{userProfile:!0}},service:!0},orderBy:{createdAt:"desc"},take:5})).forEach(e=>{a.push({id:`booking-${e.id}`,title:"新預訂",message:`${e.traveler.userProfile?.bio||e.traveler.name} 預訂了 ${e.service.title}`,type:"booking",priority:"low",timestamp:e.createdAt.toISOString(),action:"/admin/bookings",read:!1})}),o.Z.json({success:!0,notifications:a.slice(0,10),unreadCount:e+t+i,summary:{unreadChats:e,pendingServices:t,pendingBookings:i}})}catch(t){let e=[{id:"sample-1",title:"3 則新的客服訊息",message:"有客戶詢問服務相關問題，請及時回覆",type:"chat",priority:"high",timestamp:new Date().toISOString(),action:"/admin/chat",read:!1},{id:"sample-2",title:"2 項服務待審核",message:"有新的服務申請需要審核",type:"service",priority:"medium",timestamp:new Date(Date.now()-6e4).toISOString(),action:"/admin/services",read:!1},{id:"sample-3",title:"新用戶註冊",message:"今天有 5 個新用戶註冊",type:"user",priority:"low",timestamp:new Date(Date.now()-12e4).toISOString(),action:"/admin/users",read:!1}];return o.Z.json({success:!0,notifications:e,unreadCount:5,summary:{unreadChats:3,pendingServices:2,pendingBookings:0}})}}async function d(e){try{let{notificationId:t,markAllAsRead:i}=await e.json();if(i)return o.Z.json({success:!0,message:"所有通知已標記為已讀"});if(t)return o.Z.json({success:!0,message:"通知已標記為已讀"});return o.Z.json({success:!1,error:"無效的請求參數"},{status:400})}catch(e){return o.Z.json({success:!1,error:"Failed to update notifications"},{status:500})}}let p=new r.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/admin/notifications/route",pathname:"/api/admin/notifications",filename:"route",bundlePath:"app/api/admin/notifications/route"},resolvedPagePath:"/Users/zoechang/projects/Guidee/src/app/api/admin/notifications/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:m,staticGenerationAsyncStorage:l,serverHooks:g,headerHooks:h,staticGenerationBailout:w}=p,y="/api/admin/notifications/route";function f(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:l})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var i=e=>t(t.s=e),a=t.X(0,[1216],()=>i(53303));module.exports=a})();