"use strict";(()=>{var e={};e.id=4152,e.ids=[4152],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},12781:e=>{e.exports=require("stream")},73837:e=>{e.exports=require("util")},64876:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>y,originalPathname:()=>g,patchFetch:()=>x,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>v,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>f});var i={};r.r(i),r.d(i,{GET:()=>d});var n=r(95419),a=r(69108),s=r(99678),o=r(82002),c=r(34490),u=r(59413);async function d(e){try{let e=await (0,o.ts)();if(!e||"GUIDE"!==e.role)return(0,u.VR)("無權限訪問",403);let[t,r,i]=await Promise.all([c._.user.findMany({orderBy:{createdAt:"desc"},take:5,select:{id:!0,name:!0,email:!0,createdAt:!0,role:!0}}),c._.service.findMany({orderBy:{createdAt:"desc"},take:5,include:{guide:{select:{name:!0}}}}),c._.booking.findMany({orderBy:{createdAt:"desc"},take:5,include:{service:{select:{title:!0}},traveler:{select:{name:!0}}}})]),n=[...t.map(e=>({id:`user-${e.id}`,type:"user_registered",title:"新用戶註冊",description:`${e.name} 剛剛完成註冊`,time:e.createdAt,icon:"user",color:"blue"})),...r.map(e=>({id:`service-${e.id}`,type:"service_created",title:"新服務提交",description:`${e.title} 由 ${e.guide.name} 提交`,time:e.createdAt,icon:"service",color:"green"})),...i.map(e=>({id:`booking-${e.id}`,type:"booking_created",title:"新預訂確認",description:`${e.service.title} 被 ${e.traveler.name} 預訂`,time:e.createdAt,icon:"booking",color:"purple"}))].sort((e,t)=>new Date(t.time).getTime()-new Date(e.time).getTime()).slice(0,10);return(0,u.Xj)(n)}catch(e){return(0,u.VR)("獲取活動數據失敗",500)}}let l=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/admin/activity/route",pathname:"/api/admin/activity",filename:"route",bundlePath:"app/api/admin/activity/route"},resolvedPagePath:"/Users/zoechang/projects/Guidee/src/app/api/admin/activity/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:p,staticGenerationAsyncStorage:m,serverHooks:v,headerHooks:y,staticGenerationBailout:f}=l,g="/api/admin/activity/route";function x(){return(0,s.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:m})}},59413:(e,t,r)=>{r.d(t,{VR:()=>a,Xj:()=>n,aX:()=>o,m:()=>s,ql:()=>u,sm:()=>c});var i=r(78070);function n(e,t,r){return i.Z.json({success:!0,data:e,message:t,pagination:r})}function a(e,t=400){return i.Z.json({success:!1,error:e},{status:t})}function s(){return i.Z.json({success:!1,error:"未經授權的請求"},{status:401})}function o(e="資源"){return i.Z.json({success:!1,error:`${e}不存在`},{status:404})}function c(e){return i.Z.json({success:!1,error:"驗證失敗",data:e},{status:422})}function u(e,t,r,i){return{success:t,data:t?e:void 0,error:t?void 0:r,message:t?r:void 0}}},82002:(e,t,r)=>{r.d(t,{Gv:()=>l,RA:()=>p,c_:()=>d,ts:()=>m});var i=r(6521),n=r.n(i),a=r(46082),s=r.n(a),o=r(32455),c=r(34490);let u=process.env.JWT_SECRET||"your-fallback-secret";async function d(e){return n().hash(e,12)}async function l(e,t){return n().compare(e,t)}function p(e){let t={userId:e.id,email:e.email,role:e.role};return s().sign(t,u,{expiresIn:"7d"})}async function m(){try{let e=(0,o.cookies)(),t=e.get("auth-token")?.value;if(!t)return null;let r=function(e){try{return s().verify(e,u)}catch(e){return null}}(t);if(!r)return null;return await c._.user.findUnique({where:{id:r.userId},include:{userProfile:!0}})}catch(e){return null}}},34490:(e,t,r)=>{r.d(t,{_:()=>n});var i=r(53524);let n=globalThis.prisma??new i.PrismaClient({log:["query"]})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[1216],()=>r(64876));module.exports=i})();