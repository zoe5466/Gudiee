"use strict";exports.id=4757,exports.ids=[4757],exports.modules={16676:(e,t,r)=>{r.d(t,{W:()=>c,j:()=>h});var a=r(95344),i=r(3729),s=r(81202),o=r(30304),n=r(62312),l=r(25390),d=r(71756),u=r(62455);function c({variant:e="dropdown",showFlag:t=!0,showNativeName:r=!0,className:c=""}){let{locale:h,setLocale:m,t:f}=(0,u.Q)(),[g,p]=(0,i.useState)(!1),[b,x]=(0,i.useState)(!1),[y,w]=(0,i.useState)({top:0,left:0,width:0}),k=(0,i.useRef)(null),j=(0,i.useRef)(null);(0,i.useEffect)(()=>{x(!0)},[]),(0,i.useEffect)(()=>{let e=e=>{let t=e.target,r=j.current?.contains(t),a=document.querySelector("[data-language-dropdown]")?.contains(t);r||a||p(!1)};return g?(document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)):()=>{}},[g]);let v=()=>{if(j.current){let e=j.current.getBoundingClientRect();w({top:e.bottom+4,left:e.right-192,width:192})}},S=e=>{m(e),p(!1)},C=d.H8[h];return b?"inline"===e?a.jsx("div",{className:`flex gap-2 ${c}`,children:Object.entries(d.H8).map(([e,i])=>(0,a.jsxs)("button",{onClick:()=>S(e),style:{padding:"0.5rem 0.75rem",borderRadius:"0.375rem",border:"1px solid",borderColor:h===e?"#2563eb":"#e5e7eb",backgroundColor:h===e?"#eff6ff":"white",color:h===e?"#2563eb":"#6b7280",fontSize:"0.875rem",fontWeight:"500",cursor:"pointer",transition:"all 0.2s",display:"flex",alignItems:"center",gap:"0.5rem"},className:"hover:border-blue-300",children:[t&&a.jsx("span",{children:i.flag}),r&&a.jsx("span",{children:i.nativeName}),h===e&&a.jsx(n.Z,{style:{width:"0.875rem",height:"0.875rem"}})]},e))}):(0,a.jsxs)("div",{ref:k,style:{position:"relative"},className:c,children:[(0,a.jsxs)("button",{ref:j,onClick:()=>{g||v(),p(!g)},style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0.75rem",backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"0.5rem",fontSize:"0.875rem",fontWeight:"500",color:"#374151",cursor:"pointer",transition:"all 0.2s",minWidth:"8rem"},className:"hover:bg-gray-50 hover:border-gray-300",children:[a.jsx(o.Z,{style:{width:"1rem",height:"1rem"}}),t&&a.jsx("span",{children:C.flag}),r&&a.jsx("span",{children:C.nativeName}),a.jsx(l.Z,{style:{width:"0.875rem",height:"0.875rem",marginLeft:"auto",transform:g?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"}})]}),g&&b&&(0,s.createPortal)(a.jsx("div",{"data-language-dropdown":!0,style:{position:"fixed",top:y.top,left:y.left,width:y.width,backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"0.5rem",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1)",zIndex:1e4,overflow:"hidden"},children:Object.entries(d.H8).map(([e,r])=>(0,a.jsxs)("button",{onClick:()=>S(e),style:{width:"100%",display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem",fontSize:"0.875rem",color:h===e?"#2563eb":"#374151",backgroundColor:h===e?"#f8fafc":"transparent",border:"none",cursor:"pointer",transition:"all 0.2s",textAlign:"left"},className:"hover:bg-gray-50",children:[t&&a.jsx("span",{style:{fontSize:"1.125rem"},children:r.flag}),(0,a.jsxs)("div",{style:{flex:1},children:[a.jsx("div",{style:{fontWeight:"500"},children:r.nativeName}),a.jsx("div",{style:{fontSize:"0.75rem",color:"#9ca3af"},children:r.name})]}),h===e&&a.jsx(n.Z,{style:{width:"1rem",height:"1rem",color:"#2563eb"}})]},e))}),document.body)]}):(0,a.jsxs)("div",{className:`flex items-center gap-2 ${c}`,children:[a.jsx(o.Z,{className:"w-4 h-4 text-gray-500"}),a.jsx("span",{className:"text-sm text-gray-500",children:"Loading..."})]})}function h({className:e=""}){let{locale:t,setLocale:r}=(0,u.Q)(),[s,n]=(0,i.useState)(!1);if((0,i.useEffect)(()=>{n(!0)},[]),!s)return a.jsx("button",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"2.5rem",height:"2.5rem",backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"50%",cursor:"pointer",transition:"all 0.2s",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"},className:`hover:bg-gray-50 hover:scale-105 ${e}`,children:a.jsx(o.Z,{className:"w-4 h-4 text-gray-500"})});let l=d.H8[t].flag;return a.jsx("button",{onClick:()=>{let e=["zh-TW","en"],a=(e.indexOf(t)+1)%e.length,i=e[a];i&&r(i)},style:{display:"flex",alignItems:"center",justifyContent:"center",width:"2.5rem",height:"2.5rem",backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"50%",fontSize:"1.125rem",cursor:"pointer",transition:"all 0.2s",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"},className:`hover:bg-gray-50 hover:scale-105 ${e}`,title:`Switch to ${"zh-TW"===t?"English":"繁體中文"}`,children:l})}},11453:(e,t,r)=>{r.d(t,{cn:()=>s});var a=r(56815),i=r(79377);function s(...e){return(0,i.m6)((0,a.W)(e))}},2582:(e,t,r)=>{r.d(t,{a:()=>s});var a=r(43158),i=r(67023);let s=(0,a.Ue)()((0,i.tJ)((e,t)=>({user:null,token:null,refreshToken:null,isLoading:!1,isAuthenticated:!1,login:async(t,r)=>{e({isLoading:!0});try{let a=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:t,password:r})}),i=await a.json();if(!a.ok||!i.success)throw Error(i.error||i.message||"登入失敗");let s={id:i.data.user.id,email:i.data.user.email,name:i.data.user.name,avatar:i.data.user.avatar,role:i.data.user.role.toLowerCase(),isEmailVerified:i.data.user.isEmailVerified,isKYCVerified:i.data.user.isKycVerified,createdAt:i.data.user.createdAt,permissions:i.data.user.permissions||[],profile:{phone:i.data.user.phone,bio:i.data.user.userProfile?.bio,location:i.data.user.userProfile?.location,languages:i.data.user.userProfile?.languages,specialties:i.data.user.userProfile?.specialties}};e({user:s,token:i.data.token,refreshToken:null,isAuthenticated:!0,isLoading:!1})}catch(t){throw e({isLoading:!1}),t}},register:async t=>{e({isLoading:!0});try{await new Promise(e=>setTimeout(e,1500));let r={id:Date.now().toString(),email:t.email,name:t.name,role:t.userType||"customer",isEmailVerified:!1,isKYCVerified:!1,createdAt:new Date().toISOString(),permissions:"guide"===t.userType?["user:read","guide:manage","booking:manage"]:["user:read","booking:create"],profile:{phone:t.phone}},a="mock-jwt-token-"+Date.now();e({user:r,token:a,refreshToken:"mock-refresh-token",isAuthenticated:!0,isLoading:!1})}catch(t){throw e({isLoading:!1}),t}},logout:async()=>{try{await fetch("/api/auth/logout",{method:"POST",credentials:"include"})}catch(e){}e({user:null,token:null,refreshToken:null,isAuthenticated:!1})},updateUser:async r=>{let{user:a,token:i}=t();if(!a||!i)throw Error("未登入");e({isLoading:!0});try{let t=await fetch("/api/users/profile",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify(r)});if(!t.ok)throw Error("更新失敗");let s=await t.json();e({user:{...a,...s},isLoading:!1})}catch(t){throw e({isLoading:!1}),t}},refreshAuth:async()=>{let{refreshToken:r}=t();if(r)try{let t=await fetch("/api/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:r})});if(!t.ok)throw Error("Token 刷新失敗");let a=await t.json();e({token:a.token,refreshToken:a.refreshToken})}catch(e){t().logout()}},initializeAuth:async()=>{try{let t=await fetch("/api/auth/me",{credentials:"include"});if(t.ok){let r=await t.json();if(r.success&&r.data.user){let t={id:r.data.user.id,email:r.data.user.email,name:r.data.user.name,avatar:r.data.user.avatar,role:r.data.user.role.toLowerCase(),isEmailVerified:r.data.user.isEmailVerified,isKYCVerified:r.data.user.isKycVerified,createdAt:r.data.user.createdAt,permissions:r.data.user.permissions||[],profile:{phone:r.data.user.phone,bio:r.data.user.userProfile?.bio,location:r.data.user.userProfile?.location,languages:r.data.user.userProfile?.languages,specialties:r.data.user.userProfile?.specialties}};e({user:t,isAuthenticated:!0})}}}catch(e){}},setLoading:t=>{e({isLoading:t})},hasPermission:e=>{let{user:r}=t();return!!r&&("admin"===r.role||r.permissions?.includes(e)||!1)}}),{name:"guidee-auth",partialize:e=>({user:e.user,token:e.token,refreshToken:e.refreshToken,isAuthenticated:e.isAuthenticated})}))}};